import{c as $,r as l,aE as D,u as B,b4 as H,b2 as P,br as G,j as e,b6 as z,aN as Q,a as X,bs as I}from"./index-DtnxAUWU.js";import{T as E,C as A}from"./trash-2-D8Sb336G.js";import{T}from"./tag-CLmgH5HA.js";import{X as V}from"./x-Dc7d7zkt.js";import{Q as Y}from"./QuizCard-CTfb43kt.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],q=$("bookmark",U);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],O=$("circle-alert",K);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],F=$("external-link",W);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]],J=$("hand",Z);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],te=$("loader-circle",ee);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ae=$("message-square",se);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ne=$("refresh-cw",re);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],oe=$("search",le);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],ie=$("thumbs-down",ce);function de(t={}){const{threshold:a=100,onSwipeStart:g,onSwipeEnd:o,onSwipeProgress:y}=t,[v,h]=l.useState({direction:null,progress:0,isSwiping:!1}),r=l.useRef(0),j=l.useRef(0),p=l.useRef(0),m=l.useRef(!1),i=l.useRef(null),w=l.useCallback((s,n)=>{r.current=s,p.current=n,j.current=s,m.current=!1,h({direction:null,progress:0,isSwiping:!1}),g&&g()},[g]),u=l.useCallback((s,n)=>{if(r.current===0)return;j.current=s;const x=s-r.current,_=n-p.current;if(!m.current&&Math.abs(x)>Math.abs(_)&&Math.abs(x)>10&&(m.current=!0),m.current){const L=x>0?"right":"left",R=Math.min(Math.abs(x)/a,1);h({direction:L,progress:R,isSwiping:!0}),y&&y(R,L)}},[a,y]),N=l.useCallback(()=>{if(!m.current){r.current=0,p.current=0;return}const s=j.current-r.current,n=s>0?"right":"left",x=Math.abs(s);m.current=!1,r.current=0,p.current=0,j.current=0,h({direction:null,progress:0,isSwiping:!1}),x>=a&&o?o(n):o&&o(null)},[a,o]),k=l.useCallback(s=>{const n=s.touches[0];w(n.clientX,n.clientY)},[w]),c=l.useCallback(s=>{const n=s.touches[0];u(n.clientX,n.clientY),m.current&&s.preventDefault()},[u]),b=l.useCallback(()=>{N()},[N]),f=l.useCallback(s=>{w(s.clientX,s.clientY)},[w]),C=l.useCallback(s=>{u(s.clientX,s.clientY)},[u]),M=l.useCallback(()=>{N()},[N]),d=l.useCallback(s=>{i.current=s,s.addEventListener("touchstart",k,{passive:!0}),s.addEventListener("touchmove",c,{passive:!1}),s.addEventListener("touchend",b,{passive:!0}),s.addEventListener("mousedown",f),document.addEventListener("mousemove",C),document.addEventListener("mouseup",M)},[k,c,b,f,C,M]),S=l.useCallback(()=>{const s=i.current;s&&(s.removeEventListener("touchstart",k),s.removeEventListener("touchmove",c),s.removeEventListener("touchend",b),s.removeEventListener("mousedown",f),document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",M))},[k,c,b,f,C,M]);return l.useEffect(()=>()=>{S()},[S]),{swipeState:v,attachListeners:d,detachListeners:S}}function xe({item:t}){const{t:a}=D(),g=B(),{stashItem:o,trashItem:y,markViewed:v,startQuiz:h,isGeneratingQuiz:r}=H(),{addSnippet:j}=P(),p=l.useRef(null),[m,i]=l.useState(!1),w=l.useRef(Date.now()),{swipeState:u,attachListeners:N,detachListeners:k}=de({threshold:100,onSwipeEnd:s=>{s==="right"?b():s==="left"&&f()}});l.useEffect(()=>(p.current&&N(p.current),()=>{k()}),[N,k]),l.useEffect(()=>{if(!t.viewed){const s=setTimeout(()=>{v(t.id),c("view")},1e3);return()=>clearTimeout(s)}},[t.id,t.viewed,v]);const c=async s=>{const n=Date.now()-w.current,x=t.type==="did-you-know"?"didYouKnow":"questionAnswer";await G.saveInteraction({feedItemId:t.id,action:s,timeSpent:n,itemType:x,topics:t.topics||[],source:t.sources?.[0]||"unknown",content:t.content||""})},b=async()=>{await c("stash");let s=`**${t.title}**

`;if(t.image)try{const{imageUrlToBase64:n}=await Q(async()=>{const{imageUrlToBase64:_}=await import("./imageUtils-DosmAaVd.js");return{imageUrlToBase64:_}},[]),x=await n(t.image);s+=`![${t.title}](${x})

`,t.imageAttribution&&(s+=`*Image: ${t.imageAttribution}*

`)}catch(n){console.warn("Failed to convert image to base64, using URL:",n),s+=`![${t.title}](${t.image})

`,t.imageAttribution&&(s+=`*Image: ${t.imageAttribution}*

`)}s+=`${t.content}

`,t.expandedContent&&(s+=`## Deep Dive

${t.expandedContent}

`),t.mnemonic&&(s+=`ðŸ’¡ **Memory Aid:** ${t.mnemonic}

`),t.topics&&t.topics.length>0&&(s+=`**Topics:** ${t.topics.join(", ")}

`),t.searchTerms&&t.searchTerms.length>0&&(s+=`**Search Terms:** ${t.searchTerms.join(", ")}

`),t.sources&&t.sources.length>0&&(s+=`**Sources:**
`,t.sources.forEach((n,x)=>{s+=`${x+1}. ${n}
`})),await j(s,"tool",t.title),await o(t.id)},f=async()=>{await c("trash"),await y(t.id)},C=async()=>{await c("quiz"),await h(t.id)},M=async()=>{try{let s="";t.type==="did-you-know"?s=`Can you explain more about: "${t.content.substring(0,100)}..."? I'd like to understand this topic better.`:t.type==="qa"&&(s=`I just learned that ${t.content.split(".")[0]}. Can you expand on this topic and explain practical applications or implications?`),t.topics&&t.topics.length>0&&(s+=`

Related topics: ${t.topics.join(", ")}`),localStorage.setItem("pending_chat_query",s),localStorage.setItem("pending_chat_from_feed",t.id),localStorage.setItem("pending_chat_new_conversation","true"),g("/chat"),await c("quiz"),console.log("âœ… Navigating to chat with question:",s)}catch(s){console.error("âŒ Error generating chat question:",s)}},d=()=>{if(!u.isSwiping)return"";const{progress:s,direction:n}=u,x=s*100;return`translateX(${n==="right"?x:-x}px)`},S=()=>{if(!u.isSwiping)return"transparent";const{progress:s,direction:n}=u,x=Math.min(s*.3,.3);return n==="right"?`rgba(34, 197, 94, ${x})`:`rgba(239, 68, 68, ${x})`};return e.jsxs("div",{ref:p,className:"bg-white rounded-lg shadow-sm overflow-hidden transition-all hover:shadow-md cursor-pointer relative",style:{transform:d(),backgroundColor:S(),transition:u.isSwiping?"none":"all 0.2s ease",display:"block",visibility:"visible",minHeight:"100px"},children:[u.isSwiping&&e.jsxs(e.Fragment,{children:[u.direction==="right"&&e.jsxs("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-green-600 flex items-center gap-2",children:[e.jsx(q,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:a("feed.stash")})]}),u.direction==="left"&&e.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-red-600 flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:a("feed.trash")}),e.jsx(E,{className:"h-6 w-6"})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${t.type==="did-you-know"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:t.type==="did-you-know"?a("feed.didYouKnow"):a("feed.questionAnswer")}),t.stashed&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-700",children:a("feed.stashed")})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:t.title}),t.image&&e.jsxs("div",{className:"mb-3 rounded-lg overflow-hidden",children:[e.jsx("img",{src:t.image,alt:t.title,className:"w-full h-48 object-cover"}),t.imageAttribution&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 bg-gray-50 p-2 rounded",dangerouslySetInnerHTML:{__html:t.imageAttributionHtml||t.imageAttribution}})]}),e.jsxs("div",{onClick:()=>i(!0),className:"cursor-pointer",children:[e.jsx("p",{className:"text-gray-700 mb-3 line-clamp-3",children:t.content}),t.mnemonic&&e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-3 mb-3 rounded",children:e.jsxs("p",{className:"text-sm font-medium text-purple-900",children:["ðŸ’¡ ",t.mnemonic]})}),t.expandedContent&&e.jsx("p",{className:"text-xs text-blue-600 hover:text-blue-700 font-medium mb-3",children:"Click to read more..."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:(()=>{try{const s=new Date(t.createdAt);return isNaN(s.getTime())?"Recently":s.toLocaleDateString()}catch{return"Recently"}})()})]}),t.topics.length>0&&e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{className:"text-gray-700",children:t.topics.slice(0,3).join(", ")})]})]}),t.sources.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-1 font-semibold",children:[a("feed.sources"),":"]}),e.jsx("div",{className:"space-y-1",children:t.sources.slice(0,2).map((s,n)=>e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(F,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:s})]},n))})]}),t.topics&&t.topics.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 font-semibold inline",children:"Search: "}),t.topics.map((s,n)=>e.jsxs("span",{children:[e.jsx("a",{href:`https://www.google.com/search?q=${encodeURIComponent(s)}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-700 hover:underline",title:`Search Google for "${s}"`,children:s}),n<(t.topics?.length||0)-1&&e.jsx("span",{className:"text-xs text-gray-500",children:", "})]},n))]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mt-4",children:[e.jsxs("button",{onClick:async s=>{s.stopPropagation(),await f(),await c("trash")},className:`flex flex-col items-center justify-center p-3 rounded-lg transition-colors ${t.trashed?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-gray-100 hover:bg-red-50 text-gray-700 hover:text-red-600 dark:bg-gray-800 dark:hover:bg-red-900/20 dark:text-gray-300 dark:hover:text-red-400"}`,title:"Downvote - Filter from future feeds",disabled:t.trashed,children:[e.jsx(ie,{className:"h-6 w-6 mb-1"}),e.jsx("span",{className:"text-xs font-medium",children:"Downvote"})]}),e.jsxs("button",{onClick:async s=>{s.stopPropagation(),await b(),await c("stash")},className:`flex flex-col items-center justify-center p-3 rounded-lg transition-colors ${t.stashed?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":"bg-gray-100 hover:bg-blue-50 text-gray-700 hover:text-blue-600 dark:bg-gray-800 dark:hover:bg-blue-900/20 dark:text-gray-300 dark:hover:text-blue-400"}`,title:"Save to Swag",disabled:t.stashed,children:[e.jsx(J,{className:"h-6 w-6 mb-1"}),e.jsx("span",{className:"text-xs font-medium",children:"Save"})]}),e.jsx("button",{onClick:async s=>{s.stopPropagation(),await C(),await c("quiz")},disabled:r,className:`flex flex-col items-center justify-center p-3 rounded-lg transition-colors ${r?"bg-purple-100 text-purple-500 cursor-not-allowed dark:bg-purple-900/30 dark:text-purple-400":"bg-gray-100 hover:bg-purple-50 text-gray-700 hover:text-purple-600 dark:bg-gray-800 dark:hover:bg-purple-900/20 dark:text-gray-300 dark:hover:text-purple-400"}`,title:"Generate Quiz",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 mb-1",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-xs font-medium",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-6 w-6 mb-1"}),e.jsx("span",{className:"text-xs font-medium",children:"Quiz"})]})}),e.jsxs("button",{onClick:async s=>{s.stopPropagation(),await M()},className:"flex flex-col items-center justify-center p-3 bg-gray-100 hover:bg-green-50 text-gray-700 hover:text-green-600 dark:bg-gray-800 dark:hover:bg-green-900/20 dark:text-gray-300 dark:hover:text-green-400 rounded-lg transition-colors",title:"Chat - Explore this topic deeper",children:[e.jsx(ae,{className:"h-6 w-6 mb-1"}),e.jsx("span",{className:"text-xs font-medium",children:"Chat"})]})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>i(!1),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${t.type==="did-you-know"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:t.type==="did-you-know"?a("feed.didYouKnow"):a("feed.questionAnswer")}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mt-2",children:t.title})]}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close",children:e.jsx(V,{className:"h-6 w-6 text-gray-500"})})]}),e.jsxs("div",{className:"p-6",children:[t.image&&e.jsxs("div",{className:"mb-4 rounded-lg overflow-hidden",children:[e.jsx("img",{src:t.image,alt:t.title,className:"w-full h-64 object-cover"}),t.imageAttribution&&e.jsx("div",{className:"text-xs text-gray-500 mt-2 bg-gray-50 p-2 rounded",dangerouslySetInnerHTML:{__html:t.imageAttributionHtml||t.imageAttribution}})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Summary"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:t.content})]}),t.mnemonic&&e.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-4 mb-4 rounded",children:[e.jsxs("p",{className:"text-sm font-medium text-purple-900 mb-2",children:["ðŸ’¡ ",t.mnemonic]}),t.topics.length>0&&e.jsxs("a",{href:`https://www.google.com/search?q=${encodeURIComponent(t.topics.join(" "))}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700 hover:underline",children:[e.jsx(oe,{className:"h-3 w-3"}),"Search more about this"]})]}),t.expandedContent&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ðŸ“– Deep Dive"}),e.jsx("div",{className:"text-gray-700 leading-relaxed space-y-3 whitespace-pre-line",children:t.expandedContent})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-gray-500 mb-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:(()=>{try{const s=new Date(t.createdAt);return isNaN(s.getTime())?"Recently":s.toLocaleDateString()}catch{return"Recently"}})()})]}),t.topics.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:t.topics.slice(0,3).join(", ")})]})]}),t.sources.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4 mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2 font-semibold",children:[a("feed.sources"),":"]}),e.jsx("div",{className:"space-y-2",children:t.sources.map((s,n)=>e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:s})]},n))})]}),t.topics&&t.topics.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("p",{className:"text-sm text-gray-700 font-semibold inline",children:"Search: "}),t.topics.map((s,n)=>e.jsxs("span",{children:[e.jsx("a",{href:`https://www.google.com/search?q=${encodeURIComponent(s)}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 hover:underline",title:`Search Google for "${s}"`,children:s}),n<(t.topics?.length||0)-1&&e.jsx("span",{className:"text-sm text-gray-500",children:", "})]},n))]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 p-4 flex gap-3",children:[e.jsxs("button",{onClick:async()=>{await b(),i(!1)},className:`flex-1 px-4 py-3 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors ${t.stashed?"bg-green-100 text-green-700":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[e.jsx(q,{className:"h-5 w-5"}),t.stashed?a("feed.stashed"):a("feed.stash")]}),e.jsx("button",{onClick:async()=>{await C(),i(!1)},disabled:r,className:`flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium text-sm flex items-center justify-center gap-2 ${r?"opacity-50 cursor-not-allowed":""}`,children:r?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a("quiz.generating")]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-5 w-5"}),a("feed.quiz")]})}),e.jsx("button",{onClick:async()=>{await f(),i(!1)},className:"px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium text-sm flex items-center justify-center gap-2",children:e.jsx(E,{className:"h-5 w-5"})})]})]})})]})}function he(t){return{title:t.title,questions:t.questions.map(a=>({id:a.id,prompt:a.prompt,choices:a.choices,answerId:a.correctChoiceId,explanation:a.explanation}))}}function ue({quiz:t,onClose:a}){const g=he(t);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"w-full max-w-2xl",children:e.jsx(Y,{quiz:g,onClose:a,onComplete:(o,y)=>{console.log(`Feed quiz completed: ${o}/${y}`)}})})})}function ge({availableTags:t,selectedTags:a,onChange:g,placeholder:o="Select tags...",className:y=""}){const v=r=>{a.includes(r)?g(a.filter(j=>j!==r)):g([...a,r])},h=()=>{g([])};return e.jsxs("div",{className:`space-y-2 ${y}`,children:[a.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-md",children:[a.map(r=>e.jsxs("button",{onClick:()=>v(r),className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded-full hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors",children:[r,e.jsx(V,{className:"w-3 h-3"})]},r)),e.jsx("button",{onClick:h,className:"px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 underline",children:"Clear all"})]}),e.jsx("div",{className:"relative",children:e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer list-none px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a.length===0?o:`${a.length} tag(s) selected`})}),e.jsx("div",{className:"absolute z-10 mt-1 w-full max-h-60 overflow-auto bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg",children:t.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:"No tags available"}):e.jsx("div",{className:"py-1",children:t.map(r=>e.jsx("button",{onClick:()=>v(r),className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${a.includes(r)?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:r}),a.includes(r)&&e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]})},r))})})]})})]})}function je(){const{t}=D(),{isAuthenticated:a}=X(),{getAllTags:g}=P(),{items:o,generationBatches:y,currentQuiz:v,isLoading:h,isGenerating:r,generationStatus:j,error:p,selectedTags:m,generateMore:i,refresh:w,closeQuiz:u,updateSelectedTags:N}=H(),k=l.useRef(null),c=l.useRef(null),b=l.useRef(null);l.useEffect(()=>{console.log("ðŸŽ¯ FeedPage: items changed:",o.length,"items"),console.log("ðŸŽ¯ Item titles:",o.map(d=>d.title)),console.log("ðŸŽ¯ Item IDs:",o.map(d=>d.id))},[o]),l.useEffect(()=>{if(!(!b.current||!a))return c.current&&c.current.disconnect(),c.current=new IntersectionObserver(d=>{const[S]=d;S.isIntersecting&&!h&&!r&&(console.log("ðŸ“œ Infinite scroll triggered"),i())},{root:null,rootMargin:"200px",threshold:.1}),c.current.observe(b.current),()=>{c.current&&c.current.disconnect()}},[a]);const f=l.useRef(!1);l.useEffect(()=>{console.log("ðŸŽ¬ Initial load effect triggered:",{isAuthenticated:a,itemsLength:o.length,initialLoadAttempted:f.current,isLoading:h,isGenerating:r}),a&&o.length===0&&!f.current&&!h&&(console.log("ðŸŽ¬ Initial load: starting feed generation"),f.current=!0,i())},[a,o.length,h]);const C=l.useCallback(async()=>{await w(),await i()},[w,i]),M=l.useCallback(async()=>{console.log("ðŸ“± Generate Feed button clicked"),console.log("ðŸ” generateMore function exists:",!!i),console.log("ðŸ” generateMore type:",typeof i);try{console.log("ðŸš€ About to call generateMore()..."),await i(),console.log("âœ… generateMore() completed")}catch(d){console.error("âŒ Generate failed:",d)}},[i]);return console.log("ðŸŽ¨ FeedPage render:",{isAuthenticated:a,isLoading:h,isGenerating:r,itemsCount:o.length,hasError:!!p}),a?e.jsxs("div",{ref:k,className:"bg-gray-50 pb-20",style:{minHeight:"100vh"},children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-6 w-6 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t("feed.title")})]}),e.jsx("button",{onClick:C,disabled:h||r,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:t("feed.refresh"),children:e.jsx(ne,{className:`h-5 w-5 text-gray-600 ${h||r?"animate-spin":""}`})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Filter by Swag Tags"}),e.jsx(ge,{availableTags:g(),selectedTags:m,onChange:N,placeholder:"All tags (no filter)"}),m.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Feed will use only Swag content tagged with: ",e.jsx("span",{className:"font-medium",children:m.join(", ")})]})]})]})}),p&&e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(O,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-900 mb-1",children:t("errors.error")}),e.jsx("p",{className:"text-sm text-red-700",children:p})]})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[o.map((d,S)=>{console.log(`ðŸŽ´ Rendering FeedItemCard ${S+1}/${o.length}:`,d.id,d.title);const s=y.find(n=>n.itemIds.includes(d.id)&&n.itemIds[n.itemIds.length-1]===d.id);return e.jsxs("div",{children:[e.jsx(xe,{item:d}),s&&e.jsx("div",{className:"flex items-center justify-center py-2 my-4",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 border border-green-200 dark:border-green-700 rounded-full shadow-sm",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-300",children:["âœ¨ Generated ",s.itemCount," items"]}),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:"â€¢"}),e.jsxs("span",{className:"text-xs font-semibold text-green-600 dark:text-green-400",children:["ðŸ’° $",s.cost.toFixed(6)]}),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:new Date(s.timestamp).toLocaleTimeString()})]})})]},d.id)}),o.length===0&&!h&&!r&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(I,{className:"mx-auto h-16 w-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t("feed.noItems")}),e.jsxs("p",{className:"text-gray-600 mb-6",children:[t("feed.emptyMessage"),e.jsx("br",{}),t("feed.emptySubMessage")]}),e.jsx("button",{onClick:M,disabled:r,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:t(r?"feed.generating":"feed.generateFeed")})]}),(h||r)&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 gap-3",children:[e.jsx(te,{className:"h-8 w-8 text-blue-500 animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-900 font-medium",children:t(r?"feed.generating":"common.loading")}),j&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 animate-pulse",children:j})]})]}),o.length>2&&e.jsxs("div",{className:"text-center py-4 text-gray-500 text-sm",children:["â†“ Scroll down to see more items (",o.length," total) â†“"]}),e.jsx("div",{ref:b,className:"h-4"})]}),v&&e.jsx(ue,{quiz:v,onClose:u})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md text-center",children:[e.jsx(I,{className:"mx-auto h-12 w-12 text-blue-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:t("feed.title")}),e.jsx("p",{className:"text-gray-600 mb-4",children:t("feed.emptyMessage")}),e.jsx("p",{className:"text-sm text-gray-500",children:t("common.pleaseSignIn")})]})})}export{je as default};

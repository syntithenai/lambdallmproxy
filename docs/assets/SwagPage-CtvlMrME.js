const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/localEmbeddings-D9Rjvy7I.js","assets/index-BJ_WKHd_.js","assets/index-FSMZBHdf.css"])))=>i.map(i=>d[i]);
import{r as n,j as e,bl as Yt,e as $t,u as es,bm as ts,a as ss,bn as rs,m as as,d as ns,bo as os,bp as Re,b3 as ls,g as is,M as ds,bq as cs,br as gs,bs as St,bt as Ct,q as je,bu as Dt,bv as hs,bw as us,bx as ms,aS as xs,Q as ps,by as bs,bz as fs,bA as ys,bB as ks,bC as vs}from"./index-BJ_WKHd_.js";import{T as ct,a as ws}from"./TagAutocomplete-C420LHBA.js";import{s as js}from"./quizSync-Bwxxk9nX.js";const Ns=({allTags:N,selectedTags:u,onAdd:l,placeholder:i="Add tag...",className:g=""})=>{const[v,p]=n.useState(""),[S,C]=n.useState(!1),[h,z]=n.useState(0),w=n.useRef(null);n.useEffect(()=>{function j(A){w.current&&!w.current.contains(A.target)&&C(!1)}return S&&document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[S]);const B=N.filter(j=>j.toLowerCase().includes(v.toLowerCase())&&!u.includes(j)).slice(0,8);function ae(j){l(j),p(""),C(!1),z(0)}return e.jsxs("div",{className:`relative ${g}`,ref:w,children:[e.jsx("input",{type:"text",value:v,onChange:j=>{p(j.target.value),C(!0),z(0)},onFocus:()=>C(!0),onKeyDown:j=>{S&&(j.key==="ArrowDown"?(z(A=>Math.min(A+1,B.length-1)),j.preventDefault()):j.key==="ArrowUp"?(z(A=>Math.max(A-1,0)),j.preventDefault()):j.key==="Enter"&&B[h]&&ae(B[h]))},placeholder:i,className:"w-full px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white","aria-label":"Add tag to filter"}),S&&B.length>0&&e.jsx("div",{className:"absolute z-10 left-0 right-0 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded shadow-lg mt-1 max-h-48 overflow-auto",children:B.map((j,A)=>e.jsx("div",{className:`px-3 py-2 text-sm cursor-pointer ${A===h?"bg-blue-100 dark:bg-blue-900":""}`,onMouseDown:()=>ae(j),onMouseEnter:()=>z(A),children:j},j))})]})},Ss=({isOpen:N,title:u,message:l,confirmLabel:i="Confirm",cancelLabel:g="Cancel",onConfirm:v,onCancel:p,variant:S="warning"})=>{const C=Yt(N,p);if(n.useEffect(()=>{if(!N)return;const z=w=>{w.key==="Enter"?(w.preventDefault(),v()):w.key==="Escape"&&(w.preventDefault(),p())};return document.addEventListener("keydown",z),()=>document.removeEventListener("keydown",z)},[N,v,p]),!N)return null;const h={danger:"bg-red-600 hover:bg-red-700 focus:ring-red-500",warning:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500",info:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{ref:C,className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",role:"dialog","aria-labelledby":"confirm-dialog-title","aria-describedby":"confirm-dialog-description",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{id:"confirm-dialog-title",className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:u}),e.jsx("p",{id:"confirm-dialog-description",className:"text-gray-600 dark:text-gray-400 mb-6",children:l}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-400","aria-label":g,children:g}),e.jsx("button",{onClick:v,className:`px-4 py-2 text-white rounded-lg transition-colors focus:outline-none focus:ring-2 ${h[S]}`,"aria-label":i,autoFocus:!0,children:i})]})]})})})},Cs=({isOpen:N,onClose:u,onUpload:l})=>{const[i,g]=n.useState("file"),[v,p]=n.useState(""),[S,C]=n.useState(null),[h,z]=n.useState(!1),[w,B]=n.useState(!1),[ae,j]=n.useState(0),[A,X]=n.useState(null),$=n.useRef(null),{showError:P,showSuccess:Qe}=$t();if(!N)return null;const Ne=[".pdf",".docx",".txt",".md",".html",".csv",".json",".png",".jpg",".jpeg",".gif",".webp"],q=k=>{try{const D=new URL(k);return D.protocol==="http:"||D.protocol==="https:"}catch{return!1}},_=k=>k.size/4/1e6*.02,ne=k=>{const D="."+k.name.split(".").pop()?.toLowerCase();if(!Ne.includes(D)){P(`File type ${D} not supported`);return}if(k.size>10*1024*1024){P("File size exceeds 10 MB limit");return}C(k);const Y=_(k);X(Y)},Se=k=>{const D=k.target.files?.[0];D&&ne(D)},Z=k=>{k.preventDefault(),k.stopPropagation(),z(!0)},oe=k=>{k.preventDefault(),k.stopPropagation(),z(!1)},Ve=k=>{k.preventDefault(),k.stopPropagation(),z(!1);const D=k.dataTransfer.files?.[0];D&&ne(D)},le=async()=>{if(i==="file"&&!S){P("Please select a file");return}if(i==="url"&&!v.trim()){P("Please enter a URL");return}if(i==="url"&&!q(v)){P("Invalid URL format");return}B(!0),j(0);try{const k=setInterval(()=>{j(D=>Math.min(D+10,90))},300);i==="file"&&S?await l(S):await l(v),clearInterval(k),j(100),Qe("File uploaded and processed successfully"),setTimeout(()=>{C(null),p(""),X(null),j(0),B(!1),u()},500)}catch(k){console.error("Upload error:",k),P(`Upload failed: ${k instanceof Error?k.message:"Unknown error"}`),B(!1),j(0)}},be=()=>{w||(C(null),p(""),X(null),j(0),u())};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Upload Document"}),e.jsx("button",{onClick:be,disabled:w,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 disabled:opacity-50",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>g("file"),disabled:w,className:`flex-1 px-6 py-3 font-medium ${i==="file"?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"} disabled:opacity-50`,children:"ðŸ“ Upload File"}),e.jsx("button",{onClick:()=>g("url"),disabled:w,className:`flex-1 px-6 py-3 font-medium ${i==="url"?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"} disabled:opacity-50`,children:"ðŸ”— Paste URL"})]}),e.jsxs("div",{className:"p-6",children:[i==="file"?e.jsx("div",{children:e.jsxs("div",{onDragOver:Z,onDragLeave:oe,onDrop:Ve,onClick:()=>!w&&$.current?.click(),className:`
                  border-2 border-dashed rounded-lg p-8 text-center cursor-pointer
                  transition-colors duration-200
                  ${h?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500"}
                  ${w?"opacity-50 cursor-not-allowed":""}
                `,children:[e.jsx("input",{ref:$,type:"file",accept:Ne.join(","),multiple:!0,onChange:Se,disabled:w,className:"hidden"}),e.jsx("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),S?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:S.name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(S.size/1024).toFixed(2)," KB"]})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Drag and drop a file here, or click to browse"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Supported: PDF, DOCX, TXT, MD, HTML, CSV, JSON, Images"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Max size: 10 MB"})]})]})}):e.jsx("div",{children:e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"url-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Document URL"}),e.jsx("input",{id:"url-input",type:"url",value:v,onChange:k=>p(k.target.value),disabled:w,placeholder:"https://example.com/document.pdf",className:`
                    w-full px-4 py-2 border border-gray-300 dark:border-gray-600 
                    rounded-lg focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400
                    bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                    disabled:opacity-50 disabled:cursor-not-allowed
                  `}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"The document will be fetched and processed. Original URL will be preserved as the source."})]})}),A!==null&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Estimated embedding cost:"})," $",A.toFixed(4)]}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:"This estimate is based on file size and may vary depending on actual content."})]}),w&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2",children:[e.jsx("span",{children:"Uploading and processing..."}),e.jsxs("span",{children:[ae,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 dark:bg-blue-400 h-2 rounded-full transition-all duration-300",style:{width:`${ae}%`}})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:be,disabled:w,className:`
              px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 
              rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed
            `,children:"Cancel"}),e.jsx("button",{onClick:le,disabled:w||i==="file"&&!S||i==="url"&&!v.trim(),className:`
              px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg 
              transition-colors disabled:opacity-50 disabled:cursor-not-allowed
              font-medium
            `,children:w?"Processing...":i==="file"?"Upload":"Fetch & Process"})]})]})})};function Ds(N){const u=[];let l=0;for(const i of N){const g=i.content||"";let v=0;if(g.startsWith("data:image/")){l++,u.push({id:`${i.id}-img-${l}`,url:g,name:i.title||`Image ${l}`,tags:i.tags||[],snippetId:i.id,imageIndex:0,format:gt(g)});continue}if(g.includes("<img")){const p=$s(g,i,v);u.push(...p),v+=p.length,l+=p.length}if(g.includes("![")){const p=Es(g,i,v);u.push(...p),v+=p.length,l+=p.length}}return u}function $s(N,u,l){const i=[];return new DOMParser().parseFromString(N,"text/html").querySelectorAll("img").forEach((S,C)=>{const h=S.src||S.getAttribute("src");if(!h||h.includes("placeholder")||h.length<10)return;const z=S.alt||S.getAttribute("alt")||"",w=S.width||parseInt(S.getAttribute("width")||"0"),B=S.height||parseInt(S.getAttribute("height")||"0");i.push({id:`${u.id}-html-${l+C}`,url:h,name:z||`${u.title||"Image"} - ${C+1}`,tags:u.tags||[],snippetId:u.id,imageIndex:l+C,width:w||void 0,height:B||void 0,format:gt(h)})}),i}function Es(N,u,l){const i=[],g=/!\[([^\]]*)\]\(([^)\s]+)(?:\s+"([^"]*)")?\)/g;let v,p=0;for(;(v=g.exec(N))!==null;){const S=v[1]||"",C=v[2],h=v[3]||"";!C||C.includes("placeholder")||C.length<10||(i.push({id:`${u.id}-md-${l+p}`,url:C,name:h||S||`${u.title||"Image"} - ${p+1}`,tags:u.tags||[],snippetId:u.id,imageIndex:l+p,format:gt(C)}),p++)}return i}function gt(N){if(N.startsWith("data:image/")){const l=N.match(/data:image\/([a-z]+);/);return l?l[1].toUpperCase():void 0}const u=N.match(/\.([a-z]{3,4})(?:\?|$)/i);return u?u[1].toUpperCase():void 0}function zs(N){const u=N.content||"";return!!(u.startsWith("data:image/")||u.includes("<img")||u.includes("!["))}class Ls extends n.Component{constructor(u){super(u),this.state={hasError:!1,error:null}}static getDerivedStateFromError(u){return{hasError:!0,error:u}}componentDidCatch(u,l){console.error("ErrorBoundary caught an error:",u,l),this.props.onError?.(u,l)}handleReset=()=>{this.setState({hasError:!1,error:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 max-w-md w-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 dark:text-red-400 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:this.state.error?.message||"An unexpected error occurred"}),e.jsx("button",{onClick:this.handleReset,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors",children:"Try Again"})]})})}):this.props.children}}const Ps=()=>{const N=es(),u=ts(),{showSuccess:l,showError:i,showWarning:g}=$t(),{getToken:v}=ss(),{settings:p}=rs(),{getCurrentProjectId:S}=as(),C=t=>{N("/image-editor",{state:{images:[t],editingSnippetId:D?.id}})},{snippets:h,addSnippet:z,updateSnippet:w,deleteSnippets:B,mergeSnippets:ae,toggleSelection:j,selectAll:A,selectNone:X,getSelectedSnippets:$,getAllTags:P,addTagsToSnippets:Qe,removeTagsFromSnippets:Ne,storageStats:q,getEmbeddingDetails:_,generateEmbeddings:ne}=ns(),{isAvailable:Se,isConnected:Z,castSnippet:oe,sendSnippetScrollPosition:Ve,isCastingSnippet:le}=os(),[be,k]=n.useState(()=>{try{const t=localStorage.getItem("swag-google-docs-cache");if(t)return JSON.parse(t)}catch(t){console.error("Failed to load Google Docs cache:",t)}return[]}),[D,Y]=n.useState(null),[f,fe]=n.useState(null),[ht,Oe]=n.useState(""),[ut,_e]=n.useState(""),[G,Ce]=n.useState([]),[De,Ge]=n.useState(""),[Et,We]=n.useState(!1),[zt,W]=n.useState(!1),[R,ie]=n.useState("add"),[M,U]=n.useState([]),[ye,He]=n.useState(""),[Q,Je]=n.useState(""),[L,ee]=n.useState([]),[$e,H]=n.useState(!1),[Lt,Tt]=n.useState(!1),[F,Ke]=n.useState("text"),[Ee,ze]=n.useState([]),[Xe,mt]=n.useState(!1),[Ze,Le]=n.useState(!1),[Mt,xt]=n.useState(!1),[ke,Ye]=n.useState(null),[pt,Te]=n.useState(!1),[de,ce]=n.useState(null),[et,ge]=n.useState(!1),[Ts,tt]=n.useState(0),[It,st]=n.useState(!1),[te,rt]=n.useState(null),[Ft,he]=n.useState(!1),[Me,J]=n.useState(null),[se,Ie]=n.useState(null),[at,V]=n.useState(!1),[Ms,At]=n.useState({}),[nt,Pt]=n.useState(()=>{try{const t=localStorage.getItem("swag-recent-tags");return t?JSON.parse(t):[]}catch{return[]}});n.useEffect(()=>{localStorage.setItem("swag-recent-tags",JSON.stringify(nt.slice(0,10)))},[nt]);function bt(t){Pt(s=>[t,...s.filter(r=>r!==t)].slice(0,10))}n.useEffect(()=>{const t=()=>{const a=localStorage.getItem("rag_config");if(a)try{At(JSON.parse(a))}catch(o){console.error("Failed to parse RAG config:",o)}};t();const s=a=>{a.key==="rag_config"&&t()};window.addEventListener("storage",s);const r=()=>{t()};return window.addEventListener("rag_config_updated",r),()=>{window.removeEventListener("storage",s),window.removeEventListener("rag_config_updated",r)}},[]),n.useEffect(()=>{const t=s=>{s.key==="Escape"&&et&&ge(!1)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[et]);const[ve,ot]=n.useState(null),[lt,ft]=n.useState(null);n.useEffect(()=>{const t=u.state;if(t?.editingSnippetId){const s=h.find(r=>r.id===t.editingSnippetId);s&&(Y(s),Oe(s.content),_e(s.title||""),Ce(s.tags||[])),N("/swag",{replace:!0,state:{}})}},[u.state,h,N]);const[K,ue]=n.useState({}),[me,Fe]=n.useState(new Set),[we,yt]=n.useState(()=>{const t=localStorage.getItem("swag-view-mode");return t==="grid"||t==="list"?t:"grid"}),[Ae,Bt]=n.useState(()=>{const t=localStorage.getItem("swag-sort-by");return["date-new","date-old","title-az","title-za","size"].includes(t||"")?t:"date-new"});n.useEffect(()=>{localStorage.setItem("swag-view-mode",we)},[we]),n.useEffect(()=>{localStorage.setItem("swag-sort-by",Ae)},[Ae]);const[xe,Pe]=n.useState(null),Ut=n.useRef(null),qt=n.useRef(null);n.useEffect(()=>{},[]),n.useEffect(()=>{(async()=>{if(h.length===0)return;console.log("ðŸ” Checking embedding status for",h.length,"snippets");const s={};for(const r of h)try{const a=await _(r.id);s[r.id]=a.hasEmbedding;const o=r.title||"Untitled";console.log(`  Snippet "${o.substring(0,30)}": ${a.hasEmbedding?"âœ… indexed":"âŒ not indexed"}`)}catch(a){console.error(`Failed to check embedding for snippet ${r.id}:`,a)}console.log("âœ… Embedding status loaded:",Object.keys(s).length,"snippets checked"),ue(s)})()},[h,_]),n.useEffect(()=>{f&&Z&&!le&&(console.log("Auto-casting snippet to Chromecast:",f.title),oe({id:f.id,content:f.content,title:f.title,tags:f.tags,created:new Date(f.timestamp),modified:f.updateDate?new Date(f.updateDate):new Date(f.timestamp)}))},[f,Z,le,oe]),n.useEffect(()=>{F==="vector"&&Q.trim()&&!Ze&&!Xe&&(console.log("Auto-running vector search on mode switch"),dt())},[F]),n.useEffect(()=>{const t=s=>{const r=s.target;if(r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.isContentEditable){s.key==="Escape"&&(r.blur(),F==="text"?He(""):(Je(""),ze([]),Le(!1)));return}(s.ctrlKey||s.metaKey)&&s.key==="k"&&(s.preventDefault(),qt.current?.focus()),(s.ctrlKey||s.metaKey)&&s.key==="f"&&(s.preventDefault(),Ke(a=>a==="text"?"vector":"text"),l(`Switched to ${F==="text"?"Vector":"Text"} search mode`)),s.key==="Delete"&&$().length>0&&(s.preventDefault(),re("delete")),(s.ctrlKey||s.metaKey)&&s.key==="t"&&$().length>0&&(s.preventDefault(),W(!0),ie("add"),U([])),(s.ctrlKey||s.metaKey)&&s.key==="m"&&$().length>1&&(s.preventDefault(),re("merge")),(s.ctrlKey||s.metaKey)&&s.key==="i"&&$().length>0&&(s.preventDefault(),re("generate-embeddings")),(s.ctrlKey||s.metaKey)&&s.key==="q"&&$().length>0&&(s.preventDefault(),re("generate-quiz"))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[F,ye,Q,$]);const Rt=async(t=!1)=>{if(!(Lt&&!t))try{H(!0);const s=await vs();k(s),Tt(!0);try{localStorage.setItem("swag-google-docs-cache",JSON.stringify(s))}catch(r){console.error("Failed to cache Google Docs:",r)}}catch(s){console.error("Failed to load Google Docs:",s),i("Failed to load Google Docs. Please try again.")}finally{H(!1)}},kt=async()=>{if(!De.trim()){g("Please enter a document name");return}try{H(!0);const t=await fs(De),s=[t,...be];k(s);try{localStorage.setItem("swag-google-docs-cache",JSON.stringify(s))}catch(r){console.error("Failed to update Google Docs cache:",r)}Ge(""),We(!1),l(`Document "${t.name}" created successfully in Research Agent folder!`)}catch(t){console.error("Failed to create document:",t),i("Failed to create document. Please grant permissions and try again.")}finally{H(!1)}},Qt=async t=>{const s=$();if(s.length===0){g("No snippets selected");return}try{H(!0);const r=s.map(a=>{let o="";if(a.title&&(o+=`# ${a.title}

`),Dt(a.content)){const c=ys(a.content);c!==null?o+=JSON.stringify(c,null,2):o+=a.content}else o+=a.content;return o+=`

---
Source: ${a.sourceType} | ${new Date(a.timestamp).toLocaleString()}`,o}).join(`

`);await ks(t,r),X(),l(`${s.length} snippet(s) appended to document successfully!`)}catch(r){console.error("Failed to append to document:",r),i("Failed to append to document. Please try again.")}finally{H(!1)}},re=async t=>{console.log("ï¿½ handleBulkOperation called with:",t);const s=$();if(t.startsWith("append-")){const r=t.substring(7);await Qt(r);return}switch(t){case"new-doc":We(!0);break;case"append":be.length===0&&await Rt(!0);break;case"merge":if(s.length===0){g("No snippets selected");return}if(s.length<2){g("Select at least 2 snippets to combine");return}ae(s.map(r=>r.id)),X(),l(`${s.length} snippets combined`);break;case"delete":if(s.length===0){g("No snippets selected");return}confirm(`Delete ${s.length} snippet(s)?`)&&(B(s.map(r=>r.id)),l(`${s.length} snippet(s) deleted`));break;case"generate-embeddings":console.log("ðŸ” Generate embeddings case triggered"),await vt();break;case"force-embeddings":console.log("ðŸ”„ Force re-embed case triggered"),await vt(!0);break;case"tag":if(s.length===0){g("No snippets selected");return}ie("add"),U([]),W(!0);break;case"untag":if(s.length===0){g("No snippets selected");return}ie("remove"),U([]),W(!0);break;case"tag-all":A(),setTimeout(()=>{ie("add"),U([]),W(!0)},100);break;case"untag-all":A(),setTimeout(()=>{ie("remove"),U([]),W(!0)},100);break;case"generate-quiz":if(console.log("ðŸŽ¯ Generate quiz case triggered"),s.length===0){g("No snippets selected");return}await Vt();break;default:console.warn("âš ï¸ Unknown operation:",t)}},vt=async(t=!1)=>{const s=$();if(s.length===0){g("No snippets selected");return}try{xt(!0),Ye({current:0,total:s.length});const r=await ne(s.map(o=>o.id),(o,c)=>{Ye({current:o,total:c})},t);X();const a={};for(const o of s){const c=await _(o.id);a[o.id]=c.hasEmbedding}ue(o=>({...o,...a})),r.embedded>0||r.skipped>0?l(`âœ… Added to index: ${r.embedded} â€¢ â­ï¸ Skipped: ${r.skipped}${r.failed>0?` â€¢ âŒ Failed: ${r.failed}`:""}`):g("No items were added to search index")}catch(r){console.error("Embedding error:",r),i(r instanceof Error?r.message:"Failed to add to search index")}finally{xt(!1),Ye(null)}},Vt=async()=>{const t=$();if(t.length===0){g("No snippets selected");return}try{V(!0);const s=await v();if(!s){i("Authentication required. Please sign in.");return}const r=p?.providers.filter(b=>b.enabled!==!1)||[];if(r.length===0){i("No LLM providers enabled. Please enable at least one provider in Settings.");return}const a=t.map(b=>`## ${b.title}

${b.content}`).join(`

`);if(a.trim().length===0){g("Selected snippets are empty. Please select snippets with content.");return}console.log(`ðŸŽ¯ Generating quiz from ${t.length} snippet(s), ${a.length} characters`);const o=!0,c=Date.now(),x={title:`Quiz: ${t[0].title}${t.length>1?` +${t.length-1}`:""}`,questions:[]},E=await je.saveGeneratedQuiz(x.title,t.map(b=>b.id),0,o,x);console.log("ðŸ’¾ Placeholder quiz saved to database:",E),Ie({snippetIds:t.map(b=>b.id),startTime:c,enrichment:o,quizId:E}),J(x),he(!0),await Ct(a,o,r,s,(b,d,m)=>{console.log(`âœ… Question ${d+1}/${m} received:`,b.prompt),J(T=>{if(!T)return T;const I={...T,questions:[...T.questions,b]};return je.saveGeneratedQuiz(I.title,t.map(O=>O.id),I.questions.length,o,I).catch(O=>console.error("Failed to update quiz in DB:",O)),I})},(b,d)=>{console.log(`âœ… Quiz complete: ${b} questions in ${d}ms`),l(`Quiz ready with ${b} questions!`),V(!1)},b=>{console.error("Quiz generation error:",b),i(b),V(!1),he(!1),J(null)}),console.log("ðŸŽ¯ Streaming quiz generation started")}catch(s){console.error("Quiz generation error:",s),i(s instanceof Error?s.message:"Failed to generate quiz"),V(!1)}},it=async(t,s)=>{try{H(!0);const r=t.length+s.length;let a=0;ce({current:0,total:r,status:"Starting..."});const o=50*1024*1024,c=10*1024*1024,x="http://localhost:3000",E=t.filter(d=>d.size>o);if(E.length>0){const d=E.map(m=>`${m.name} (${(m.size/1024/1024).toFixed(1)}MB)`).join(", ");i(`Files too large (max 50MB): ${d}`),H(!1),ce(null);return}const b=t.filter(d=>d.size>c&&d.size<=o);if(b.length>0){const d=b.map(m=>`${m.name} (${(m.size/1024/1024).toFixed(1)}MB)`).join(", ");g(`Large files detected - processing may be slow: ${d}`)}for(const d of t){ce({current:a,total:r,status:`Converting ${d.name}...`});try{let m;const T=d.name.split(".").pop()?.toLowerCase();if(["pdf","docx","doc","png","jpg","jpeg","gif","webp","html","htm"].includes(T||"")){const I=new FormData;I.append("file",d);const O=await v(),pe=await fetch(`${x}/convert-to-markdown`,{method:"POST",headers:{...O?{Authorization:`Bearer ${O}`}:{}},body:I});if(!pe.ok){const qe=await pe.text();throw console.error(`Conversion failed for ${d.name}:`,qe),new Error(`Server error (${pe.status}): ${qe.substring(0,100)}`)}let y=await pe.json();if(console.log(`ðŸ“¥ Received response for ${d.name}:`,{hasBody:!!y.body,bodyType:typeof y.body,hasMarkdown:!!y.markdown,hasContent:!!y.content,resultKeys:Object.keys(y),bodyPreview:typeof y.body=="string"?y.body.substring(0,200):y.body}),y.body&&typeof y.body=="string")try{console.log(`ðŸ”„ Parsing nested body JSON for ${d.name}...`),y=JSON.parse(y.body),console.log("âœ… Parsed body, keys:",Object.keys(y)),console.log("âœ… Parsed body content:",{hasMarkdown:!!y.markdown,hasContent:!!y.content,markdownType:typeof y.markdown,contentType:typeof y.content,markdownValue:y.markdown,contentValue:y.content})}catch(qe){console.error("Failed to parse response body:",qe)}if(console.log(`ðŸ“„ Final result for ${d.name}:`,{hasMarkdown:!!y.markdown,hasContent:!!y.content,markdownLength:y.markdown?.length||0,contentLength:y.content?.length||0,markdownPreview:y.markdown?y.markdown.substring(0,100):"(none)",contentPreview:y.content?y.content.substring(0,100):"(none)"}),!y.markdown&&!y.content)throw console.error("âŒ No markdown or content in result:",JSON.stringify(y,null,2)),new Error("No content returned from conversion - PDF may be empty or image-based");if(m=y.markdown||y.content,!m||m.trim().length===0)throw console.error("âŒ Markdown content is empty:",{markdownContent:m,type:typeof m,length:m?.length}),new Error("Converted content is empty - PDF may contain only images")}else m=await d.text();await z(m,"user",d.name)}catch(m){console.error(`Failed to process ${d.name}:`,m);const T=m instanceof Error?m.message:"Unknown error";g(`Could not process ${d.name}: ${T}`)}a++}for(const d of s){ce({current:a,total:r,status:`Fetching ${d}...`});try{const m=await v(),T=await fetch(`${x}/convert-to-markdown`,{method:"POST",headers:{"Content-Type":"application/json",...m?{Authorization:`Bearer ${m}`}:{}},body:JSON.stringify({url:d})});if(!T.ok)throw new Error(`Failed to fetch ${d}`);let I=await T.json();if(I.body&&typeof I.body=="string")try{I=JSON.parse(I.body)}catch(pe){console.error("Failed to parse response body:",pe)}const O=I.markdown||I.content;if(!O||O.trim().length===0)throw new Error("No content extracted from URL");await z(O,"user",d)}catch(m){console.error(`Failed to fetch ${d}:`,m),g(`Could not fetch ${d}`)}a++}ce({current:r,total:r,status:"Complete!"}),l(`Successfully added ${t.length} file(s) and ${s.length} URL(s) as snippets`),Te(!1)}catch(r){console.error("Upload error:",r),i(r instanceof Error?r.message:"Upload failed")}finally{H(!1),ce(null)}},Ot=async t=>{typeof t=="string"?await it([],[t]):await it([t],[])},_t=t=>{t.preventDefault(),t.stopPropagation(),tt(s=>s+1),t.dataTransfer.items&&t.dataTransfer.items.length>0&&ge(!0)},Gt=t=>{t.preventDefault(),t.stopPropagation(),tt(s=>{const r=s-1;return r===0&&ge(!1),r})},Wt=t=>{t.preventDefault(),t.stopPropagation()},Ht=async t=>{t.preventDefault(),t.stopPropagation(),ge(!1),tt(0);const s=Array.from(t.dataTransfer.files);s.length>0&&(console.log(`ðŸ“¦ Dropped ${s.length} file(s)`),await it(s,[]))},Jt=()=>{if(R==="filter"){ee(M),W(!1),U([]);return}const t=$();if(t.length===0||M.length===0){g("Please select tags");return}R==="add"?(Qe(t.map(s=>s.id),M),l(`Added ${M.length} tag(s) to ${t.length} snippet(s)`)):(Ne(t.map(s=>s.id),M),l(`Removed ${M.length} tag(s) from ${t.length} snippet(s)`)),W(!1),U([])},Be=t=>{Y(t),Oe(t.content),_e(t.title||""),Ce(t.tags||[])},wt=async()=>{const t=await z("","user","New Snippet");t&&Be(t)},Kt=async()=>{D&&(await w(D.id,{content:ht,title:ut.trim()||void 0,tags:G.length>0?G:void 0}),L.length>0&&(L.every(s=>G.includes(s))||g("This snippet is now hidden by current filters.")),Y(null))},dt=async()=>{if(!(!Q.trim()||F!=="vector")){mt(!0);try{let t;const s=await Re.getCachedQueryEmbedding(Q.trim());if(s)console.log("âœ… Using cached query embedding"),t=s.embedding;else{const x=p?.embeddingSource==="local";if(console.log(`Query embedding source: ${p?.embeddingSource}, useLocal=${x}`),x){console.log("ðŸ  Generating query embedding locally");const{getLocalEmbeddingService:d}=await ls(async()=>{const{getLocalEmbeddingService:I}=await import("./localEmbeddings-D9Rjvy7I.js");return{getLocalEmbeddingService:I}},__vite__mapDeps([0,1,2])),m=d(),T=p?.embeddingModel||"Xenova/all-MiniLM-L6-v2";console.log(`ðŸ“¦ Using model: ${T}`),await m.loadModel(T),t=await m.generateEmbedding(Q.trim()),console.log("âœ… Generated local query embedding")}else{console.log("ðŸ”„ Fetching query embedding from backend API");const d=await is(),m=await v();console.log("ðŸŒ Using API URL for embed-query:",d);const T=await fetch(`${d}/rag/embed-query`,{method:"POST",headers:{"Content-Type":"application/json",...m?{Authorization:`Bearer ${m}`}:{}},body:JSON.stringify({query:Q,embeddingModel:p?.embeddingModel,providers:p?.providers||[]})});if(!T.ok)throw new Error(`Backend error: ${T.status}`);t=(await T.json()).embedding}const b=JSON.parse(localStorage.getItem("rag_config")||"{}").embeddingModel||p?.embeddingModel||"text-embedding-3-small";await Re.cacheQueryEmbedding(Q.trim(),t,b),console.log("ðŸ’¾ Cached query embedding for future use")}const a=JSON.parse(localStorage.getItem("rag_config")||"{}").similarityThreshold??.3;console.log(`ðŸ” Vector search with threshold: ${a}, query: "${Q}"`);const o=await Re.getAllChunks();if(console.log(`ðŸ“Š Total chunks in IndexedDB: ${o.length}`),o.length===0){g('No embeddings found in database. Generate embeddings first using "Add to Search Index".'),ze([]),Le(!0);return}const c=await Re.vectorSearch(t,10,a);console.log("ðŸŽ¯ Vector search results:",{resultsCount:c.length,threshold:a,scores:c.map(x=>x.score.toFixed(3)),snippetIds:c.map(x=>x.snippet_id)}),ze(c),Le(!0),c.length===0?g(`No similar content found with threshold ${a}. Try lowering the threshold in RAG settings or generate more embeddings.`):l(`Found ${c.length} similar chunks (scores: ${c[0].score.toFixed(3)}-${c[c.length-1].score.toFixed(3)})`)}catch(t){console.error("Vector search error:",t),i("Failed to perform vector search. Make sure embeddings are generated.")}finally{mt(!1)}}},Xt=t=>{const r={searchTerms:[`${t.title||""} ${t.content.substring(0,200)}`.trim()],clearExisting:!0,fromSnippet:t.id};localStorage.setItem("feed_generation_request",JSON.stringify(r)),N("/feed"),l("Generating feed from snippet...")},Zt=t=>{N("/chat",{state:{systemMessage:t.content,initialQuery:"Please expand on the above content and fact-check the key claims. Provide additional context, verify the accuracy of the main points, and highlight any areas that may need further investigation or clarification.",autoSubmit:!0,clearChat:!0,fromSnippet:t.id,snippetTitle:t.title}}),l("Opening chat with snippet context...")},jt=(()=>{if(F==="vector"){if(console.log("ðŸ” Vector search mode active",{hasRunVectorSearch:Ze,vectorSearchResultsCount:Ee.length,snippetsCount:h.length}),!Ze)return console.log("â¸ï¸ No vector search run yet, showing empty"),[];if(Ee.length===0)return console.log("ðŸ“­ Vector search returned no results"),[];const t=new Map;console.log("ðŸ”„ Processing vector search results:",Ee.map(r=>({snippet_id:r.snippet_id,score:r.score,chunk_id:r.chunk_id})));for(const r of Ee){const a=h.find(c=>c.id===r.snippet_id);if(!a){console.warn("âš ï¸ Snippet not found for ID:",r.snippet_id,"Available IDs:",h.map(c=>c.id).slice(0,5));continue}if(L.length>0&&(!a.tags||a.tags.length===0||!L.every(x=>a.tags?.includes(x))))continue;const o=t.get(r.snippet_id);(!o||r.score>o.score)&&t.set(r.snippet_id,{snippet:a,score:r.score})}const s=Array.from(t.values()).map(({snippet:r,score:a})=>({...r,_searchScore:a})).sort((r,a)=>a._searchScore-r._searchScore);return console.log("âœ… Returning vector search results:",s.length,"snippets"),s}return h.filter(t=>{if(ye.trim()){const s=ye.toLowerCase(),r=t.content.toLowerCase().includes(s),a=t.title?.toLowerCase().includes(s);if(!r&&!a)return!1}return!(L.length>0&&(!t.tags||t.tags.length===0||!L.every(r=>t.tags?.includes(r))))})})(),Nt=(()=>{const t=[...jt];switch(Ae){case"date-new":return t.sort((s,r)=>(r.updateDate||r.timestamp)-(s.updateDate||s.timestamp));case"date-old":return t.sort((s,r)=>(s.updateDate||s.timestamp)-(r.updateDate||r.timestamp));case"title-az":return t.sort((s,r)=>{const a=(s.title||"").toLowerCase(),o=(r.title||"").toLowerCase();return a.localeCompare(o)});case"title-za":return t.sort((s,r)=>{const a=(s.title||"").toLowerCase();return(r.title||"").toLowerCase().localeCompare(a)});case"size":return t.sort((s,r)=>r.content.length-s.content.length);default:return t}})(),Ue=Object.values(K).filter(Boolean).length;return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50 dark:bg-gray-900 relative",onDragEnter:_t,onDragLeave:Gt,onDragOver:Wt,onDrop:Ht,children:[et&&e.jsx("div",{className:"absolute inset-0 bg-blue-500/20 backdrop-blur-sm z-40 flex items-center justify-center",onClick:()=>ge(!1),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-8 border-4 border-dashed border-blue-500 dark:border-blue-400 relative",children:[e.jsx("button",{onClick:()=>ge(!1),className:"absolute top-2 right-2 p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors",title:"Close (Esc)","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("svg",{className:"w-16 h-16 text-blue-500 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Drop Documents Here"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:"Upload files to add them as snippets"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:"Press Esc or click to cancel"})]})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-2 md:px-4 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 md:gap-4 mb-2",children:[e.jsx("div",{className:"flex items-center gap-2 md:gap-3",children:e.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Swag"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:wt,className:"p-2 md:px-3 md:py-1.5 text-sm bg-green-600 text-white rounded hover:bg-green-700 transition-colors flex items-center gap-2",title:"Create a new blank snippet","aria-label":"New Snippet",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden md:inline",children:"New Snippet"})]}),e.jsxs("button",{onClick:()=>Te(!0),className:"p-2 md:px-3 md:py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center gap-2",title:"Upload documents as snippets (auto-embeds if enabled)","aria-label":"Upload Documents",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"hidden md:inline",children:"Upload Documents"})]}),h.length>0&&e.jsxs("div",{className:"flex gap-1 bg-gray-100 dark:bg-gray-700 rounded p-1",children:[e.jsx("button",{onClick:()=>yt("grid"),className:`px-3 py-1.5 text-xs rounded transition-colors ${we==="grid"?"bg-white dark:bg-gray-800 text-blue-600 font-medium shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,title:"Grid view",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsx("button",{onClick:()=>yt("list"),className:`px-3 py-1.5 text-xs rounded transition-colors ${we==="list"?"bg-white dark:bg-gray-800 text-blue-600 font-medium shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,title:"List view",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]}),h.length>0&&e.jsxs("select",{value:Ae,onChange:t=>Bt(t.target.value),className:"px-3 py-1.5 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white",title:"Sort snippets",children:[e.jsx("option",{value:"date-new",children:"ðŸ“… Newest First"}),e.jsx("option",{value:"date-old",children:"ðŸ“… Oldest First"}),e.jsx("option",{value:"title-az",children:"ðŸ”¤ Title A-Z"}),e.jsx("option",{value:"title-za",children:"ðŸ”¤ Title Z-A"}),e.jsx("option",{value:"size",children:"ðŸ“ By Size"})]}),h.length>0&&e.jsxs("div",{className:"hidden md:flex flex-col gap-1",children:[q&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Storage:"}),e.jsx("div",{className:"w-32 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${q.percentUsed<50?"bg-green-500":q.percentUsed<80?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(q.percentUsed,100)}%`}})}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:[q.percentUsed.toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Search Index:"}),e.jsx("div",{className:"w-32 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${h.length>0?Ue/h.length*100:0}%`}})}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:[Ue,"/",h.length]})]})]}),h.length>0&&e.jsxs("details",{className:"md:hidden relative",children:[e.jsx("summary",{className:"p-2 cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200",children:e.jsx("svg",{className:"w-5 h-5 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-3 z-10 min-w-[240px]",children:[e.jsxs("a",{href:"/quiz",className:"flex items-center gap-2 px-3 py-2 mb-3 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),"Quiz"]}),q&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Storage:"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:[q.percentUsed.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${q.percentUsed<50?"bg-green-500":q.percentUsed<80?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(q.percentUsed,100)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Search Index:"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:[Ue,"/",h.length]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${h.length>0?Ue/h.length*100:0}%`}})})]})]})]})]})]}),h.length>0&&e.jsxs("div",{children:[L.length>0&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Filtering:"}),L.map(t=>e.jsxs("button",{onClick:()=>ee(L.filter(s=>s!==t)),className:"px-2 py-0.5 text-xs rounded-full bg-blue-600 text-white hover:bg-blue-700 transition-colors flex items-center gap-1",children:[t,e.jsx("span",{children:"Ã—"})]},t)),e.jsx("button",{onClick:()=>ee([]),className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Clear"})]}),e.jsxs("div",{className:"flex gap-2 items-start max-w-2xl",children:[e.jsxs("div",{className:"flex gap-1 bg-gray-100 dark:bg-gray-700 rounded p-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>{Ke("text")},className:`px-3 py-1.5 text-sm rounded transition-colors ${F==="text"?"bg-white dark:bg-gray-800 text-blue-600 font-medium shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"Text"}),e.jsx("button",{onClick:()=>{Ke("vector")},className:`px-3 py-1.5 text-sm rounded transition-colors ${F==="vector"?"bg-white dark:bg-gray-800 text-blue-600 font-medium shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,title:"Semantic search using embeddings",children:"ðŸ” Vector"})]}),e.jsxs("div",{className:"flex gap-2 items-center flex-1",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:F==="text"?ye:Q,onChange:t=>{F==="text"?He(t.target.value):Je(t.target.value)},onKeyDown:t=>{t.key==="Enter"&&F==="vector"&&dt()},placeholder:F==="vector"?"Semantic search...":"Search snippets...",className:"w-full px-3 py-1.5 pl-8 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("svg",{className:"w-4 h-4 absolute left-2.5 top-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(F==="text"?ye:Q)&&e.jsx("button",{onClick:()=>{F==="text"?He(""):(Je(""),ze([]),Le(!1))},className:"absolute right-2.5 top-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),F==="vector"&&e.jsx("button",{onClick:dt,disabled:Xe||!Q.trim(),className:"px-4 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium transition-colors flex-shrink-0",children:Xe?"Searching...":"Search"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Filter by tag:"}),e.jsx("span",{className:"hidden md:flex gap-1",children:nt.filter(t=>P().includes(t)).slice(0,5).map(t=>{const s=L.includes(t);return e.jsx("button",{onClick:()=>{ee(s?L.filter(r=>r!==t):[...L,t]),bt(t)},className:`px-3 py-1 rounded-full text-xs font-medium transition-all ${s?"bg-blue-600 text-white shadow-md hover:bg-blue-700":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,title:`${s?"Remove":"Add"} tag filter`,children:t},t)})}),e.jsx("div",{className:"flex-1 min-w-[180px] max-w-xs",children:e.jsx(Ns,{allTags:P(),selectedTags:L,onAdd:t=>{ee([...L,t]),bt(t)},placeholder:"Add tag to filter..."})}),h.length>0&&!f&&!D&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-px bg-gray-300 dark:bg-gray-600 mx-1"}),e.jsxs("button",{onClick:A,className:"px-3 py-1 text-xs rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center gap-1.5 whitespace-nowrap",title:"Select all snippets (Ctrl+A)",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),e.jsx("span",{children:"Select All"})]}),e.jsxs("button",{onClick:X,className:"px-3 py-1 text-xs rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center gap-1.5 whitespace-nowrap",title:"Deselect all snippets (Ctrl+D)",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),e.jsx("span",{children:"Select None"})]}),e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium ml-2",children:[$().length>0?`${$().length}/`:"",h.length," snippet",h.length!==1?"s":""]})]})]})]})]}),ke&&e.jsxs("div",{className:"mx-6 mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"ðŸ” Adding to Search Index..."}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[ke.current," / ",ke.total]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${ke.current/ke.total*100}%`}})}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:"This may take a moment. Embeddings enable semantic search over your snippets."})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-0 md:px-6 py-6 pb-32 min-h-0",children:h.length===0?e.jsxs("div",{className:"text-center py-16 px-4",children:[e.jsx("svg",{className:"w-20 h-20 mx-auto mb-6 text-gray-300 dark:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-3",children:"No Content Snippets Yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8 max-w-md mx-auto",children:"Start building your knowledge base by capturing content from conversations, documents, or creating new snippets."}),e.jsxs("div",{className:"flex gap-3 justify-center flex-wrap",children:[e.jsxs("button",{onClick:wt,className:"px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 shadow-md",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create New Snippet"]}),e.jsxs("button",{onClick:()=>Te(!0),className:"px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 shadow-md",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload Documents"]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"ðŸ’¡ Quick Tips"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-2 max-w-lg mx-auto text-left",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400 mt-0.5",children:"âœ“"}),e.jsxs("span",{children:["Use the ",e.jsx("strong",{children:"grab button"})," in chat to save messages as snippets"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400 mt-0.5",children:"âœ“"}),e.jsx("span",{children:"Upload documents to automatically create searchable snippets"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400 mt-0.5",children:"âœ“"}),e.jsxs("span",{children:["Add snippets to the ",e.jsx("strong",{children:"Search Index"})," for semantic search"]})]})]})]})]}):jt.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("p",{className:"text-lg",children:"No matching snippets"}),e.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your search or tag filters"})]}):we==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 md:gap-4",children:Nt.map(t=>e.jsxs("div",{className:`relative bg-white dark:bg-gray-800 rounded-lg shadow-sm border-2 transition-all ${t.selected?"border-blue-500 ring-2 ring-blue-200 dark:ring-blue-800":"border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("input",{type:"checkbox",checked:t.selected||!1,onChange:()=>j(t.id),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"})}),Se&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onClick:()=>{oe({id:t.id,content:t.content,title:t.title,tags:t.tags,created:new Date(t.timestamp),modified:t.updateDate?new Date(t.updateDate):new Date(t.timestamp)}),l(`Casting snippet to ${Z?"TV":"Chromecast"}`)},className:"p-2 text-sm bg-purple-600 text-white rounded-full hover:bg-purple-700 transition-colors shadow-md",title:"Cast to TV",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm0-4v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})})})}),e.jsxs("div",{className:"p-4 pt-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(t.timestamp).toLocaleString()}),"_searchScore"in t&&e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 font-medium",children:["ðŸŽ¯ ",t._searchScore.toFixed(3)]})]}),t.title&&e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:t.title}),e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[(t.tags||[]).map((s,r)=>e.jsxs("span",{className:"group px-2 py-0.5 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full flex items-center gap-1",children:[e.jsx("span",{className:"cursor-pointer hover:underline",onClick:a=>{a.stopPropagation(),L.includes(s)||ee([...L,s])},title:"Filter by this tag",children:s}),e.jsx("button",{onClick:async a=>{a.stopPropagation();const o=(t.tags||[]).filter(E=>E!==s);await w(t.id,{tags:o});const c=t.id,x=s;Pe({snippetId:c,tag:x,timestamp:Date.now()}),l(`Removed tag "${s}"`),setTimeout(()=>{Pe(E=>E&&E.snippetId===c&&E.tag===x?null:E)},5e3)},className:"opacity-60 hover:opacity-100 hover:text-red-600 dark:hover:text-red-400 transition-opacity",title:"Remove tag",children:"Ã—"})]},r)),e.jsx("div",{className:"inline-block",onClick:s=>s.stopPropagation(),children:e.jsx(ct,{existingTags:P(),currentTags:t.tags||[],onAddTag:async s=>{await w(t.id,{tags:[...t.tags||[],s]}),l(`Added tag "${s}"`)},placeholder:"+ tag",className:"text-xs w-20"})})]})}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 mb-3 max-h-48 overflow-hidden cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded p-2 -m-2 transition-colors",onClick:()=>fe(t),children:e.jsx("div",{className:"line-clamp-6",children:e.jsx(ds,{content:t.content,snippetId:t.id,snippetTags:t.tags||[]},`${t.id}-${t.updateDate||t.timestamp}`)})}),e.jsxs("div",{className:"flex gap-2 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),Xt(t)},className:"p-2 text-sm bg-orange-500 text-white rounded hover:bg-orange-600 transition-colors",title:"Generate feed from snippet","aria-label":"Generate feed",children:e.jsx(cs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),Zt(t)},className:"p-2 text-sm bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors",title:"Expand and fact-check in chat","aria-label":"Chat expand",children:e.jsx(gs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:async s=>{s.stopPropagation(),console.log("ðŸ§  Quiz button clicked for snippet:",t.title);try{V(!0);const r=await v();if(!r){console.error("âŒ No token available"),i("Authentication required. Please sign in."),V(!1);return}console.log("âœ… Token obtained");const a=p?.providers?.filter(b=>b.enabled!==!1)||[];a.length>0?console.log(`âœ… Using ${a.length} frontend provider(s):`,a.map(b=>b.type)):console.log("â„¹ï¸ No frontend providers - backend will use environment providers");const o=`## ${t.title}

${t.content}`;if(o.trim().length===0){g("Snippet is empty. Please add content first."),V(!1);return}console.log(`ðŸŽ¯ Generating quiz from snippet: ${t.title}`),l("Generating quiz...");const c=!0,x=Date.now(),E={title:`Quiz: ${t.title}`,questions:[]};J(E),await Ct(o,c,a,r,b=>{J(d=>d&&{...d,questions:[...d.questions,b]})},async b=>{console.log(`âœ… Quiz complete: ${b} questions`),await J(d=>(d&&d.questions.length>0&&je.saveGeneratedQuiz(d.title,[t.id],d.questions.length,c,d).then(m=>{console.log("âœ… Quiz saved with ID:",m),Ie({snippetIds:[t.id],startTime:x,enrichment:c,quizId:m})}).catch(m=>console.error("Failed to save quiz to DB:",m)),d)),l(`Quiz ready with ${b} questions!`),V(!1),he(!0)},b=>{console.error("Quiz generation error:",b),i(b),V(!1),he(!1),J(null)})}catch(r){console.error("Failed to generate quiz:",r),i("Failed to generate quiz"),V(!1)}},className:"p-2 text-sm bg-indigo-500 text-white rounded hover:bg-indigo-600 transition-colors",title:"Generate quiz from this snippet","aria-label":"Generate Quiz",children:e.jsx(St,{className:"w-5 h-5"})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),rt(t)},className:"p-2 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",title:"Share snippet","aria-label":"Share",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async s=>{s.stopPropagation(),console.log("ðŸ”˜ Embedding button clicked for snippet:",t.id),Fe(r=>new Set(r).add(t.id));try{console.log("ðŸ“Š Checking embedding status...");const r=await _(t.id),a=r.hasEmbedding;if(console.log(`ðŸ“Š Embedding status: ${a?"INDEXED":"NOT INDEXED"}`,r),ue(o=>({...o,[t.id]:a})),a){const o=`âœ… Embeddings found: ${r.chunkCount} chunk${r.chunkCount!==1?"s":""}`;l(o)}else{console.log("ðŸ”„ Starting indexing process for snippet:",t.id),l("ðŸ”„ Indexing snippet...");try{const o=await ne([t.id]);console.log("ðŸ“Š Indexing result:",o);const c=await _(t.id);console.log("ðŸ“Š Updated embedding status:",c),ue(x=>({...x,[t.id]:c.hasEmbedding})),o.embedded>0?l(`âœ… Snippet indexed: ${c.chunkCount} chunk${c.chunkCount!==1?"s":""}`):o.failed>0?i("Failed to index snippet"):(console.warn("âš ï¸ Indexing completed but no embeddings created or failed"),g("Indexing completed but status unclear"))}catch(o){console.error("âŒ Failed to index snippet:",o),i("Failed to index snippet")}}}catch(r){console.error("âŒ Failed to check embedding status:",r),i("Failed to check embedding status")}finally{console.log("âœ… Embedding check/index operation complete"),Fe(r=>{const a=new Set(r);return a.delete(t.id),a})}},className:`p-2 text-sm rounded transition-colors ${me.has(t.id)?"bg-yellow-500 text-white cursor-wait":K[t.id]===!0?"bg-green-600 text-white hover:bg-green-700":K[t.id]===!1?"bg-gray-400 text-white hover:bg-gray-500":"bg-blue-500 text-white hover:bg-blue-600"}`,title:me.has(t.id)?"Processing...":K[t.id]===!0?"Has embeddings (click for details)":K[t.id]===!1?"No embeddings (click to index)":"Check embedding status (auto-index if needed)",disabled:me.has(t.id),children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"})})}),e.jsx("button",{onClick:()=>Be(t),className:"p-2 text-sm bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"Edit snippet","aria-label":"Edit",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})]})]})]},t.id))}):e.jsx("div",{className:"space-y-2",children:Nt.map(t=>e.jsxs("div",{className:`flex items-center gap-4 p-3 bg-white dark:bg-gray-800 rounded-lg border-2 transition-all hover:shadow-md ${t.selected?"border-blue-500 ring-2 ring-blue-200 dark:ring-blue-800":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx("input",{type:"checkbox",checked:t.selected||!1,onChange:()=>j(t.id),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>fe(t),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:t.title||"Untitled"}),"_searchScore"in t&&e.jsxs("span",{className:"px-2 py-0.5 text-xs rounded-full bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 font-medium flex-shrink-0",children:["ðŸŽ¯ ",t._searchScore.toFixed(3)]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:t.content})]}),e.jsxs("div",{className:"flex gap-1 flex-wrap max-w-xs flex-shrink-0",children:[(t.tags||[]).slice(0,3).map((s,r)=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full cursor-pointer hover:bg-blue-200 dark:hover:bg-blue-800",onClick:a=>{a.stopPropagation(),L.includes(s)||ee([...L,s])},title:"Filter by this tag",children:s},r)),(t.tags||[]).length>3&&e.jsxs("span",{className:"px-2 py-0.5 text-xs text-gray-500 dark:text-gray-400",children:["+",(t.tags||[]).length-3]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:new Date(t.timestamp).toLocaleDateString()}),e.jsx("button",{onClick:async s=>{s.stopPropagation(),console.log("ðŸ”˜ Embedding button clicked (grid) for snippet:",t.id),Fe(r=>new Set(r).add(t.id));try{const r=await _(t.id),a=r.hasEmbedding;if(console.log(`ðŸ“Š Embedding status: ${a?"INDEXED":"NOT INDEXED"}`,r),ue(o=>({...o,[t.id]:a})),a){const o=`âœ… Embeddings found: ${r.chunkCount} chunk${r.chunkCount!==1?"s":""}`;l(o)}else{console.log("ðŸ”„ Starting indexing process for snippet:",t.id),l("ðŸ”„ Indexing snippet...");try{const o=await ne([t.id]);console.log("ðŸ“Š Indexing result:",o);const c=await _(t.id);console.log("ðŸ“Š Updated embedding status:",c),ue(x=>({...x,[t.id]:c.hasEmbedding})),o.embedded>0?l(`âœ… Snippet indexed: ${c.chunkCount} chunk${c.chunkCount!==1?"s":""}`):o.failed>0?i("Failed to index snippet"):(console.warn("âš ï¸ Indexing completed but no embeddings created or failed"),g("Indexing completed but status unclear"))}catch(o){console.error("âŒ Failed to index snippet:",o),i("Failed to index snippet")}}}catch(r){console.error("Failed to check embedding status:",r),i("Failed to check embedding status")}finally{console.log("âœ… Embedding check/index operation complete"),Fe(r=>{const a=new Set(r);return a.delete(t.id),a})}},className:`p-1.5 text-sm rounded transition-colors ${me.has(t.id)?"bg-yellow-500 text-white cursor-wait":K[t.id]===!0?"bg-green-500 text-white hover:bg-green-600":K[t.id]===!1?"bg-gray-400 text-white hover:bg-gray-500":"bg-blue-500 text-white hover:bg-blue-600"}`,title:me.has(t.id)?"Processing...":K[t.id]===!0?"Has embeddings (click for details)":K[t.id]===!1?"No embeddings (click to index)":"Check embedding status (auto-index if needed)",disabled:me.has(t.id),children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"})})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),rt(t)},className:"p-1.5 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors",title:"Share snippet",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}),e.jsx("button",{onClick:()=>Be(t),className:"p-1.5 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"Edit snippet",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})]},t.id))})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full h-full max-w-6xl max-h-[95vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Edit Snippet"}),e.jsx("button",{onClick:()=>Y(null),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-3xl leading-none","aria-label":"Close",children:"Ã—"})]}),e.jsxs("div",{className:"p-6 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Title (optional)"}),e.jsx("input",{type:"text",value:ut,onChange:t=>_e(t.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-lg",placeholder:"Enter a title..."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:G.map(t=>e.jsxs("span",{className:"px-3 py-1 text-sm bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full flex items-center gap-2 group",children:[t,e.jsx("button",{onClick:()=>{ot(t),st(!0)},className:"hover:text-red-600 dark:hover:text-red-400 opacity-60 group-hover:opacity-100 transition-opacity",title:"Remove tag",children:"Ã—"})]},t))}),e.jsx(ct,{existingTags:P(),currentTags:G,onAddTag:t=>{G.includes(t)||Ce([...G,t])},placeholder:"Type to add tag..."})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Content"}),e.jsx("div",{style:{height:"calc(100vh - 28rem)",overflowY:"auto"},children:e.jsx(ws,{value:ht,onChange:Oe,placeholder:"Start typing your content...",editable:!0,snippetId:D?.id,snippetTags:G,onImageEdit:C})})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3",children:[e.jsxs("button",{onClick:()=>Y(null),className:"p-2 md:px-6 md:py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors flex items-center gap-1.5",title:"Cancel","aria-label":"Cancel",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),e.jsx("span",{className:"hidden md:inline",children:"Cancel"})]}),e.jsxs("button",{onClick:Kt,className:"p-2 md:px-6 md:py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-1.5",title:"Save Changes","aria-label":"Save Changes",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"hidden md:inline",children:"Save Changes"})]})]})]})}),e.jsx(Ss,{isOpen:It,title:"Remove Tag?",message:`Remove tag "${ve}"?`,confirmLabel:"Remove Tag",cancelLabel:"Cancel",variant:"danger",onConfirm:async()=>{if(ve){if(lt){const t=h.find(s=>s.id===lt);t&&(await w(lt,{tags:(t.tags||[]).filter(s=>s!==ve)}),l(`Removed tag "${ve}"`)),ft(null)}else Ce(G.filter(t=>t!==ve));st(!1),ot(null)}},onCancel:()=>{st(!1),ot(null),ft(null)}}),Et&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Create New Google Doc"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Document Name"}),e.jsx("input",{type:"text",value:De,onChange:t=>Ge(t.target.value),onKeyPress:t=>t.key==="Enter"&&kt(),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"My Swag Document",autoFocus:!0})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{We(!1),Ge("")},className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",disabled:$e,children:"Cancel"}),e.jsx("button",{onClick:kt,disabled:$e||!De.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:$e?"Creating...":"Create"})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full h-full max-w-6xl max-h-[95vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[f.title&&e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:f.title}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(f.timestamp).toLocaleString()})})]}),e.jsx("button",{onClick:()=>fe(null),className:"ml-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-3xl leading-none","aria-label":"Close",children:"Ã—"})]}),e.jsx("div",{ref:Ut,className:"flex-1 overflow-y-auto p-6",onScroll:t=>{if(le&&Z){const s=t.currentTarget,r=s.scrollTop/(s.scrollHeight-s.clientHeight)*100;Ve(r)}},children:e.jsx("div",{className:"text-gray-800 dark:text-gray-200",children:(()=>{const t=f.content;return Dt(t)?e.jsx(hs,{content:t}):e.jsx(us,{text:t,renderAsMarkdown:!0},`${f.id}-${f.updateDate||f.timestamp}`)})()})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[Z&&le&&e.jsxs("div",{className:"text-sm text-purple-600 dark:text-purple-400 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 animate-pulse",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm0-4v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})}),"Casting to TV"]}),e.jsxs("div",{className:"flex gap-3 ml-auto",children:[Se&&e.jsx("button",{onClick:()=>{oe({id:f.id,content:f.content,title:f.title,tags:f.tags,created:new Date(f.timestamp),modified:f.updateDate?new Date(f.updateDate):new Date(f.timestamp)}),l(`Casting snippet to ${Z?"TV":"Chromecast"}`)},className:"p-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",title:"Cast to TV",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm0-4v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})})}),e.jsx(ms,{text:f.content,variant:"button",className:"p-2 md:px-4 md:py-2"}),e.jsxs("button",{onClick:()=>{fe(null),Be(f)},className:"p-2 md:px-4 md:py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center gap-1.5",title:"Edit","aria-label":"Edit",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{className:"hidden md:inline",children:"Edit"})]}),e.jsxs("button",{onClick:()=>fe(null),className:"p-2 md:px-4 md:py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-1.5",title:"Close","aria-label":"Close",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),e.jsx("span",{className:"hidden md:inline",children:"Close"})]})]})]})]})}),$().length>0&&!f&&!D&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 bg-white dark:bg-gray-800 shadow-2xl rounded-full px-4 md:px-6 py-3 flex items-center gap-2 md:gap-4 border-2 border-gray-200 dark:border-gray-700 z-50 animate-in slide-in-from-bottom duration-200 max-w-[95vw] overflow-x-auto",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap",children:[$().length," selected"]}),e.jsx("div",{className:"h-6 w-px bg-gray-300 dark:bg-gray-600"}),e.jsxs("button",{onClick:()=>re("generate-embeddings"),disabled:Mt,className:"px-2 md:px-3 py-1.5 text-sm rounded-lg bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-1.5 whitespace-nowrap",title:"Add to Search Index (Ctrl+I)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("span",{className:"hidden md:inline",children:"Index"})]}),e.jsxs("button",{onClick:()=>re("generate-quiz"),disabled:at,className:"px-2 md:px-3 py-1.5 text-sm rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-1.5 whitespace-nowrap",title:"Generate Quiz (Ctrl+Q)",children:[at?e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx(St,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:at?"Generating...":"Quiz"})]}),e.jsxs("button",{onClick:()=>{W(!0),ie("add"),U([])},className:"px-2 md:px-3 py-1.5 text-sm rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors flex items-center gap-1.5 whitespace-nowrap",title:"Add Tags (Ctrl+T)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),e.jsx("span",{className:"hidden md:inline",children:"Tag"})]}),e.jsxs("button",{onClick:()=>{const t=$(),s=Ds(t);if(s.length===0){g("No images found in selected snippets");return}N("/image-editor",{state:{images:s}})},disabled:$().filter(zs).length===0,className:"px-2 md:px-3 py-1.5 text-sm rounded-lg bg-orange-600 text-white hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-1.5 whitespace-nowrap",title:"Edit Images",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),e.jsx("span",{className:"hidden md:inline",children:"Edit Images"})]}),e.jsxs("button",{onClick:()=>re("merge"),disabled:$().length<2,className:"px-2 md:px-3 py-1.5 text-sm rounded-lg bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-1.5 whitespace-nowrap",title:"Merge Snippets (Ctrl+M)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),e.jsx("span",{className:"hidden md:inline",children:"Merge"})]}),e.jsxs("button",{onClick:()=>re("delete"),className:"px-2 md:px-3 py-1.5 text-sm rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors flex items-center gap-1.5 whitespace-nowrap",title:"Delete Selected (Del)",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e.jsx("span",{className:"hidden md:inline",children:"Delete"})]})]}),xe&&e.jsxs("div",{className:"fixed bottom-6 right-6 bg-gray-900 dark:bg-gray-800 text-white rounded-lg shadow-2xl px-5 py-3 flex items-center gap-4 border border-gray-700 z-50 animate-in slide-in-from-right duration-200",children:[e.jsxs("span",{className:"text-sm",children:["Removed tag ",e.jsxs("strong",{children:['"',xe.tag,'"']})]}),e.jsx("button",{onClick:async()=>{const t=h.find(s=>s.id===xe.snippetId);t&&(await w(xe.snippetId,{tags:[...t.tags||[],xe.tag]}),l(`Restored tag "${xe.tag}"`)),Pe(null)},className:"px-3 py-1 text-sm bg-white text-gray-900 rounded hover:bg-gray-100 transition-colors font-medium",children:"Undo"}),e.jsx("button",{onClick:()=>Pe(null),className:"text-gray-400 hover:text-white transition-colors",title:"Dismiss",children:"Ã—"})]}),zt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-md",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:R==="add"?"Add Tags":R==="remove"?"Remove Tags":"Filter by Tags"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:R==="add"?"Select or create tags to add to selected snippets":R==="remove"?"Select tags to remove from selected snippets":"Select tags to filter snippets"})]}),e.jsxs("div",{className:"p-6",children:[M.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:M.map(t=>e.jsxs("span",{className:"px-3 py-1 text-sm bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full flex items-center gap-2",children:[t,e.jsx("button",{onClick:()=>U(M.filter(s=>s!==t)),className:"hover:text-red-600 dark:hover:text-red-400",children:"Ã—"})]},t))}),R==="add"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Add New Tag"}),e.jsx(ct,{existingTags:P(),currentTags:M,onAddTag:t=>{M.includes(t)||U([...M,t])},placeholder:"Type to search or create tags...",className:"w-full"})]}),P().length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:R==="add"?"Or Select Existing":R==="remove"?"Select Tags to Remove":"Select Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-48 overflow-y-auto",children:P().map(t=>e.jsx("button",{onClick:()=>{M.includes(t)?U(M.filter(s=>s!==t)):U([...M,t])},className:`px-3 py-1 text-sm rounded-full transition-colors ${M.includes(t)?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:t},t))})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{W(!1),U([])},className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Jt,disabled:R!=="filter"&&M.length===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:R==="add"?"Add Tags":R==="remove"?"Remove Tags":"Apply Filter"})]})]})}),$e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 flex items-center justify-center z-40",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-700 dark:text-gray-300",children:"Processing..."})]})}),de&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 flex items-center justify-center z-40",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl min-w-[300px]",children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx("span",{children:de.status}),e.jsxs("span",{children:[de.current," / ",de.total]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${de.current/de.total*100}%`}})})]})})}),pt&&e.jsx(Cs,{isOpen:pt,onClose:()=>Te(!1),onUpload:Ot}),te&&e.jsx(xs,{snippetId:te.id,content:te.content,title:te.title,tags:te.tags,sourceType:te.sourceType,sharedGoogleDocId:te.sharedGoogleDocId,sharedGoogleDocUrl:te.sharedGoogleDocUrl,onClose:()=>rt(null)}),Ft&&Me&&se&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsx(Ls,{onError:(t,s)=>{console.error("Quiz error:",t,s),i("Quiz encountered an error. Please try again."),he(!1),J(null),Ie(null)},children:e.jsx(ps,{quiz:{title:Me.title,questions:Me.questions.map(t=>({id:t.id,prompt:t.prompt,choices:t.choices,answerId:t.correctChoiceId||t.answerId,explanation:t.explanation}))},onClose:()=>{he(!1),J(null),Ie(null)},onComplete:async(t,s,r)=>{const a=Math.round(t/s*100),o=Date.now()-se.startTime;try{if(se.quizId){await je.updateQuizCompletion(se.quizId,t,o,r),console.log("âœ… Quiz completion updated in IndexedDB:",se.quizId);const x=await v();x&&js(se.quizId,x).then(E=>{E&&console.log("âœ… Quiz statistic synced to Google Sheets")}).catch(E=>{console.error("Failed to sync quiz statistic:",E)})}else{console.warn("No quizId found, using fallback save method");const x=S();await je.saveQuizStatistic({quizTitle:Me.title,snippetIds:se.snippetIds,score:t,totalQuestions:s,timeTaken:o,completedAt:new Date().toISOString(),answers:r,enrichment:se.enrichment,completed:!0,projectId:x||void 0})}l(`Quiz completed! Score: ${t}/${s} (${a}%)`),(()=>{const x=localStorage.getItem("google_drive_access_token"),E=localStorage.getItem("auto_sync_enabled")==="true";return x&&x.length>0&&E})()&&setTimeout(async()=>{try{(await bs.syncQuizProgress()).success&&console.log("âœ… Quiz progress synced to Google Drive")}catch(x){console.error("âŒ Failed to sync quiz progress:",x)}},1e4)}catch(c){console.error("Failed to save quiz statistic:",c),g(`Quiz completed! Score: ${t}/${s} (${a}%) - Statistics not saved`)}}})})})]})};export{Ps as SwagPage};

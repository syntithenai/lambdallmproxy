import{c as k,r as n,aE as F,u as X,br as H,bl as Q,bs as G,j as e,b5 as R,b4 as E,b9 as V,a as Y,bt as A}from"./index-Bd6EJdj1.js";import{C as I}from"./calendar-dIZi5ms8.js";import{Q as B}from"./QuizCard-DDw0EVEO.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],T=k("bookmark",P);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],K=k("circle-alert",U);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],q=k("external-link",O);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]],Z=k("hand",W);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ee=k("loader-circle",J);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],te=k("message-square",se);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],re=k("refresh-cw",ae);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],le=k("search",ne);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],D=k("tag",ce);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],ie=k("thumbs-down",oe);function de(s={}){const{threshold:t=100,onSwipeStart:g,onSwipeEnd:c,onSwipeProgress:b}=s,[h,d]=n.useState({direction:null,progress:0,isSwiping:!1}),l=n.useRef(0),f=n.useRef(0),y=n.useRef(0),x=n.useRef(!1),j=n.useRef(null),z=n.useCallback((r,p)=>{l.current=r,y.current=p,f.current=r,x.current=!1,d({direction:null,progress:0,isSwiping:!1}),g&&g()},[g]),M=n.useCallback((r,p)=>{if(l.current===0)return;f.current=r;const L=r-l.current,a=p-y.current;if(!x.current&&Math.abs(L)>Math.abs(a)&&Math.abs(L)>10&&(x.current=!0),x.current){const i=L>0?"right":"left",w=Math.min(Math.abs(L)/t,1);d({direction:i,progress:w,isSwiping:!0}),b&&b(w,i)}},[t,b]),$=n.useCallback(()=>{if(!x.current){l.current=0,y.current=0;return}const r=f.current-l.current,p=r>0?"right":"left",L=Math.abs(r);x.current=!1,l.current=0,y.current=0,f.current=0,d({direction:null,progress:0,isSwiping:!1}),L>=t&&c?c(p):c&&c(null)},[t,c]),m=n.useCallback(r=>{const p=r.touches[0];z(p.clientX,p.clientY)},[z]),u=n.useCallback(r=>{const p=r.touches[0];M(p.clientX,p.clientY),x.current&&r.preventDefault()},[M]),N=n.useCallback(()=>{$()},[$]),C=n.useCallback(r=>{z(r.clientX,r.clientY)},[z]),v=n.useCallback(r=>{M(r.clientX,r.clientY)},[M]),o=n.useCallback(()=>{$()},[$]),S=n.useCallback(r=>{j.current=r,r.addEventListener("touchstart",m,{passive:!0}),r.addEventListener("touchmove",u,{passive:!1}),r.addEventListener("touchend",N,{passive:!0}),r.addEventListener("mousedown",C),document.addEventListener("mousemove",v),document.addEventListener("mouseup",o)},[m,u,N,C,v,o]),_=n.useCallback(()=>{const r=j.current;r&&(r.removeEventListener("touchstart",m),r.removeEventListener("touchmove",u),r.removeEventListener("touchend",N),r.removeEventListener("mousedown",C),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",o))},[m,u,N,C,v,o]);return n.useEffect(()=>()=>{_()},[_]),{swipeState:h,attachListeners:S,detachListeners:_}}function xe({item:s}){const{t}=F(),g=X(),{stashItem:c,trashItem:b,markViewed:h,startQuiz:d,isGeneratingQuiz:l}=H(),{addSnippet:f}=Q(),y=n.useRef(null),[x,j]=n.useState(!1),[z,M]=n.useState(!1),$=n.useRef(Date.now()),m=M,{swipeState:u,attachListeners:N,detachListeners:C}=de({threshold:100,onSwipeEnd:a=>{a==="right"?o():a==="left"&&S()}});n.useEffect(()=>(y.current&&N(y.current),()=>{C()}),[N,C]),n.useEffect(()=>{if(!s.viewed){const a=setTimeout(()=>{h(s.id),v("view")},1e3);return()=>clearTimeout(a)}},[s.id,s.viewed,h]);const v=async a=>{const i=Date.now()-$.current,w=s.type==="did-you-know"?"didYouKnow":"questionAnswer";await G.saveInteraction({feedItemId:s.id,action:a,timeSpent:i,itemType:w,topics:s.topics||[],source:s.sources?.[0]||"unknown",content:s.content||""})},o=async()=>{await v("stash");let a=`**${s.title}**

`;s.image&&(a+=`![${s.title}](${s.image})

`,s.imageAttribution&&(a+=`*Image: ${s.imageAttribution}*

`)),a+=`${s.content}

`,a+=`**Topics:** ${s.topics.join(", ")}`,s.sources&&s.sources.length>0&&(a+=`

**Sources:**
`,s.sources.forEach((i,w)=>{a+=`${w+1}. ${i}
`})),await f(a,"tool",s.title),await c(s.id)},S=async()=>{await v("trash"),await b(s.id)},_=async()=>{await v("quiz"),await d(s.id)},r=async()=>{await v("skip");const a=`Can you explain more about ${s.title}? ${s.topics.length>0?`I'm particularly interested in ${s.topics.slice(0,2).join(" and ")}.`:""} Please provide detailed information and examples.`;g("/chat",{state:{initialQuery:a,autoSubmit:!0}})},p=()=>{if(!u.isSwiping)return"";const{progress:a,direction:i}=u,w=a*100;return`translateX(${i==="right"?w:-w}px)`},L=()=>{if(!u.isSwiping)return"transparent";const{progress:a,direction:i}=u,w=Math.min(a*.3,.3);return i==="right"?`rgba(34, 197, 94, ${w})`:`rgba(239, 68, 68, ${w})`};return e.jsxs("div",{ref:y,className:"bg-white rounded-lg shadow-sm overflow-hidden transition-all hover:shadow-md cursor-pointer relative",style:{transform:p(),backgroundColor:L(),transition:u.isSwiping?"none":"all 0.2s ease",display:"block",visibility:"visible",minHeight:"100px"},onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[u.isSwiping&&e.jsxs(e.Fragment,{children:[u.direction==="right"&&e.jsxs("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-green-600 flex items-center gap-2",children:[e.jsx(T,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:t("feed.stash")})]}),u.direction==="left"&&e.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-red-600 flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:t("feed.trash")}),e.jsx(R,{className:"h-6 w-6"})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${s.type==="did-you-know"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:s.type==="did-you-know"?t("feed.didYouKnow"):t("feed.questionAnswer")}),s.stashed&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-700",children:t("feed.stashed")})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:s.title}),s.image&&e.jsxs("div",{className:"mb-3 rounded-lg overflow-hidden",children:[e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-48 object-cover"}),s.imageAttribution&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 bg-gray-50 p-2 rounded",dangerouslySetInnerHTML:{__html:s.imageAttributionHtml||s.imageAttribution}})]}),e.jsxs("div",{onClick:()=>j(!0),className:"cursor-pointer",children:[e.jsx("p",{className:"text-gray-700 mb-3 line-clamp-3",children:s.content}),s.mnemonic&&e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-3 mb-3 rounded",children:e.jsxs("p",{className:"text-sm font-medium text-purple-900",children:["ðŸ’¡ ",s.mnemonic]})}),s.expandedContent&&e.jsx("p",{className:"text-xs text-blue-600 hover:text-blue-700 font-medium mb-3",children:"Click to read more..."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{children:(()=>{try{const a=new Date(s.createdAt);return isNaN(a.getTime())?"Recently":a.toLocaleDateString()}catch{return"Recently"}})()})]}),s.topics.length>0&&e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{className:"text-gray-700",children:s.topics.slice(0,3).join(", ")})]})]}),s.sources.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-1 font-semibold",children:[t("feed.sources"),":"]}),e.jsx("div",{className:"space-y-1",children:s.sources.slice(0,2).map((a,i)=>e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:a})]},i))})]}),s.searchTerms&&s.searchTerms.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 font-semibold inline",children:"Search: "}),s.searchTerms.map((a,i)=>e.jsxs("span",{children:[e.jsx("a",{href:`https://www.google.com/search?q=${encodeURIComponent(a)}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-700 hover:underline",title:`Search Google for "${a}"`,children:a}),i<(s.searchTerms?.length||0)-1&&e.jsx("span",{className:"text-xs text-gray-500",children:", "})]},i))]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3 grid grid-cols-4 gap-2",children:[e.jsxs("button",{onClick:S,className:"flex flex-col items-center justify-center gap-2 p-4 bg-red-50 hover:bg-red-100 text-red-700 rounded-lg transition-colors",title:"Downvote - Hide similar content",children:[e.jsx(ie,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Block"})]}),e.jsxs("button",{onClick:o,disabled:s.stashed,className:"flex flex-col items-center justify-center gap-2 p-4 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Save to Swag",children:[e.jsx(Z,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:s.stashed?"Saved":"Save"})]}),e.jsxs("button",{onClick:_,disabled:l,className:"flex flex-col items-center justify-center gap-2 p-4 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Generate Quiz",children:[l?e.jsxs("svg",{className:"animate-spin h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx(E,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Quiz"})]}),e.jsxs("button",{onClick:r,className:"flex flex-col items-center justify-center gap-2 p-4 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors",title:"Discuss in Chat",children:[e.jsx(te,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Chat"})]})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>j(!1),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${s.type==="did-you-know"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:s.type==="did-you-know"?t("feed.didYouKnow"):t("feed.questionAnswer")}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mt-2",children:s.title})]}),e.jsx("button",{onClick:()=>j(!1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close",children:e.jsx(V,{className:"h-6 w-6 text-gray-500"})})]}),e.jsxs("div",{className:"p-6",children:[s.image&&e.jsxs("div",{className:"mb-4 rounded-lg overflow-hidden",children:[e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-64 object-cover"}),s.imageAttribution&&e.jsx("div",{className:"text-xs text-gray-500 mt-2 bg-gray-50 p-2 rounded",dangerouslySetInnerHTML:{__html:s.imageAttributionHtml||s.imageAttribution}})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Summary"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.content})]}),s.mnemonic&&e.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-4 mb-4 rounded",children:[e.jsxs("p",{className:"text-sm font-medium text-purple-900 mb-2",children:["ðŸ’¡ ",s.mnemonic]}),s.topics.length>0&&e.jsxs("a",{href:`https://www.google.com/search?q=${encodeURIComponent(s.topics.join(" "))}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700 hover:underline",children:[e.jsx(le,{className:"h-3 w-3"}),"Search more about this"]})]}),s.expandedContent&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ðŸ“– Deep Dive"}),e.jsx("div",{className:"text-gray-700 leading-relaxed space-y-3 whitespace-pre-line",children:s.expandedContent})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-gray-500 mb-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{children:(()=>{try{const a=new Date(s.createdAt);return isNaN(a.getTime())?"Recently":a.toLocaleDateString()}catch{return"Recently"}})()})]}),s.topics.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{children:s.topics.slice(0,3).join(", ")})]})]}),s.sources.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4 mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2 font-semibold",children:[t("feed.sources"),":"]}),e.jsx("div",{className:"space-y-2",children:s.sources.map((a,i)=>e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:a})]},i))})]}),s.searchTerms&&s.searchTerms.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("p",{className:"text-sm text-gray-700 font-semibold inline",children:"Search: "}),s.searchTerms.map((a,i)=>e.jsxs("span",{children:[e.jsx("a",{href:`https://www.google.com/search?q=${encodeURIComponent(a)}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 hover:underline",title:`Search Google for "${a}"`,children:a}),i<(s.searchTerms?.length||0)-1&&e.jsx("span",{className:"text-sm text-gray-500",children:", "})]},i))]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 p-4 flex gap-3",children:[e.jsxs("button",{onClick:async()=>{await o(),j(!1)},className:`flex-1 px-4 py-3 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors ${s.stashed?"bg-green-100 text-green-700":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[e.jsx(T,{className:"h-5 w-5"}),s.stashed?t("feed.stashed"):t("feed.stash")]}),e.jsx("button",{onClick:async()=>{await _(),j(!1)},disabled:l,className:`flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium text-sm flex items-center justify-center gap-2 ${l?"opacity-50 cursor-not-allowed":""}`,children:l?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),t("quiz.generating")]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-5 w-5"}),t("feed.quiz")]})}),e.jsx("button",{onClick:async()=>{await S(),j(!1)},className:"px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium text-sm flex items-center justify-center gap-2",children:e.jsx(R,{className:"h-5 w-5"})})]})]})})]})}function he(s){return{title:s.title,questions:s.questions.map(t=>({id:t.id,prompt:t.prompt,choices:t.choices,answerId:t.correctChoiceId,explanation:t.explanation}))}}function ue({quiz:s,onClose:t}){const g=he(s);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"w-full max-w-2xl",children:e.jsx(B,{quiz:g,onClose:t,onComplete:(c,b)=>{console.log(`Feed quiz completed: ${c}/${b}`)}})})})}function me({availableTags:s,selectedTags:t,onChange:g,placeholder:c="Select tags...",className:b=""}){const h=l=>{t.includes(l)?g(t.filter(f=>f!==l)):g([...t,l])},d=()=>{g([])};return e.jsxs("div",{className:`space-y-2 ${b}`,children:[t.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-md",children:[t.map(l=>e.jsxs("button",{onClick:()=>h(l),className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded-full hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors",children:[l,e.jsx(V,{className:"w-3 h-3"})]},l)),e.jsx("button",{onClick:d,className:"px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 underline",children:"Clear all"})]}),e.jsx("div",{className:"relative",children:e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer list-none px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.length===0?c:`${t.length} tag(s) selected`})}),e.jsx("div",{className:"absolute z-10 mt-1 w-full max-h-60 overflow-auto bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg",children:s.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:"No tags available"}):e.jsx("div",{className:"py-1",children:s.map(l=>e.jsx("button",{onClick:()=>h(l),className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${t.includes(l)?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:l}),t.includes(l)&&e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]})},l))})})]})})]})}function ye(){const{t:s}=F(),{isAuthenticated:t}=Y(),{getAllTags:g}=Q(),{items:c,currentQuiz:b,isLoading:h,isGenerating:d,generationStatus:l,error:f,selectedTags:y,generateMore:x,refresh:j,closeQuiz:z,updateSelectedTags:M}=H(),$=n.useRef(null),m=n.useRef(null),u=n.useRef(null);n.useEffect(()=>{console.log("ðŸŽ¯ FeedPage: items changed:",c.length,"items"),console.log("ðŸŽ¯ Item titles:",c.map(o=>o.title)),console.log("ðŸŽ¯ Item IDs:",c.map(o=>o.id))},[c]),n.useEffect(()=>{if(!(!u.current||!t))return m.current&&m.current.disconnect(),m.current=new IntersectionObserver(o=>{const[S]=o;S.isIntersecting&&!h&&!d&&(console.log("ðŸ“œ Infinite scroll triggered"),x())},{root:null,rootMargin:"200px",threshold:.1}),m.current.observe(u.current),()=>{m.current&&m.current.disconnect()}},[t]);const N=n.useRef(!1);n.useEffect(()=>{console.log("ðŸŽ¬ Initial load effect triggered:",{isAuthenticated:t,itemsLength:c.length,initialLoadAttempted:N.current,isLoading:h,isGenerating:d}),t&&c.length===0&&!N.current&&!h&&(console.log("ðŸŽ¬ Initial load: starting feed generation"),N.current=!0,x())},[t,c.length,h]);const C=n.useCallback(async()=>{await j(),await x()},[j,x]),v=n.useCallback(async()=>{console.log("ðŸ“± Generate Feed button clicked"),console.log("ðŸ” generateMore function exists:",!!x),console.log("ðŸ” generateMore type:",typeof x);try{console.log("ðŸš€ About to call generateMore()..."),await x(),console.log("âœ… generateMore() completed")}catch(o){console.error("âŒ Generate failed:",o)}},[x]);return console.log("ðŸŽ¨ FeedPage render:",{isAuthenticated:t,isLoading:h,isGenerating:d,itemsCount:c.length,hasError:!!f}),t?e.jsxs("div",{ref:$,className:"bg-gray-50 pb-20",style:{minHeight:"100vh"},children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-6 w-6 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s("feed.title")})]}),e.jsx("button",{onClick:C,disabled:h||d,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:s("feed.refresh"),children:e.jsx(re,{className:`h-5 w-5 text-gray-600 ${h||d?"animate-spin":""}`})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Filter by Swag Tags"}),e.jsx(me,{availableTags:g(),selectedTags:y,onChange:M,placeholder:"All tags (no filter)"}),y.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Feed will use only Swag content tagged with: ",e.jsx("span",{className:"font-medium",children:y.join(", ")})]})]})]})}),f&&e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(K,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-900 mb-1",children:s("errors.error")}),e.jsx("p",{className:"text-sm text-red-700",children:f})]})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[c.map((o,S)=>(console.log(`ðŸŽ´ Rendering FeedItemCard ${S+1}/${c.length}:`,o.id,o.title),e.jsx(xe,{item:o},o.id))),c.length===0&&!h&&!d&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(A,{className:"mx-auto h-16 w-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s("feed.noItems")}),e.jsxs("p",{className:"text-gray-600 mb-6",children:[s("feed.emptyMessage"),e.jsx("br",{}),s("feed.emptySubMessage")]}),e.jsx("button",{onClick:v,disabled:d,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:s(d?"feed.generating":"feed.generateFeed")})]}),(h||d)&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 gap-3",children:[e.jsx(ee,{className:"h-8 w-8 text-blue-500 animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-900 font-medium",children:s(d?"feed.generating":"common.loading")}),l&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 animate-pulse",children:l})]})]}),c.length>2&&e.jsxs("div",{className:"text-center py-4 text-gray-500 text-sm",children:["â†“ Scroll down to see more items (",c.length," total) â†“"]}),e.jsx("div",{ref:u,className:"h-4"})]}),b&&e.jsx(ue,{quiz:b,onClose:z})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md text-center",children:[e.jsx(A,{className:"mx-auto h-12 w-12 text-blue-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:s("feed.title")}),e.jsx("p",{className:"text-gray-600 mb-4",children:s("feed.emptyMessage")}),e.jsx("p",{className:"text-sm text-gray-500",children:s("common.pleaseSignIn")})]})})}export{ye as default};

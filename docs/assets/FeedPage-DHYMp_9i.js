import{r as a,aB as I,bk as T,ba as A,bl as F,j as e,c as X}from"./index-BytxRUHL.js";import{c as y,B as D}from"./trophy-BlteG3TE.js";import{T as z,C as Y}from"./trash-2-Ck33fIJd.js";import{Q}from"./QuizCard-aqPTpSWD.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],R=y("bookmark",B);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],V=y("chevron-down",H);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],K=y("chevron-up",G);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],P=y("circle-alert",O);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],J=y("external-link",U);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Z=y("loader-circle",W);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],se=y("refresh-cw",ee);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],L=y("sparkles",te);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],ae=y("tag",ne);function re(s={}){const{threshold:n=100,onSwipeStart:u,onSwipeEnd:h,onSwipeProgress:i}=s,[d,v]=a.useState({direction:null,progress:0,isSwiping:!1}),o=a.useRef(0),p=a.useRef(0),j=a.useRef(0),f=a.useRef(!1),x=a.useRef(null),g=a.useCallback((t,c)=>{o.current=t,j.current=c,p.current=t,f.current=!1,v({direction:null,progress:0,isSwiping:!1}),u&&u()},[u]),l=a.useCallback((t,c)=>{if(o.current===0)return;p.current=t;const S=t-o.current,q=c-j.current;if(!f.current&&Math.abs(S)>Math.abs(q)&&Math.abs(S)>10&&(f.current=!0),f.current){const _=S>0?"right":"left",$=Math.min(Math.abs(S)/n,1);v({direction:_,progress:$,isSwiping:!0}),i&&i($,_)}},[n,i]),m=a.useCallback(()=>{if(!f.current){o.current=0,j.current=0;return}const t=p.current-o.current,c=t>0?"right":"left",S=Math.abs(t);f.current=!1,o.current=0,j.current=0,p.current=0,v({direction:null,progress:0,isSwiping:!1}),S>=n&&h?h(c):h&&h(null)},[n,h]),b=a.useCallback(t=>{const c=t.touches[0];g(c.clientX,c.clientY)},[g]),w=a.useCallback(t=>{const c=t.touches[0];l(c.clientX,c.clientY),f.current&&t.preventDefault()},[l]),N=a.useCallback(()=>{m()},[m]),k=a.useCallback(t=>{g(t.clientX,t.clientY)},[g]),C=a.useCallback(t=>{l(t.clientX,t.clientY)},[l]),M=a.useCallback(()=>{m()},[m]),E=a.useCallback(t=>{x.current=t,t.addEventListener("touchstart",b,{passive:!0}),t.addEventListener("touchmove",w,{passive:!1}),t.addEventListener("touchend",N,{passive:!0}),t.addEventListener("mousedown",k),document.addEventListener("mousemove",C),document.addEventListener("mouseup",M)},[b,w,N,k,C,M]),r=a.useCallback(()=>{const t=x.current;t&&(t.removeEventListener("touchstart",b),t.removeEventListener("touchmove",w),t.removeEventListener("touchend",N),t.removeEventListener("mousedown",k),document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",M))},[b,w,N,k,C,M]);return a.useEffect(()=>()=>{r()},[r]),{swipeState:d,attachListeners:E,detachListeners:r}}function ce({item:s}){const{t:n}=I(),{stashItem:u,trashItem:h,markViewed:i,startQuiz:d}=T(),{addSnippet:v}=A(),o=a.useRef(null),[p,j]=a.useState(!1),[f,x]=a.useState(!1),g=a.useRef(Date.now()),{swipeState:l,attachListeners:m,detachListeners:b}=re({threshold:100,onSwipeEnd:r=>{r==="right"?N():r==="left"&&k()}});a.useEffect(()=>(o.current&&m(o.current),()=>{b()}),[m,b]),a.useEffect(()=>{if(!s.viewed){const r=setTimeout(()=>{i(s.id),w("view")},1e3);return()=>clearTimeout(r)}},[s.id,s.viewed,i]);const w=async r=>{const t=Date.now()-g.current,c=s.type==="did-you-know"?"didYouKnow":"questionAnswer";await F.saveInteraction({feedItemId:s.id,action:r,timeSpent:t,itemType:c,topics:s.topics||[],source:s.sources?.[0]||"unknown",content:s.content||""})},N=async()=>{await w("stash");const r=`**${s.title}**

${s.content}

Topics: ${s.topics.join(", ")}`;await v(r,"tool",s.title),await u(s.id)},k=async()=>{await w("trash"),await h(s.id)},C=async()=>{await w("quiz"),await d(s.id)},M=()=>{if(!l.isSwiping)return"";const{progress:r,direction:t}=l,c=r*100;return`translateX(${t==="right"?c:-c}px)`},E=()=>{if(!l.isSwiping)return"transparent";const{progress:r,direction:t}=l,c=Math.min(r*.3,.3);return t==="right"?`rgba(34, 197, 94, ${c})`:`rgba(239, 68, 68, ${c})`};return e.jsxs("div",{ref:o,className:"bg-white rounded-lg shadow-sm overflow-hidden transition-all hover:shadow-md cursor-pointer relative",style:{transform:M(),backgroundColor:E(),transition:l.isSwiping?"none":"all 0.2s ease"},onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:[l.isSwiping&&e.jsxs(e.Fragment,{children:[l.direction==="right"&&e.jsxs("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-green-600 flex items-center gap-2",children:[e.jsx(R,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:n("feed.stash")})]}),l.direction==="left"&&e.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-red-600 flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:n("feed.trash")}),e.jsx(z,{className:"h-6 w-6"})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${s.type==="did-you-know"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:s.type==="did-you-know"?n("feed.didYouKnow"):n("feed.qAndA")}),s.stashed&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-700",children:n("feed.stashed")})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:s.title}),s.image&&e.jsxs("div",{className:"mb-3 rounded-lg overflow-hidden",children:[e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-48 object-cover"}),s.imageAttribution&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 bg-gray-50 p-2 rounded",dangerouslySetInnerHTML:{__html:s.imageAttributionHtml||s.imageAttribution}})]}),e.jsx("p",{className:`text-gray-700 mb-3 ${p?"":"line-clamp-3"}`,children:s.content}),s.content.length>200&&e.jsx("button",{onClick:()=>j(!p),className:"text-sm text-blue-600 hover:text-blue-700 font-medium flex items-center gap-1 mb-3",children:p?e.jsxs(e.Fragment,{children:[n("feed.showLess")," ",e.jsx(K,{className:"h-4 w-4"})]}):e.jsxs(e.Fragment,{children:[n("feed.showMore")," ",e.jsx(V,{className:"h-4 w-4"})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]}),s.topics.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:s.topics.slice(0,3).join(", ")})]})]}),s.sources.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-1 font-semibold",children:[n("feed.sources"),":"]}),e.jsx("div",{className:"space-y-1",children:s.sources.slice(0,2).map((r,t)=>e.jsxs("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:r})]},t))})]}),e.jsxs("div",{className:`flex gap-2 transition-opacity ${f||l.isSwiping?"opacity-100":"opacity-0 md:opacity-100"}`,children:[e.jsxs("button",{onClick:N,disabled:s.stashed,className:"flex-1 px-4 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),s.stashed?n("feed.stashed"):n("feed.stash")]}),e.jsxs("button",{onClick:C,className:"flex-1 px-4 py-2 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),n("feed.quiz")]}),e.jsx("button",{onClick:k,className:"px-4 py-2 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors font-medium text-sm flex items-center justify-center gap-2",children:e.jsx(z,{className:"h-4 w-4"})})]})]})]})}function oe(s){return{title:s.title,questions:s.questions.map(n=>({id:n.id,prompt:n.prompt,choices:n.choices,answerId:n.correctChoiceId,explanation:n.explanation}))}}function ie({quiz:s,onClose:n}){const u=oe(s);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"w-full max-w-2xl",children:e.jsx(Q,{quiz:u,onClose:n,onComplete:(h,i)=>{console.log(`Feed quiz completed: ${h}/${i}`)}})})})}function xe(){const{t:s}=I(),{isAuthenticated:n}=X(),{items:u,currentQuiz:h,isLoading:i,isGenerating:d,error:v,generateMore:o,refresh:p,closeQuiz:j}=T(),f=a.useRef(null),x=a.useRef(null),g=a.useRef(null);a.useEffect(()=>{if(!(!g.current||!n))return x.current&&x.current.disconnect(),x.current=new IntersectionObserver(m=>{const[b]=m;b.isIntersecting&&!i&&!d&&o()},{root:null,rootMargin:"200px",threshold:.1}),x.current.observe(g.current),()=>{x.current&&x.current.disconnect()}},[n,i,d,o]),a.useEffect(()=>{n&&u.length===0&&!i&&!d&&o()},[n,u.length,i,d,o]);const l=a.useCallback(async()=>{await p(),await o()},[p,o]);return n?e.jsxs("div",{ref:f,className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-6 w-6 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s("feed.title")})]}),e.jsx("button",{onClick:l,disabled:i||d,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:s("feed.refresh"),children:e.jsx(se,{className:`h-5 w-5 text-gray-600 ${i||d?"animate-spin":""}`})})]})}),v&&e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(P,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-900 mb-1",children:s("errors.error")}),e.jsx("p",{className:"text-sm text-red-700",children:v})]})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[u.map(m=>e.jsx(ce,{item:m},m.id)),u.length===0&&!i&&!d&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(L,{className:"mx-auto h-16 w-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s("feed.noItems")}),e.jsxs("p",{className:"text-gray-600 mb-6",children:[s("feed.emptyMessage"),e.jsx("br",{}),s("feed.emptySubMessage")]}),e.jsx("button",{onClick:o,disabled:d,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:s(d?"feed.generating":"feed.generateFeed")})]}),(i||d)&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Z,{className:"h-8 w-8 text-blue-500 animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:s(d?"feed.generating":"common.loading")})]}),e.jsx("div",{ref:g,className:"h-4"})]}),h&&e.jsx(ie,{quiz:h,onClose:j})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md text-center",children:[e.jsx(L,{className:"mx-auto h-12 w-12 text-blue-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:s("feed.title")}),e.jsx("p",{className:"text-gray-600 mb-4",children:s("feed.emptyMessage")}),e.jsx("p",{className:"text-sm text-gray-500",children:s("common.pleaseSignIn")})]})})}export{xe as default};

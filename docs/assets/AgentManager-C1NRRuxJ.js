import{j as t,aF as q,r as x,aG as r,aH as C,aI as B,aJ as E}from"./index-C8omfh96.js";const u=({agent:s,isSelected:h,onSelect:j,onPause:l,onAbort:b,onRetry:a,onResume:y})=>{const n=s.completedAt?s.completedAt-s.startTime:Date.now()-s.startTime,o={idle:"💤",queued:"⏳",running:"🏃",paused:"⏸️",completed:"✅",error:"❌",aborted:"🛑"},m={thinking:"🤔",tool_execution:"🔧",streaming:"📝",waiting:"⏱️"},p={idle:"bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-600",queued:"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-300 dark:border-yellow-600",running:"bg-blue-50 dark:bg-blue-900/20 border-blue-300 dark:border-blue-600",paused:"bg-orange-50 dark:bg-orange-900/20 border-orange-300 dark:border-orange-600",completed:"bg-green-50 dark:bg-green-900/20 border-green-300 dark:border-green-600",error:"bg-red-50 dark:bg-red-900/20 border-red-300 dark:border-red-600",aborted:"bg-gray-100 dark:bg-gray-800 border-gray-400 dark:border-gray-500"};return t.jsxs("div",{className:`
        agent-card p-3 rounded-lg border-2 cursor-pointer transition-all
        ${p[s.status]||p.idle}
        ${h?"ring-2 ring-blue-500 shadow-lg":"hover:shadow-md"}
      `,onClick:j,children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[t.jsx("span",{className:"text-xl",children:o[s.status]}),t.jsx("span",{className:"font-medium truncate dark:text-gray-100",children:s.title})]}),t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap ml-2",children:q(n)})]}),s.status==="running"&&t.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm",children:[t.jsx("span",{children:m[s.phase]}),t.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:s.phase.replace("_"," ")}),t.jsxs("span",{className:"ml-auto text-xs text-gray-500 dark:text-gray-400",children:["Iteration ",s.iterationCount,"/",s.maxIterations]})]}),t.jsxs("div",{className:"flex gap-3 text-xs text-gray-600 dark:text-gray-400 mb-2",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"font-medium",children:"Memory:"}),t.jsxs("span",{children:[s.estimatedMemoryUsage,"MB"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"font-medium",children:"Tokens:"}),t.jsx("span",{children:s.tokenCount.toLocaleString()})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"font-medium",children:"Tools:"}),t.jsx("span",{children:s.toolCallsCount})]})]}),s.lastError&&t.jsxs("div",{className:"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 text-xs p-2 rounded mb-2",children:["⚠️ ",s.lastError]}),s.retryCount>0&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:["Retry attempt ",s.retryCount]}),t.jsxs("div",{className:"flex gap-2 mt-2",children:[s.status==="running"&&t.jsxs(t.Fragment,{children:[l&&t.jsx("button",{onClick:d=>{d.stopPropagation(),l()},className:"text-xs px-2 py-1 bg-orange-500 hover:bg-orange-600 text-white rounded transition-colors",children:"⏸️ Pause"}),b&&t.jsx("button",{onClick:d=>{d.stopPropagation(),b()},className:"text-xs px-2 py-1 bg-red-500 hover:bg-red-600 text-white rounded transition-colors",children:"🛑 Abort"})]}),s.status==="paused"&&y&&t.jsx("button",{onClick:d=>{d.stopPropagation(),y()},className:"text-xs px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors",children:"▶️ Resume"}),(s.status==="error"||s.status==="aborted")&&a&&t.jsx("button",{onClick:d=>{d.stopPropagation(),a()},className:"text-xs px-2 py-1 bg-green-500 hover:bg-green-600 text-white rounded transition-colors",children:"🔄 Retry"})]})]})},F=({onSwitchToAgent:s,onCreateNewAgent:h,onClose:j})=>{const[l,b]=x.useState([]),[a,y]=x.useState(null),[n,o]=x.useState(null),[m,p]=x.useState(!0);x.useEffect(()=>{d(),A();const e=setInterval(()=>{m&&d()},2e3),i=setInterval(()=>{A()},5e3);return()=>{clearInterval(e),clearInterval(i)}},[m]),x.useEffect(()=>{const e=()=>{d()};return r.on("agent-started",e),r.on("agent-completed",e),r.on("agent-error",e),r.on("agent-paused",e),r.on("agent-aborted",e),r.on("queue-updated",e),()=>{r.off("agent-started",e),r.off("agent-completed",e),r.off("agent-error",e),r.off("agent-paused",e),r.off("agent-aborted",e),r.off("queue-updated",e)}},[]);const d=async()=>{const e=await C.getAllAgents();b(e)},A=()=>{const e=B();y(e)},M=async e=>{await r.pauseAgent(e)},I=async e=>{await r.resumeAgent(e)},f=async e=>{await r.abortAgent(e)},S=async e=>{const i=await C.getAgent(e);i&&(i.status="idle",i.retryCount+=1,i.lastError=void 0,await r.enqueue(i))},R=async()=>{confirm("Clear all completed agents?")&&(await C.clearCompletedAgents(),await d())},k=l.filter(e=>e.status==="running"),v=l.filter(e=>e.status==="queued"),g=l.filter(e=>e.status==="completed"),N=l.filter(e=>["error","aborted"].includes(e.status)),w=l.filter(e=>e.status==="paused"),c=a?E(a):{level:"ok"};return t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("h2",{className:"text-xl font-bold dark:text-gray-100",children:"🤖 Agent Manager"}),t.jsx("button",{onClick:h,className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded transition-colors",children:"+ New Chat"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[t.jsx("input",{type:"checkbox",checked:m,onChange:e=>p(e.target.checked),className:"rounded"}),"Auto-refresh"]}),t.jsx("button",{onClick:j,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"✕"})]})]}),a&&t.jsxs("div",{className:`p-3 border-b ${c.level==="critical"?"bg-red-50 dark:bg-red-900/20 border-red-300 dark:border-red-600":c.level==="warning"?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-300 dark:border-yellow-600":"border-gray-200 dark:border-gray-700"}`,children:[t.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:["Browser Memory: ",a.usedMemory.toFixed(0),"MB / ",a.totalMemory.toFixed(0),"MB"," • ",a.availableMemory.toFixed(0),"MB available"]}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden",children:t.jsx("div",{className:`h-full transition-all ${a.isLowMemory?"bg-red-500":"bg-blue-500"}`,style:{width:`${Math.min(100,a.usedMemory/a.totalMemory*100)}%`}})}),"message"in c&&c.message&&t.jsx("div",{className:`text-xs mt-1 ${c.level==="critical"?"text-red-700 dark:text-red-300":"text-yellow-700 dark:text-yellow-300"}`,children:c.message})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[k.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300",children:["🏃 Running (",k.length,")"]}),t.jsx("div",{className:"space-y-2",children:k.map(e=>t.jsx(u,{agent:e,isSelected:n===e.id,onSelect:()=>{o(e.id),s(e.id,e.chatId)},onPause:()=>M(e.id),onAbort:()=>f(e.id)},e.id))})]}),v.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300",children:["⏳ Queued (",v.length,")"]}),t.jsx("div",{className:"space-y-2",children:v.map(e=>t.jsx(u,{agent:e,isSelected:n===e.id,onSelect:()=>{o(e.id),s(e.id,e.chatId)},onAbort:()=>f(e.id)},e.id))})]}),w.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300",children:["⏸️ Paused (",w.length,")"]}),t.jsx("div",{className:"space-y-2",children:w.map(e=>t.jsx(u,{agent:e,isSelected:n===e.id,onSelect:()=>{o(e.id),s(e.id,e.chatId)},onResume:()=>I(e.id),onAbort:()=>f(e.id)},e.id))})]}),g.length>0&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:["✅ Completed (",g.length,")"]}),t.jsx("button",{onClick:R,className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"Clear All"})]}),t.jsx("div",{className:"space-y-2",children:g.slice(0,5).map(e=>t.jsx(u,{agent:e,isSelected:n===e.id,onSelect:()=>{o(e.id),s(e.id,e.chatId)}},e.id))}),g.length>5&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["... and ",g.length-5," more"]})]}),N.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300",children:["❌ Failed/Aborted (",N.length,")"]}),t.jsx("div",{className:"space-y-2",children:N.map(e=>t.jsx(u,{agent:e,isSelected:n===e.id,onSelect:()=>{o(e.id),s(e.id,e.chatId)},onRetry:()=>S(e.id)},e.id))})]}),l.length===0&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"text-4xl mb-2",children:"🤖"}),t.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"No agents yet. Start a new chat to create one!"}),t.jsx("button",{onClick:h,className:"mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Create New Chat"})]})]})]})})};export{F as AgentManager};

import{c as K,u as O,aF as V,aG as W,a as Y,aH as X,aI as Z,aJ as ee,r as n,aK as te,q as p,j as e,aL as y,aM as se,aN as ae}from"./index-CzgpLTVy.js";import{T as C,Q as ie}from"./QuizCard-DUG3DDYo.js";import{s as re}from"./quizSync-Cx4OpVxV.js";import{T as ne,C as le}from"./trending-up-ChNJ98bg.js";import{C as oe}from"./calendar-BXKI6cj2.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ce=K("arrow-left",de);function pe(){const P=O(),{t:s}=V(),{showSuccess:z,showError:x,showWarning:b}=W(),{getToken:q}=Y(),{getCurrentProjectId:f}=X(),{snippets:c}=Z(),{settings:$}=ee(),[w,L]=n.useState([]),Q=n.useMemo(()=>{const t=f();return t?w.filter(i=>i.projectId===t):w},[w,f]),[m,E]=n.useState(null),[M,S]=n.useState(!0),[T,F]=n.useState(0),[D,I]=n.useState(!1),[A,j]=n.useState(!1),[v,k]=n.useState(null),[u,N]=n.useState(null);n.useEffect(()=>{g()},[]),n.useEffect(()=>{if(T===0||!(()=>{const a=localStorage.getItem("google_drive_access_token"),l=localStorage.getItem("auto_sync_enabled")==="true";return a&&a.length>0&&l})())return;const i=setTimeout(async()=>{try{(await te.syncQuizProgress()).success&&console.log("âœ… Quiz progress synced to Google Drive")}catch(a){console.error("âŒ Failed to sync quiz progress:",a)}},1e4);return()=>clearTimeout(i)},[T]),n.useEffect(()=>{const t=()=>{document.hidden||(console.log("Quiz page visible - reloading statistics"),g())};return document.addEventListener("visibilitychange",t),window.addEventListener("focus",g),()=>{document.removeEventListener("visibilitychange",t),window.removeEventListener("focus",g)}},[]);const g=async()=>{try{S(!0);const[t,i]=await Promise.all([p.getQuizStatistics(20),p.getStatisticsSummary()]);console.log("ðŸ“Š Loaded quiz statistics:",{totalQuizzes:t.length,completed:t.filter(a=>a.completed).length,incomplete:t.filter(a=>!a.completed).length,quizzes:t.map(a=>({id:a.id.substring(0,8),title:a.quizTitle,completed:a.completed,hasQuizData:!!a.quizData}))}),L(t),E(i)}catch(t){console.error("Failed to load quiz statistics:",t),x(s("quiz.errorLoadingStats"))}finally{S(!1)}},G=async(t,i)=>{if(confirm(s("quiz.confirmDelete",{title:i})))try{await p.deleteQuizStatistic(t),z(s("quiz.quizDeleted")),await g()}catch(a){console.error("Failed to delete quiz:",a),x(s("quiz.errorDeletingQuiz"))}},_=async t=>{if(t.quizData){console.log("âœ… Using stored quiz data:",t.quizTitle),N({snippetIds:t.snippetIds,startTime:Date.now(),enrichment:t.enrichment,quizId:t.id}),k(t.quizData),j(!0);return}console.log("âš ï¸ Quiz data not available for:",t.quizTitle),x("Quiz data not available. Please generate a new quiz instead.")},R=async()=>{if(c.length===0){b("No snippets available. Please add some snippets first.");return}try{I(!0);const t=await q();if(!t){x("Authentication required. Please sign in.");return}const i=$.providers.filter(d=>d.enabled!==!1);if(i.length===0){x("No LLM providers enabled. Please enable at least one provider in Settings.");return}const a=c.map(d=>`## ${d.title||"Untitled"}

${d.content}`).join(`

`);if(a.trim().length===0){b("All snippets are empty. Please add content to your snippets.");return}console.log(`ðŸŽ¯ Generating quiz from ${c.length} snippet(s), ${a.length} characters`);const l=!0,o=Date.now(),r=await ae(a,l,i,t);console.log("âœ… Quiz generated:",r.title);const h=await p.saveGeneratedQuiz(r.title,c.map(d=>d.id),r.questions?.length||0,l,r);console.log("ðŸ’¾ Quiz saved to database:",h,"with",r.questions?.length||0,"questions"),N({snippetIds:c.map(d=>d.id),startTime:o,enrichment:l,quizId:h}),k(r),j(!0),z(`Quiz "${r.title}" created successfully!`)}catch(t){console.error("Failed to generate quiz:",t),x(t instanceof Error?t.message:"Failed to generate quiz. Please try again.")}finally{I(!1)}},B=t=>{const i=Math.floor(t/6e4),a=Math.floor(t%6e4/1e3);return`${i}:${a.toString().padStart(2,"0")}`},H=t=>{const i=new Date(t),l=new Date().getTime()-i.getTime(),o=Math.floor(l/(1e3*60*60*24));return o===0?s("quiz.today"):o===1?s("quiz.yesterday"):o<7?s("quiz.daysAgo",{days:o}):i.toLocaleDateString()},U=t=>t>=90?"text-green-600 dark:text-green-400":t>=70?"text-blue-600 dark:text-blue-400":t>=50?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",J=t=>t>=90?"bg-green-100 dark:bg-green-900/30":t>=70?"bg-blue-100 dark:bg-blue-900/30":t>=50?"bg-yellow-100 dark:bg-yellow-900/30":"bg-red-100 dark:bg-red-900/30";return M?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:s("quiz.loadingStats")})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4 pb-24",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>P("/"),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-lg transition-colors",title:s("quiz.backToChat"),children:e.jsx(ce,{className:"w-6 h-6 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2 quiz-page-header","data-testid":"quiz-page-title",children:[e.jsx(y,{className:"w-8 h-8 text-indigo-600 dark:text-indigo-400"}),s("quiz.title")]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:s("quiz.subtitle")})]})]}),e.jsxs("button",{onClick:R,disabled:D||c.length===0,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center gap-2",title:c.length===0?"No snippets available":"Generate quiz from all snippets",children:[e.jsx(y,{className:"w-5 h-5"}),D?"Generating...":s("quiz.createNewQuiz")]})]}),m&&m.totalQuizzes>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:s("quiz.totalQuizzes")}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:m.totalQuizzes})]}),e.jsx(C,{className:"w-12 h-12 text-yellow-500"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:s("quiz.averageScore")}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:[m.averagePercentage.toFixed(0),"%"]})]}),e.jsx(ne,{className:"w-12 h-12 text-blue-500"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:s("quiz.highestScore")}),e.jsxs("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:[m.highestScore.toFixed(0),"%"]})]}),e.jsx(C,{className:"w-12 h-12 text-green-500"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:s("quiz.questionsAnswered")}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:m.totalQuestionsAnswered})]}),e.jsx(y,{className:"w-12 h-12 text-indigo-500"})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:s("quiz.recentQuizzes")})}),Q.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(y,{className:"w-16 h-16 text-gray-400 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:s("quiz.noQuizzesYet")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("quiz.noQuizzesDescription")}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-4 max-w-md mx-auto",children:["ðŸ’¡ ",s("quiz.quizMeHelp")]})]}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:Q.map(t=>e.jsx("div",{className:`p-6 transition-colors cursor-pointer ${t.completed?"hover:bg-gray-50 dark:hover:bg-gray-750":"bg-yellow-50 dark:bg-yellow-900/20 hover:bg-yellow-100 dark:hover:bg-yellow-900/30 border-l-4 border-yellow-500"}`,onClick:()=>_(t),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.quizTitle}),t.completed?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${J(t.percentage)} ${U(t.percentage)}`,children:[t.score,"/",t.totalQuestions," (",t.percentage,"%)"]}),e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded text-xs font-medium",children:s("quiz.clickToRetake")||"Click to Retake"})]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-semibold bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-200",children:s("quiz.clickToRestart")})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"}),H(t.completedAt)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"}),B(t.timeTaken)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"w-4 h-4"}),s("quiz.snippetCount",{count:t.snippetIds.length})]}),t.enrichment&&e.jsx("span",{className:"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded text-xs font-medium",children:s("quiz.enriched")}),!t.synced&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 rounded text-xs font-medium",children:s("quiz.notSynced")})]})]}),e.jsx("button",{onClick:i=>{i.stopPropagation(),G(t.id,t.quizTitle)},className:"p-2 text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:s("quiz.deleteQuiz"),children:e.jsx(se,{className:"w-5 h-5"})})]})},t.id))})]})]}),A&&v&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsx(ie,{quiz:v,onClose:()=>{console.log("âŒ Quiz modal closed without completion"),console.log("ðŸ“ Quiz should remain in database as incomplete"),j(!1),k(null),N(null),g()},onComplete:async(t,i,a)=>{const l=Math.round(t/i*100),o=Date.now()-u.startTime;try{if(u.quizId){await p.updateQuizCompletion(u.quizId,t,o,a);const r=await q();r&&re(u.quizId,r).then(h=>{h&&console.log("âœ… Quiz statistic synced to Google Sheets")}).catch(h=>{console.error("Failed to sync quiz statistic:",h)})}else{console.warn("No quizId found, using fallback save method");const r=f();await p.saveQuizStatistic({quizTitle:v.title,snippetIds:u.snippetIds,score:t,totalQuestions:i,timeTaken:o,completedAt:new Date().toISOString(),answers:a,enrichment:u.enrichment,completed:!0,projectId:r||void 0})}z(`Quiz completed! Score: ${t}/${i} (${l}%)`),await g(),F(Date.now())}catch(r){console.error("Failed to save quiz statistic:",r),b(`Quiz completed! Score: ${t}/${i} (${l}%) - Statistics not saved`)}}})})]})}export{pe as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BJ_WKHd_.js","assets/index-FSMZBHdf.css"])))=>i.map(i=>d[i]);
import{c as U,r as n,aT as oe,u as de,bQ as le,d as ie,e as ue,n as W,j as e,aR as ge,bH as V,bR as J,bs as Z,br as ee,aQ as te,bN as K,bx as he,aS as xe,b3 as se,a as me,bq as X,bS as pe,bT as fe}from"./index-BJ_WKHd_.js";import{C as ae}from"./calendar-D11I0Qwn.js";import{T as ne}from"./tag-CQacTKyP.js";import{L as re}from"./loader-circle-BOs7g56h.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],ye=U("arrow-up",be);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],je=U("bookmark",ve);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ne=U("circle-alert",we);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Ce=U("search",Se);function ke(t={}){const{threshold:g=100,onSwipeStart:$,onSwipeEnd:b,onSwipeProgress:C}=t,[H,D]=n.useState({direction:null,progress:0,isSwiping:!1}),w=n.useRef(0),k=n.useRef(0),f=n.useRef(0),p=n.useRef(!1),h=n.useRef(null),I=n.useCallback((r,u)=>{w.current=r,f.current=u,k.current=r,p.current=!1,D({direction:null,progress:0,isSwiping:!1}),$&&$()},[$]),i=n.useCallback((r,u)=>{if(w.current===0)return;k.current=r;const j=r-w.current,z=u-f.current;if(!p.current&&Math.abs(j)>Math.abs(z)&&Math.abs(j)>10&&(p.current=!0),p.current){const M=j>0?"right":"left",L=Math.min(Math.abs(j)/g,1);D({direction:M,progress:L,isSwiping:!0}),C&&C(L,M)}},[g,C]),d=n.useCallback(()=>{if(!p.current){w.current=0,f.current=0;return}const r=k.current-w.current,u=r>0?"right":"left",j=Math.abs(r);p.current=!1,w.current=0,f.current=0,k.current=0,D({direction:null,progress:0,isSwiping:!1}),j>=g&&b?b(u):b&&b(null)},[g,b]),y=n.useCallback(r=>{const u=r.touches[0];I(u.clientX,u.clientY)},[I]),T=n.useCallback(r=>{const u=r.touches[0];i(u.clientX,u.clientY),p.current&&r.preventDefault()},[i]),v=n.useCallback(()=>{d()},[d]),R=n.useCallback(r=>{I(r.clientX,r.clientY)},[I]),E=n.useCallback(r=>{i(r.clientX,r.clientY)},[i]),m=n.useCallback(()=>{d()},[d]),F=n.useCallback(r=>{h.current=r,r.addEventListener("touchstart",y,{passive:!0}),r.addEventListener("touchmove",T,{passive:!1}),r.addEventListener("touchend",v,{passive:!0}),r.addEventListener("mousedown",R),document.addEventListener("mousemove",E),document.addEventListener("mouseup",m)},[y,T,v,R,E,m]),N=n.useCallback(()=>{const r=h.current;r&&(r.removeEventListener("touchstart",y),r.removeEventListener("touchmove",T),r.removeEventListener("touchend",v),r.removeEventListener("mousedown",R),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",m))},[y,T,v,R,E,m]);return n.useEffect(()=>()=>{N()},[N]),{swipeState:H,attachListeners:F,detachListeners:N}}function Ie({item:t}){const{t:g}=oe(),$=de(),{stashItem:b,markViewed:C,startQuiz:H,generatingQuizForItem:D,generateMore:w}=le(),{addSnippet:k}=ie(),{showSuccess:f}=ue(),p=D===t.id,h=n.useRef(null),[I,i]=n.useState(!1),[d,y]=n.useState(!1),[T,v]=n.useState(!1),R=n.useRef(Date.now()),E=v,{swipeState:m,attachListeners:F,detachListeners:N}=ke({threshold:100,onSwipeEnd:s=>{s==="right"&&u()}});n.useEffect(()=>{const s="ontouchstart"in window&&window.innerWidth<768;return h.current&&s&&F(h.current),()=>{s&&N()}},[F,N]),n.useEffect(()=>{if(!t.viewed){const s=setTimeout(()=>{C(t.id),r("view")},1e3);return()=>clearTimeout(s)}},[t.id,t.viewed,C]);const r=async s=>{const l=Date.now()-R.current,x=t.type==="did-you-know"?"didYouKnow":"questionAnswer";await W.saveInteraction({feedItemId:t.id,action:s,timeSpent:l,itemType:x,topics:t.topics||[],source:t.sources?.[0]||"unknown",content:t.content||""})},u=async()=>{await r("stash");let s=`**${t.title}**

`;if(t.image){const x=t.image.startsWith("data:"),P=t.image.startsWith("http://")||t.image.startsWith("https://"),Y=t.image.length;console.log("ðŸ“¸ Stashing item with image:",{isDataUri:x,isHttpUrl:P,imageSize:Y,imageSource:t.imageSource,imageProvider:t.imageProvider,imageUrl:x?`data:... (${(Y/1024).toFixed(1)} KB)`:t.image});let B=t.image;if(x)try{const{imageStorage:a}=await se(async()=>{const{imageStorage:o}=await import("./index-BJ_WKHd_.js").then(c=>c.da);return{imageStorage:o}},__vite__mapDeps([0,1]));B=await a.saveImage(t.image),console.log(`âœ… Saved data URI image to IndexedDB: ${B} (${(Y/1024).toFixed(1)} KB)`)}catch(a){console.error("âŒ Failed to save image to IndexedDB, using data URI:",a)}else if(P)try{console.log(`ðŸŒ Fetching HTTP image from: ${t.image}`);const o=await(await fetch(t.image)).blob(),c=await new Promise((A,G)=>{const _=new FileReader;_.onloadend=()=>A(_.result),_.onerror=G,_.readAsDataURL(o)});console.log(`âœ… Converted HTTP image to base64 (${(c.length/1024).toFixed(1)} KB)`);const{imageStorage:S}=await se(async()=>{const{imageStorage:A}=await import("./index-BJ_WKHd_.js").then(G=>G.da);return{imageStorage:A}},__vite__mapDeps([0,1]));B=await S.saveImage(c),console.log(`âœ… Saved HTTP image to IndexedDB: ${B}`)}catch(a){console.error("âŒ Failed to fetch/convert HTTP image, using original URL:",a)}s+=`![${t.title}](${B})

`,t.imageAttribution&&(s+=`*Image: ${t.imageAttribution}*

`)}s+=`${t.content}

`,t.expandedContent&&t.expandedContent!==t.content&&(s+=`---

`,s+=`**Detailed Information:**

${t.expandedContent}

`),t.mnemonic&&(s+=`---

`,s+=`**Memory Aid:** ${t.mnemonic}

`),s+=`**Topics:** ${t.topics.join(", ")}`,t.sources&&t.sources.length>0&&(s+=`

**Sources:**
`,t.sources.forEach((x,P)=>{s+=`${P+1}. ${x}
`}));const l=[...t.topics||[],"admin:feed"];await k(s,"tool",t.title,l),await b(t.id)},j=async()=>{await r("quiz"),await H(t.id)},z=async()=>{await r("skip");const s=`Can you explain more about ${t.title}? ${t.topics.length>0?`I'm particularly interested in ${t.topics.slice(0,2).join(" and ")}.`:""} Please provide detailed information and examples.`,l=`You are a helpful AI assistant. The user is asking questions about the following article:

Title: ${t.title}

Content:
${t.expandedContent}

${t.topics.length>0?`Topics: ${t.topics.join(", ")}`:""}

Please use this article as context to answer the user's questions. You can provide additional information beyond what's in the article, but reference the article content when relevant.`;$("/chat",{state:{initialQuery:s,systemMessage:l,autoSubmit:!0,clearChat:!0}})},M=()=>{y(!0)},L=async(s,l)=>{s.preventDefault(),s.stopPropagation(),console.log("ðŸ·ï¸ Tag clicked, regenerating feed with topic:",l),window.scrollTo({top:0,behavior:"smooth"}),f(`ðŸ” Generating feed items about "${l}"`),i(!1),await w([l])},Q=()=>{if(!m.isSwiping)return"";const{progress:s,direction:l}=m,x=s*100;return`translateX(${l==="right"?x:-x}px)`},q=()=>{if(!m.isSwiping)return"transparent";const{progress:s,direction:l}=m,x=Math.min(s*.3,.3);return l==="right"?`rgba(34, 197, 94, ${x})`:`rgba(239, 68, 68, ${x})`};return e.jsxs("div",{ref:h,className:"bg-white sm:rounded-lg shadow-sm overflow-hidden transition-all hover:shadow-md cursor-pointer relative",style:{transform:Q(),backgroundColor:q(),transition:m.isSwiping?"none":"all 0.2s ease",display:"block",visibility:"visible",minHeight:"100px"},onMouseEnter:()=>E(!0),onMouseLeave:()=>E(!1),children:[m.isSwiping&&e.jsxs(e.Fragment,{children:[m.direction==="right"&&e.jsxs("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-green-600 flex items-center gap-2",children:[e.jsx(je,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:g("feed.stash")})]}),m.direction==="left"&&e.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-red-600 flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:g("feed.trash")}),e.jsx(ge,{className:"h-6 w-6"})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${t.type==="did-you-know"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:t.type==="did-you-know"?g("feed.didYouKnow"):g("feed.questionAnswer")}),t.stashed&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-700",children:g("feed.stashed")})]}),e.jsx("h3",{onClick:()=>i(!0),className:"text-lg font-bold text-gray-900 mb-2 cursor-pointer hover:text-blue-600 transition-colors",children:t.title}),t.image&&e.jsxs("div",{className:"mb-3 rounded-lg overflow-hidden",children:[e.jsx("img",{src:t.image,alt:t.title,onClick:()=>i(!0),className:"w-full h-48 object-cover cursor-pointer hover:opacity-90 transition-opacity"}),t.imageAttribution&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 bg-gray-50 p-2 rounded",dangerouslySetInnerHTML:{__html:t.imageAttributionHtml||t.imageAttribution}})]}),e.jsxs("div",{onClick:()=>i(!0),className:"cursor-pointer hover:bg-gray-50 rounded-lg p-2 -m-2 transition-colors",title:"Click to read full article",children:[e.jsx("p",{className:"text-gray-700 mb-3 line-clamp-3",children:typeof t.content=="string"?t.content:t.content?.summary||"No content available"}),t.mnemonic&&e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-3 mb-3 rounded",children:e.jsxs("p",{className:"text-sm font-medium text-purple-900",children:["ðŸ’¡ ",typeof t.mnemonic=="string"?t.mnemonic:JSON.stringify(t.mnemonic)]})}),t.expandedContent&&e.jsx("p",{className:"text-xs text-blue-600 hover:text-blue-700 font-medium mb-3",children:"Click to read more..."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:(()=>{try{const s=new Date(t.createdAt);return isNaN(s.getTime())?"Recently":s.toLocaleDateString()}catch{return"Recently"}})()})]}),t.topics.length>0&&e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx(ne,{className:"h-4 w-4"}),t.topics.slice(0,3).map((s,l)=>e.jsxs("span",{children:[e.jsx("button",{onClick:x=>L(x,s),className:"text-gray-700 hover:text-blue-600 hover:underline cursor-pointer bg-transparent border-0 p-0",title:`Generate feed items about "${s}"`,children:s}),l<Math.min(t.topics.length,3)-1&&e.jsx("span",{className:"text-gray-500",children:", "})]},l))]})]}),t.sources.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-1 font-semibold",children:[g("feed.sources"),":"]}),e.jsx("div",{className:"space-y-1",children:t.sources.slice(0,2).map((s,l)=>e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:s})]},l))})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3 grid grid-cols-4 gap-2",children:[e.jsxs("button",{onClick:u,className:"flex flex-col items-center justify-center gap-2 p-4 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg transition-colors",title:"Save to Swag",children:[e.jsx(J,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Save"})]}),e.jsxs("button",{onClick:j,disabled:p,className:"flex flex-col items-center justify-center gap-2 p-4 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Generate Quiz",children:[p?e.jsxs("svg",{className:"animate-spin h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx(Z,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Quiz"})]}),e.jsxs("button",{onClick:z,className:"flex flex-col items-center justify-center gap-2 p-4 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors",title:"Discuss in Chat",children:[e.jsx(ee,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Chat"})]}),e.jsxs("button",{onClick:M,className:"flex flex-col items-center justify-center gap-2 p-4 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-lg transition-colors",title:"Share this article",children:[e.jsx(te,{className:"h-6 w-6"}),e.jsx("span",{className:"text-xs font-medium",children:"Share"})]})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>i(!1),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-[90%] max-h-[90vh] overflow-y-auto",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${t.type==="did-you-know"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:t.type==="did-you-know"?g("feed.didYouKnow"):g("feed.questionAnswer")}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mt-2",children:t.title})]}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close",children:e.jsx(K,{className:"h-6 w-6 text-gray-500"})})]}),e.jsxs("div",{className:"p-6",children:[t.image&&e.jsxs("div",{className:"mb-4 rounded-lg overflow-hidden",children:[e.jsx("img",{src:t.image,alt:t.title,className:"w-full h-64 object-cover"}),t.imageAttribution&&e.jsx("div",{className:"text-xs text-gray-500 mt-2 bg-gray-50 p-2 rounded",dangerouslySetInnerHTML:{__html:t.imageAttributionHtml||t.imageAttribution}})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Summary"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:t.content})]}),t.mnemonic&&e.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-4 mb-4 rounded",children:[e.jsxs("p",{className:"text-sm font-medium text-purple-900 mb-2",children:["ðŸ’¡ ",t.mnemonic]}),t.topics.length>0&&e.jsxs("div",{className:"flex items-center gap-1 flex-wrap text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Topics:"}),e.jsx("button",{onClick:s=>L(s,t.topics.join(" ")),className:"text-blue-600 hover:text-blue-700 hover:underline cursor-pointer bg-transparent border-0 p-0",title:`Generate feed items about "${t.topics.join(", ")}"`,children:t.topics.join(", ")})]})]}),t.expandedContent&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"ðŸ“– Deep Dive"}),e.jsx(he,{text:typeof t.expandedContent=="string"?t.expandedContent:JSON.stringify(t.expandedContent,null,2),variant:"icon"})]}),e.jsx("div",{className:"text-gray-700 leading-relaxed space-y-3 whitespace-pre-line",children:typeof t.expandedContent=="string"?t.expandedContent:JSON.stringify(t.expandedContent,null,2)})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-gray-500 mb-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:(()=>{try{const s=new Date(t.createdAt);return isNaN(s.getTime())?"Recently":s.toLocaleDateString()}catch{return"Recently"}})()})]}),t.topics.length>0&&e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx(ne,{className:"h-4 w-4"}),t.topics.slice(0,3).map((s,l)=>e.jsxs("span",{children:[e.jsx("button",{onClick:x=>L(x,s),className:"text-gray-700 hover:text-blue-600 hover:underline cursor-pointer bg-transparent border-0 p-0",title:`Generate feed items about "${s}"`,children:s}),l<Math.min(t.topics.length,3)-1&&e.jsx("span",{className:"text-gray-500",children:", "})]},l))]})]}),t.sources.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4 mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2 font-semibold",children:[g("feed.sources"),":"]}),e.jsx("div",{className:"space-y-2",children:t.sources.map((s,l)=>e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:s})]},l))})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 p-4 flex gap-3",children:[e.jsxs("button",{onClick:async()=>{await u(),i(!1)},className:"flex-1 px-4 py-3 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors",children:[e.jsx(J,{className:"h-5 w-5"}),"Save"]}),e.jsx("button",{onClick:async()=>{await j(),i(!1)},disabled:p,className:"flex-1 px-4 py-3 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg transition-colors font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:p?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),g("quiz.generating")]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-5 w-5"}),g("feed.quiz")]})}),e.jsxs("button",{onClick:async()=>{await z(),i(!1)},className:"flex-1 px-4 py-3 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors",children:[e.jsx(ee,{className:"h-5 w-5"}),"Chat"]}),e.jsxs("button",{onClick:()=>{M(),i(!1)},className:"flex-1 px-4 py-3 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors",children:[e.jsx(te,{className:"h-5 w-5"}),"Share"]})]})]})}),d&&e.jsx(xe,{snippetId:t.id,content:(()=>{let s="";if(t.imageBase64||t.image){const l=t.imageBase64||t.image,x=t.title||"Feed item image";s+=`![${x}](${l})

`}return s+=t.expandedContent||t.content,t.mnemonic&&(s+=`

**Memory Aid:** ${t.mnemonic}`),s})(),title:t.title,tags:t.topics||[],sourceType:"assistant",timestamp:new Date(t.createdAt).getTime(),onClose:()=>y(!1)})]})}function Ae(){const{t}=oe(),{isAuthenticated:g}=me(),{snippets:$=[]}=ie()||{snippets:[]},[b,C]=n.useState(""),[H,D]=n.useState(!1),[w,k]=n.useState("adult"),[f,p]=n.useState([]),{items:h,currentQuiz:I,isLoading:i,isGenerating:d,generationStatus:y,error:T,generateMore:v,refresh:R,closeQuiz:E,clearAllItems:m,stopGeneration:F,lastSearchCriteria:N}=le(),r=n.useRef(null),u=n.useRef(null),j=n.useRef(null),z=n.useRef(d),M=n.useRef(i),L=n.useRef(v),Q=n.useRef(N);n.useEffect(()=>{console.log("ðŸ”„ FeedPage: isGenerating changed:",d),console.log("ðŸ”„ FeedPage: generationStatus:",y),z.current=d,M.current=i,L.current=v,Q.current=N},[d,i,v,y,N]);const q=n.useMemo(()=>{const a={};return $.forEach(o=>{o.tags?.forEach(c=>{c.startsWith("admin:")||(a[c]=(a[c]||0)+1)})}),Object.entries(a).sort((o,c)=>c[1]-o[1]).slice(0,10).map(([o])=>o)},[$]),s=n.useCallback(async()=>{const a=b.trim(),o=[...f];a&&o.push(a),o.length!==0&&(console.log("ðŸ” Searching with criteria:",o),await m(),await v(o),C(""))},[b,f,m,v]),l=n.useCallback(a=>{p(o=>o.includes(a)?(console.log("ðŸ·ï¸ Deselecting tag:",a),o.filter(S=>S!==a)):(console.log("ðŸ·ï¸ Selecting tag:",a),[...o,a]))},[]),x=n.useCallback(()=>{console.log("ðŸ·ï¸ Selecting all tags"),p(q)},[q]),P=n.useCallback(()=>{console.log("ðŸ·ï¸ Deselecting all tags"),p([])},[]);n.useEffect(()=>{console.log("ðŸŽ¯ FeedPage: items changed:",h.length,"items"),console.log("ðŸŽ¯ Item titles:",h.map(a=>a.title)),console.log("ðŸŽ¯ Item IDs:",h.map(a=>a.id))},[h]),n.useEffect(()=>{(async()=>{const o=await W.getMaturityLevel();k(o)})()},[]),n.useEffect(()=>{(async()=>{const o=localStorage.getItem("feed_generation_request");if(o)try{const{searchTerms:c,clearExisting:S,fromSnippet:A}=JSON.parse(o);console.log("ðŸŽ¯ Feed generation request from snippet:",{searchTerms:c,clearExisting:S,fromSnippet:A}),S&&await m(),c&&c.length>0&&await v(c),localStorage.removeItem("feed_generation_request")}catch(c){console.error("âŒ Failed to process feed generation request:",c),localStorage.removeItem("feed_generation_request")}})()},[]),n.useEffect(()=>{if(!(!j.current||!g))return u.current&&u.current.disconnect(),u.current=new IntersectionObserver(a=>{const[o]=a,c=Q.current;console.log("ðŸ‘ï¸ IntersectionObserver fired:",{isIntersecting:o.isIntersecting,itemsLength:h.length,lastSearchCriteria:c});const S=c&&c.length>0,A=h.length>0,G=A||S,_=M.current,O=z.current,ce=L.current;console.log("ðŸ” Infinite scroll check:",{isIntersecting:o.isIntersecting,currentIsLoading:_,currentIsGenerating:O,shouldAllowInfiniteScroll:G,hasActiveSearchCriteria:S,hasExistingItems:A,itemsLength:h.length}),o.isIntersecting&&!_&&!O&&G?(console.log("ðŸ“œ Infinite scroll triggered - generating more items..."),console.log("ðŸ“œ Reason: hasExistingItems="+A+", hasActiveSearchCriteria="+S),ce()):o.isIntersecting&&!G?(console.log("ðŸ“œ Infinite scroll blocked: no items and no active search criteria (need user interests input or clicked tag)"),console.log("ðŸ“œ Debug: itemsLength="+h.length+", lastSearchCriteria="+(c?c.join(", "):"null"))):o.isIntersecting&&(_||O)&&console.log("ðŸ“œ Infinite scroll blocked: already generating/loading")},{root:null,rootMargin:"200px",threshold:.1}),u.current.observe(j.current),()=>{u.current&&u.current.disconnect()}},[g]),n.useEffect(()=>{const a=()=>{D(window.scrollY>300)};return window.addEventListener("scroll",a),()=>window.removeEventListener("scroll",a)},[]);const Y=n.useCallback(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]),B=n.useCallback(async()=>{await R()},[R]);return console.log("ðŸŽ¨ FeedPage render:",{isAuthenticated:g,isLoading:i,isGenerating:d,itemsCount:h.length,hasError:!!T}),g?e.jsxs("div",{ref:r,className:"bg-gray-50 pb-20",style:{minHeight:"100vh"},children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:[d&&e.jsx("div",{className:"bg-blue-50 border-b border-blue-200 px-2 sm:px-4 py-2",children:e.jsxs("div",{className:"max-w-2xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-blue-600 animate-spin"}),e.jsx("span",{className:"text-sm text-blue-800 font-medium",children:y||"Generating feed items..."})]}),e.jsxs("button",{onClick:a=>{console.log("ðŸ”´ Stop button clicked!",a),F()},className:"px-3 py-1.5 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors flex items-center gap-1.5 text-sm font-medium shadow-md hover:shadow-lg",title:"Stop feed generation",children:[e.jsx(K,{className:"h-4 w-4"}),"Stop"]})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-2 sm:px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-6 w-6 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t("feed.title")})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:B,disabled:i||d,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:t("feed.refresh"),children:e.jsx(pe,{className:`h-5 w-5 text-gray-600 ${i||d?"animate-spin":""}`})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"ðŸŽ“ Content Maturity Level"}),e.jsxs("select",{value:w,onChange:async a=>{const o=a.target.value;k(o),await W.setMaturityLevel(o),window.dispatchEvent(new Event("feed-maturity-changed"))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"child",children:"Child (Ages 6-12) - Simple language, educational content"}),e.jsx("option",{value:"youth",children:"Youth (Ages 13-17) - Age-appropriate topics, moderate complexity"}),e.jsx("option",{value:"adult",children:"Adult (18+) - General audience, varied complexity"}),e.jsx("option",{value:"academic",children:"Academic - Advanced topics, research-focused, technical"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"What are your interests?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:b,onChange:a=>C(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(b.trim()||f.length>0)&&!d&&s()},placeholder:"e.g., artificial intelligence, space exploration, history...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d}),e.jsxs("button",{onClick:s,disabled:!b.trim()&&f.length===0||d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Search"]})]})]}),q.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Select tags to include in search:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:x,className:"text-xs px-2 py-1 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-colors",children:"Select All"}),e.jsx("button",{onClick:P,className:"text-xs px-2 py-1 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded transition-colors",children:"Select None"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:q.map(a=>{const o=f.includes(a);return e.jsx("button",{onClick:()=>l(a),disabled:d,className:`px-3 py-1.5 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium ${o?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:a},a)})}),f.length>0&&e.jsxs("p",{className:"text-xs text-blue-600",children:[f.length," tag",f.length!==1?"s":""," selected"]})]}),q.length===0&&e.jsx("p",{className:"text-xs text-gray-500",children:"Add some interests above or save content with tags in Swag to see tag suggestions here."})]})]})]}),T&&e.jsx("div",{className:"max-w-2xl mx-auto px-2 sm:px-4 py-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Ne,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-900 mb-1",children:t("errors.error")}),e.jsx("p",{className:"text-sm text-red-700",children:T})]})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-2 sm:px-4 py-4 space-y-4",children:[h.map((a,o)=>(console.log(`ðŸŽ´ Rendering FeedItemCard ${o+1}/${h.length}:`,a.id,a.title),e.jsx(Ie,{item:a},a.id))),h.length===0&&!i&&!d&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(X,{className:"mx-auto h-16 w-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t("feed.noItems")}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Use the search or tag buttons above to generate your personalized feed"})]}),(i||d)&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 gap-3",children:[e.jsx(re,{className:"h-8 w-8 text-blue-500 animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-900 font-medium",children:t(d?"feed.generating":"common.loading")}),y&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 animate-pulse",children:y})]}),d&&e.jsxs("button",{onClick:a=>{console.log("ðŸ”´ Bottom stop button clicked!",a),F()},className:"mt-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors flex items-center gap-2 text-sm font-medium shadow-md hover:shadow-lg",title:"Stop feed generation",children:[e.jsx(K,{className:"h-4 w-4"}),"Stop Generation"]})]})]}),h.length>2&&e.jsxs("div",{className:"text-center py-4 text-gray-500 text-sm",children:["â†“ Scroll down to see more items (",h.length," total) â†“"]}),e.jsx("div",{ref:j,className:"h-4"}),H&&e.jsx("button",{onClick:Y,className:"fixed bottom-6 right-6 bg-blue-600 text-white rounded-full p-3 shadow-lg hover:bg-blue-700 transition-all duration-300 hover:scale-110 z-50",title:"Scroll to top","aria-label":"Scroll to top",children:e.jsx(ye,{className:"h-6 w-6"})}),I&&e.jsx(fe,{quiz:I,onClose:E})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md text-center",children:[e.jsx(X,{className:"mx-auto h-12 w-12 text-blue-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:t("feed.title")}),e.jsx("p",{className:"text-gray-600 mb-4",children:t("feed.emptyMessage")}),e.jsx("p",{className:"text-sm text-gray-500",children:t("common.pleaseSignIn")})]})})}export{Ae as default};

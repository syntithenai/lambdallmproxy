function w(e){const t=[];let n=0;for(const a of e){const s=a.content||"";if(s.startsWith("data:image/")){n++,t.push({id:`${a.id}-img-${n}`,url:s,name:a.title||`Image ${n}`,tags:a.tags||[],snippetId:a.id,imageIndex:0,markdownPosition:0,format:d(s)});continue}if(s.includes("<img")){const i=I(s,a,n);t.push(...i),n+=i.length}if(s.includes("![")){const i=x(s,a,n);t.push(...i),n+=i.length}}return t}function I(e,t,n){const a=[];return new DOMParser().parseFromString(e,"text/html").querySelectorAll("img").forEach((r,o)=>{const c=r.src||r.getAttribute("src");if(!c||c.includes("placeholder")||c.length<10)return;const g=r.alt||r.getAttribute("alt")||"",h=r.width||parseInt(r.getAttribute("width")||"0"),f=r.height||parseInt(r.getAttribute("height")||"0"),p=new RegExp(`<img[^>]*src=['"]${$(c)}['"][^>]*>`,"i"),u=e.match(p),l=u?e.indexOf(u[0]):-1;a.push({id:`${t.id}-html-${n+o+1}`,url:c,name:g||`${t.title||"Image"} - ${o+1}`,tags:t.tags||[],snippetId:t.id,imageIndex:o,markdownPosition:l!==-1?l:void 0,width:h||void 0,height:f||void 0,format:d(c)})}),a}function $(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function x(e,t,n){const a=[],s=/!\[([^\]]*)\]\(([^)\s]+)(?:\s+"([^"]*)")?\)/g;let i,m=0;for(;(i=s.exec(e))!==null;){const r=i[1]||"",o=i[2],c=i[3]||"",g=i.index;!o||o.includes("placeholder")||o.length<10||(a.push({id:`${t.id}-md-${n+m+1}`,url:o,name:c||r||`${t.title||"Image"} - ${m+1}`,tags:t.tags||[],snippetId:t.id,imageIndex:m,markdownPosition:g,format:d(o)}),m++)}return a}function d(e){if(e.startsWith("data:image/")){const n=e.match(/data:image\/([a-z]+);/);return n?n[1].toUpperCase():void 0}const t=e.match(/\.([a-z]{3,4})(?:\?|$)/i);return t?t[1].toUpperCase():void 0}function k(e){const t=e.content||"";return!!(t.startsWith("data:image/")||t.includes("<img")||t.includes("!["))}export{w as e,k as s};

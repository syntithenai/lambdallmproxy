const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CaLBu1It.js","assets/index-CZRIoQTw.css"])))=>i.map(i=>d[i]);
import{j as e,bo as Se,bp as Ie,r as g,ba as ke,g as Ce,u as Be,bq as Ue,a as Ge,aI as _e,b8 as Ke,R as ne,aT as Ne,br as Fe}from"./index-CaLBu1It.js";const Oe=({image:c,isSelected:C,onToggleSelection:j,processingStatus:w,isNew:$=!1})=>e.jsxs("div",{className:`
        relative rounded-lg overflow-hidden border-2 transition-all
        ${C?"border-blue-500 shadow-lg":"border-gray-200"}
        ${$?"ring-4 ring-green-500 animate-pulse":""}
      `,children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("input",{type:"checkbox",checked:C,onChange:j,className:"w-5 h-5 rounded bg-white/80 backdrop-blur cursor-pointer"})}),e.jsx("img",{src:c.url,alt:c.name,className:"w-full h-auto object-cover",loading:"lazy"},c.url),w?.status==="processing"&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto"}),e.jsx("p",{className:"text-sm mt-2",children:w.message}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2 mx-4",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${w.progress}%`}})})]})}),w?.status==="error"&&e.jsx("div",{className:"absolute inset-0 bg-red-500/20 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-red-900 bg-white/90 p-2 rounded",children:[e.jsx("p",{className:"text-sm font-bold",children:"âŒ Error"}),e.jsx("p",{className:"text-xs",children:w.error})]})}),w?.status==="complete"&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-500 text-white px-2 py-1 rounded text-xs font-bold",children:"âœ“ Done"}),e.jsxs("div",{className:"p-2 bg-gray-50",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:c.name}),e.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:c.tags.map(d=>e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-xs rounded",children:d},d))}),c.width&&c.height&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.width," Ã— ",c.height,c.format&&` â€¢ ${c.format.toUpperCase()}`]})]})]}),We=({images:c,selectedImages:C,onToggleSelection:j,processingStatus:w,newlyGeneratedIds:$=new Set})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:[c.map(d=>e.jsx(Oe,{image:d,isSelected:C.has(d.id),onToggleSelection:()=>j(d.id),processingStatus:w.get(d.id),isNew:$.has(d.id)},d.id)),c.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg",children:"No images to display"}),e.jsx("p",{className:"text-sm",children:"Navigate from the Swag page to edit images"})]})]}),He=({onSelectAll:c,onSelectNone:C,selectedCount:j,totalCount:w})=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:c,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",disabled:j===w,children:"Select All"}),e.jsx("button",{onClick:C,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",disabled:j===0,children:"Select None"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[j," of ",w," selected"]})]}),qe=({selectedCount:c,onOperation:C,disabled:j})=>{const{features:w}=Se(),{settings:$,updateSettings:d}=Ie(),y=w?.imageEditingAI??!1,[v,z]=g.useState(null),N=g.useRef({});g.useEffect(()=>{const o=A=>{if(v&&N.current[v]){const x=N.current[v];x&&!x.contains(A.target)&&z(null)}};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[v]);const I=o=>`px-3 py-1.5 text-xs font-medium rounded transition-colors flex items-center gap-1 ${j||c===0?"bg-gray-100 text-gray-400 cursor-not-allowed":o?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,h="w-full text-left px-3 py-2 text-xs hover:bg-gray-100 transition-colors border-b border-gray-100 last:border-b-0",R="font-semibold text-gray-600 px-3 py-1 text-[10px] uppercase tracking-wider bg-gray-50",B=o=>{j||c===0||z(v===o?null:o)},a=o=>{C(o),z(null)};return e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-start",children:[e.jsxs("div",{className:"relative",ref:o=>{N.current.transform=o},children:[e.jsx("button",{onClick:()=>B("transform"),disabled:j||c===0,className:I(v==="transform"),children:"ðŸ”„ Transform â–¾"}),v==="transform"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[200px] max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:R,children:"Flip"}),e.jsx("button",{onClick:()=>a({type:"flip",params:{direction:"horizontal"},label:"Flip Horizontal"}),className:h,children:"â†”ï¸ Flip Horizontal"}),e.jsx("button",{onClick:()=>a({type:"flip",params:{direction:"vertical"},label:"Flip Vertical"}),className:h,children:"â†•ï¸ Flip Vertical"}),e.jsx("div",{className:R,children:"Rotate"}),e.jsx("button",{onClick:()=>a({type:"rotate",params:{degrees:90},label:"Rotate 90Â° CW"}),className:h,children:"â†» Rotate 90Â° Clockwise"}),e.jsx("button",{onClick:()=>a({type:"rotate",params:{degrees:270},label:"Rotate 90Â° CCW"}),className:h,children:"â†º Rotate 90Â° Counter-Clockwise"}),e.jsx("button",{onClick:()=>a({type:"rotate",params:{degrees:180},label:"Rotate 180Â°"}),className:h,children:"ðŸ”„ Rotate 180Â°"}),e.jsx("div",{className:R,children:"Crop (AI)"}),e.jsxs("button",{onClick:()=>a({type:"autocrop",params:{focus:"center"},label:"AI Auto-Crop"}),disabled:!y,className:h,title:y?"Intelligently crop to content":"Requires AI provider (OpenAI, Gemini, etc.)",children:["ðŸ¤– AI Auto-Crop ",!y&&"ðŸ”’"]}),e.jsxs("button",{onClick:()=>a({type:"facedetect",params:{focus:"face"},label:"AI Face-Crop"}),disabled:!y,className:h,title:y?"Crop to detected faces":"Requires AI provider (OpenAI, Gemini, etc.)",children:["ðŸ‘¤ AI Face-Crop ",!y&&"ðŸ”’"]}),e.jsx("div",{className:R,children:"Resize"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{percentage:50},label:"50%"}),className:h,children:"ðŸ”½ 50% Size"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{percentage:200},label:"200%"}),className:h,children:"ðŸ”¼ 200% Size"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{width:800,height:800},label:"Square 800Ã—800"}),className:h,children:"â¬œ To Square (800Ã—800)"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{width:1920,height:1080},label:"16:9 HD"}),className:h,children:"ðŸ“º To 16:9 (1920Ã—1080)"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{width:1600,height:1200},label:"4:3 Standard"}),className:h,children:"ðŸ“· To 4:3 (1600Ã—1200)"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{width:1500,height:1e3},label:"3:2 Photo"}),className:h,children:"ðŸ“¸ To 3:2 (1500Ã—1000)"})]})]}),e.jsxs("div",{className:"relative",ref:o=>{N.current.effects=o},children:[e.jsx("button",{onClick:()=>B("effects"),disabled:j||c===0,className:I(v==="effects"),children:"âœ¨ Effects â–¾"}),v==="effects"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[200px] max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:R,children:"Enhancement"}),e.jsx("button",{onClick:()=>a({type:"filter",params:{filter:"normalize"},label:"Auto Enhance"}),className:h,children:"ðŸ“Š Auto Enhance"}),e.jsx("div",{className:R,children:"Filters"}),e.jsx("button",{onClick:()=>a({type:"filter",params:{filter:"sepia"},label:"Sepia"}),className:h,children:"ðŸŸ¤ Sepia"}),e.jsx("button",{onClick:()=>a({type:"filter",params:{filter:"grayscale"},label:"Greyscale"}),className:h,children:"âš« Greyscale"}),e.jsx("div",{className:R,children:"Adjustments"}),e.jsx("button",{onClick:()=>a({type:"modulate",params:{brightness:1.2},label:"Brightness +20%"}),className:h,children:"â˜€ï¸ Brightness +20%"}),e.jsx("button",{onClick:()=>a({type:"modulate",params:{brightness:.8},label:"Brightness -20%"}),className:h,children:"ðŸŒ™ Brightness -20%"}),e.jsx("button",{onClick:()=>a({type:"modulate",params:{saturation:1.5},label:"Saturation +50%"}),className:h,children:"ðŸŽ¨ Saturation +50%"}),e.jsx("button",{onClick:()=>a({type:"modulate",params:{saturation:.5},label:"Saturation -50%"}),className:h,children:"ðŸŽ¨ Saturation -50%"}),e.jsx("button",{onClick:()=>a({type:"modulate",params:{hue:90},label:"Hue Shift +90Â°"}),className:h,children:"ðŸŒˆ Hue Shift +90Â°"}),e.jsx("div",{className:R,children:"Image Effects"}),e.jsx("button",{onClick:()=>a({type:"filter",params:{filter:"sharpen"},label:"Sharpen"}),className:h,children:"âœ¨ Sharpen"}),e.jsx("button",{onClick:()=>a({type:"filter",params:{filter:"blur",strength:3},label:"Blur"}),className:h,children:"ðŸŒ«ï¸ Blur"}),e.jsx("div",{className:R,children:"Borders"}),e.jsx("button",{onClick:()=>a({type:"extend",params:{top:20,bottom:20,left:20,right:20,background:{r:255,g:255,b:255}},label:"White Border"}),className:h,children:"â¬œ Add White Border (20px)"}),e.jsx("button",{onClick:()=>a({type:"extend",params:{top:20,bottom:20,left:20,right:20,background:{r:0,g:0,b:0}},label:"Black Border"}),className:h,children:"â¬› Add Black Border (20px)"})]})]}),e.jsx("button",{onClick:()=>a({type:"duplicate",params:{},label:"Duplicate"}),disabled:j||c===0,className:`px-3 py-1.5 text-xs font-medium rounded transition-colors flex items-center gap-1 ${j||c===0?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,title:"Duplicate selected images and save to SWAG",children:"ðŸ“‹ Duplicate"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"image-quality",className:"text-xs font-medium text-gray-700",children:"Image Quality:"}),e.jsxs("select",{id:"image-quality",value:$?.imageQuality||"low",onChange:o=>d({imageQuality:o.target.value}),className:"px-2 py-1.5 text-xs font-medium bg-white border border-gray-300 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500",title:"Default quality for AI image generation (affects cost)",children:[e.jsx("option",{value:"low",children:"Low (256Ã—256, cheapest)"}),e.jsx("option",{value:"medium",children:"Medium (512Ã—512)"}),e.jsx("option",{value:"high",children:"High (1024Ã—1024+, best)"})]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-3 flex justify-between items-center",children:[e.jsxs("span",{children:[c," image",c!==1?"s":""," selected"]}),c>0&&e.jsxs("span",{className:"text-gray-400",children:["Select operation above â€¢ ",v?"ðŸ“‚ Menu open":"ðŸ’¡ Click for more options"]})]})]})},Ve=({value:c,onChange:C,onSubmit:j,disabled:w,placeholder:$="Describe transformation (e.g., 'resize to 800px width', 'convert to grayscale', or 'add a dog')"})=>{const[d,y]=g.useState(!1),[v,z]=g.useState(!1),[N,I]=g.useState(!1),[h,R]=g.useState([]),[B,a]=g.useState(-1),o=g.useRef(null),A=g.useRef(null),x=g.useRef(!1),E=g.useRef(""),X=g.useRef(null),K=g.useRef(null),_=g.useRef(null),M=g.useRef(null),se=g.useRef(null),G=g.useRef(null);g.useEffect(()=>{const i=localStorage.getItem("imageEditorPromptHistory");if(i)try{R(JSON.parse(i))}catch(u){console.error("Failed to parse prompt history:",u)}},[]);const U=i=>{i.trim()&&(R(u=>{const T=u.filter(D=>D!==i),L=[i,...T].slice(0,50);return localStorage.setItem("imageEditorPromptHistory",JSON.stringify(L)),L}),a(-1))},me=async()=>{try{const i=await navigator.mediaDevices.getUserMedia({audio:!0});G.current=i;const u=new(window.AudioContext||window.webkitAudioContext);X.current=u;const T=u.createAnalyser();T.fftSize=256,T.smoothingTimeConstant=.8,K.current=T,u.createMediaStreamSource(i).connect(T);const D=T.frequencyBinCount,O=new Uint8Array(D);_.current=O,F()}catch(i){console.error("Error accessing microphone:",i)}},F=()=>{if(!K.current||!_.current||!se.current)return;const i=se.current,u=i.getContext("2d");if(!u)return;const T=K.current,L=_.current,D=T.frequencyBinCount,O=()=>{if(!d)return;M.current=requestAnimationFrame(O),T.getByteFrequencyData(L),u.fillStyle="rgba(15, 23, 42, 0.95)",u.fillRect(0,0,i.width,i.height);const le=i.width/D*2.5;let Z,ae=0;for(let V=0;V<D;V++){Z=L[V]/255*i.height*.8;const W=L[V]/255,pe=200,H=50+W*30,oe=40+W*30;u.fillStyle=`hsl(${pe}, ${H}%, ${oe}%)`,u.fillRect(ae,i.height-Z,le,Z),ae+=le+1}u.strokeStyle="rgba(148, 163, 184, 0.3)",u.lineWidth=1,u.beginPath(),u.moveTo(0,i.height/2),u.lineTo(i.width,i.height/2),u.stroke()};O()},Y=()=>{M.current&&(cancelAnimationFrame(M.current),M.current=null),G.current&&(G.current.getTracks().forEach(i=>i.stop()),G.current=null),X.current&&(X.current.close(),X.current=null)};g.useEffect(()=>{const i=window.SpeechRecognition||window.webkitSpeechRecognition;return i&&(z(!0),o.current=new i,o.current.continuous=!0,o.current.interimResults=!0,o.current.lang="en-US",o.current.maxAlternatives=1,o.current.onresult=u=>{let T="",L="";for(let D=u.resultIndex;D<u.results.length;D++){const O=u.results[D][0].transcript;u.results[D].isFinal?L+=O:T+=O}if((T.trim()||L.trim())&&(x.current||(x.current=!0,console.log("ðŸŽ¤ Speech detected, starting timeout...")),E.current=T,A.current&&clearTimeout(A.current),A.current=setTimeout(()=>{console.log("ðŸŽ¤ Silence detected, stopping..."),o.current&&o.current.stop()},2e3)),L){const D=(E.current+" "+L).trim();C(c?`${c} ${D}`:D),E.current=""}},o.current.onerror=u=>{if(console.error("Speech recognition error:",u.error),u.error==="no-speech"){if(console.log("ðŸŽ¤ No speech detected yet, continuing to listen..."),!x.current&&d)try{o.current.start()}catch{}}else y(!1),x.current=!1,A.current&&clearTimeout(A.current)},o.current.onend=()=>{console.log("ðŸŽ¤ Recognition ended"),y(!1),I(!1);const u=x.current;x.current=!1,E.current="",A.current&&clearTimeout(A.current),Y(),u&&c.trim()&&setTimeout(()=>{j()},500)}),()=>{o.current&&o.current.stop(),A.current&&clearTimeout(A.current),Y()}},[C,c,d]);const re=async()=>{if(o.current)if(d)o.current.stop(),y(!1),I(!1),Y();else try{I(!0),await me(),o.current.start(),y(!0)}catch(i){console.error("Error starting speech recognition:",i),y(!1),I(!1),Y()}};g.useEffect(()=>{const i=u=>{u.key==="Escape"&&N&&re()};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[N]);const ie=i=>{i.preventDefault(),c.trim()&&!w&&(U(c),j())},ue=i=>{if(i.key==="ArrowUp"&&!i.shiftKey){if(i.preventDefault(),h.length===0)return;const u=Math.min(B+1,h.length-1);a(u),C(h[u])}else if(i.key==="ArrowDown"&&!i.shiftKey){if(i.preventDefault(),B<=0){a(-1),C("");return}const u=B-1;a(u),C(h[u])}else i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),c.trim()&&!w&&(U(c),j()))};return e.jsxs("div",{className:"bg-white p-4",children:[e.jsxs("form",{onSubmit:ie,children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{value:c,onChange:i=>C(i.target.value),disabled:w,placeholder:$,tabIndex:1,className:"w-full border border-gray-300 rounded-lg p-3 pr-12 resize-none h-24 focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",onKeyDown:ue}),v&&e.jsx("button",{type:"button",onClick:re,disabled:w,tabIndex:3,className:`
                  absolute right-2 top-2 p-2 rounded-full transition-all
                  ${d?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}
                  ${w?"opacity-50 cursor-not-allowed":""}
                `,title:d?"Listening... Click to stop":"Click to speak command","aria-label":d?"Stop voice input":"Start voice input",children:e.jsxs("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"})]})})]}),e.jsx("button",{type:"submit",disabled:w||!c.trim(),tabIndex:2,className:`
              self-end px-6 py-3 rounded-lg font-medium transition-colors
              ${w||!c.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}
            `,children:"Apply"})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsx("strong",{children:"Examples:"}),' "resize to 800px width" â€¢ "convert to grayscale" â€¢ "rotate 90 degrees" â€¢ "add a dog" â€¢ "change background to sunset"',v&&e.jsxs(e.Fragment,{children:[" â€¢ ",e.jsx("strong",{children:"ðŸŽ¤ Voice:"})," Click microphone to speak commands (auto-submits)"]})," ","â€¢ Press ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Enter"})," to apply â€¢ ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Shift+Enter"})," for new line"]})]}),N&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm",children:e.jsxs("div",{className:"relative bg-slate-900 rounded-2xl shadow-2xl p-8 max-w-2xl w-full mx-4",children:[e.jsx("button",{onClick:re,className:"absolute top-4 right-4 text-slate-400 hover:text-white transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4 rounded-full bg-blue-500 bg-opacity-20",children:e.jsxs("svg",{className:"w-8 h-8 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"})]})}),e.jsx("h3",{className:"text-2xl font-semibold text-white mb-2",children:x.current?"Listening...":"Speak your command"}),e.jsx("p",{className:"text-slate-400 text-sm",children:x.current?"Processing your voice input...":'Try: "resize to 800 pixels" or "convert to grayscale"'})]}),e.jsx("div",{className:"mb-6 rounded-xl overflow-hidden border border-slate-700 shadow-inner",children:e.jsx("canvas",{ref:se,width:600,height:200,className:"w-full h-48"})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 text-slate-300",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"text-sm font-medium",children:x.current?"Speech detected":"Ready to listen"})]}),E.current&&e.jsx("div",{className:"mt-4 p-3 bg-slate-800 rounded-lg border border-slate-700",children:e.jsxs("p",{className:"text-slate-300 text-sm italic",children:['"',E.current,'"']})}),e.jsx("div",{className:"mt-6 text-center text-xs text-slate-500",children:"Click outside or press ESC to cancel â€¢ Stops automatically after 2 seconds of silence"})]})})]})},Je=({onSelect:c,onClose:C,allowMultiple:j=!0})=>{const{snippets:w}=ke(),[$,d]=g.useState(new Set),[y,v]=g.useState(""),z=g.useMemo(()=>{const a=[];return w.forEach(o=>{const A=/<img[^>]+src=["']([^"']+)["'][^>]*>/g;let x,E=0;for(;(x=A.exec(o.content))!==null;){const K=x[1];K&&(a.push({id:`${o.id}-img-${E}`,url:K,name:o.title||"Untitled",snippetId:o.id,imageIndex:E,tags:o.tags||[]}),E++)}const X=/!\[([^\]]*)\]\(([^)]+)\)/g;for(;(x=X.exec(o.content))!==null;){const K=x[2],_=x[1];K&&(a.push({id:`${o.id}-img-${E}`,url:K,name:_||o.title||"Untitled",snippetId:o.id,imageIndex:E,tags:o.tags||[]}),E++)}}),a},[w]),N=g.useMemo(()=>{if(!y.trim())return z;const a=y.toLowerCase();return z.filter(o=>o.name.toLowerCase().includes(a)||o.tags.some(A=>A.toLowerCase().includes(a)))},[z,y]),I=a=>{const o=new Set($);o.has(a)?o.delete(a):(j||o.clear(),o.add(a)),d(o)},h=()=>{d(new Set(N.map(a=>a.id)))},R=()=>{d(new Set)},B=()=>{const a=z.filter(o=>$.has(o.id));c(a)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"border-b border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Select Images from Swag"}),e.jsx("button",{onClick:C,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",placeholder:"Search images by name or tags...",value:y,onChange:a=>v(a.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:h,className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Select All"}),e.jsx("button",{onClick:R,className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Clear"})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[$.size," selected Â· ",N.length," total images"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:N.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:y?"No images found matching your search":"No images found in Swag"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:N.map(a=>e.jsxs("div",{onClick:()=>I(a.id),className:`relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${$.has(a.id)?"border-blue-500 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"aspect-square bg-gray-100",children:e.jsx("img",{src:a.url,alt:a.name,className:"w-full h-full object-cover",loading:"lazy"})}),$.has(a.id)&&e.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"p-2 bg-white",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 truncate",title:a.name,children:a.name}),a.tags.length>0&&e.jsxs("div",{className:"flex gap-1 mt-1 flex-wrap",children:[a.tags.slice(0,2).map((o,A)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded",children:o},A)),a.tags.length>2&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",a.tags.length-2]})]})]})]},a.id))})}),e.jsxs("div",{className:"border-t border-gray-200 p-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:C,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:B,disabled:$.size===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:["Add ",$.size," Image",$.size!==1?"s":""]})]})]})})};async function Qe(c,C){const w=`${await Ce()}/image-edit`,$=localStorage.getItem("google_oauth_token"),d=await fetch(w,{method:"POST",headers:{"Content-Type":"application/json",...$?{"X-Google-OAuth-Token":$}:{}},body:JSON.stringify(c)});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);if(!d.body)throw new Error("Response body is null");const y=d.body.getReader(),v=new TextDecoder;let z="";try{for(;;){const{done:N,value:I}=await y.read();if(N)break;z+=v.decode(I,{stream:!0});const h=z.split(`

`);z=h.pop()||"";for(const R of h)if(R.startsWith("data: ")){const B=R.substring(6);try{const a=JSON.parse(B);if(C(a),a.type==="error"||a.type==="complete")return}catch(a){console.error("Failed to parse SSE event:",a,B)}}}}finally{y.releaseLock()}}async function Xe(c,C,j){const $=`${await Ce()}/parse-image-command`,d=j||localStorage.getItem("google_oauth_token")||localStorage.getItem("access_token"),y=C?.filter(I=>I.enabled!==!1&&I.apiKey&&I.apiKey.trim()!=="")||[],v=y.length>0;console.log("ðŸ” [parseImageCommand] Sending request:",{hasGoogleToken:!!d,tokenSource:j?"parameter":"localStorage",tokenLength:d?.length,providersCount:y.length,hasValidProviders:v,providers:y.map(I=>({type:I.type,hasApiKey:!!I.apiKey,enabled:I.enabled})),willUseBackendProviders:!v});const z={command:c};v&&(z.providers=y);const N=await fetch($,{method:"POST",headers:{"Content-Type":"application/json",...d?{Authorization:`Bearer ${d}`,"X-Google-OAuth-Token":d}:{}},body:JSON.stringify(z)});if(!N.ok)throw new Error(`HTTP error! status: ${N.status}`);return await N.json()}const Ze=()=>{const c=Be(),C=Ue(),{addSnippet:j,updateSnippet:w,snippets:$}=ke(),{settings:d}=Ie(),{getToken:y}=Ge(),{features:v}=Se(),{providerCapabilities:z}=_e(),{showSuccess:N,showInfo:I,showWarning:h}=Ke(),R=C.state,B=R?.images||[],a=R?.editingSnippetId,[o,A]=g.useState(B),[x,E]=g.useState(()=>{const s=localStorage.getItem("image_editor_images");if(s)try{const r=localStorage.getItem("image_editor_selection"),n=JSON.parse(s);if(r&&n){const t=JSON.parse(r),l=n.map(f=>f.id),b=B.map(f=>f.id);if(l.length===b.length&&l.every(f=>b.includes(f))){const f=t.filter(m=>b.includes(m));if(f.length>0)return new Set(f)}}}catch(r){console.error("Failed to load persisted selection:",r)}return B.length>0?new Set(B.map(r=>r.id)):new Set}),[X]=g.useState([]),[K,_]=g.useState(new Map),[M,se]=g.useState(()=>{try{return localStorage.getItem("image_editor_command")||""}catch(s){return console.error("Failed to load persisted command:",s),""}}),[G,U]=g.useState(!1),[me]=g.useState(new Set),[F,Y]=g.useState(new Map),[re,ie]=g.useState(!1),[ue,i]=g.useState(!1),[u,T]=g.useState(!1),[L,D]=g.useState(""),[O,le]=g.useState("1024x768"),[Z,ae]=g.useState(!1),V=g.useRef(null),[W,pe]=g.useState([new Map(F)]),[H,oe]=g.useState(0),he=H>0,xe=H<W.length-1,be=()=>{if(!he)return;const s=H-1;oe(s),Y(new Map(W[s]))},ye=()=>{if(!xe)return;const s=H+1;oe(s),Y(new Map(W[s]))};ne.useEffect(()=>{if(W.length===0||W[H].size!==F.size||Array.from(F.entries()).some(([s,r])=>W[H].get(s)!==r)){const s=W.slice(0,H+1);s.push(new Map(F)),pe(s),oe(s.length-1)}},[F]),ne.useEffect(()=>{const s=r=>{(r.ctrlKey||r.metaKey)&&!r.shiftKey&&r.key==="z"?(r.preventDefault(),be()):(r.ctrlKey||r.metaKey)&&(r.shiftKey&&r.key==="z"||r.key==="y")&&(r.preventDefault(),ye())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[he,xe,H]),ne.useEffect(()=>{try{M.trim()?localStorage.setItem("image_editor_command",M):localStorage.removeItem("image_editor_command")}catch(s){console.error("Failed to persist command:",s)}},[M]),ne.useEffect(()=>{try{o.length>0&&localStorage.setItem("image_editor_images",JSON.stringify(o))}catch(s){console.error("Failed to persist images:",s)}},[o]),ne.useEffect(()=>{try{x.size>0?localStorage.setItem("image_editor_selection",JSON.stringify(Array.from(x))):localStorage.removeItem("image_editor_selection")}catch(s){console.error("Failed to persist selection:",s)}},[x]);const ee=[...X,...o].map(s=>{const r=F.get(s.id);return r?{...s,url:r}:s}),Ae=()=>{E(new Set(ee.map(s=>s.id)))},$e=()=>{E(new Set)},Ee=s=>{const r=new Set(x);r.has(s)?r.delete(s):r.add(s),E(r)},we=async s=>{if(x.size===0)return;if(s.type==="duplicate"){await ze();return}U(!0);const r=Array.from(x),n=ee.filter(t=>r.includes(t.id));try{await Qe({images:n.map(t=>({id:t.id,url:t.url})),operations:[s]},t=>{if(t.type==="image_start"&&t.imageId)_(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"processing",progress:0,message:`Starting ${s.label}...`}));else if(t.type==="progress"&&t.imageId)_(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"processing",progress:t.progress||0,message:t.currentOperation?`${t.currentOperation}... ${t.progress}%`:`${t.status}...`}));else if(t.type==="image_complete"&&t.imageId&&t.result){if(_(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"complete",progress:100,message:"Complete",result:t.result?.url})),t.result?.url&&(Y(b=>new Map(b).set(t.imageId,t.result.url)),ee.find(b=>b.id===t.imageId)?.snippetId?(Le(t.imageId,t.result.url),N("Image auto-saved to snippet")):(Pe(t.imageId,t.result.url),N("New snippet created")),t.result.didAutoResize&&t.result.originalDimensions&&t.result.dimensions&&I(`Auto-resized from ${t.result.originalDimensions.width}Ã—${t.result.originalDimensions.height} to ${t.result.dimensions.width}Ã—${t.result.dimensions.height} (max 1024Ã—768)`),t.cost&&t.cost.total>0)){const b=t.cost.isUserProvidedKey?`ðŸ’° Cost: $${t.cost.total.toFixed(4)} (Lambda only - your API key used)`:`ðŸ’° Cost: $${t.cost.total.toFixed(4)} (LLM: $${t.cost.llm.toFixed(4)}, Lambda: $${t.cost.lambda.toFixed(4)})`;I(b)}}else t.type==="image_error"&&t.imageId?_(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"error",progress:0,message:t.error||"Processing failed",error:t.error})):t.type==="complete"?console.log("All images processed:",t):t.type==="error"&&(console.error("API error:",t.error),alert(`Error: ${t.error}`))}),setTimeout(()=>{U(!1),r.forEach(t=>{_(l=>{const b=new Map(l);return b.delete(t),b})})},3e3)}catch(t){console.error("Image processing error:",t),alert(`Error processing images: ${t instanceof Error?t.message:String(t)}`),U(!1),r.forEach(l=>{_(b=>new Map(b).set(l,{imageId:l,status:"error",progress:0,message:"Failed",error:t instanceof Error?t.message:String(t)}))})}},Le=async(s,r)=>{const n=ee.find(l=>l.id===s);if(!n||!n.snippetId){console.warn("Cannot auto-update: image has no snippetId");return}const t=$.find(l=>l.id===n.snippetId);if(!t){console.error("Source snippet not found:",n.snippetId);return}try{const l=/<img[^>]+src=["']([^"']+)["'][^>]*>|!\[[^\]]*\]\(([^)]+)\)/g,b=[];let S;for(;(S=l.exec(t.content))!==null;)b.push(S[1]||S[2]);const f=n.imageIndex??0,m=b[f];if(!m){console.error("Could not find image URL at index",f);return}if(console.log("Auto-updating image:",{oldUrl:m,newUrl:r,isSwagImage:m.startsWith("swag-image://")}),m.startsWith("swag-image://")){const k=m.replace("swag-image://","");await Fe.updateImage(k,r),console.log("Updated IndexedDB image:",k)}else{let k=t.content;const J=`](${m})`;k=k.split(J).join(`](${r})`);const te=`src="${m}"`,p=`src='${m}'`;k=k.split(te).join(`src="${r}"`),k=k.split(p).join(`src='${r}'`),await w(n.snippetId,{content:k}),console.log("Updated snippet content for direct image URL")}console.log("Auto-updated snippet:",n.snippetId)}catch(l){console.error("Auto-update failed:",l)}},Pe=async(s,r)=>{const n=ee.find(t=>t.id===s);if(!n){console.warn("Cannot auto-create: image not found");return}try{const t=`Image - ${n.name||new Date().toLocaleString()}`,l=`<img src="${r}" alt="${n.name||"Generated image"}" />`;await j(l,"user",t),console.log("Auto-created snippet for new image:",s)}catch(t){console.error("Auto-create failed:",t)}},ze=async()=>{const s=Array.from(x),r=ee.filter(n=>s.includes(n.id));if(r.length!==0&&!(r.length>1&&!window.confirm(`Are you sure you want to duplicate ${r.length} images? This will create ${r.length} new snippets in SWAG.`))){U(!0);try{const n=[];for(const l of r){const b=`duplicate-${Date.now()}-${Math.random()}`,S=`${l.name} (Copy)`,f={id:b,url:l.url,name:S,tags:[...l.tags,"duplicated"]};n.push(f);try{const m=`Copy of: ${l.name}`,k=`![${S}](${l.url})`;await j(k,"user",m),console.log(`âœ… Duplicated and saved to SWAG: ${S}`)}catch(m){console.error("Failed to save duplicate to SWAG:",m),I(`Duplicated ${S} but failed to save to SWAG`)}}A(l=>[...l,...n]);const t=n.map(l=>l.id);E(new Set(t)),N(`Duplicated ${n.length} image${n.length>1?"s":""} and saved to SWAG`)}catch(n){console.error("Duplicate error:",n),alert(`Error duplicating images: ${n instanceof Error?n.message:String(n)}`)}finally{U(!1)}}},Re=s=>new Promise((r,n)=>{const t=new FileReader;t.onload=()=>r(t.result),t.onerror=n,t.readAsDataURL(s)}),je=async(s,r,n)=>new Promise(t=>{const l=new Image;l.onload=()=>{const b=document.createElement("canvas"),S=b.getContext("2d");let{width:f,height:m}=l;if(f>r||m>n){const k=Math.min(r/f,n/m);f=Math.floor(f*k),m=Math.floor(m*k)}b.width=f,b.height=m,S.drawImage(l,0,0,f,m),t(b.toDataURL("image/jpeg",.9))},l.src=s}),Te=async s=>{const r=s.target.files;if(!(!r||r.length===0)){ie(!0);try{const n=[];for(const t of Array.from(r)){const l=await Re(t),b=await je(l,1024,768),f={id:`upload-${Date.now()}-${Math.random()}`,url:b,name:t.name,tags:["uploaded"]};n.push(f)}A(t=>[...t,...n]),E(new Set(n.map(t=>t.id))),N(`Uploaded ${n.length} image(s)`)}catch(n){console.error("Upload error:",n),alert(`Failed to upload images: ${n instanceof Error?n.message:String(n)}`)}finally{ie(!1),V.current&&(V.current.value="")}}},De=s=>{A(r=>[...r,...s]),E(new Set(s.map(r=>r.id))),i(!1),N(`Loaded ${s.length} image(s) from Swag`)},ve=async()=>{if(L.trim()){ae(!0);try{console.log("ðŸ” [Generate] Checking auth tokens:"),console.log("  - google_access_token:",localStorage.getItem("google_access_token")?"EXISTS":"MISSING"),console.log("  - google_oauth_token:",localStorage.getItem("google_oauth_token")?"EXISTS":"MISSING"),console.log("  - access_token:",localStorage.getItem("access_token")?"EXISTS":"MISSING");let s=await y();if(console.log("ðŸ”‘ [Generate] getToken() returned:",s?`${s.substring(0,30)}...`:"NULL"),s||(s=localStorage.getItem("google_oauth_token")||localStorage.getItem("access_token"),s&&console.log("âš ï¸ [Generate] Using fallback token from localStorage")),!s)throw new Error("Please sign in to generate images. Click the Sign In button in the top right.");const r=await Ne(()=>import("./index-CaLBu1It.js").then(P=>P.cX),__vite__mapDeps([0,1])).then(P=>P.getCachedApiBase());console.log("ðŸ” UI providers:",d?.providers),console.log("ðŸ” Environment providers:",z);const n=(d?.providers||[]).filter(P=>{const ce=P.enabled!==!1,de=!!P.apiKey,ge=["openai","together","replicate","gemini"].includes(P.type);return console.log(`ðŸ” UI Provider ${P.type}: enabled=${ce}, hasApiKey=${de}, isImageProvider=${ge}`),ce&&de&&ge}),t=(z||[]).filter(P=>["openai","together","replicate","gemini"].includes(P.type)).map(P=>({id:P.id,type:P.type,apiEndpoint:P.endpoint||"",apiKey:"",enabled:P.enabled!==!1,source:"environment"}));console.log(`âœ… Found ${n.length} UI providers, ${t.length} environment providers`);const l=[...n,...t];if(l.length===0)throw new Error("No image generation provider configured. Please add OpenAI, Together, Replicate, or Gemini in Settings.");const b=["openai","together","gemini","replicate"];l.sort((P,ce)=>{const de=b.indexOf(P.type.toLowerCase()),ge=b.indexOf(ce.type.toLowerCase());return de-ge});const S=l[0];let f="dall-e-3";S.type.toLowerCase()==="together"?f="black-forest-labs/FLUX.1-schnell-Free":S.type.toLowerCase()==="replicate"?f="black-forest-labs/flux-schnell":S.type.toLowerCase()==="gemini"&&(f="imagen-3.0-generate-001"),console.log(`ðŸŽ¨ Generating image with ${S.type}:${f}`),console.log("ðŸ”‘ Using auth token:",s?`${s.substring(0,20)}...`:"NONE");const k={low:"standard",medium:"standard",high:"hd"}[d?.imageQuality||"low"];console.log(`ðŸŽ¨ Using image quality: ${d?.imageQuality||"low"} (mapped to: ${k})`);const J=await fetch(`${r}/generate-image`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({prompt:L,provider:S.type,model:f,size:O,quality:k,style:"natural",accessToken:s,imageQuality:d?.imageQuality||"low",openaiApiKey:S.type==="openai"?S.apiKey:void 0,togetherApiKey:S.type==="together"?S.apiKey:void 0,replicateApiKey:S.type==="replicate"?S.apiKey:void 0,geminiApiKey:S.type==="gemini"?S.apiKey:void 0})});if(!J.ok)throw new Error(`HTTP ${J.status}: ${J.statusText}`);const te=await J.json();if(!te.success)throw new Error(te.error||"Generation failed");let p=te.base64||te.imageUrl;if(!p)throw new Error("No image data returned from backend");p.startsWith("data:")||(p=`data:image/jpeg;base64,${p}`);const Q=await je(p,1024,768),q=`generated-${Date.now()}`,fe={id:q,url:Q,name:`Generated: ${L.substring(0,50)}`,tags:["generated"]};A(P=>[...P,fe]),E(new Set([q])),N("Image generated successfully!")}catch(s){console.error("Generation error:",s),I(`Failed to generate: ${s instanceof Error?s.message:String(s)}`);const r=`generated-placeholder-${Date.now()}`,n={id:r,url:"data:image/svg+xml;base64,"+btoa(`
          <svg width="1024" height="768" xmlns="http://www.w3.org/2000/svg">
            <rect width="100%" height="100%" fill="#fee"/>
            <text x="50%" y="50%" text-anchor="middle" fill="#c00" font-size="20" font-family="Arial">
              Generation failed. Using placeholder.
            </text>
            <text x="50%" y="55%" text-anchor="middle" fill="#666" font-size="14" font-family="Arial">
              Prompt: ${L.substring(0,60)}
            </text>
          </svg>
        `),name:`Placeholder: ${L.substring(0,50)}`,tags:["placeholder"]};A(t=>[...t,n]),E(new Set([r]))}finally{ae(!1),T(!1),D("")}}},Me=async()=>{if(M.trim()){U(!0);try{if(x.size===0){console.log("ðŸŽ¨ No images selected - generating new image from prompt:",M);const t=await y(),{generateImage:l}=await Ne(async()=>{const{generateImage:p}=await import("./index-CaLBu1It.js").then(Q=>Q.cX);return{generateImage:p}},__vite__mapDeps([0,1])),b=d?.providers.filter(p=>p.enabled!==!1&&p.capabilities?.image!==!1&&(p.type==="openai"||p.type==="replicate"||p.type==="together"))||[];if(b.length===0){alert("No image generation provider configured. Please configure one in Settings."),U(!1);return}const S=b[0],f={};d?.providers.forEach(p=>{p.type==="openai"&&p.apiKey&&(f.openaiApiKey=p.apiKey),p.type==="replicate"&&p.apiKey&&(f.replicateApiKey=p.apiKey),p.type==="together"&&p.apiKey&&(f.togetherApiKey=p.apiKey),p.type==="gemini"&&p.apiKey&&(f.geminiApiKey=p.apiKey)});const m=await l(M,S.type,"","","1024x768","fast","vivid",t,f);if(!m.success||!m.imageUrl){alert(m.error||"Failed to generate image"),U(!1);return}let k=m.imageUrl;if(m.base64&&!m.base64.startsWith("data:"))k=`data:image/png;base64,${m.base64}`;else if(m.base64)k=m.base64;else if(m.imageUrl&&m.imageUrl.startsWith("http"))try{console.log("ðŸ”„ Converting HTTP image to base64 for persistent storage...");const Q=await(await fetch(m.imageUrl)).blob(),q=new FileReader;k=await new Promise((fe,P)=>{q.onloadend=()=>fe(q.result),q.onerror=P,q.readAsDataURL(Q)}),console.log("âœ… Converted to base64 for storage")}catch(p){console.error("Failed to convert image to base64:",p),k=m.imageUrl}const J=`generated-${Date.now()}-${Math.random()}`,te={id:J,url:k,name:`Generated: ${M.substring(0,50)}`,tags:["ai-generated"]};A(p=>[...p,te]),E(new Set([J]));try{const p=`AI Image: ${M.substring(0,80)}`,Q=`![Generated Image](${k})

**Prompt:** ${M}`;await j(Q,"user",p),console.log("âœ… Auto-saved generated image to SWAG"),N("Image generated and saved to SWAG")}catch(p){console.error("Failed to auto-save to SWAG:",p),N("Image generated (failed to save to SWAG)")}if(m.cost!==void 0&&m.cost>0){const Q=b.some(q=>q.apiKey&&q.apiKey.trim()!=="")?`ðŸ’° Generation cost: $${m.cost.toFixed(4)} (using your API key)`:`ðŸ’° Generation cost: $${m.cost.toFixed(4)} (includes 25% LLM markup + Lambda fees)`;I(Q)}se(""),U(!1);return}console.log("Parsing command:",M);const s=await y(),r=await Xe(M,d?.providers||[],s);if(!r.success||r.operations.length===0){h(r.explanation||'Could not understand command. Try: "make smaller", "rotate right", "convert to jpg", "remove glasses"'),U(!1);return}console.log("Parsed operations:",r.operations),r.operations.some(t=>t.type==="generate")&&console.log("ðŸŽ¨ Generative AI operations detected - will be processed by backend");for(const t of r.operations)await we(t);se("")}catch(s){console.error("Command parsing error:",s),alert(`Error: ${s instanceof Error?s.message:String(s)}`)}finally{U(!1)}}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[!v?.imageEditingBasic&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-start",children:[e.jsx("svg",{className:"w-6 h-6 text-red-400 mt-0.5 mr-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Image Editing Unavailable"}),e.jsx("div",{className:"mt-1 text-sm text-red-700",children:e.jsx("p",{children:"Image editing is currently unavailable. Please contact support."})})]})]})}),v?.imageEditingBasic&&!v?.imageEditingAI&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-start",children:[e.jsx("svg",{className:"w-6 h-6 text-blue-400 mt-0.5 mr-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"AI Features Limited"}),e.jsx("div",{className:"mt-1 text-sm text-blue-700",children:e.jsx("p",{children:"Basic editing is available. Configure image providers in settings for AI features (AI crop, image generation)."})})]})]})}),e.jsx("header",{className:"bg-white border-b border-gray-200 p-4 sticky top-0 z-20 shadow-sm",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>{a?c("/swag",{state:{editingSnippetId:a}}):c("/swag")},className:"flex items-center gap-2 text-gray-700 hover:text-gray-900 font-medium transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Swag"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:be,disabled:!he||G,className:"px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Undo (Ctrl+Z)",children:"â†¶ Undo"}),e.jsx("button",{onClick:ye,disabled:!xe||G,className:"px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Redo (Ctrl+Y)",children:"â†· Redo"})]}),e.jsxs("h1",{className:"text-xl font-bold text-gray-900",children:["Image Editor",x.size>0&&` (${x.size} selected)`]})]}),e.jsx("div",{className:"text-sm text-gray-600",children:F.size>0&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-lg bg-green-50 text-green-700 border border-green-200",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Auto-saved: ",F.size," image",F.size>1?"s":""]})})]})}),e.jsx("div",{className:"bg-white border-b border-gray-200 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>V.current?.click(),disabled:re||G,className:"flex items-center gap-2 px-3 sm:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"hidden sm:inline",children:re?"Uploading...":"ðŸ“ Upload File"}),e.jsx("span",{className:"sm:hidden",children:"ðŸ“"})]}),e.jsx("input",{ref:V,type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp,image/avif",multiple:!0,className:"hidden",onChange:Te}),e.jsxs("button",{onClick:()=>i(!0),disabled:G,className:"flex items-center gap-2 px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),e.jsx("span",{className:"hidden sm:inline",children:"ðŸ“š Select from Swag"}),e.jsx("span",{className:"sm:hidden",children:"ðŸ“š"})]}),e.jsxs("button",{onClick:()=>T(!0),disabled:!v?.imageEditingAI||G,className:`flex items-center gap-2 px-3 sm:px-4 py-2 rounded-lg transition-colors ${!v?.imageEditingAI||G?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,title:v?.imageEditingAI?"":"Configure image providers in settings to enable",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("span",{className:"hidden sm:inline",children:"âœ¨ Generate from Prompt"}),e.jsx("span",{className:"sm:hidden",children:"âœ¨"})]})]})}),ue&&e.jsx(Je,{onSelect:De,onClose:()=>i(!1),allowMultiple:!0}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Generate Image from Prompt"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),L.trim()&&!Z&&ve()},children:[e.jsx("textarea",{value:L,onChange:s=>D(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),L.trim()&&!Z&&ve())},placeholder:"Describe the image you want to create...",className:"w-full h-32 border border-gray-300 rounded p-3 mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500",tabIndex:1,autoFocus:!0}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Image Size"}),e.jsxs("select",{value:O,onChange:s=>le(s.target.value),className:"w-full border border-gray-300 rounded p-2 focus:outline-none focus:ring-2 focus:ring-purple-500",tabIndex:2,children:[e.jsx("option",{value:"1024x1024",children:"Square (1024Ã—1024)"}),e.jsx("option",{value:"1024x768",children:"Landscape (1024Ã—768)"}),e.jsx("option",{value:"768x1024",children:"Portrait (768Ã—1024)"}),e.jsx("option",{value:"1792x1024",children:"Wide (1792Ã—1024)"}),e.jsx("option",{value:"1024x1792",children:"Tall (1024Ã—1792)"})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{T(!1),D("")},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",tabIndex:4,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!L.trim()||Z,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",tabIndex:3,children:Z?"Generating...":"Generate Image"})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 text-center",children:["Press ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Enter"})," to generate â€¢ ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Shift+Enter"})," for new line"]})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(He,{onSelectAll:Ae,onSelectNone:$e,selectedCount:x.size,totalCount:ee.length}),e.jsx(We,{images:ee,selectedImages:x,onToggleSelection:Ee,processingStatus:K,newlyGeneratedIds:me})]})}),e.jsx("footer",{className:"bg-white border-t border-gray-200 sticky bottom-0 z-20 shadow-lg",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(qe,{selectedCount:x.size,onOperation:we,disabled:G}),e.jsx(Ve,{value:M,onChange:se,onSubmit:Me,disabled:G||x.size===0,placeholder:x.size===0?"Select images to apply transformations":"Describe transformation (e.g., 'resize to 800px width' or 'convert to grayscale')"})]})})]})};export{Ze as ImageEditorPage};

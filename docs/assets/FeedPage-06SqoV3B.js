import{aD as C,r,aE as D,bn as H,b8 as X,bo as G,j as e,b3 as A,a as Q,bp as L}from"./index-DPhdhRTJ.js";import{T as R,C as T}from"./trash-2-CVRkgaHV.js";import{X as Y,Q as V}from"./QuizCard-DUOjvQAk.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],_=C("bookmark",B);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],U=C("circle-alert",P);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],q=C("external-link",K);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]],W=C("hand",O);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Z=C("loader-circle",J);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],se=C("refresh-cw",ee);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ae=C("search",te);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],F=C("tag",re);function ne(s={}){const{threshold:a=100,onSwipeStart:p,onSwipeEnd:l,onSwipeProgress:f}=s,[x,i]=r.useState({direction:null,progress:0,isSwiping:!1}),c=r.useRef(0),m=r.useRef(0),j=r.useRef(0),o=r.useRef(!1),S=r.useRef(null),N=r.useCallback((t,n)=>{c.current=t,j.current=n,m.current=t,o.current=!1,i({direction:null,progress:0,isSwiping:!1}),p&&p()},[p]),k=r.useCallback((t,n)=>{if(c.current===0)return;m.current=t;const u=t-c.current,E=n-j.current;if(!o.current&&Math.abs(u)>Math.abs(E)&&Math.abs(u)>10&&(o.current=!0),o.current){const z=u>0?"right":"left",I=Math.min(Math.abs(u)/a,1);i({direction:z,progress:I,isSwiping:!0}),f&&f(I,z)}},[a,f]),h=r.useCallback(()=>{if(!o.current){c.current=0,j.current=0;return}const t=m.current-c.current,n=t>0?"right":"left",u=Math.abs(t);o.current=!1,c.current=0,j.current=0,m.current=0,i({direction:null,progress:0,isSwiping:!1}),u>=a&&l?l(n):l&&l(null)},[a,l]),g=r.useCallback(t=>{const n=t.touches[0];N(n.clientX,n.clientY)},[N]),y=r.useCallback(t=>{const n=t.touches[0];k(n.clientX,n.clientY),o.current&&t.preventDefault()},[k]),b=r.useCallback(()=>{h()},[h]),v=r.useCallback(t=>{N(t.clientX,t.clientY)},[N]),w=r.useCallback(t=>{k(t.clientX,t.clientY)},[k]),d=r.useCallback(()=>{h()},[h]),M=r.useCallback(t=>{S.current=t,t.addEventListener("touchstart",g,{passive:!0}),t.addEventListener("touchmove",y,{passive:!1}),t.addEventListener("touchend",b,{passive:!0}),t.addEventListener("mousedown",v),document.addEventListener("mousemove",w),document.addEventListener("mouseup",d)},[g,y,b,v,w,d]),$=r.useCallback(()=>{const t=S.current;t&&(t.removeEventListener("touchstart",g),t.removeEventListener("touchmove",y),t.removeEventListener("touchend",b),t.removeEventListener("mousedown",v),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",d))},[g,y,b,v,w,d]);return r.useEffect(()=>()=>{$()},[$]),{swipeState:x,attachListeners:M,detachListeners:$}}function le({item:s}){const{t:a}=D(),{stashItem:p,trashItem:l,markViewed:f,startQuiz:x,isGeneratingQuiz:i}=H(),{addSnippet:c}=X(),m=r.useRef(null),[j,o]=r.useState(!1),[S,N]=r.useState(!1),k=r.useRef(Date.now()),{swipeState:h,attachListeners:g,detachListeners:y}=ne({threshold:100,onSwipeEnd:t=>{t==="right"?v():t==="left"&&w()}});r.useEffect(()=>(m.current&&g(m.current),()=>{y()}),[g,y]),r.useEffect(()=>{if(!s.viewed){const t=setTimeout(()=>{f(s.id),b("view")},1e3);return()=>clearTimeout(t)}},[s.id,s.viewed,f]);const b=async t=>{const n=Date.now()-k.current,u=s.type==="did-you-know"?"didYouKnow":"questionAnswer";await G.saveInteraction({feedItemId:s.id,action:t,timeSpent:n,itemType:u,topics:s.topics||[],source:s.sources?.[0]||"unknown",content:s.content||""})},v=async()=>{await b("stash");let t=`**${s.title}**

`;s.image&&(t+=`![${s.title}](${s.image})

`,s.imageAttribution&&(t+=`*Image: ${s.imageAttribution}*

`)),t+=`${s.content}

`,t+=`**Topics:** ${s.topics.join(", ")}`,s.sources&&s.sources.length>0&&(t+=`

**Sources:**
`,s.sources.forEach((n,u)=>{t+=`${u+1}. ${n}
`})),await c(t,"tool",s.title),await p(s.id)},w=async()=>{await b("trash"),await l(s.id)},d=async()=>{await b("quiz"),await x(s.id)},M=()=>{if(!h.isSwiping)return"";const{progress:t,direction:n}=h,u=t*100;return`translateX(${n==="right"?u:-u}px)`},$=()=>{if(!h.isSwiping)return"transparent";const{progress:t,direction:n}=h,u=Math.min(t*.3,.3);return n==="right"?`rgba(34, 197, 94, ${u})`:`rgba(239, 68, 68, ${u})`};return e.jsxs("div",{ref:m,className:"bg-white rounded-lg shadow-sm overflow-hidden transition-all hover:shadow-md cursor-pointer relative",style:{transform:M(),backgroundColor:$(),transition:h.isSwiping?"none":"all 0.2s ease",display:"block",visibility:"visible",minHeight:"100px"},onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),children:[h.isSwiping&&e.jsxs(e.Fragment,{children:[h.direction==="right"&&e.jsxs("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-green-600 flex items-center gap-2",children:[e.jsx(_,{className:"h-6 w-6"}),e.jsx("span",{className:"font-semibold",children:a("feed.stash")})]}),h.direction==="left"&&e.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-red-600 flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:a("feed.trash")}),e.jsx(R,{className:"h-6 w-6"})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${s.type==="did-you-know"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:s.type==="did-you-know"?a("feed.didYouKnow"):a("feed.questionAnswer")}),s.stashed&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-700",children:a("feed.stashed")})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:s.title}),s.image&&e.jsxs("div",{className:"mb-3 rounded-lg overflow-hidden",children:[e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-48 object-cover"}),s.imageAttribution&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 bg-gray-50 p-2 rounded",dangerouslySetInnerHTML:{__html:s.imageAttributionHtml||s.imageAttribution}})]}),e.jsxs("div",{onClick:()=>o(!0),className:"cursor-pointer",children:[e.jsx("p",{className:"text-gray-700 mb-3 line-clamp-3",children:s.content}),s.mnemonic&&e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-3 mb-3 rounded",children:e.jsxs("p",{className:"text-sm font-medium text-purple-900",children:["ðŸ’¡ ",s.mnemonic]})}),s.expandedContent&&e.jsx("p",{className:"text-xs text-blue-600 hover:text-blue-700 font-medium mb-3",children:"Click to read more..."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:(()=>{try{const t=new Date(s.createdAt);return isNaN(t.getTime())?"Recently":t.toLocaleDateString()}catch{return"Recently"}})()})]}),s.topics.length>0&&e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"text-gray-700",children:s.topics.slice(0,3).join(", ")})]})]}),s.sources.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-1 font-semibold",children:[a("feed.sources"),":"]}),e.jsx("div",{className:"space-y-1",children:s.sources.slice(0,2).map((t,n)=>e.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:t})]},n))})]}),s.searchTerms&&s.searchTerms.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 mb-3",children:[e.jsx("p",{className:"text-xs text-gray-500 font-semibold inline",children:"Search: "}),s.searchTerms.map((t,n)=>e.jsxs("span",{children:[e.jsx("a",{href:`https://www.google.com/search?q=${encodeURIComponent(t)}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-700 hover:underline",title:`Search Google for "${t}"`,children:t}),n<(s.searchTerms?.length||0)-1&&e.jsx("span",{className:"text-xs text-gray-500",children:", "})]},n))]}),e.jsxs("div",{className:`flex gap-2 transition-opacity ${S||h.isSwiping?"opacity-100":"opacity-0 md:opacity-100"}`,children:[e.jsxs("button",{onClick:v,disabled:s.stashed,className:"flex-1 px-4 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),s.stashed?a("feed.stashed"):a("feed.stash")]}),e.jsxs("button",{onClick:d,className:"flex-1 px-4 py-2 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),a("feed.quiz")]}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors font-medium text-sm flex items-center justify-center gap-2",children:e.jsx(R,{className:"h-4 w-4"})})]})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>o(!1),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded ${s.type==="did-you-know"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:s.type==="did-you-know"?a("feed.didYouKnow"):a("feed.questionAnswer")}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mt-2",children:s.title})]}),e.jsx("button",{onClick:()=>o(!1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close",children:e.jsx(Y,{className:"h-6 w-6 text-gray-500"})})]}),e.jsxs("div",{className:"p-6",children:[s.image&&e.jsxs("div",{className:"mb-4 rounded-lg overflow-hidden",children:[e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-64 object-cover"}),s.imageAttribution&&e.jsx("div",{className:"text-xs text-gray-500 mt-2 bg-gray-50 p-2 rounded",dangerouslySetInnerHTML:{__html:s.imageAttributionHtml||s.imageAttribution}})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Summary"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.content})]}),s.mnemonic&&e.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-400 p-4 mb-4 rounded",children:[e.jsxs("p",{className:"text-sm font-medium text-purple-900 mb-2",children:["ðŸ’¡ ",s.mnemonic]}),s.topics.length>0&&e.jsxs("a",{href:`https://www.google.com/search?q=${encodeURIComponent(s.topics.join(" "))}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700 hover:underline",children:[e.jsx(ae,{className:"h-3 w-3"}),"Search more about this"]})]}),s.expandedContent&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ðŸ“– Deep Dive"}),e.jsx("div",{className:"text-gray-700 leading-relaxed space-y-3 whitespace-pre-line",children:s.expandedContent})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-gray-500 mb-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:(()=>{try{const t=new Date(s.createdAt);return isNaN(t.getTime())?"Recently":t.toLocaleDateString()}catch{return"Recently"}})()})]}),s.topics.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{children:s.topics.slice(0,3).join(", ")})]})]}),s.sources.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4 mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2 font-semibold",children:[a("feed.sources"),":"]}),e.jsx("div",{className:"space-y-2",children:s.sources.map((t,n)=>e.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:t})]},n))})]}),s.searchTerms&&s.searchTerms.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("p",{className:"text-sm text-gray-700 font-semibold inline",children:"Search: "}),s.searchTerms.map((t,n)=>e.jsxs("span",{children:[e.jsx("a",{href:`https://www.google.com/search?q=${encodeURIComponent(t)}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-700 hover:underline",title:`Search Google for "${t}"`,children:t}),n<(s.searchTerms?.length||0)-1&&e.jsx("span",{className:"text-sm text-gray-500",children:", "})]},n))]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 p-4 flex gap-3",children:[e.jsxs("button",{onClick:async()=>{await v(),o(!1)},className:`flex-1 px-4 py-3 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-colors ${s.stashed?"bg-green-100 text-green-700":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[e.jsx(_,{className:"h-5 w-5"}),s.stashed?a("feed.stashed"):a("feed.stash")]}),e.jsx("button",{onClick:async()=>{await d(),o(!1)},disabled:i,className:`flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium text-sm flex items-center justify-center gap-2 ${i?"opacity-50 cursor-not-allowed":""}`,children:i?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a("quiz.generating")]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-5 w-5"}),a("feed.quiz")]})}),e.jsx("button",{onClick:async()=>{await w(),o(!1)},className:"px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium text-sm flex items-center justify-center gap-2",children:e.jsx(R,{className:"h-5 w-5"})})]})]})})]})}function ce(s){return{title:s.title,questions:s.questions.map(a=>({id:a.id,prompt:a.prompt,choices:a.choices,answerId:a.correctChoiceId,explanation:a.explanation}))}}function oe({quiz:s,onClose:a}){const p=ce(s);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"w-full max-w-2xl",children:e.jsx(V,{quiz:p,onClose:a,onComplete:(l,f)=>{console.log(`Feed quiz completed: ${l}/${f}`)}})})})}function ie({availableTags:s,selectedTags:a,onChange:p,placeholder:l="Select tags...",className:f=""}){const x=c=>{a.includes(c)?p(a.filter(m=>m!==c)):p([...a,c])},i=()=>{p([])};return e.jsxs("div",{className:`space-y-2 ${f}`,children:[a.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-md",children:[a.map(c=>e.jsxs("button",{onClick:()=>x(c),className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded-full hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors",children:[c,e.jsx(Y,{className:"w-3 h-3"})]},c)),e.jsx("button",{onClick:i,className:"px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 underline",children:"Clear all"})]}),e.jsx("div",{className:"relative",children:e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer list-none px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a.length===0?l:`${a.length} tag(s) selected`})}),e.jsx("div",{className:"absolute z-10 mt-1 w-full max-h-60 overflow-auto bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg",children:s.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500 dark:text-gray-400",children:"No tags available"}):e.jsx("div",{className:"py-1",children:s.map(c=>e.jsx("button",{onClick:()=>x(c),className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${a.includes(c)?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:c}),a.includes(c)&&e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]})},c))})})]})})]})}function ue(){const{t:s}=D(),{isAuthenticated:a}=Q(),{getAllTags:p}=X(),{items:l,currentQuiz:f,isLoading:x,isGenerating:i,generationStatus:c,error:m,selectedTags:j,generateMore:o,refresh:S,closeQuiz:N,updateSelectedTags:k}=H(),h=r.useRef(null),g=r.useRef(null),y=r.useRef(null);r.useEffect(()=>{console.log("ðŸŽ¯ FeedPage: items changed:",l.length,"items"),console.log("ðŸŽ¯ Item titles:",l.map(d=>d.title)),console.log("ðŸŽ¯ Item IDs:",l.map(d=>d.id))},[l]),r.useEffect(()=>{if(!(!y.current||!a))return g.current&&g.current.disconnect(),g.current=new IntersectionObserver(d=>{const[M]=d;M.isIntersecting&&!x&&!i&&(console.log("ðŸ“œ Infinite scroll triggered"),o())},{root:null,rootMargin:"200px",threshold:.1}),g.current.observe(y.current),()=>{g.current&&g.current.disconnect()}},[a]);const b=r.useRef(!1);r.useEffect(()=>{console.log("ðŸŽ¬ Initial load effect triggered:",{isAuthenticated:a,itemsLength:l.length,initialLoadAttempted:b.current,isLoading:x,isGenerating:i}),a&&l.length===0&&!b.current&&!x&&(console.log("ðŸŽ¬ Initial load: starting feed generation"),b.current=!0,o())},[a,l.length,x]);const v=r.useCallback(async()=>{await S(),await o()},[S,o]),w=r.useCallback(async()=>{console.log("ðŸ“± Generate Feed button clicked"),console.log("ðŸ” generateMore function exists:",!!o),console.log("ðŸ” generateMore type:",typeof o);try{console.log("ðŸš€ About to call generateMore()..."),await o(),console.log("âœ… generateMore() completed")}catch(d){console.error("âŒ Generate failed:",d)}},[o]);return console.log("ðŸŽ¨ FeedPage render:",{isAuthenticated:a,isLoading:x,isGenerating:i,itemsCount:l.length,hasError:!!m}),a?e.jsxs("div",{ref:h,className:"bg-gray-50 pb-20",style:{minHeight:"100vh"},children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-6 w-6 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s("feed.title")})]}),e.jsx("button",{onClick:v,disabled:x||i,className:"p-2 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:s("feed.refresh"),children:e.jsx(se,{className:`h-5 w-5 text-gray-600 ${x||i?"animate-spin":""}`})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Filter by Swag Tags"}),e.jsx(ie,{availableTags:p(),selectedTags:j,onChange:k,placeholder:"All tags (no filter)"}),j.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Feed will use only Swag content tagged with: ",e.jsx("span",{className:"font-medium",children:j.join(", ")})]})]})]})}),m&&e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(U,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-900 mb-1",children:s("errors.error")}),e.jsx("p",{className:"text-sm text-red-700",children:m})]})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-4 space-y-4",children:[l.map((d,M)=>(console.log(`ðŸŽ´ Rendering FeedItemCard ${M+1}/${l.length}:`,d.id,d.title),e.jsx(le,{item:d},d.id))),l.length===0&&!x&&!i&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(L,{className:"mx-auto h-16 w-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s("feed.noItems")}),e.jsxs("p",{className:"text-gray-600 mb-6",children:[s("feed.emptyMessage"),e.jsx("br",{}),s("feed.emptySubMessage")]}),e.jsx("button",{onClick:w,disabled:i,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:s(i?"feed.generating":"feed.generateFeed")})]}),(x||i)&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 gap-3",children:[e.jsx(Z,{className:"h-8 w-8 text-blue-500 animate-spin"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-900 font-medium",children:s(i?"feed.generating":"common.loading")}),c&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 animate-pulse",children:c})]})]}),l.length>2&&e.jsxs("div",{className:"text-center py-4 text-gray-500 text-sm",children:["â†“ Scroll down to see more items (",l.length," total) â†“"]}),e.jsx("div",{ref:y,className:"h-4"})]}),f&&e.jsx(oe,{quiz:f,onClose:N})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md text-center",children:[e.jsx(L,{className:"mx-auto h-12 w-12 text-blue-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:s("feed.title")}),e.jsx("p",{className:"text-gray-600 mb-4",children:s("feed.emptyMessage")}),e.jsx("p",{className:"text-sm text-gray-500",children:s("common.pleaseSignIn")})]})})}export{ue as default};

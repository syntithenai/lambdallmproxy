const $=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","waitingforkey","resize","enterpictureinpicture","leavepictureinpicture","webkitbeginfullscreen","webkitendfullscreen","webkitpresentationmodechanged"],q=["autopictureinpicture","disablepictureinpicture","disableremoteplayback","autoplay","controls","controlslist","crossorigin","loop","muted","playsinline","poster","preload","src"];function C(e){return`
    <style>
      :host {
        display: inline-flex;
        line-height: 0;
        flex-direction: column;
        justify-content: end;
      }

      audio {
        width: 100%;
      }
    </style>
    <slot name="media">
      <audio${O(e)}></audio>
    </slot>
    <slot></slot>
  `}function V(e){return`
    <style>
      :host {
        display: inline-block;
        line-height: 0;
      }

      video {
        max-width: 100%;
        max-height: 100%;
        min-width: 100%;
        min-height: 100%;
        object-fit: var(--media-object-fit, contain);
        object-position: var(--media-object-position, 50% 50%);
      }

      video::-webkit-media-text-track-container {
        transform: var(--media-webkit-text-track-transform);
        transition: var(--media-webkit-text-track-transition);
      }
    </style>
    <slot name="media">
      <video${O(e)}></video>
    </slot>
    <slot></slot>
  `}function M(e,{tag:t,is:i}){const s=globalThis.document?.createElement?.(t,{is:i}),o=s?I(s):[];return class k extends e{static getTemplateHTML=t.endsWith("audio")?C:V;static shadowRootOptions={mode:"open"};static Events=$;static#t=!1;static get observedAttributes(){return k.#i(),[...s?.constructor?.observedAttributes??[],...q]}static#i(){if(this.#t)return;this.#t=!0;const n=new Set(this.observedAttributes);n.delete("muted");for(const d of o)if(!(d in this.prototype))if(typeof s[d]=="function")this.prototype[d]=function(...a){return this.#r(),this.call?this.call(d,...a):this.nativeEl?.[d]?.apply(this.nativeEl,a)};else{const a={get(){this.#r();const c=d.toLowerCase();if(n.has(c)){const u=this.getAttribute(c);return u===null?!1:u===""?!0:u}return this.get?.(d)??this.nativeEl?.[d]}};d!==d.toUpperCase()&&(a.set=function(c){this.#r();const u=d.toLowerCase();if(n.has(u)){c===!0||c===!1||c==null?this.toggleAttribute(u,!!c):this.setAttribute(u,c);return}if(this.set){this.set(d,c);return}this.nativeEl&&(this.nativeEl[d]=c)}),Object.defineProperty(this.prototype,d,a)}}#e=!1;#n=null;#s=new Map;#o;get;set;call;get nativeEl(){return this.#r(),this.#n??this.querySelector(":scope > [slot=media]")??this.querySelector(t)??this.shadowRoot?.querySelector(t)??null}set nativeEl(n){this.#n=n}get defaultMuted(){return this.hasAttribute("muted")}set defaultMuted(n){this.toggleAttribute("muted",n)}get src(){return this.getAttribute("src")}set src(n){this.setAttribute("src",`${n}`)}get preload(){return this.getAttribute("preload")??this.nativeEl?.preload}set preload(n){this.setAttribute("preload",`${n}`)}#r(){this.#e||(this.#e=!0,this.init())}init(){if(!this.shadowRoot){this.attachShadow({mode:"open"});const n=H(this.attributes);i&&(n.is=i),t&&(n.part=t),this.shadowRoot.innerHTML=this.constructor.getTemplateHTML(n)}this.nativeEl.muted=this.hasAttribute("muted");for(const n of o)this.#u(n);this.#o=new MutationObserver(this.#c.bind(this)),this.shadowRoot.addEventListener("slotchange",()=>this.#d()),this.#d();for(const n of this.constructor.Events)this.shadowRoot.addEventListener(n,this,!0)}handleEvent(n){n.target===this.nativeEl&&this.dispatchEvent(new CustomEvent(n.type,{detail:n.detail}))}#d(){const n=new Map(this.#s);(this.shadowRoot?.querySelector("slot:not([name])")?.assignedElements({flatten:!0}).filter(c=>["track","source"].includes(c.localName))).forEach(c=>{n.delete(c);let u=this.#s.get(c);u||(u=c.cloneNode(),this.#s.set(c,u),this.#o?.observe(c,{attributes:!0})),this.nativeEl?.append(u),this.#a(u)}),n.forEach((c,u)=>{c.remove(),this.#s.delete(u)})}#c(n){for(const d of n)if(d.type==="attributes"){const{target:a,attributeName:c}=d,u=this.#s.get(a);u&&c&&(u.setAttribute(c,a.getAttribute(c)??""),this.#a(u))}}#a(n){n&&n.localName==="track"&&n.default&&(n.kind==="chapters"||n.kind==="metadata")&&n.track.mode==="disabled"&&(n.track.mode="hidden")}#u(n){if(Object.prototype.hasOwnProperty.call(this,n)){const d=this[n];delete this[n],this[n]=d}}attributeChangedCallback(n,d,a){this.#r(),this.#h(n,d,a)}#h(n,d,a){["id","class"].includes(n)||!k.observedAttributes.includes(n)&&this.constructor.observedAttributes.includes(n)||(a===null?this.nativeEl?.removeAttribute(n):this.nativeEl?.getAttribute(n)!==a&&this.nativeEl?.setAttribute(n,a))}connectedCallback(){this.#r()}}}function I(e){const t=[];for(let i=Object.getPrototypeOf(e);i&&i!==HTMLElement.prototype;i=Object.getPrototypeOf(i)){const s=Object.getOwnPropertyNames(i);t.push(...s)}return t}function O(e){let t="";for(const i in e){if(!q.includes(i))continue;const s=e[i];s===""?t+=` ${i}`:t+=` ${i}="${s}"`}return t}function H(e){const t={};for(const i of e)t[i.name]=i.value;return t}const Z=M(globalThis.HTMLElement??class{},{tag:"video"});M(globalThis.HTMLElement??class{},{tag:"audio"});class p extends Event{track;constructor(t,i){super(t),this.track=i.track}}const m=new WeakMap;function r(e){return m.get(e)??z(e,{})}function z(e,t){let i=m.get(e);return i||m.set(e,i={}),Object.assign(i,t)}function y(e,t){const i=e.videoTracks;r(t).media=e,r(t).renditionSet||(r(t).renditionSet=new Set);const s=r(i).trackSet;s.add(t);const o=s.size-1;o in T.prototype||Object.defineProperty(T.prototype,o,{get(){return[...r(this).trackSet][o]}}),queueMicrotask(()=>{i.dispatchEvent(new p("addtrack",{track:t}))})}function b(e){const t=r(e).media?.videoTracks;if(!t)return;r(t).trackSet.delete(e),queueMicrotask(()=>{t.dispatchEvent(new p("removetrack",{track:e}))})}function B(e){const t=r(e).media.videoTracks??[];let i=!1;for(const s of t)s!==e&&(s.selected=!1,i=!0);if(i){if(r(t).changeRequested)return;r(t).changeRequested=!0,queueMicrotask(()=>{delete r(t).changeRequested,t.dispatchEvent(new Event("change"))})}}class T extends EventTarget{#t;#i;#e;constructor(){super(),r(this).trackSet=new Set}get#n(){return r(this).trackSet}[Symbol.iterator](){return this.#n.values()}get length(){return this.#n.size}getTrackById(t){return[...this.#n].find(i=>i.id===t)??null}get selectedIndex(){return[...this.#n].findIndex(t=>t.selected)}get onaddtrack(){return this.#t}set onaddtrack(t){this.#t&&(this.removeEventListener("addtrack",this.#t),this.#t=void 0),typeof t=="function"&&(this.#t=t,this.addEventListener("addtrack",t))}get onremovetrack(){return this.#i}set onremovetrack(t){this.#i&&(this.removeEventListener("removetrack",this.#i),this.#i=void 0),typeof t=="function"&&(this.#i=t,this.addEventListener("removetrack",t))}get onchange(){return this.#e}set onchange(t){this.#e&&(this.removeEventListener("change",this.#e),this.#e=void 0),typeof t=="function"&&(this.#e=t,this.addEventListener("change",t))}}class g extends Event{rendition;constructor(t,i){super(t),this.rendition=i.rendition}}function F(e,t){const i=r(e).media.videoRenditions;r(t).media=r(e).media,r(t).track=e;const s=r(e).renditionSet;s.add(t);const o=s.size-1;o in E.prototype||Object.defineProperty(E.prototype,o,{get(){return f(this)[o]}}),queueMicrotask(()=>{e.selected&&i.dispatchEvent(new g("addrendition",{rendition:t}))})}function D(e){const t=r(e).media.videoRenditions,i=r(e).track;r(i).renditionSet.delete(e),queueMicrotask(()=>{r(e).track.selected&&t.dispatchEvent(new g("removerendition",{rendition:e}))})}function N(e){const t=r(e).media.videoRenditions;!t||r(t).changeRequested||(r(t).changeRequested=!0,queueMicrotask(()=>{delete r(t).changeRequested,r(e).track.selected&&t.dispatchEvent(new Event("change"))}))}function f(e){return[...r(e).media.videoTracks].filter(i=>i.selected).flatMap(i=>[...r(i).renditionSet])}class E extends EventTarget{#t;#i;#e;[Symbol.iterator](){return f(this).values()}get length(){return f(this).length}getRenditionById(t){return f(this).find(i=>`${i.id}`==`${t}`)??null}get selectedIndex(){return f(this).findIndex(t=>t.selected)}set selectedIndex(t){for(const[i,s]of f(this).entries())s.selected=i===t}get onaddrendition(){return this.#t}set onaddrendition(t){this.#t&&(this.removeEventListener("addrendition",this.#t),this.#t=void 0),typeof t=="function"&&(this.#t=t,this.addEventListener("addrendition",t))}get onremoverendition(){return this.#i}set onremoverendition(t){this.#i&&(this.removeEventListener("removerendition",this.#i),this.#i=void 0),typeof t=="function"&&(this.#i=t,this.addEventListener("removerendition",t))}get onchange(){return this.#e}set onchange(t){this.#e&&(this.removeEventListener("change",this.#e),this.#e=void 0),typeof t=="function"&&(this.#e=t,this.addEventListener("change",t))}}class U{src;id;width;height;bitrate;frameRate;codec;#t=!1;get selected(){return this.#t}set selected(t){this.#t!==t&&(this.#t=t,N(this))}}class j{id;kind;label="";language="";sourceBuffer;#t=!1;addRendition(t,i,s,o,h,n){const d=new U;return d.src=t,d.width=i,d.height=s,d.frameRate=n,d.bitrate=h,d.codec=o,F(this,d),d}removeRendition(t){D(t)}get selected(){return this.#t}set selected(t){this.#t!==t&&(this.#t=t,t===!0&&B(this))}}function W(e,t){const i=r(e).media.audioRenditions;r(t).media=r(e).media,r(t).track=e;const s=r(e).renditionSet;s.add(t);const o=s.size-1;o in L.prototype||Object.defineProperty(L.prototype,o,{get(){return l(this)[o]}}),queueMicrotask(()=>{e.enabled&&i.dispatchEvent(new g("addrendition",{rendition:t}))})}function G(e){const t=r(e).media.audioRenditions,i=r(e).track;r(i).renditionSet.delete(e),queueMicrotask(()=>{r(e).track.enabled&&t.dispatchEvent(new g("removerendition",{rendition:e}))})}function J(e){const t=r(e).media.audioRenditions;!t||r(t).changeRequested||(r(t).changeRequested=!0,queueMicrotask(()=>{delete r(t).changeRequested,r(e).track.enabled&&t.dispatchEvent(new Event("change"))}))}function l(e){return[...r(e).media.audioTracks].filter(i=>i.enabled).flatMap(i=>[...r(i).renditionSet])}class L extends EventTarget{#t;#i;#e;[Symbol.iterator](){return l(this).values()}get length(){return l(this).length}getRenditionById(t){return l(this).find(i=>`${i.id}`==`${t}`)??null}get selectedIndex(){return l(this).findIndex(t=>t.selected)}set selectedIndex(t){for(const[i,s]of l(this).entries())s.selected=i===t}get onaddrendition(){return this.#t}set onaddrendition(t){this.#t&&(this.removeEventListener("addrendition",this.#t),this.#t=void 0),typeof t=="function"&&(this.#t=t,this.addEventListener("addrendition",t))}get onremoverendition(){return this.#i}set onremoverendition(t){this.#i&&(this.removeEventListener("removerendition",this.#i),this.#i=void 0),typeof t=="function"&&(this.#i=t,this.addEventListener("removerendition",t))}get onchange(){return this.#e}set onchange(t){this.#e&&(this.removeEventListener("change",this.#e),this.#e=void 0),typeof t=="function"&&(this.#e=t,this.addEventListener("change",t))}}class K{src;id;bitrate;codec;#t=!1;get selected(){return this.#t}set selected(t){this.#t!==t&&(this.#t=t,J(this))}}function R(e,t){const i=e.audioTracks;r(t).media=e,r(t).renditionSet||(r(t).renditionSet=new Set);const s=r(i).trackSet;s.add(t);const o=s.size-1;o in S.prototype||Object.defineProperty(S.prototype,o,{get(){return[...r(this).trackSet][o]}}),queueMicrotask(()=>{i.dispatchEvent(new p("addtrack",{track:t}))})}function w(e){const t=r(e).media?.audioTracks;if(!t)return;r(t).trackSet.delete(e),queueMicrotask(()=>{t.dispatchEvent(new p("removetrack",{track:e}))})}function Q(e){const t=r(e).media.audioTracks;!t||r(t).changeRequested||(r(t).changeRequested=!0,queueMicrotask(()=>{delete r(t).changeRequested,t.dispatchEvent(new Event("change"))}))}class S extends EventTarget{#t;#i;#e;constructor(){super(),r(this).trackSet=new Set}get#n(){return r(this).trackSet}[Symbol.iterator](){return this.#n.values()}get length(){return this.#n.size}getTrackById(t){return[...this.#n].find(i=>i.id===t)??null}get onaddtrack(){return this.#t}set onaddtrack(t){this.#t&&(this.removeEventListener("addtrack",this.#t),this.#t=void 0),typeof t=="function"&&(this.#t=t,this.addEventListener("addtrack",t))}get onremovetrack(){return this.#i}set onremovetrack(t){this.#i&&(this.removeEventListener("removetrack",this.#i),this.#i=void 0),typeof t=="function"&&(this.#i=t,this.addEventListener("removetrack",t))}get onchange(){return this.#e}set onchange(t){this.#e&&(this.removeEventListener("change",this.#e),this.#e=void 0),typeof t=="function"&&(this.#e=t,this.addEventListener("change",t))}}class P{id;kind;label="";language="";sourceBuffer;#t=!1;addRendition(t,i,s){const o=new K;return o.src=t,o.codec=i,o.bitrate=s,W(this,o),o}removeRendition(t){G(t)}get enabled(){return this.#t}set enabled(t){this.#t!==t&&(this.#t=t,Q(this))}}const A=v(globalThis.HTMLMediaElement,"video"),x=v(globalThis.HTMLMediaElement,"audio");function _(e){if(!e?.prototype)return e;const t=v(e,"video");(!t||`${t}`.includes("[native code]"))&&Object.defineProperty(e.prototype,"videoTracks",{get(){return X(this)}});const i=v(e,"audio");(!i||`${i}`.includes("[native code]"))&&Object.defineProperty(e.prototype,"audioTracks",{get(){return Y(this)}}),"addVideoTrack"in e.prototype||(e.prototype.addVideoTrack=function(h,n="",d=""){const a=new j;return a.kind=h,a.label=n,a.language=d,y(this,a),a}),"removeVideoTrack"in e.prototype||(e.prototype.removeVideoTrack=b),"addAudioTrack"in e.prototype||(e.prototype.addAudioTrack=function(h,n="",d=""){const a=new P;return a.kind=h,a.label=n,a.language=d,R(this,a),a}),"removeAudioTrack"in e.prototype||(e.prototype.removeAudioTrack=w),"videoRenditions"in e.prototype||Object.defineProperty(e.prototype,"videoRenditions",{get(){return s(this)}});const s=h=>{let n=r(h).videoRenditions;return n||(n=new E,r(n).media=h,r(h).videoRenditions=n),n};"audioRenditions"in e.prototype||Object.defineProperty(e.prototype,"audioRenditions",{get(){return o(this)}});const o=h=>{let n=r(h).audioRenditions;return n||(n=new L,r(n).media=h,r(h).audioRenditions=n),n};return e}function v(e,t){if(e?.prototype)return Object.getOwnPropertyDescriptor(e.prototype,`${t}Tracks`)?.get}function X(e){let t=r(e).videoTracks;if(!t&&(t=new T,r(e).videoTracks=t,A)){const i=A.call(e.nativeEl??e);for(const s of i)y(e,s);i.addEventListener("change",()=>{t.dispatchEvent(new Event("change"))}),i.addEventListener("addtrack",s=>{if([...t].some(o=>o instanceof j)){for(const o of i)b(o);return}y(e,s.track)}),i.addEventListener("removetrack",s=>{b(s.track)})}return t}function Y(e){let t=r(e).audioTracks;if(!t&&(t=new S,r(e).audioTracks=t,x)){const i=x.call(e.nativeEl??e);for(const s of i)R(e,s);i.addEventListener("change",()=>{t.dispatchEvent(new Event("change"))}),i.addEventListener("addtrack",s=>{if([...t].some(o=>o instanceof P)){for(const o of i)w(o);return}R(e,s.track)}),i.addEventListener("removetrack",s=>{w(s.track)})}return t}export{Z as C,_ as M};

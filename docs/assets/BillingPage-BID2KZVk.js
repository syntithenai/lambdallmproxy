import{aH as oe,a as Pe,aI as De,r as d,aJ as Be,aK as Ie,j as e,R as Oe}from"./index-Drh4wbhL.js";const Me=({isOpen:s,onClose:m,onConfirm:v,providers:E})=>{const{t:g}=oe(),[f,L]=d.useState("all"),[M,A]=d.useState(""),[w,T]=d.useState(""),[S,N]=d.useState(""),[C,D]=d.useState(!1);if(!s)return null;const q=()=>{const b={};f==="provider"?b.provider=M:f==="dateRange"&&(w&&(b.startDate=w),S&&(b.endDate=S)),v(f,b),D(!1),m()},I=()=>!(!C||f==="provider"&&!M||f==="dateRange"&&!w&&!S);return e.jsx("div",{className:"modal-overlay",onClick:m,children:e.jsxs("div",{className:"modal-content",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:g("billing.clearBillingData")}),e.jsx("button",{className:"modal-close",onClick:m,children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"warning-banner",children:g("billing.clearDataWarning")}),e.jsxs("div",{className:"clear-mode-tabs",children:[e.jsx("button",{className:f==="all"?"active":"",onClick:()=>L("all"),children:g("billing.clearAll")}),e.jsx("button",{className:f==="provider"?"active":"",onClick:()=>L("provider"),children:g("billing.clearByProvider")}),e.jsx("button",{className:f==="dateRange"?"active":"",onClick:()=>L("dateRange"),children:g("billing.clearByDateRange")})]}),e.jsxs("div",{className:"clear-mode-content",children:[f==="all"&&e.jsxs("div",{className:"clear-mode-description",children:[e.jsx("p",{children:g("billing.clearAllDescription")}),e.jsx("p",{children:g("billing.considerExportFirst")})]}),f==="provider"&&e.jsxs("div",{className:"clear-mode-options",children:[e.jsxs("label",{children:[g("billing.selectProvider"),e.jsxs("select",{value:M,onChange:b=>A(b.target.value),children:[e.jsx("option",{value:"",children:g("billing.selectProviderPlaceholder")}),E.map(b=>e.jsx("option",{value:b,children:b},b))]})]}),e.jsx("p",{className:"hint",children:g("billing.clearProviderHint")})]}),f==="dateRange"&&e.jsxs("div",{className:"clear-mode-options",children:[e.jsxs("label",{children:[g("billing.startDate"),":",e.jsx("input",{type:"date",value:w,onChange:b=>T(b.target.value)})]}),e.jsxs("label",{children:[g("billing.endDate"),":",e.jsx("input",{type:"date",value:S,onChange:b=>N(b.target.value)})]}),e.jsx("p",{className:"hint",children:g("billing.clearDateRangeHint")})]}),e.jsx("div",{className:"confirmation-checkbox",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:C,onChange:b=>D(b.target.checked)}),e.jsx("span",{children:g("billing.confirmUndoCheckbox")})]})})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:m,children:g("billing.cancel")}),e.jsx("button",{className:"btn-danger",onClick:q,disabled:!I(),children:g("billing.clearData")})]})]})})},Ae=()=>{const{t:s}=oe(),{accessToken:m,isAuthenticated:v}=Pe(),{refreshUsage:E}=De(),[g,f]=d.useState(null),[L,M]=d.useState(!0),[A,w]=d.useState(null),[T,S]=d.useState(""),[N,C]=d.useState(""),[D,q]=d.useState(""),[I,b]=d.useState(""),[ce,K]=d.useState(!1),[z,Q]=d.useState("overview"),[_,de]=d.useState(!0),[ge,pe]=d.useState(new Set),[H,he]=d.useState(0),[ue,me]=d.useState(0),[Fe,be]=d.useState(0),[V,R]=d.useState(!1),[P,xe]=d.useState("5.00"),[Y,J]=d.useState(!1),U=d.useRef(null),[j,F]=d.useState(1),[W,je]=d.useState(100);d.useEffect(()=>{console.log("ðŸ” [BillingPage] Auth State:",{isAuthenticated:v,hasAccessToken:!!m,tokenLength:m?.length||0})},[v,m]);const $=d.useCallback(async()=>{M(!0),w(null);try{if(console.log("ðŸ“Š [BillingPage] fetchBillingData called"),console.log("ðŸ“Š [BillingPage] accessToken present:",!!m),console.log("ðŸ“Š [BillingPage] isAuthenticated:",v),!m||!v){const h="Not authenticated. Please sign in.";throw console.error("âŒ [BillingPage] Authentication check failed:",h),new Error(h)}const t=await X(),n=`${t}/billing`;console.log("ðŸŒ [BillingPage] API Base:",t),console.log("ðŸŒ [BillingPage] Request URL:",n);const r={Authorization:`Bearer ${m}`,"Content-Type":"application/json"};console.log("ðŸ“¤ [BillingPage] Sending request to:",n),console.log("ðŸ“¤ [BillingPage] Request headers:",Object.keys(r));const p=await fetch(n,{method:"GET",headers:r});if(console.log("ðŸ“¥ [BillingPage] Response received:",{status:p.status,statusText:p.statusText,ok:p.ok,headers:Object.fromEntries(p.headers.entries())}),!p.ok){let h;try{h=await p.json()}catch(k){throw console.error("âŒ [BillingPage] Failed to parse error response:",k),new Error(`HTTP ${p.status}: ${p.statusText}`)}throw console.error("âŒ [BillingPage] Backend returned error:",h),new Error(h.message||h.error||`HTTP ${p.status}`)}const l=await p.json();if(console.log("ðŸ“Š Billing data received:",{source:l.source,transactionCount:l.transactions?.length,hasByType:!!l.totals?.byType,hasByProvider:!!l.totals?.byProvider,hasByModel:!!l.totals?.byModel,byTypeKeys:l.totals?.byType?Object.keys(l.totals.byType):[],byProviderKeys:l.totals?.byProvider?Object.keys(l.totals.byProvider):[],byModelKeys:l.totals?.byModel?Object.keys(l.totals.byModel):[]}),l.transactions&&l.transactions.length>0){const h=[...new Set(l.transactions.map(k=>k.type))];console.log("ðŸ“Š Unique transaction types in data:",h),console.log("ðŸ“Š Sample transactions:",l.transactions.slice(0,3))}l.source==="service"&&l.message&&(console.log("â„¹ï¸ Billing data source: Service key sheet"),console.log("â„¹ï¸ Message:",l.message)),f(l),console.log("âœ… [BillingPage] Billing data loaded successfully");let c=0,o=0,a=0;if(l.transactions)for(const h of l.transactions)if(h.type==="credit_added"){const k=Math.abs(h.cost);o+=k,c+=k,console.log(`ðŸ’³ Found credit: +$${k.toFixed(2)}, total credits: $${o.toFixed(2)}, balance: $${c.toFixed(2)}`)}else a+=h.cost,c-=h.cost;he(c),me(o),be(a),console.log(`ðŸ’³ Final summary - Balance: $${c.toFixed(4)}, Total Credits: $${o.toFixed(4)}, Total Expenses: $${a.toFixed(4)}`),E()}catch(t){console.error("âŒ [BillingPage] Error fetching billing data:",{message:t.message,stack:t.stack,name:t.name,error:t});const n=t.message||"Failed to load billing data";w(n),t.message?.includes("Not authenticated")?w("âŒ Not authenticated. Please sign in with Google to view billing data."):t.message?.includes("NetworkError")||t.message?.includes("Failed to fetch")?w("âŒ Network error. Please check your connection and ensure the backend server is running."):w(`âŒ Failed to load billing data: ${n}`)}finally{M(!1),console.log("ðŸ [BillingPage] fetchBillingData completed, loading:",!1)}},[m,v]),ye=async(t,n)=>{try{if(!m||!v)throw new Error("Not authenticated");const r=new URLSearchParams({mode:t});t==="provider"&&n.provider&&r.append("provider",n.provider),t==="dateRange"&&(n.startDate&&r.append("startDate",n.startDate),n.endDate&&r.append("endDate",n.endDate));const p=await X(),l=await fetch(`${p}/billing/clear?${r.toString()}`,{method:"DELETE",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"}});if(!l.ok){const o=await l.json();throw new Error(o.message||"Failed to clear data")}const c=await l.json();alert(s("billing.dataClearedSuccess",{count:c.deletedCount,remaining:c.remainingCount})),$()}catch(r){console.error("Error clearing data:",r),alert(s("billing.dataClearError",{message:r.message}))}},fe=()=>{if(!g||O.length===0){alert(s("billing.noDataToExport"));return}const t=["Timestamp","Type","Provider","Model","Tokens In","Tokens Out","Total Tokens","Cost ($)","Duration (ms)","Memory Limit (MB)","Memory Used (MB)","Request ID","Status","Error"],n=O.map(o=>[o.timestamp,o.type,o.provider,o.model,o.tokensIn,o.tokensOut,o.totalTokens,o.cost.toFixed(8),o.durationMs,o.memoryLimitMB||"",o.memoryUsedMB||"",o.requestId||"",o.status,o.error||""]),r=[t.join(","),...n.map(o=>o.map(a=>`"${a}"`).join(","))].join(`
`),p=new Blob([r],{type:"text/csv"}),l=URL.createObjectURL(p),c=document.createElement("a");c.href=l,c.download=`billing-${new Date().toISOString().split("T")[0]}.csv`,c.click(),URL.revokeObjectURL(l)},X=async()=>{const t=window.location.hostname;if(t==="localhost"||t==="127.0.0.1"){const n="http://localhost:3000";try{if((await fetch(n,{method:"OPTIONS",signal:AbortSignal.timeout(500)})).status!==void 0)return n}catch{}}return"https://nrw7pperjjdswbmqgmigbwsbyi0rwdqf.lambda-url.us-east-1.on.aws"};if(d.useEffect(()=>{v&&m&&$()},[v,m]),d.useEffect(()=>{if(!V||!U.current||!m)return;const t=setInterval(()=>{window.paypal&&(clearInterval(t),J(!0),U.current.innerHTML="",window.paypal.Buttons({createOrder:async()=>{try{const n=parseFloat(P);if(n<5)throw new Error("Minimum purchase is $5.00");const r=await Ie(n,m);if(!r.success||!r.orderId)throw new Error(r.error||"Failed to create order");return r.orderId}catch(n){throw console.error("PayPal createOrder error:",n),alert(`Error creating order: ${n.message}`),n}},onApprove:async n=>{try{const r=await Be(n.orderID,m);if(!r.success)throw new Error(r.error||"Failed to capture payment");R(!1),await $(),await E()}catch(r){console.error("PayPal onApprove error:",r),alert(`Error processing payment: ${r.message}`)}},onError:n=>{console.error("PayPal error:",n),alert("PayPal encountered an error. Please try again.")},style:{layout:"vertical",color:"blue",shape:"rect",label:"paypal"}}).render(U.current).then(()=>{J(!1)}).catch(n=>{console.error("PayPal render error:",n),J(!1)}))},100);return()=>clearInterval(t)},[V,P,m]),d.useEffect(()=>{F(1)},[T,N,D,I]),!v)return e.jsx("div",{className:"billing-page",children:e.jsxs("div",{className:"error-message",children:[e.jsx("h3",{children:s("billing.signInRequired")}),e.jsx("p",{children:s("billing.signInToViewBilling")}),e.jsxs("div",{className:"info-box",style:{marginTop:"20px",padding:"15px",background:"#e3f2fd",borderRadius:"8px",textAlign:"left"},children:[e.jsx("h4",{style:{marginTop:0,color:"#1976d2"},children:s("billing.howToAccessBilling")}),e.jsxs("ol",{style:{marginLeft:"20px",color:"#424242"},children:[e.jsx("li",{children:s("billing.signInStep1")}),e.jsx("li",{children:s("billing.signInStep2")})]}),e.jsx("p",{style:{marginTop:"15px",color:"#666",fontSize:"0.9em"},children:s("billing.billingDataNote")}),e.jsxs("details",{style:{marginTop:"15px",fontSize:"0.85em",color:"#888"},children:[e.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:s("billing.debugInfo")}),e.jsx("pre",{style:{marginTop:"10px",padding:"10px",background:"#f5f5f5",borderRadius:"4px",overflow:"auto"},children:JSON.stringify({isAuthenticated:v,hasAccessToken:!!m,tokenLength:m?.length||0,currentPath:window.location.pathname},null,2)})]})]})]})});if(L)return e.jsx("div",{className:"billing-page",children:e.jsx("div",{className:"loading",children:s("billing.loading")})});if(A)return e.jsx("div",{className:"billing-page",children:e.jsxs("div",{className:"error-message",children:[e.jsx("h3",{children:s("billing.errorLoading")}),e.jsx("p",{children:A}),e.jsx("button",{onClick:$,style:{marginTop:"15px"},children:s("billing.retry")})]})});if(!g)return e.jsx("div",{className:"billing-page",children:e.jsx("div",{className:"loading",children:s("billing.noBillingData")})});if(!g.transactions||g.transactions.length===0)return e.jsxs("div",{className:"billing-page",children:[e.jsxs("div",{className:"billing-header",children:[e.jsx("h1",{children:s("billing.title")}),e.jsx("p",{style:{color:"#666",marginTop:"8px"},children:g.message||s("billing.noTransactionsMessage")})]}),e.jsxs("div",{className:"info-box",style:{marginTop:"20px",padding:"20px",background:"#f5f5f5",borderRadius:"8px"},children:[e.jsx("h3",{style:{marginTop:0},children:s("billing.noBillingDataYet")}),e.jsx("p",{children:s("billing.startUsingChat")}),e.jsx("button",{onClick:$,style:{marginTop:"15px"},children:s("billing.refresh")})]})]});const O=g.transactions.filter(t=>{if(T||N){const n=new Date(t.timestamp);if(T&&n<new Date(T))return!1;if(N){const r=new Date(N);if(r.setHours(23,59,59,999),n>r)return!1}}return!(D&&String(t.type).toLowerCase()!==D.toLowerCase()||I&&t.provider.toLowerCase()!==I.toLowerCase())}),Z=O.length,B=Math.ceil(Z/W),ee=(j-1)*W,ve=ee+W,te=O.slice(ee,ve),x=((t,n=!1,r=!1)=>{const p={},l={},c={},o={};let a=0,h=0,k=0,le=0;const re=new Set(t.filter(i=>i.requestId&&i.type!=="lambda_invocation"&&i.type!=="credit_added").map(i=>i.requestId)).size,ae=t.filter(i=>i.type!=="summary"&&i.type!=="credit_added"&&i.type!=="lambda_invocation").length;return console.log("ðŸ“Š Transaction counts:",{totalTransactions:t.length,uniqueRequestIds:re,totalLLMCalls:ae,sampleTransactionTypes:t.slice(0,5).map(i=>({type:i.type,requestId:i.requestId,model:i.model}))}),t.forEach(i=>{if(!i||!i.model){console.warn("Skipping invalid transaction:",i);return}let u=i.provider||"unknown";if(u==="unknown"&&i.model&&(i.model.includes("gemini")?u="gemini":i.model.includes("gpt")||i.model.includes("o1-")?u="openai":(i.model.includes("llama")||i.model.includes("mixtral"))&&(u="groq")),u&&(u==="aws-lambda"||u.toLowerCase()==="aws")&&(u="aws"),u!==i.provider&&(i.provider=u),!(r&&u==="aws")){if((!n||String(i.type)!=="credit_added")&&(a+=i.cost),h+=i.totalTokens||0,k+=i.tokensIn||0,le+=i.tokensOut||0,u!=="aws"){const y=String(i.type);p[y]||(p[y]={cost:0,tokens:0,tokensIn:0,tokensOut:0,count:0}),p[y].cost+=i.cost,p[y].tokens+=i.totalTokens||0,p[y].tokensIn+=i.tokensIn||0,p[y].tokensOut+=i.tokensOut||0,p[y].count+=1}if(u!=="aws"&&(l[u]||(l[u]={cost:0,tokens:0,tokensIn:0,tokensOut:0,count:0}),l[u].cost+=i.cost,l[u].tokens+=i.totalTokens||0,l[u].tokensIn+=i.tokensIn||0,l[u].tokensOut+=i.tokensOut||0,l[u].count+=1),u!=="aws"&&(c[i.model]||(c[i.model]={cost:0,tokens:0,tokensIn:0,tokensOut:0,count:0,provider:u}),c[i.model].cost+=i.cost,c[i.model].tokens+=i.totalTokens||0,c[i.model].tokensIn+=i.tokensIn||0,c[i.model].tokensOut+=i.tokensOut||0,c[i.model].count+=1),u==="aws"){const y=i.model||"unknown";o[y]||(o[y]={cost:0,count:0,totalDuration:0,avgDuration:0,totalMemory:0,avgMemory:0}),o[y].cost+=i.cost,o[y].count+=1,o[y].totalDuration+=i.durationMs||0;let G=0;if(i.breakdownJson)try{G=JSON.parse(i.breakdownJson).memoryLimitMB||0}catch{G=i.memoryLimitMB||0}else G=i.memoryLimitMB||0;o[y].totalMemory+=G}}}),Object.values(o).forEach(i=>{i.count>0&&(i.avgDuration=i.totalDuration/i.count,i.avgMemory=i.totalMemory/i.count)}),{totalCost:a,totalTokens:h,totalTokensIn:k,totalTokensOut:le,totalUserQueries:re,totalLLMCalls:ae,byType:p,byProvider:l,byModel:c,byEndpoint:o}})(O,!0,!0),se=Array.from(new Set(g.transactions.map(t=>t.provider))).sort(),ke=Array.from(new Set(g.transactions.map(t=>String(t.type)))),ne=t=>{const n=new Map,r=[];t.forEach(l=>{if(l.requestId&&l.requestId!==""){const c=n.get(l.requestId)||[];c.push(l),n.set(l.requestId,c)}else r.push(l)}),n.forEach(l=>{l.sort((c,o)=>new Date(c.timestamp).getTime()-new Date(o.timestamp).getTime())}),r.sort((l,c)=>new Date(c.timestamp).getTime()-new Date(l.timestamp).getTime());const p=Array.from(n.entries()).sort(([,l],[,c])=>{const o=l[0].timestamp,a=c[0].timestamp;return new Date(a).getTime()-new Date(o).getTime()});return{grouped:new Map(p),ungrouped:r}},{grouped:ie,ungrouped:Se}=ne(te),{grouped:we,ungrouped:Te}=ne(O),Ne=t=>{pe(n=>{const r=new Set(n);return r.has(t)?r.delete(t):r.add(t),r})};return e.jsx("div",{className:"billing-page-container",children:e.jsxs("div",{className:"billing-page",children:[e.jsxs("div",{className:"billing-header",children:[e.jsx("div",{className:"billing-title",children:e.jsx("h1",{children:s("billing.title")})}),e.jsxs("div",{className:"billing-actions",children:[e.jsxs("button",{className:"btn-secondary flex items-center gap-1.5",onClick:fe,title:s("billing.exportCSV"),"aria-label":s("billing.exportCSV"),children:[e.jsx("span",{children:"ðŸ“¥"}),e.jsx("span",{className:"hidden md:inline",children:s("billing.exportCSV")})]}),g.source!=="service"&&e.jsxs("button",{className:"btn-danger flex items-center gap-1.5",onClick:()=>K(!0),title:s("billing.clearData"),"aria-label":s("billing.clearData"),children:[e.jsx("span",{children:"ðŸ—‘ï¸"}),e.jsx("span",{className:"hidden md:inline",children:s("billing.clearData")})]})]})]}),e.jsxs("div",{className:"billing-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:["ðŸ“… ",s("billing.startDate"),":",e.jsx("input",{type:"date",value:T,onChange:t=>S(t.target.value),placeholder:s("billing.startDate"),max:N||void 0})]}),e.jsxs("label",{children:["ðŸ“… ",s("billing.endDate"),":",e.jsx("input",{type:"date",value:N,onChange:t=>C(t.target.value),placeholder:s("billing.endDate"),min:T||void 0})]}),e.jsxs("label",{children:["ðŸ·ï¸ ",s("billing.type"),":",e.jsxs("select",{value:D,onChange:t=>q(t.target.value),children:[e.jsx("option",{value:"",children:s("billing.allTypes")}),ke.map(t=>e.jsx("option",{value:t,children:s(`billing.types.${t}`,t.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase()))},t))]})]}),e.jsxs("label",{children:["ðŸ”Œ ",s("billing.provider"),":",e.jsxs("select",{value:I,onChange:t=>b(t.target.value),children:[e.jsx("option",{value:"",children:s("billing.allProviders")}),se.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),(T||N||D||I)&&e.jsx("button",{className:"btn-clear-filters",onClick:()=>{S(""),C(""),q(""),b("")},children:s("billing.clearFilters")})]}),e.jsxs("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid #e0e0e0",display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.85rem",color:"#666",fontWeight:500},children:s("billing.quickRanges")}),e.jsx("button",{className:"btn-clear-filters",style:{fontSize:"0.8rem",padding:"0.4rem 0.8rem"},onClick:()=>{const t=new Date;S(t.toISOString().split("T")[0]),C(t.toISOString().split("T")[0])},children:s("billing.today")}),e.jsx("button",{className:"btn-clear-filters",style:{fontSize:"0.8rem",padding:"0.4rem 0.8rem"},onClick:()=>{const t=new Date,n=new Date(t);n.setDate(t.getDate()-7),S(n.toISOString().split("T")[0]),C(t.toISOString().split("T")[0])},children:s("billing.last7Days")}),e.jsx("button",{className:"btn-clear-filters",style:{fontSize:"0.8rem",padding:"0.4rem 0.8rem"},onClick:()=>{const t=new Date,n=new Date(t);n.setMonth(t.getMonth()-1),S(n.toISOString().split("T")[0]),C(t.toISOString().split("T")[0])},children:s("billing.last30Days")}),e.jsx("button",{className:"btn-clear-filters",style:{fontSize:"0.8rem",padding:"0.4rem 0.8rem"},onClick:()=>{const t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1);S(n.toISOString().split("T")[0]),C(t.toISOString().split("T")[0])},children:s("billing.thisMonth")})]})]}),e.jsxs("div",{className:"billing-tabs",children:[e.jsx("button",{className:z==="overview"?"active":"",onClick:()=>Q("overview"),children:s("billing.overview")}),e.jsxs("button",{className:z==="transactions"?"active":"",onClick:()=>Q("transactions"),children:[s("billing.transactions")," (",O.length,")"]})]}),z==="overview"&&e.jsxs("div",{className:"billing-overview",children:[e.jsxs("div",{className:"summary-cards",children:[e.jsxs("div",{className:"summary-card",style:{background:H>0?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",border:"2px solid rgba(255,255,255,0.3)"},children:[e.jsx("div",{className:"summary-label",style:{color:"rgba(255,255,255,0.9)",fontSize:"1.1rem",fontWeight:"bold",marginBottom:"8px"},children:s("billing.balance")}),e.jsxs("div",{className:"summary-value",style:{fontSize:"2.5rem",fontWeight:"bold",marginBottom:"12px"},children:["$",H.toFixed(2)]}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"rgba(255,255,255,0.7)",marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.2)"},children:[s("billing.totalCredits"),": $",ue.toFixed(2)]}),e.jsx("button",{style:{background:"white",color:"#764ba2",border:"none",padding:"8px 16px",borderRadius:"6px",fontSize:"0.85rem",fontWeight:"bold",cursor:"pointer",marginTop:"12px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onClick:()=>R(!0),children:s("billing.purchaseCredits")})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:s("billing.totalCost")}),e.jsxs("div",{className:"summary-value",children:["$",x.totalCost.toFixed(8)]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#666",marginTop:"4px"},children:s("billing.usageOnly")})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:s("billing.totalTokens")}),e.jsx("div",{className:"summary-value",children:x.totalTokens.toLocaleString()}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#666",marginTop:"4px"},children:[s("billing.tokensIn"),": ",x.totalTokensIn.toLocaleString()," | ",s("billing.tokensOut"),": ",x.totalTokensOut.toLocaleString()]})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:s("billing.totalRequests")}),e.jsxs("div",{className:"summary-value",children:[x.totalUserQueries," / ",x.totalLLMCalls]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#666",marginTop:"4px"},children:s("billing.userQueriesLlmCalls")})]})]}),x.byEndpoint&&Object.keys(x.byEndpoint).length>0&&e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h3",{children:"AWS Lambda Invocations"}),e.jsxs("table",{className:"breakdown-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Endpoint"}),e.jsx("th",{children:"Requests"}),e.jsx("th",{children:"Allocated Memory (MB)"}),e.jsx("th",{children:"Avg Duration (ms)"}),e.jsx("th",{children:"Total Cost ($)"})]})}),e.jsx("tbody",{children:Object.entries(x.byEndpoint).sort((t,n)=>n[1].cost-t[1].cost).map(([t,n])=>e.jsxs("tr",{children:[e.jsx("td",{children:t}),e.jsx("td",{children:n.count}),e.jsx("td",{children:n.avgMemory.toFixed(1)}),e.jsx("td",{children:n.avgDuration.toFixed(0)}),e.jsxs("td",{children:["$",n.cost.toFixed(8)]})]},t))})]})]}),x.byType&&Object.keys(x.byType).length>0&&e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h3",{children:s("billing.byType")}),e.jsxs("table",{className:"breakdown-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("billing.type")}),e.jsx("th",{children:s("billing.requests")}),e.jsx("th",{children:s("billing.tokensIn")}),e.jsx("th",{children:s("billing.tokensOut")}),e.jsx("th",{children:s("billing.totalTokens")}),e.jsx("th",{children:s("billing.cost")})]})}),e.jsx("tbody",{children:Object.entries(x.byType).map(([t,n])=>e.jsxs("tr",{children:[e.jsx("td",{children:t}),e.jsx("td",{children:n.count}),e.jsx("td",{children:n.tokensIn.toLocaleString()}),e.jsx("td",{children:n.tokensOut.toLocaleString()}),e.jsx("td",{children:n.tokens.toLocaleString()}),e.jsxs("td",{children:["$",n.cost.toFixed(8)]})]},t))})]})]}),x.byProvider&&Object.keys(x.byProvider).length>0&&e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h3",{children:s("billing.byProvider")}),e.jsxs("table",{className:"breakdown-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("billing.provider")}),e.jsx("th",{children:s("billing.requests")}),e.jsx("th",{children:s("billing.tokensIn")}),e.jsx("th",{children:s("billing.tokensOut")}),e.jsx("th",{children:s("billing.totalTokens")}),e.jsx("th",{children:s("billing.cost")})]})}),e.jsx("tbody",{children:Object.entries(x.byProvider).map(([t,n])=>e.jsxs("tr",{children:[e.jsx("td",{children:t}),e.jsx("td",{children:n.count}),e.jsx("td",{children:n.tokensIn.toLocaleString()}),e.jsx("td",{children:n.tokensOut.toLocaleString()}),e.jsx("td",{children:n.tokens.toLocaleString()}),e.jsxs("td",{children:["$",n.cost.toFixed(8)]})]},t))})]})]}),x.byModel&&Object.keys(x.byModel).length>0&&e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h3",{children:s("billing.byModel")}),e.jsxs("table",{className:"breakdown-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("billing.provider")}),e.jsx("th",{children:s("billing.model")}),e.jsx("th",{children:s("billing.requests")}),e.jsx("th",{children:s("billing.tokensIn")}),e.jsx("th",{children:s("billing.tokensOut")}),e.jsx("th",{children:s("billing.totalTokens")}),e.jsx("th",{children:s("billing.cost")})]})}),e.jsx("tbody",{children:Object.entries(x.byModel).filter(([t,n])=>n&&n.provider).sort((t,n)=>{const r=t[1].provider.localeCompare(n[1].provider);return r!==0?r:t[0].localeCompare(n[0])}).map(([t,n])=>e.jsxs("tr",{children:[e.jsx("td",{children:n.provider}),e.jsx("td",{children:t}),e.jsx("td",{children:n.count}),e.jsx("td",{children:n.tokensIn.toLocaleString()}),e.jsx("td",{children:n.tokensOut.toLocaleString()}),e.jsx("td",{children:n.tokens.toLocaleString()}),e.jsxs("td",{children:["$",n.cost.toFixed(8)]})]},t))})]})]})]}),z==="transactions"&&e.jsxs("div",{className:"billing-transactions",children:[e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",background:"#f5f5f5",borderRadius:"8px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:_,onChange:t=>de(t.target.checked),style:{cursor:"pointer"}}),e.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:s("billing.groupByRequestId")})]}),e.jsxs("select",{value:W,onChange:t=>{je(Number(t.target.value)),F(1)},style:{padding:"0.4rem 0.6rem",border:"1px solid #ccc",borderRadius:"4px",fontSize:"0.85rem"},children:[e.jsxs("option",{value:50,children:["50 ",s("billing.perPage")]}),e.jsxs("option",{value:100,children:["100 ",s("billing.perPage")]}),e.jsxs("option",{value:250,children:["250 ",s("billing.perPage")]}),e.jsxs("option",{value:500,children:["500 ",s("billing.perPage")]}),e.jsxs("option",{value:1e3,children:["1000 ",s("billing.perPage")]})]}),e.jsx("span",{style:{fontSize:"0.85rem",color:"#666",marginLeft:"auto"},children:_?s("billing.totalRequestGroups",{total:we.size,showing:ie.size,ungrouped:Te.length}):s("billing.totalTransactionsShowing",{total:Z,showing:te.length})})]}),e.jsxs("div",{className:"transactions-table-container",children:[e.jsxs("table",{className:"transactions-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[_&&e.jsx("th",{style:{width:"40px"},children:"â–¶"}),e.jsx("th",{children:s("billing.timestamp")}),e.jsx("th",{children:s("billing.type")}),e.jsx("th",{children:s("billing.provider")}),e.jsx("th",{children:s("billing.model")}),e.jsx("th",{children:s("billing.tokens")}),e.jsx("th",{children:s("billing.cost")}),e.jsx("th",{children:s("billing.duration")}),e.jsx("th",{children:s("billing.status")})]})}),e.jsx("tbody",{children:_?e.jsxs(e.Fragment,{children:[Array.from(ie.entries()).map(([t,n])=>{const r=ge.has(t),p=n.reduce((a,h)=>a+h.cost,0),l=n.reduce((a,h)=>a+h.totalTokens,0),c=n.reduce((a,h)=>a+h.durationMs,0),o=n[0];return e.jsxs(Oe.Fragment,{children:[e.jsxs("tr",{onClick:()=>Ne(t),style:{background:"#f0f0f0",fontWeight:500,cursor:"pointer",userSelect:"none"},children:[e.jsx("td",{style:{textAlign:"center"},children:r?"â–¼":"â–¶"}),e.jsx("td",{children:new Date(o.timestamp).toLocaleString()}),e.jsx("td",{colSpan:3,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{children:s("billing.requestGroup",{count:n.length})}),e.jsxs("code",{style:{fontSize:"0.75rem",background:"#fff",padding:"2px 6px",borderRadius:"4px",color:"#666"},children:[t.substring(0,12),"..."]})]})}),e.jsx("td",{children:l.toLocaleString()}),e.jsx("td",{children:e.jsxs("strong",{children:["$",p.toFixed(8)]})}),e.jsxs("td",{children:[c,"ms"]}),e.jsx("td",{className:n.every(a=>a.status==="success")?"status-success":"status-error",children:n.every(a=>a.status==="success")?"success":"partial"})]}),r&&n.map((a,h)=>e.jsxs("tr",{style:{...String(a.type)==="guardrail_input"||String(a.type)==="guardrail_output"?{background:"#fffde7"}:String(a.type)==="image_generation"?{background:"#e3f2fd"}:String(a.type)==="tts"?{background:"#f3e5f5"}:{background:"#fafafa"},borderLeft:"3px solid #ddd"},children:[e.jsx("td",{style:{textAlign:"center",color:"#ccc"},children:"â””"}),e.jsx("td",{style:{paddingLeft:"2rem",fontSize:"0.9rem"},children:new Date(a.timestamp).toLocaleString()}),e.jsx("td",{children:String(a.type)==="guardrail_input"?"ðŸ›¡ï¸ Guardrail Input":String(a.type)==="guardrail_output"?"ðŸ›¡ï¸ Guardrail Output":String(a.type)==="image_generation"?"ðŸ–¼ï¸ Image Generation":String(a.type)==="tts"?"ðŸŽ™ï¸ Text-to-Speech":String(a.type)==="chat"?"Chat":String(a.type)==="embedding"?"Embedding":String(a.type)==="planning"?"Planning":typeof a.type=="string"?String(a.type).replace(/_/g," ").replace(/\b\w/g,k=>k.toUpperCase()):String(a.type)}),e.jsx("td",{children:a.provider}),e.jsx("td",{children:a.model}),e.jsx("td",{children:a.totalTokens.toLocaleString()}),e.jsxs("td",{children:["$",a.cost.toFixed(8)]}),e.jsxs("td",{children:[a.durationMs,"ms"]}),e.jsx("td",{className:a.status==="success"?"status-success":"status-error",children:a.status})]},`${t}-${h}`))]},t)}),Se.map((t,n)=>e.jsxs("tr",{style:String(t.type)==="guardrail_input"||String(t.type)==="guardrail_output"?{background:"#fffde7"}:String(t.type)==="image_generation"?{background:"#e3f2fd"}:String(t.type)==="tts"?{background:"#f3e5f5"}:{},children:[e.jsx("td",{style:{textAlign:"center",color:"#ccc"},children:"â€”"}),e.jsx("td",{children:new Date(t.timestamp).toLocaleString()}),e.jsx("td",{children:s(`billing.types.${t.type}`,{defaultValue:typeof t.type=="string"?String(t.type).replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()):String(t.type)})}),e.jsx("td",{children:t.provider}),e.jsx("td",{children:t.model}),e.jsx("td",{children:t.totalTokens.toLocaleString()}),e.jsxs("td",{children:["$",t.cost.toFixed(8)]}),e.jsxs("td",{children:[t.durationMs,"ms"]}),e.jsx("td",{className:t.status==="success"?"status-success":"status-error",children:t.status})]},`ungrouped-${n}`))]}):g.transactions.map((t,n)=>e.jsxs("tr",{style:String(t.type)==="guardrail_input"||String(t.type)==="guardrail_output"?{background:"#fffde7"}:String(t.type)==="image_generation"?{background:"#e3f2fd"}:String(t.type)==="tts"?{background:"#f3e5f5"}:{},children:[e.jsx("td",{children:new Date(t.timestamp).toLocaleString()}),e.jsx("td",{children:s(`billing.types.${t.type}`,{defaultValue:typeof t.type=="string"?String(t.type).replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()):String(t.type)})}),e.jsx("td",{children:t.provider}),e.jsx("td",{children:t.model}),e.jsx("td",{children:t.totalTokens.toLocaleString()}),e.jsxs("td",{children:["$",t.cost.toFixed(8)]}),e.jsxs("td",{children:[t.durationMs,"ms"]}),e.jsx("td",{className:t.status==="success"?"status-success":"status-error",children:t.status})]},n))})]}),e.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"center",alignItems:"center",gap:"1rem",padding:"1rem",borderTop:"1px solid #eee"},children:[e.jsxs("button",{onClick:()=>F(1),disabled:j===1,style:{padding:"0.5rem 0.75rem",border:"1px solid #ccc",borderRadius:"4px",background:j===1?"#f5f5f5":"white",cursor:j===1?"not-allowed":"pointer",fontSize:"0.85rem"},children:["â®ï¸ ",s("billing.first")]}),e.jsxs("button",{onClick:()=>F(j-1),disabled:j===1,style:{padding:"0.5rem 0.75rem",border:"1px solid #ccc",borderRadius:"4px",background:j===1?"#f5f5f5":"white",cursor:j===1?"not-allowed":"pointer",fontSize:"0.85rem"},children:["â—€ï¸ ",s("billing.prev")]}),e.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:500},children:[s("billing.page")," ",j," ",s("billing.of")," ",B]}),e.jsxs("button",{onClick:()=>F(j+1),disabled:j===B,style:{padding:"0.5rem 0.75rem",border:"1px solid #ccc",borderRadius:"4px",background:j===B?"#f5f5f5":"white",cursor:j===B?"not-allowed":"pointer",fontSize:"0.85rem"},children:[s("billing.next")," â–¶ï¸"]}),e.jsxs("button",{onClick:()=>F(B),disabled:j===B,style:{padding:"0.5rem 0.75rem",border:"1px solid #ccc",borderRadius:"4px",background:j===B?"#f5f5f5":"white",cursor:j===B?"not-allowed":"pointer",fontSize:"0.85rem"},children:[s("billing.last")," â­ï¸"]})]})]})]}),e.jsx(Me,{isOpen:ce,onClose:()=>K(!1),onConfirm:ye,providers:se}),V&&e.jsx("div",{className:"modal-overlay",onClick:()=>R(!1),children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),style:{maxWidth:"500px"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:s("billing.addCreditsTitle")}),e.jsx("button",{className:"modal-close",onClick:()=>R(!1),children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{style:{marginBottom:"20px"},children:e.jsx("p",{children:s("billing.purchaseCreditsDescription")})}),e.jsxs("div",{style:{padding:"15px",background:"#fff8e1",border:"1px solid #ffc107",borderRadius:"8px",marginBottom:"20px",fontSize:"0.95rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",color:"#f57c00"},children:"â„¹ï¸ Transparent Pricing Notice"}),e.jsxs("p",{style:{margin:"0 0 8px 0",color:"#5d4037"},children:["PayPal charges ",e.jsx("strong",{children:"2.9% + $0.30"})," per transaction for payment processing. To maintain transparent pricing, these fees are ",e.jsx("strong",{children:"deducted from your credit purchase"}),"."]}),e.jsxs("p",{style:{margin:0,color:"#5d4037",fontSize:"0.9rem"},children:["Example: $10.00 payment = $",(10-(10*.029+.3)).toFixed(2)," in credits (fee: $",(10*.029+.3).toFixed(2),")"]})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:s("billing.enterAmount")}),e.jsx("input",{type:"number",min:"5",step:"1",value:P,onChange:t=>xe(t.target.value),style:{width:"100%",padding:"10px",fontSize:"1rem",border:"1px solid #ddd",borderRadius:"4px"},placeholder:s("billing.minimumPurchase")})]}),e.jsxs("div",{style:{background:"#f5f5f5",padding:"15px",borderRadius:"4px",marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{children:"Payment Amount"}),e.jsxs("strong",{children:["$",parseFloat(P||"0").toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",fontSize:"0.9rem",color:"#d32f2f"},children:[e.jsx("span",{children:"PayPal Fee (2.9% + $0.30)"}),e.jsxs("span",{children:["-$",(parseFloat(P||"0")*.029+.3).toFixed(2)]})]}),e.jsx("div",{style:{borderTop:"1px solid #ddd",paddingTop:"8px",marginTop:"8px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold",color:"#2e7d32"},children:[e.jsx("span",{children:s("billing.creditsToAdd")}),e.jsxs("span",{children:["$",Math.max(0,parseFloat(P||"0")-(parseFloat(P||"0")*.029+.3)).toFixed(2)]})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.9rem",color:"#666",marginTop:"8px"},children:[e.jsx("span",{children:s("billing.newBalance")}),e.jsxs("span",{children:["$",(H+Math.max(0,parseFloat(P||"0")-(parseFloat(P||"0")*.029+.3))).toFixed(2)]})]})]}),e.jsx("div",{style:{padding:"12px",background:"#e3f2fd",borderRadius:"4px",fontSize:"0.9rem",marginBottom:"20px"},children:s("billing.tipUseOwnKeys")}),e.jsx("div",{ref:U,style:{minHeight:"150px",display:Y?"none":"block"}}),Y&&e.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#666"},children:s("billing.loadingPayPal")}),!window.paypal&&e.jsx("div",{style:{padding:"15px",background:"#fff3cd",border:"1px solid #ffc107",borderRadius:"4px",color:"#856404"},children:s("billing.paypalNotLoaded")})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn-secondary",onClick:()=>R(!1),children:s("common.close")})})]})})]})})};export{Ae as default};

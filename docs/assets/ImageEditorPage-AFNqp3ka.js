const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bd6EJdj1.js","assets/index-CZ_RePpw.css"])))=>i.map(i=>d[i]);
import{j as e,bh as ve,r as m,bl as Ne,g as Se,u as Te,bm as De,be as Me,a as Be,aF as Ge,b1 as _e,R as oe,aN as je,bn as Ke}from"./index-Bd6EJdj1.js";const Fe=({image:d,isSelected:A,onToggleSelection:v,processingStatus:j,isNew:N=!1})=>e.jsxs("div",{className:`
        relative rounded-lg overflow-hidden border-2 transition-all
        ${A?"border-blue-500 shadow-lg":"border-gray-200"}
        ${N?"ring-4 ring-green-500 animate-pulse":""}
      `,children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("input",{type:"checkbox",checked:A,onChange:v,className:"w-5 h-5 rounded bg-white/80 backdrop-blur cursor-pointer"})}),e.jsx("img",{src:d.url,alt:d.name,className:"w-full h-auto object-cover",loading:"lazy"},d.url),j?.status==="processing"&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto"}),e.jsx("p",{className:"text-sm mt-2",children:j.message}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2 mx-4",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${j.progress}%`}})})]})}),j?.status==="error"&&e.jsx("div",{className:"absolute inset-0 bg-red-500/20 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-red-900 bg-white/90 p-2 rounded",children:[e.jsx("p",{className:"text-sm font-bold",children:"❌ Error"}),e.jsx("p",{className:"text-xs",children:j.error})]})}),j?.status==="complete"&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-500 text-white px-2 py-1 rounded text-xs font-bold",children:"✓ Done"}),e.jsxs("div",{className:"p-2 bg-gray-50",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:d.name}),e.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:d.tags.map(o=>e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-xs rounded",children:o},o))}),d.width&&d.height&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[d.width," × ",d.height,d.format&&` • ${d.format.toUpperCase()}`]})]})]}),Ue=({images:d,selectedImages:A,onToggleSelection:v,processingStatus:j,newlyGeneratedIds:N=new Set})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:[d.map(o=>e.jsx(Fe,{image:o,isSelected:A.has(o.id),onToggleSelection:()=>v(o.id),processingStatus:j.get(o.id),isNew:N.has(o.id)},o.id)),d.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg",children:"No images to display"}),e.jsx("p",{className:"text-sm",children:"Navigate from the Swag page to edit images"})]})]}),Oe=({onSelectAll:d,onSelectNone:A,selectedCount:v,totalCount:j})=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:d,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",disabled:v===j,children:"Select All"}),e.jsx("button",{onClick:A,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",disabled:v===0,children:"Select None"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[v," of ",j," selected"]})]}),We=({selectedCount:d,onOperation:A,disabled:v})=>{const{features:j}=ve(),N=j?.imageEditingAI??!1,[o,I]=m.useState(null),E=m.useRef({});m.useEffect(()=>{const k=g=>{if(o&&E.current[o]){const c=E.current[o];c&&!c.contains(g.target)&&I(null)}};return document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[o]);const R=k=>`px-3 py-1.5 text-xs font-medium rounded transition-colors flex items-center gap-1 ${v||d===0?"bg-gray-100 text-gray-400 cursor-not-allowed":k?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,n="w-full text-left px-3 py-2 text-xs hover:bg-gray-100 transition-colors border-b border-gray-100 last:border-b-0",b="font-semibold text-gray-600 px-3 py-1 text-[10px] uppercase tracking-wider bg-gray-50",B=k=>{v||d===0||I(o===k?null:k)},h=k=>{A(k),I(null)};return e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-start",children:[e.jsxs("div",{className:"relative",ref:k=>{E.current.transform=k},children:[e.jsx("button",{onClick:()=>B("transform"),disabled:v||d===0,className:R(o==="transform"),children:"🔄 Transform ▾"}),o==="transform"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[200px] max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:b,children:"Flip"}),e.jsx("button",{onClick:()=>h({type:"flip",params:{direction:"horizontal"},label:"Flip Horizontal"}),className:n,children:"↔️ Flip Horizontal"}),e.jsx("button",{onClick:()=>h({type:"flip",params:{direction:"vertical"},label:"Flip Vertical"}),className:n,children:"↕️ Flip Vertical"}),e.jsx("div",{className:b,children:"Rotate"}),e.jsx("button",{onClick:()=>h({type:"rotate",params:{degrees:90},label:"Rotate 90° CW"}),className:n,children:"↻ Rotate 90° Clockwise"}),e.jsx("button",{onClick:()=>h({type:"rotate",params:{degrees:270},label:"Rotate 90° CCW"}),className:n,children:"↺ Rotate 90° Counter-Clockwise"}),e.jsx("button",{onClick:()=>h({type:"rotate",params:{degrees:180},label:"Rotate 180°"}),className:n,children:"🔄 Rotate 180°"}),e.jsx("div",{className:b,children:"Crop (AI)"}),e.jsxs("button",{onClick:()=>h({type:"autocrop",params:{focus:"center"},label:"AI Auto-Crop"}),disabled:!N,className:n,title:N?"Intelligently crop to content":"Requires AI provider (OpenAI, Gemini, etc.)",children:["🤖 AI Auto-Crop ",!N&&"🔒"]}),e.jsxs("button",{onClick:()=>h({type:"facedetect",params:{focus:"face"},label:"AI Face-Crop"}),disabled:!N,className:n,title:N?"Crop to detected faces":"Requires AI provider (OpenAI, Gemini, etc.)",children:["👤 AI Face-Crop ",!N&&"🔒"]}),e.jsx("div",{className:b,children:"Resize"}),e.jsx("button",{onClick:()=>h({type:"resize",params:{percentage:50},label:"50%"}),className:n,children:"🔽 50% Size"}),e.jsx("button",{onClick:()=>h({type:"resize",params:{percentage:200},label:"200%"}),className:n,children:"🔼 200% Size"}),e.jsx("button",{onClick:()=>h({type:"resize",params:{width:800,height:800},label:"Square 800×800"}),className:n,children:"⬜ To Square (800×800)"}),e.jsx("button",{onClick:()=>h({type:"resize",params:{width:1920,height:1080},label:"16:9 HD"}),className:n,children:"📺 To 16:9 (1920×1080)"}),e.jsx("button",{onClick:()=>h({type:"resize",params:{width:1600,height:1200},label:"4:3 Standard"}),className:n,children:"📷 To 4:3 (1600×1200)"}),e.jsx("button",{onClick:()=>h({type:"resize",params:{width:1500,height:1e3},label:"3:2 Photo"}),className:n,children:"📸 To 3:2 (1500×1000)"})]})]}),e.jsxs("div",{className:"relative",ref:k=>{E.current.effects=k},children:[e.jsx("button",{onClick:()=>B("effects"),disabled:v||d===0,className:R(o==="effects"),children:"✨ Effects ▾"}),o==="effects"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[200px] max-h-[500px] overflow-y-auto",children:[e.jsx("div",{className:b,children:"Enhancement"}),e.jsx("button",{onClick:()=>h({type:"filter",params:{filter:"normalize"},label:"Auto Enhance"}),className:n,children:"📊 Auto Enhance"}),e.jsx("div",{className:b,children:"Filters"}),e.jsx("button",{onClick:()=>h({type:"filter",params:{filter:"sepia"},label:"Sepia"}),className:n,children:"🟤 Sepia"}),e.jsx("button",{onClick:()=>h({type:"filter",params:{filter:"grayscale"},label:"Greyscale"}),className:n,children:"⚫ Greyscale"}),e.jsx("div",{className:b,children:"Adjustments"}),e.jsx("button",{onClick:()=>h({type:"modulate",params:{brightness:1.2},label:"Brightness +20%"}),className:n,children:"☀️ Brightness +20%"}),e.jsx("button",{onClick:()=>h({type:"modulate",params:{brightness:.8},label:"Brightness -20%"}),className:n,children:"🌙 Brightness -20%"}),e.jsx("button",{onClick:()=>h({type:"modulate",params:{saturation:1.5},label:"Saturation +50%"}),className:n,children:"🎨 Saturation +50%"}),e.jsx("button",{onClick:()=>h({type:"modulate",params:{saturation:.5},label:"Saturation -50%"}),className:n,children:"🎨 Saturation -50%"}),e.jsx("button",{onClick:()=>h({type:"modulate",params:{hue:90},label:"Hue Shift +90°"}),className:n,children:"🌈 Hue Shift +90°"}),e.jsx("div",{className:b,children:"Image Effects"}),e.jsx("button",{onClick:()=>h({type:"filter",params:{filter:"sharpen"},label:"Sharpen"}),className:n,children:"✨ Sharpen"}),e.jsx("button",{onClick:()=>h({type:"filter",params:{filter:"blur",strength:3},label:"Blur"}),className:n,children:"🌫️ Blur"}),e.jsx("div",{className:b,children:"Borders"}),e.jsx("button",{onClick:()=>h({type:"extend",params:{top:20,bottom:20,left:20,right:20,background:{r:255,g:255,b:255}},label:"White Border"}),className:n,children:"⬜ Add White Border (20px)"}),e.jsx("button",{onClick:()=>h({type:"extend",params:{top:20,bottom:20,left:20,right:20,background:{r:0,g:0,b:0}},label:"Black Border"}),className:n,children:"⬛ Add Black Border (20px)"})]})]}),e.jsx("button",{onClick:()=>h({type:"duplicate",params:{},label:"Duplicate"}),disabled:v||d===0,className:`px-3 py-1.5 text-xs font-medium rounded transition-colors flex items-center gap-1 ${v||d===0?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,title:"Duplicate selected images and save to SWAG",children:"📋 Duplicate"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-3 flex justify-between items-center",children:[e.jsxs("span",{children:[d," image",d!==1?"s":""," selected"]}),d>0&&e.jsxs("span",{className:"text-gray-400",children:["Select operation above • ",o?"📂 Menu open":"💡 Click for more options"]})]})]})},He=({value:d,onChange:A,onSubmit:v,disabled:j,placeholder:N="Describe transformation (e.g., 'resize to 800px width', 'convert to grayscale', or 'add a dog')"})=>{const[o,I]=m.useState(!1),[E,R]=m.useState(!1),[n,b]=m.useState(!1),[B,h]=m.useState([]),[k,g]=m.useState(-1),c=m.useRef(null),L=m.useRef(null),w=m.useRef(!1),$=m.useRef(""),J=m.useRef(null),F=m.useRef(null),K=m.useRef(null),M=m.useRef(null),Z=m.useRef(null),_=m.useRef(null);m.useEffect(()=>{const i=localStorage.getItem("imageEditorPromptHistory");if(i)try{h(JSON.parse(i))}catch(p){console.error("Failed to parse prompt history:",p)}},[]);const G=i=>{i.trim()&&(h(p=>{const T=p.filter(D=>D!==i),z=[i,...T].slice(0,50);return localStorage.setItem("imageEditorPromptHistory",JSON.stringify(z)),z}),g(-1))},ge=async()=>{try{const i=await navigator.mediaDevices.getUserMedia({audio:!0});_.current=i;const p=new(window.AudioContext||window.webkitAudioContext);J.current=p;const T=p.createAnalyser();T.fftSize=256,T.smoothingTimeConstant=.8,F.current=T,p.createMediaStreamSource(i).connect(T);const D=T.frequencyBinCount,O=new Uint8Array(D);K.current=O,U()}catch(i){console.error("Error accessing microphone:",i)}},U=()=>{if(!F.current||!K.current||!Z.current)return;const i=Z.current,p=i.getContext("2d");if(!p)return;const T=F.current,z=K.current,D=T.frequencyBinCount,O=()=>{if(!o)return;M.current=requestAnimationFrame(O),T.getByteFrequencyData(z),p.fillStyle="rgba(15, 23, 42, 0.95)",p.fillRect(0,0,i.width,i.height);const ie=i.width/D*2.5;let Q,se=0;for(let q=0;q<D;q++){Q=z[q]/255*i.height*.8;const W=z[q]/255,ue=200,H=50+W*30,re=40+W*30;p.fillStyle=`hsl(${ue}, ${H}%, ${re}%)`,p.fillRect(se,i.height-Q,ie,Q),se+=ie+1}p.strokeStyle="rgba(148, 163, 184, 0.3)",p.lineWidth=1,p.beginPath(),p.moveTo(0,i.height/2),p.lineTo(i.width,i.height/2),p.stroke()};O()},X=()=>{M.current&&(cancelAnimationFrame(M.current),M.current=null),_.current&&(_.current.getTracks().forEach(i=>i.stop()),_.current=null),J.current&&(J.current.close(),J.current=null)};m.useEffect(()=>{const i=window.SpeechRecognition||window.webkitSpeechRecognition;return i&&(R(!0),c.current=new i,c.current.continuous=!0,c.current.interimResults=!0,c.current.lang="en-US",c.current.maxAlternatives=1,c.current.onresult=p=>{let T="",z="";for(let D=p.resultIndex;D<p.results.length;D++){const O=p.results[D][0].transcript;p.results[D].isFinal?z+=O:T+=O}if((T.trim()||z.trim())&&(w.current||(w.current=!0,console.log("🎤 Speech detected, starting timeout...")),$.current=T,L.current&&clearTimeout(L.current),L.current=setTimeout(()=>{console.log("🎤 Silence detected, stopping..."),c.current&&c.current.stop()},2e3)),z){const D=($.current+" "+z).trim();A(d?`${d} ${D}`:D),$.current=""}},c.current.onerror=p=>{if(console.error("Speech recognition error:",p.error),p.error==="no-speech"){if(console.log("🎤 No speech detected yet, continuing to listen..."),!w.current&&o)try{c.current.start()}catch{}}else I(!1),w.current=!1,L.current&&clearTimeout(L.current)},c.current.onend=()=>{console.log("🎤 Recognition ended"),I(!1),b(!1);const p=w.current;w.current=!1,$.current="",L.current&&clearTimeout(L.current),X(),p&&d.trim()&&setTimeout(()=>{v()},500)}),()=>{c.current&&c.current.stop(),L.current&&clearTimeout(L.current),X()}},[A,d,o]);const te=async()=>{if(c.current)if(o)c.current.stop(),I(!1),b(!1),X();else try{b(!0),await ge(),c.current.start(),I(!0)}catch(i){console.error("Error starting speech recognition:",i),I(!1),b(!1),X()}};m.useEffect(()=>{const i=p=>{p.key==="Escape"&&n&&te()};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[n]);const ne=i=>{i.preventDefault(),d.trim()&&!j&&(G(d),v())},me=i=>{if(i.key==="ArrowUp"&&!i.shiftKey){if(i.preventDefault(),B.length===0)return;const p=Math.min(k+1,B.length-1);g(p),A(B[p])}else if(i.key==="ArrowDown"&&!i.shiftKey){if(i.preventDefault(),k<=0){g(-1),A("");return}const p=k-1;g(p),A(B[p])}else i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),d.trim()&&!j&&(G(d),v()))};return e.jsxs("div",{className:"bg-white p-4",children:[e.jsxs("form",{onSubmit:ne,children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{value:d,onChange:i=>A(i.target.value),disabled:j,placeholder:N,tabIndex:1,className:"w-full border border-gray-300 rounded-lg p-3 pr-12 resize-none h-24 focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",onKeyDown:me}),E&&e.jsx("button",{type:"button",onClick:te,disabled:j,tabIndex:3,className:`
                  absolute right-2 top-2 p-2 rounded-full transition-all
                  ${o?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}
                  ${j?"opacity-50 cursor-not-allowed":""}
                `,title:o?"Listening... Click to stop":"Click to speak command","aria-label":o?"Stop voice input":"Start voice input",children:e.jsxs("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"})]})})]}),e.jsx("button",{type:"submit",disabled:j||!d.trim(),tabIndex:2,className:`
              self-end px-6 py-3 rounded-lg font-medium transition-colors
              ${j||!d.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}
            `,children:"Apply"})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsx("strong",{children:"Examples:"}),' "resize to 800px width" • "convert to grayscale" • "rotate 90 degrees" • "add a dog" • "change background to sunset"',E&&e.jsxs(e.Fragment,{children:[" • ",e.jsx("strong",{children:"🎤 Voice:"})," Click microphone to speak commands (auto-submits)"]})," ","• Press ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Enter"})," to apply • ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Shift+Enter"})," for new line"]})]}),n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm",children:e.jsxs("div",{className:"relative bg-slate-900 rounded-2xl shadow-2xl p-8 max-w-2xl w-full mx-4",children:[e.jsx("button",{onClick:te,className:"absolute top-4 right-4 text-slate-400 hover:text-white transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4 rounded-full bg-blue-500 bg-opacity-20",children:e.jsxs("svg",{className:"w-8 h-8 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"})]})}),e.jsx("h3",{className:"text-2xl font-semibold text-white mb-2",children:w.current?"Listening...":"Speak your command"}),e.jsx("p",{className:"text-slate-400 text-sm",children:w.current?"Processing your voice input...":'Try: "resize to 800 pixels" or "convert to grayscale"'})]}),e.jsx("div",{className:"mb-6 rounded-xl overflow-hidden border border-slate-700 shadow-inner",children:e.jsx("canvas",{ref:Z,width:600,height:200,className:"w-full h-48"})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 text-slate-300",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"text-sm font-medium",children:w.current?"Speech detected":"Ready to listen"})]}),$.current&&e.jsx("div",{className:"mt-4 p-3 bg-slate-800 rounded-lg border border-slate-700",children:e.jsxs("p",{className:"text-slate-300 text-sm italic",children:['"',$.current,'"']})}),e.jsx("div",{className:"mt-6 text-center text-xs text-slate-500",children:"Click outside or press ESC to cancel • Stops automatically after 2 seconds of silence"})]})})]})},Ve=({onSelect:d,onClose:A,allowMultiple:v=!0})=>{const{snippets:j}=Ne(),[N,o]=m.useState(new Set),[I,E]=m.useState(""),R=m.useMemo(()=>{const g=[];return j.forEach(c=>{const L=/<img[^>]+src=["']([^"']+)["'][^>]*>/g;let w,$=0;for(;(w=L.exec(c.content))!==null;){const F=w[1];F&&(g.push({id:`${c.id}-img-${$}`,url:F,name:c.title||"Untitled",snippetId:c.id,imageIndex:$,tags:c.tags||[]}),$++)}const J=/!\[([^\]]*)\]\(([^)]+)\)/g;for(;(w=J.exec(c.content))!==null;){const F=w[2],K=w[1];F&&(g.push({id:`${c.id}-img-${$}`,url:F,name:K||c.title||"Untitled",snippetId:c.id,imageIndex:$,tags:c.tags||[]}),$++)}}),g},[j]),n=m.useMemo(()=>{if(!I.trim())return R;const g=I.toLowerCase();return R.filter(c=>c.name.toLowerCase().includes(g)||c.tags.some(L=>L.toLowerCase().includes(g)))},[R,I]),b=g=>{const c=new Set(N);c.has(g)?c.delete(g):(v||c.clear(),c.add(g)),o(c)},B=()=>{o(new Set(n.map(g=>g.id)))},h=()=>{o(new Set)},k=()=>{const g=R.filter(c=>N.has(c.id));d(g)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"border-b border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Select Images from Swag"}),e.jsx("button",{onClick:A,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",placeholder:"Search images by name or tags...",value:I,onChange:g=>E(g.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:B,className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Select All"}),e.jsx("button",{onClick:h,className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Clear"})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[N.size," selected · ",n.length," total images"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:n.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:I?"No images found matching your search":"No images found in Swag"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:n.map(g=>e.jsxs("div",{onClick:()=>b(g.id),className:`relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${N.has(g.id)?"border-blue-500 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"aspect-square bg-gray-100",children:e.jsx("img",{src:g.url,alt:g.name,className:"w-full h-full object-cover",loading:"lazy"})}),N.has(g.id)&&e.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"p-2 bg-white",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 truncate",title:g.name,children:g.name}),g.tags.length>0&&e.jsxs("div",{className:"flex gap-1 mt-1 flex-wrap",children:[g.tags.slice(0,2).map((c,L)=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded",children:c},L)),g.tags.length>2&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",g.tags.length-2]})]})]})]},g.id))})}),e.jsxs("div",{className:"border-t border-gray-200 p-4 flex justify-end gap-3",children:[e.jsx("button",{onClick:A,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:k,disabled:N.size===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:["Add ",N.size," Image",N.size!==1?"s":""]})]})]})})};async function qe(d,A){const j=`${await Se()}/image-edit`,N=localStorage.getItem("google_oauth_token"),o=await fetch(j,{method:"POST",headers:{"Content-Type":"application/json",...N?{"X-Google-OAuth-Token":N}:{}},body:JSON.stringify(d)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);if(!o.body)throw new Error("Response body is null");const I=o.body.getReader(),E=new TextDecoder;let R="";try{for(;;){const{done:n,value:b}=await I.read();if(n)break;R+=E.decode(b,{stream:!0});const B=R.split(`

`);R=B.pop()||"";for(const h of B)if(h.startsWith("data: ")){const k=h.substring(6);try{const g=JSON.parse(k);if(A(g),g.type==="error"||g.type==="complete")return}catch(g){console.error("Failed to parse SSE event:",g,k)}}}}finally{I.releaseLock()}}async function Je(d,A,v){const N=`${await Se()}/parse-image-command`,o=v||localStorage.getItem("google_oauth_token")||localStorage.getItem("access_token"),I=A?.filter(b=>b.enabled!==!1&&b.apiKey&&b.apiKey.trim()!=="")||[],E=I.length>0;console.log("🔍 [parseImageCommand] Sending request:",{hasGoogleToken:!!o,tokenSource:v?"parameter":"localStorage",tokenLength:o?.length,providersCount:I.length,hasValidProviders:E,providers:I.map(b=>({type:b.type,hasApiKey:!!b.apiKey,enabled:b.enabled})),willUseBackendProviders:!E});const R={command:d};E&&(R.providers=I);const n=await fetch(N,{method:"POST",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`,"X-Google-OAuth-Token":o}:{}},body:JSON.stringify(R)});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return await n.json()}const Qe=()=>{const d=Te(),A=De(),{addSnippet:v,updateSnippet:j,snippets:N}=Ne(),{settings:o}=Me(),{getToken:I}=Be(),{features:E}=ve(),{providerCapabilities:R}=Ge(),{showSuccess:n,showInfo:b,showWarning:B}=_e(),h=A.state,k=h?.images||[],g=h?.editingSnippetId,[c,L]=m.useState(k),[w,$]=m.useState(()=>{const s=localStorage.getItem("image_editor_images");if(s)try{const r=localStorage.getItem("image_editor_selection"),a=JSON.parse(s);if(r&&a){const t=JSON.parse(r),l=a.map(x=>x.id),f=k.map(x=>x.id);if(l.length===f.length&&l.every(x=>f.includes(x))){const x=t.filter(u=>f.includes(u));if(x.length>0)return new Set(x)}}}catch(r){console.error("Failed to load persisted selection:",r)}return k.length>0?new Set(k.map(r=>r.id)):new Set}),[J]=m.useState([]),[F,K]=m.useState(new Map),[M,Z]=m.useState(()=>{try{return localStorage.getItem("image_editor_command")||""}catch(s){return console.error("Failed to load persisted command:",s),""}}),[_,G]=m.useState(!1),[ge]=m.useState(new Set),[U,X]=m.useState(new Map),[te,ne]=m.useState(!1),[me,i]=m.useState(!1),[p,T]=m.useState(!1),[z,D]=m.useState(""),[O,ie]=m.useState("1024x768"),[Q,se]=m.useState(!1),q=m.useRef(null),[W,ue]=m.useState([new Map(U)]),[H,re]=m.useState(0),pe=H>0,he=H<W.length-1,xe=()=>{if(!pe)return;const s=H-1;re(s),X(new Map(W[s]))},fe=()=>{if(!he)return;const s=H+1;re(s),X(new Map(W[s]))};oe.useEffect(()=>{if(W.length===0||W[H].size!==U.size||Array.from(U.entries()).some(([s,r])=>W[H].get(s)!==r)){const s=W.slice(0,H+1);s.push(new Map(U)),ue(s),re(s.length-1)}},[U]),oe.useEffect(()=>{const s=r=>{(r.ctrlKey||r.metaKey)&&!r.shiftKey&&r.key==="z"?(r.preventDefault(),xe()):(r.ctrlKey||r.metaKey)&&(r.shiftKey&&r.key==="z"||r.key==="y")&&(r.preventDefault(),fe())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[pe,he,H]),oe.useEffect(()=>{try{M.trim()?localStorage.setItem("image_editor_command",M):localStorage.removeItem("image_editor_command")}catch(s){console.error("Failed to persist command:",s)}},[M]),oe.useEffect(()=>{try{c.length>0&&localStorage.setItem("image_editor_images",JSON.stringify(c))}catch(s){console.error("Failed to persist images:",s)}},[c]),oe.useEffect(()=>{try{w.size>0?localStorage.setItem("image_editor_selection",JSON.stringify(Array.from(w))):localStorage.removeItem("image_editor_selection")}catch(s){console.error("Failed to persist selection:",s)}},[w]);const Y=[...J,...c].map(s=>{const r=U.get(s.id);return r?{...s,url:r}:s}),Ie=()=>{$(new Set(Y.map(s=>s.id)))},ke=()=>{$(new Set)},Ce=s=>{const r=new Set(w);r.has(s)?r.delete(s):r.add(s),$(r)},be=async s=>{if(w.size===0)return;if(s.type==="duplicate"){await Ee();return}G(!0);const r=Array.from(w),a=Y.filter(t=>r.includes(t.id));try{await qe({images:a.map(t=>({id:t.id,url:t.url})),operations:[s]},t=>{if(t.type==="image_start"&&t.imageId)K(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"processing",progress:0,message:`Starting ${s.label}...`}));else if(t.type==="progress"&&t.imageId)K(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"processing",progress:t.progress||0,message:t.currentOperation?`${t.currentOperation}... ${t.progress}%`:`${t.status}...`}));else if(t.type==="image_complete"&&t.imageId&&t.result){if(K(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"complete",progress:100,message:"Complete",result:t.result?.url})),t.result?.url&&(X(f=>new Map(f).set(t.imageId,t.result.url)),Y.find(f=>f.id===t.imageId)?.snippetId?(Ae(t.imageId,t.result.url),n("Image auto-saved to snippet")):($e(t.imageId,t.result.url),n("New snippet created")),t.result.didAutoResize&&t.result.originalDimensions&&t.result.dimensions&&b(`Auto-resized from ${t.result.originalDimensions.width}×${t.result.originalDimensions.height} to ${t.result.dimensions.width}×${t.result.dimensions.height} (max 1024×768)`),t.cost&&t.cost.total>0)){const f=t.cost.isUserProvidedKey?`💰 Cost: $${t.cost.total.toFixed(4)} (Lambda only - your API key used)`:`💰 Cost: $${t.cost.total.toFixed(4)} (LLM: $${t.cost.llm.toFixed(4)}, Lambda: $${t.cost.lambda.toFixed(4)})`;b(f)}}else t.type==="image_error"&&t.imageId?K(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"error",progress:0,message:t.error||"Processing failed",error:t.error})):t.type==="complete"?console.log("All images processed:",t):t.type==="error"&&(console.error("API error:",t.error),alert(`Error: ${t.error}`))}),setTimeout(()=>{G(!1),r.forEach(t=>{K(l=>{const f=new Map(l);return f.delete(t),f})})},3e3)}catch(t){console.error("Image processing error:",t),alert(`Error processing images: ${t instanceof Error?t.message:String(t)}`),G(!1),r.forEach(l=>{K(f=>new Map(f).set(l,{imageId:l,status:"error",progress:0,message:"Failed",error:t instanceof Error?t.message:String(t)}))})}},Ae=async(s,r)=>{const a=Y.find(l=>l.id===s);if(!a||!a.snippetId){console.warn("Cannot auto-update: image has no snippetId");return}const t=N.find(l=>l.id===a.snippetId);if(!t){console.error("Source snippet not found:",a.snippetId);return}try{const l=/<img[^>]+src=["']([^"']+)["'][^>]*>|!\[[^\]]*\]\(([^)]+)\)/g,f=[];let S;for(;(S=l.exec(t.content))!==null;)f.push(S[1]||S[2]);const x=a.imageIndex??0,u=f[x];if(!u){console.error("Could not find image URL at index",x);return}if(console.log("Auto-updating image:",{oldUrl:u,newUrl:r,isSwagImage:u.startsWith("swag-image://")}),u.startsWith("swag-image://")){const C=u.replace("swag-image://","");await Ke.updateImage(C,r),console.log("Updated IndexedDB image:",C)}else{let C=t.content;const V=`](${u})`;C=C.split(V).join(`](${r})`);const ae=`src="${u}"`,y=`src='${u}'`;C=C.split(ae).join(`src="${r}"`),C=C.split(y).join(`src='${r}'`),await j(a.snippetId,{content:C}),console.log("Updated snippet content for direct image URL")}console.log("Auto-updated snippet:",a.snippetId)}catch(l){console.error("Auto-update failed:",l)}},$e=async(s,r)=>{const a=Y.find(t=>t.id===s);if(!a){console.warn("Cannot auto-create: image not found");return}try{const t=`Image - ${a.name||new Date().toLocaleString()}`,l=`<img src="${r}" alt="${a.name||"Generated image"}" />`;await v(l,"user",t),console.log("Auto-created snippet for new image:",s)}catch(t){console.error("Auto-create failed:",t)}},Ee=async()=>{const s=Array.from(w),r=Y.filter(a=>s.includes(a.id));if(r.length!==0&&!(r.length>1&&!window.confirm(`Are you sure you want to duplicate ${r.length} images? This will create ${r.length} new snippets in SWAG.`))){G(!0);try{const a=[];for(const l of r){const f=`duplicate-${Date.now()}-${Math.random()}`,S=`${l.name} (Copy)`,x={id:f,url:l.url,name:S,tags:[...l.tags,"duplicated"]};a.push(x);try{const u=`Copy of: ${l.name}`,C=`![${S}](${l.url})`;await v(C,"user",u),console.log(`✅ Duplicated and saved to SWAG: ${S}`)}catch(u){console.error("Failed to save duplicate to SWAG:",u),b(`Duplicated ${S} but failed to save to SWAG`)}}L(l=>[...l,...a]);const t=a.map(l=>l.id);$(new Set(t)),n(`Duplicated ${a.length} image${a.length>1?"s":""} and saved to SWAG`)}catch(a){console.error("Duplicate error:",a),alert(`Error duplicating images: ${a instanceof Error?a.message:String(a)}`)}finally{G(!1)}}},Le=s=>new Promise((r,a)=>{const t=new FileReader;t.onload=()=>r(t.result),t.onerror=a,t.readAsDataURL(s)}),ye=async(s,r,a)=>new Promise(t=>{const l=new Image;l.onload=()=>{const f=document.createElement("canvas"),S=f.getContext("2d");let{width:x,height:u}=l;if(x>r||u>a){const C=Math.min(r/x,a/u);x=Math.floor(x*C),u=Math.floor(u*C)}f.width=x,f.height=u,S.drawImage(l,0,0,x,u),t(f.toDataURL("image/jpeg",.9))},l.src=s}),ze=async s=>{const r=s.target.files;if(!(!r||r.length===0)){ne(!0);try{const a=[];for(const t of Array.from(r)){const l=await Le(t),f=await ye(l,1024,768),x={id:`upload-${Date.now()}-${Math.random()}`,url:f,name:t.name,tags:["uploaded"]};a.push(x)}L(t=>[...t,...a]),$(new Set(a.map(t=>t.id))),n(`Uploaded ${a.length} image(s)`)}catch(a){console.error("Upload error:",a),alert(`Failed to upload images: ${a instanceof Error?a.message:String(a)}`)}finally{ne(!1),q.current&&(q.current.value="")}}},Pe=s=>{L(r=>[...r,...s]),$(new Set(s.map(r=>r.id))),i(!1),n(`Loaded ${s.length} image(s) from Swag`)},we=async()=>{if(z.trim()){se(!0);try{console.log("🔍 [Generate] Checking auth tokens:"),console.log("  - google_access_token:",localStorage.getItem("google_access_token")?"EXISTS":"MISSING"),console.log("  - google_oauth_token:",localStorage.getItem("google_oauth_token")?"EXISTS":"MISSING"),console.log("  - access_token:",localStorage.getItem("access_token")?"EXISTS":"MISSING");let s=await I();if(console.log("🔑 [Generate] getToken() returned:",s?`${s.substring(0,30)}...`:"NULL"),s||(s=localStorage.getItem("google_oauth_token")||localStorage.getItem("access_token"),s&&console.log("⚠️ [Generate] Using fallback token from localStorage")),!s)throw new Error("Please sign in to generate images. Click the Sign In button in the top right.");const r=await je(()=>import("./index-Bd6EJdj1.js").then(P=>P.cD),__vite__mapDeps([0,1])).then(P=>P.getCachedApiBase());console.log("🔍 UI providers:",o.providers),console.log("🔍 Environment providers:",R);const a=(o.providers||[]).filter(P=>{const le=P.enabled!==!1,ce=!!P.apiKey,de=["openai","together","replicate","gemini"].includes(P.type);return console.log(`🔍 UI Provider ${P.type}: enabled=${le}, hasApiKey=${ce}, isImageProvider=${de}`),le&&ce&&de}),t=(R||[]).filter(P=>["openai","together","replicate","gemini"].includes(P.type)).map(P=>({id:P.id,type:P.type,apiEndpoint:P.endpoint||"",apiKey:"",enabled:P.enabled!==!1,source:"environment"}));console.log(`✅ Found ${a.length} UI providers, ${t.length} environment providers`);const l=[...a,...t];if(l.length===0)throw new Error("No image generation provider configured. Please add OpenAI, Together, Replicate, or Gemini in Settings.");const f=["openai","together","gemini","replicate"];l.sort((P,le)=>{const ce=f.indexOf(P.type.toLowerCase()),de=f.indexOf(le.type.toLowerCase());return ce-de});const S=l[0];let x="dall-e-3";S.type.toLowerCase()==="together"?x="black-forest-labs/FLUX.1-schnell-Free":S.type.toLowerCase()==="replicate"?x="black-forest-labs/flux-schnell":S.type.toLowerCase()==="gemini"&&(x="imagen-3.0-generate-001"),console.log(`🎨 Generating image with ${S.type}:${x}`),console.log("🔑 Using auth token:",s?`${s.substring(0,20)}...`:"NONE");const u=await fetch(`${r}/generate-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:z,provider:S.type,model:x,size:O,quality:"standard",style:"natural",accessToken:s,openaiApiKey:S.type==="openai"?S.apiKey:void 0,togetherApiKey:S.type==="together"?S.apiKey:void 0,replicateApiKey:S.type==="replicate"?S.apiKey:void 0,geminiApiKey:S.type==="gemini"?S.apiKey:void 0})});if(!u.ok)throw new Error(`HTTP ${u.status}: ${u.statusText}`);const C=await u.json();if(!C.success)throw new Error(C.error||"Generation failed");let V=C.base64||C.imageUrl;if(!V)throw new Error("No image data returned from backend");V.startsWith("data:")||(V=`data:image/jpeg;base64,${V}`);const ae=await ye(V,1024,768),y=`generated-${Date.now()}`,ee={id:y,url:ae,name:`Generated: ${z.substring(0,50)}`,tags:["generated"]};L(P=>[...P,ee]),$(new Set([y])),n("Image generated successfully!")}catch(s){console.error("Generation error:",s),b(`Failed to generate: ${s instanceof Error?s.message:String(s)}`);const r=`generated-placeholder-${Date.now()}`,a={id:r,url:"data:image/svg+xml;base64,"+btoa(`
          <svg width="1024" height="768" xmlns="http://www.w3.org/2000/svg">
            <rect width="100%" height="100%" fill="#fee"/>
            <text x="50%" y="50%" text-anchor="middle" fill="#c00" font-size="20" font-family="Arial">
              Generation failed. Using placeholder.
            </text>
            <text x="50%" y="55%" text-anchor="middle" fill="#666" font-size="14" font-family="Arial">
              Prompt: ${z.substring(0,60)}
            </text>
          </svg>
        `),name:`Placeholder: ${z.substring(0,50)}`,tags:["placeholder"]};L(t=>[...t,a]),$(new Set([r]))}finally{se(!1),T(!1),D("")}}},Re=async()=>{if(M.trim()){G(!0);try{if(w.size===0){console.log("🎨 No images selected - generating new image from prompt:",M);const t=await I(),{generateImage:l}=await je(async()=>{const{generateImage:y}=await import("./index-Bd6EJdj1.js").then(ee=>ee.cD);return{generateImage:y}},__vite__mapDeps([0,1])),f=o.providers.filter(y=>y.enabled!==!1&&y.capabilities?.image!==!1&&(y.type==="openai"||y.type==="replicate"||y.type==="together"));if(f.length===0){alert("No image generation provider configured. Please configure one in Settings."),G(!1);return}const S=f[0],x={};o.providers.forEach(y=>{y.type==="openai"&&y.apiKey&&(x.openaiApiKey=y.apiKey),y.type==="replicate"&&y.apiKey&&(x.replicateApiKey=y.apiKey),y.type==="together"&&y.apiKey&&(x.togetherApiKey=y.apiKey),y.type==="gemini"&&y.apiKey&&(x.geminiApiKey=y.apiKey)});const u=await l(M,S.type,"","","1024x768","fast","vivid",t,x);if(!u.success||!u.imageUrl){alert(u.error||"Failed to generate image"),G(!1);return}let C=u.imageUrl;u.base64&&!u.base64.startsWith("data:")?C=`data:image/png;base64,${u.base64}`:u.base64&&(C=u.base64);const V=`generated-${Date.now()}-${Math.random()}`,ae={id:V,url:C,name:`Generated: ${M.substring(0,50)}`,tags:["ai-generated"]};L(y=>[...y,ae]),$(new Set([V]));try{const y=`AI Image: ${M.substring(0,80)}`,ee=`![Generated Image](${C})

**Prompt:** ${M}`;await v(ee,"user",y),console.log("✅ Auto-saved generated image to SWAG"),n("Image generated and saved to SWAG")}catch(y){console.error("Failed to auto-save to SWAG:",y),n("Image generated (failed to save to SWAG)")}if(u.cost!==void 0&&u.cost>0){const ee=f.some(P=>P.apiKey&&P.apiKey.trim()!=="")?`💰 Generation cost: $${u.cost.toFixed(4)} (using your API key)`:`💰 Generation cost: $${u.cost.toFixed(4)} (includes 25% LLM markup + Lambda fees)`;b(ee)}Z(""),G(!1);return}console.log("Parsing command:",M);const s=await I(),r=await Je(M,o.providers,s);if(!r.success||r.operations.length===0){B(r.explanation||'Could not understand command. Try: "make smaller", "rotate right", "convert to jpg", "remove glasses"'),G(!1);return}console.log("Parsed operations:",r.operations),r.operations.some(t=>t.type==="generate")&&console.log("🎨 Generative AI operations detected - will be processed by backend");for(const t of r.operations)await be(t);Z("")}catch(s){console.error("Command parsing error:",s),alert(`Error: ${s instanceof Error?s.message:String(s)}`)}finally{G(!1)}}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[!E?.imageEditingBasic&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-start",children:[e.jsx("svg",{className:"w-6 h-6 text-red-400 mt-0.5 mr-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Image Editing Unavailable"}),e.jsx("div",{className:"mt-1 text-sm text-red-700",children:e.jsx("p",{children:"Image editing is currently unavailable. Please contact support."})})]})]})}),E?.imageEditingBasic&&!E?.imageEditingAI&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-start",children:[e.jsx("svg",{className:"w-6 h-6 text-blue-400 mt-0.5 mr-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"AI Features Limited"}),e.jsx("div",{className:"mt-1 text-sm text-blue-700",children:e.jsx("p",{children:"Basic editing is available. Configure image providers in settings for AI features (AI crop, image generation)."})})]})]})}),e.jsx("header",{className:"bg-white border-b border-gray-200 p-4 sticky top-0 z-20 shadow-sm",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>{g?d("/swag",{state:{editingSnippetId:g}}):d("/swag")},className:"flex items-center gap-2 text-gray-700 hover:text-gray-900 font-medium transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Swag"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:xe,disabled:!pe||_,className:"px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Undo (Ctrl+Z)",children:"↶ Undo"}),e.jsx("button",{onClick:fe,disabled:!he||_,className:"px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Redo (Ctrl+Y)",children:"↷ Redo"})]}),e.jsxs("h1",{className:"text-xl font-bold text-gray-900",children:["Image Editor",w.size>0&&` (${w.size} selected)`]})]}),e.jsx("div",{className:"text-sm text-gray-600",children:U.size>0&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-lg bg-green-50 text-green-700 border border-green-200",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Auto-saved: ",U.size," image",U.size>1?"s":""]})})]})}),e.jsx("div",{className:"bg-white border-b border-gray-200 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>q.current?.click(),disabled:te||_,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),te?"Uploading...":"📁 Upload File"]}),e.jsx("input",{ref:q,type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp,image/avif",multiple:!0,className:"hidden",onChange:ze}),e.jsxs("button",{onClick:()=>i(!0),disabled:_,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),"📚 Select from Swag"]}),e.jsxs("button",{onClick:()=>T(!0),disabled:!E?.imageEditingAI||_,className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${!E?.imageEditingAI||_?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,title:E?.imageEditingAI?"":"Configure image providers in settings to enable",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),"✨ Generate from Prompt"]})]})}),me&&e.jsx(Ve,{onSelect:Pe,onClose:()=>i(!1),allowMultiple:!0}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Generate Image from Prompt"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),z.trim()&&!Q&&we()},children:[e.jsx("textarea",{value:z,onChange:s=>D(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),z.trim()&&!Q&&we())},placeholder:"Describe the image you want to create...",className:"w-full h-32 border border-gray-300 rounded p-3 mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500",tabIndex:1,autoFocus:!0}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Image Size"}),e.jsxs("select",{value:O,onChange:s=>ie(s.target.value),className:"w-full border border-gray-300 rounded p-2 focus:outline-none focus:ring-2 focus:ring-purple-500",tabIndex:2,children:[e.jsx("option",{value:"1024x1024",children:"Square (1024×1024)"}),e.jsx("option",{value:"1024x768",children:"Landscape (1024×768)"}),e.jsx("option",{value:"768x1024",children:"Portrait (768×1024)"}),e.jsx("option",{value:"1792x1024",children:"Wide (1792×1024)"}),e.jsx("option",{value:"1024x1792",children:"Tall (1024×1792)"})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{T(!1),D("")},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",tabIndex:4,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!z.trim()||Q,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",tabIndex:3,children:Q?"Generating...":"Generate Image"})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 text-center",children:["Press ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Enter"})," to generate • ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Shift+Enter"})," for new line"]})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(Oe,{onSelectAll:Ie,onSelectNone:ke,selectedCount:w.size,totalCount:Y.length}),e.jsx(Ue,{images:Y,selectedImages:w,onToggleSelection:Ce,processingStatus:F,newlyGeneratedIds:ge})]})}),e.jsx("footer",{className:"bg-white border-t border-gray-200 sticky bottom-0 z-20 shadow-lg",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(We,{selectedCount:w.size,onOperation:be,disabled:_}),e.jsx(He,{value:M,onChange:Z,onSubmit:Re,disabled:_||w.size===0,placeholder:w.size===0?"Select images to apply transformations":"Describe transformation (e.g., 'resize to 800px width' or 'convert to grayscale')"})]})})]})};export{Qe as ImageEditorPage};

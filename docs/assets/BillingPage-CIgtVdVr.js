import{aE as ne,a as Te,aF as Ne,r as c,aG as Ce,aH as Pe,j as e,R as De}from"./index-Dvb_RkvQ.js";const Be=({isOpen:s,onClose:u,onConfirm:y,providers:M})=>{const{t:d}=ne(),[j,$]=c.useState("all"),[I,E]=c.useState(""),[k,S]=c.useState(""),[f,w]=c.useState(""),[T,C]=c.useState(!1);if(!s)return null;const A=()=>{const m={};j==="provider"?m.provider=I:j==="dateRange"&&(k&&(m.startDate=k),f&&(m.endDate=f)),y(j,m),C(!1),u()},D=()=>!(!T||j==="provider"&&!I||j==="dateRange"&&!k&&!f);return e.jsx("div",{className:"modal-overlay",onClick:u,children:e.jsxs("div",{className:"modal-content",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:d("billing.clearBillingData")}),e.jsx("button",{className:"modal-close",onClick:u,children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"warning-banner",children:d("billing.clearDataWarning")}),e.jsxs("div",{className:"clear-mode-tabs",children:[e.jsx("button",{className:j==="all"?"active":"",onClick:()=>$("all"),children:d("billing.clearAll")}),e.jsx("button",{className:j==="provider"?"active":"",onClick:()=>$("provider"),children:d("billing.clearByProvider")}),e.jsx("button",{className:j==="dateRange"?"active":"",onClick:()=>$("dateRange"),children:d("billing.clearByDateRange")})]}),e.jsxs("div",{className:"clear-mode-content",children:[j==="all"&&e.jsxs("div",{className:"clear-mode-description",children:[e.jsx("p",{children:d("billing.clearAllDescription")}),e.jsx("p",{children:d("billing.considerExportFirst")})]}),j==="provider"&&e.jsxs("div",{className:"clear-mode-options",children:[e.jsxs("label",{children:[d("billing.selectProvider"),e.jsxs("select",{value:I,onChange:m=>E(m.target.value),children:[e.jsx("option",{value:"",children:d("billing.selectProviderPlaceholder")}),M.map(m=>e.jsx("option",{value:m,children:m},m))]})]}),e.jsx("p",{className:"hint",children:d("billing.clearProviderHint")})]}),j==="dateRange"&&e.jsxs("div",{className:"clear-mode-options",children:[e.jsxs("label",{children:[d("billing.startDate"),":",e.jsx("input",{type:"date",value:k,onChange:m=>S(m.target.value)})]}),e.jsxs("label",{children:[d("billing.endDate"),":",e.jsx("input",{type:"date",value:f,onChange:m=>w(m.target.value)})]}),e.jsx("p",{className:"hint",children:d("billing.clearDateRangeHint")})]}),e.jsx("div",{className:"confirmation-checkbox",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:T,onChange:m=>C(m.target.checked)}),e.jsx("span",{children:d("billing.confirmUndoCheckbox")})]})})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:u,children:d("billing.cancel")}),e.jsx("button",{className:"btn-danger",onClick:A,disabled:!D(),children:d("billing.clearData")})]})]})})},$e=()=>{const{t:s}=ne(),{accessToken:u,isAuthenticated:y}=Te(),{refreshUsage:M}=Ne(),[d,j]=c.useState(null),[$,I]=c.useState(!0),[E,k]=c.useState(null),[S,f]=c.useState(""),[w,T]=c.useState(""),[C,A]=c.useState(""),[D,m]=c.useState(""),[ie,V]=c.useState(!1),[z,K]=c.useState("overview"),[q,le]=c.useState(!0),[re,ae]=c.useState(new Set),[W,oe]=c.useState(0),[ce,de]=c.useState(0),[Oe,ge]=c.useState(0),[G,L]=c.useState(!1),[N,pe]=c.useState("5.00"),[Q,H]=c.useState(!1),U=c.useRef(null),[b,F]=c.useState(1),[_,he]=c.useState(100);c.useEffect(()=>{console.log("🔍 [BillingPage] Auth State:",{isAuthenticated:y,hasAccessToken:!!u,tokenLength:u?.length||0})},[y,u]);const R=c.useCallback(async()=>{I(!0),k(null);try{if(console.log("📊 [BillingPage] fetchBillingData called"),console.log("📊 [BillingPage] accessToken present:",!!u),console.log("📊 [BillingPage] isAuthenticated:",y),!u||!y){const h="Not authenticated. Please sign in.";throw console.error("❌ [BillingPage] Authentication check failed:",h),new Error(h)}const t=await Y(),n=`${t}/billing`;console.log("🌐 [BillingPage] API Base:",t),console.log("🌐 [BillingPage] Request URL:",n);const i={Authorization:`Bearer ${u}`,"Content-Type":"application/json"};console.log("📤 [BillingPage] Sending request to:",n),console.log("📤 [BillingPage] Request headers:",Object.keys(i));const g=await fetch(n,{method:"GET",headers:i});if(console.log("📥 [BillingPage] Response received:",{status:g.status,statusText:g.statusText,ok:g.ok,headers:Object.fromEntries(g.headers.entries())}),!g.ok){let h;try{h=await g.json()}catch(v){throw console.error("❌ [BillingPage] Failed to parse error response:",v),new Error(`HTTP ${g.status}: ${g.statusText}`)}throw console.error("❌ [BillingPage] Backend returned error:",h),new Error(h.message||h.error||`HTTP ${g.status}`)}const l=await g.json();if(console.log("📊 Billing data received:",{source:l.source,transactionCount:l.transactions?.length,hasByType:!!l.totals?.byType,hasByProvider:!!l.totals?.byProvider,hasByModel:!!l.totals?.byModel,byTypeKeys:l.totals?.byType?Object.keys(l.totals.byType):[],byProviderKeys:l.totals?.byProvider?Object.keys(l.totals.byProvider):[],byModelKeys:l.totals?.byModel?Object.keys(l.totals.byModel):[]}),l.transactions&&l.transactions.length>0){const h=[...new Set(l.transactions.map(v=>v.type))];console.log("📊 Unique transaction types in data:",h),console.log("📊 Sample transactions:",l.transactions.slice(0,3))}l.source==="service"&&l.message&&(console.log("ℹ️ Billing data source: Service key sheet"),console.log("ℹ️ Message:",l.message)),j(l),console.log("✅ [BillingPage] Billing data loaded successfully");let p=0,o=0,r=0;if(l.transactions)for(const h of l.transactions)if(h.type==="credit_added"){const v=Math.abs(h.cost);o+=v,p+=v,console.log(`💳 Found credit: +$${v.toFixed(2)}, total credits: $${o.toFixed(2)}, balance: $${p.toFixed(2)}`)}else r+=h.cost,p-=h.cost;oe(p),de(o),ge(r),console.log(`💳 Final summary - Balance: $${p.toFixed(4)}, Total Credits: $${o.toFixed(4)}, Total Expenses: $${r.toFixed(4)}`),M()}catch(t){console.error("❌ [BillingPage] Error fetching billing data:",{message:t.message,stack:t.stack,name:t.name,error:t});const n=t.message||"Failed to load billing data";k(n),t.message?.includes("Not authenticated")?k("❌ Not authenticated. Please sign in with Google to view billing data."):t.message?.includes("NetworkError")||t.message?.includes("Failed to fetch")?k("❌ Network error. Please check your connection and ensure the backend server is running."):k(`❌ Failed to load billing data: ${n}`)}finally{I(!1),console.log("🏁 [BillingPage] fetchBillingData completed, loading:",!1)}},[u,y]),ue=async(t,n)=>{try{if(!u||!y)throw new Error("Not authenticated");const i=new URLSearchParams({mode:t});t==="provider"&&n.provider&&i.append("provider",n.provider),t==="dateRange"&&(n.startDate&&i.append("startDate",n.startDate),n.endDate&&i.append("endDate",n.endDate));const g=await Y(),l=await fetch(`${g}/billing/clear?${i.toString()}`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}});if(!l.ok){const o=await l.json();throw new Error(o.message||"Failed to clear data")}const p=await l.json();alert(s("billing.dataClearedSuccess",{count:p.deletedCount,remaining:p.remainingCount})),R()}catch(i){console.error("Error clearing data:",i),alert(s("billing.dataClearError",{message:i.message}))}},me=()=>{if(!d||B.length===0){alert(s("billing.noDataToExport"));return}const t=["Timestamp","Type","Provider","Model","Tokens In","Tokens Out","Total Tokens","Cost ($)","Duration (ms)","Memory Limit (MB)","Memory Used (MB)","Request ID","Status","Error"],n=B.map(o=>[o.timestamp,o.type,o.provider,o.model,o.tokensIn,o.tokensOut,o.totalTokens,o.cost.toFixed(6),o.durationMs,o.memoryLimitMB||"",o.memoryUsedMB||"",o.requestId||"",o.status,o.error||""]),i=[t.join(","),...n.map(o=>o.map(r=>`"${r}"`).join(","))].join(`
`),g=new Blob([i],{type:"text/csv"}),l=URL.createObjectURL(g),p=document.createElement("a");p.href=l,p.download=`billing-${new Date().toISOString().split("T")[0]}.csv`,p.click(),URL.revokeObjectURL(l)},Y=async()=>{const t=window.location.hostname;if(t==="localhost"||t==="127.0.0.1"){const n="http://localhost:3000";try{if((await fetch(n,{method:"OPTIONS",signal:AbortSignal.timeout(500)})).status!==void 0)return n}catch{}}return"https://nrw7pperjjdswbmqgmigbwsbyi0rwdqf.lambda-url.us-east-1.on.aws"};if(c.useEffect(()=>{y&&u&&R()},[y,u]),c.useEffect(()=>{if(!G||!U.current||!u)return;const t=setInterval(()=>{window.paypal&&(clearInterval(t),H(!0),U.current.innerHTML="",window.paypal.Buttons({createOrder:async()=>{try{const n=parseFloat(N);if(n<5)throw new Error("Minimum purchase is $5.00");const i=await Pe(n,u);if(!i.success||!i.orderId)throw new Error(i.error||"Failed to create order");return i.orderId}catch(n){throw console.error("PayPal createOrder error:",n),alert(`Error creating order: ${n.message}`),n}},onApprove:async n=>{try{const i=await Ce(n.orderID,u);if(!i.success)throw new Error(i.error||"Failed to capture payment");L(!1),await R(),await M()}catch(i){console.error("PayPal onApprove error:",i),alert(`Error processing payment: ${i.message}`)}},onError:n=>{console.error("PayPal error:",n),alert("PayPal encountered an error. Please try again.")},style:{layout:"vertical",color:"blue",shape:"rect",label:"paypal"}}).render(U.current).then(()=>{H(!1)}).catch(n=>{console.error("PayPal render error:",n),H(!1)}))},100);return()=>clearInterval(t)},[G,N,u]),c.useEffect(()=>{F(1)},[S,w,C,D]),!y)return e.jsx("div",{className:"billing-page",children:e.jsxs("div",{className:"error-message",children:[e.jsx("h3",{children:s("billing.signInRequired")}),e.jsx("p",{children:s("billing.signInToViewBilling")}),e.jsxs("div",{className:"info-box",style:{marginTop:"20px",padding:"15px",background:"#e3f2fd",borderRadius:"8px",textAlign:"left"},children:[e.jsx("h4",{style:{marginTop:0,color:"#1976d2"},children:s("billing.howToAccessBilling")}),e.jsxs("ol",{style:{marginLeft:"20px",color:"#424242"},children:[e.jsx("li",{children:s("billing.signInStep1")}),e.jsx("li",{children:s("billing.signInStep2")})]}),e.jsx("p",{style:{marginTop:"15px",color:"#666",fontSize:"0.9em"},children:s("billing.billingDataNote")}),e.jsxs("details",{style:{marginTop:"15px",fontSize:"0.85em",color:"#888"},children:[e.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:s("billing.debugInfo")}),e.jsx("pre",{style:{marginTop:"10px",padding:"10px",background:"#f5f5f5",borderRadius:"4px",overflow:"auto"},children:JSON.stringify({isAuthenticated:y,hasAccessToken:!!u,tokenLength:u?.length||0,currentPath:window.location.pathname},null,2)})]})]})]})});if($)return e.jsx("div",{className:"billing-page",children:e.jsx("div",{className:"loading",children:s("billing.loading")})});if(E)return e.jsx("div",{className:"billing-page",children:e.jsxs("div",{className:"error-message",children:[e.jsx("h3",{children:s("billing.errorLoading")}),e.jsx("p",{children:E}),e.jsx("button",{onClick:R,style:{marginTop:"15px"},children:s("billing.retry")})]})});if(!d)return e.jsx("div",{className:"billing-page",children:e.jsx("div",{className:"loading",children:s("billing.noBillingData")})});if(!d.transactions||d.transactions.length===0)return e.jsxs("div",{className:"billing-page",children:[e.jsxs("div",{className:"billing-header",children:[e.jsx("h1",{children:s("billing.title")}),e.jsx("p",{style:{color:"#666",marginTop:"8px"},children:d.message||s("billing.noTransactionsMessage")})]}),e.jsxs("div",{className:"info-box",style:{marginTop:"20px",padding:"20px",background:"#f5f5f5",borderRadius:"8px"},children:[e.jsx("h3",{style:{marginTop:0},children:s("billing.noBillingDataYet")}),e.jsx("p",{children:s("billing.startUsingChat")}),e.jsx("button",{onClick:R,style:{marginTop:"15px"},children:s("billing.refresh")})]})]});const B=d.transactions.filter(t=>{if(S||w){const n=new Date(t.timestamp);if(S&&n<new Date(S))return!1;if(w){const i=new Date(w);if(i.setHours(23,59,59,999),n>i)return!1}}return!(C&&String(t.type).toLowerCase()!==C.toLowerCase()||D&&t.provider.toLowerCase()!==D.toLowerCase())}),J=B.length,P=Math.ceil(J/_),X=(b-1)*_,be=X+_,Z=B.slice(X,be),x=((t,n=!1)=>{const i={},g={},l={};let p=0,o=0,r=0,h=0;const v=t.filter(a=>a.type==="chat"),ke=t.filter(a=>a.type!=="summary"&&a.type!=="credit_added"&&a.type!=="lambda_invocation"),Se=v.length,we=ke.length;return t.forEach(a=>{if(!a||!a.model||!a.provider){console.warn("Skipping invalid transaction:",a);return}(!n||String(a.type)!=="credit_added")&&(p+=a.cost),o+=a.totalTokens||0,r+=a.tokensIn||0,h+=a.tokensOut||0;const O=String(a.type);i[O]||(i[O]={cost:0,tokens:0,tokensIn:0,tokensOut:0,count:0}),i[O].cost+=a.cost,i[O].tokens+=a.totalTokens||0,i[O].tokensIn+=a.tokensIn||0,i[O].tokensOut+=a.tokensOut||0,i[O].count+=1,g[a.provider]||(g[a.provider]={cost:0,tokens:0,tokensIn:0,tokensOut:0,count:0}),g[a.provider].cost+=a.cost,g[a.provider].tokens+=a.totalTokens||0,g[a.provider].tokensIn+=a.tokensIn||0,g[a.provider].tokensOut+=a.tokensOut||0,g[a.provider].count+=1,l[a.model]||(l[a.model]={cost:0,tokens:0,tokensIn:0,tokensOut:0,count:0,provider:a.provider}),l[a.model].cost+=a.cost,l[a.model].tokens+=a.totalTokens||0,l[a.model].tokensIn+=a.tokensIn||0,l[a.model].tokensOut+=a.tokensOut||0,l[a.model].count+=1}),{totalCost:p,totalTokens:o,totalTokensIn:r,totalTokensOut:h,totalUserQueries:Se,totalLLMCalls:we,byType:i,byProvider:g,byModel:l}})(B,!0),ee=Array.from(new Set(d.transactions.map(t=>t.provider))).sort(),xe=Array.from(new Set(d.transactions.map(t=>String(t.type)))),te=t=>{const n=new Map,i=[];t.forEach(l=>{if(l.requestId&&l.requestId!==""){const p=n.get(l.requestId)||[];p.push(l),n.set(l.requestId,p)}else i.push(l)}),n.forEach(l=>{l.sort((p,o)=>new Date(p.timestamp).getTime()-new Date(o.timestamp).getTime())}),i.sort((l,p)=>new Date(p.timestamp).getTime()-new Date(l.timestamp).getTime());const g=Array.from(n.entries()).sort(([,l],[,p])=>{const o=l[0].timestamp,r=p[0].timestamp;return new Date(r).getTime()-new Date(o).getTime()});return{grouped:new Map(g),ungrouped:i}},{grouped:se,ungrouped:je}=te(Z),{grouped:ye,ungrouped:fe}=te(B),ve=t=>{ae(n=>{const i=new Set(n);return i.has(t)?i.delete(t):i.add(t),i})};return e.jsx("div",{className:"billing-page-container",children:e.jsxs("div",{className:"billing-page",children:[e.jsxs("div",{className:"billing-header",children:[e.jsx("div",{className:"billing-title",children:e.jsx("h1",{children:s("billing.title")})}),e.jsxs("div",{className:"billing-actions",children:[e.jsxs("button",{className:"btn-secondary flex items-center gap-1.5",onClick:me,title:s("billing.exportCSV"),"aria-label":s("billing.exportCSV"),children:[e.jsx("span",{children:"📥"}),e.jsx("span",{className:"hidden md:inline",children:s("billing.exportCSV")})]}),d.source!=="service"&&e.jsxs("button",{className:"btn-danger flex items-center gap-1.5",onClick:()=>V(!0),title:s("billing.clearData"),"aria-label":s("billing.clearData"),children:[e.jsx("span",{children:"🗑️"}),e.jsx("span",{className:"hidden md:inline",children:s("billing.clearData")})]})]})]}),e.jsxs("div",{className:"billing-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:["📅 ",s("billing.startDate"),":",e.jsx("input",{type:"date",value:S,onChange:t=>f(t.target.value),placeholder:s("billing.startDate"),max:w||void 0})]}),e.jsxs("label",{children:["📅 ",s("billing.endDate"),":",e.jsx("input",{type:"date",value:w,onChange:t=>T(t.target.value),placeholder:s("billing.endDate"),min:S||void 0})]}),e.jsxs("label",{children:["🏷️ ",s("billing.type"),":",e.jsxs("select",{value:C,onChange:t=>A(t.target.value),children:[e.jsx("option",{value:"",children:s("billing.allTypes")}),xe.map(t=>e.jsx("option",{value:t,children:s(`billing.types.${t}`,t.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase()))},t))]})]}),e.jsxs("label",{children:["🔌 ",s("billing.provider"),":",e.jsxs("select",{value:D,onChange:t=>m(t.target.value),children:[e.jsx("option",{value:"",children:s("billing.allProviders")}),ee.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),(S||w||C||D)&&e.jsx("button",{className:"btn-clear-filters",onClick:()=>{f(""),T(""),A(""),m("")},children:s("billing.clearFilters")})]}),e.jsxs("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid #e0e0e0",display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.85rem",color:"#666",fontWeight:500},children:s("billing.quickRanges")}),e.jsx("button",{className:"btn-clear-filters",style:{fontSize:"0.8rem",padding:"0.4rem 0.8rem"},onClick:()=>{const t=new Date;f(t.toISOString().split("T")[0]),T(t.toISOString().split("T")[0])},children:s("billing.today")}),e.jsx("button",{className:"btn-clear-filters",style:{fontSize:"0.8rem",padding:"0.4rem 0.8rem"},onClick:()=>{const t=new Date,n=new Date(t);n.setDate(t.getDate()-7),f(n.toISOString().split("T")[0]),T(t.toISOString().split("T")[0])},children:s("billing.last7Days")}),e.jsx("button",{className:"btn-clear-filters",style:{fontSize:"0.8rem",padding:"0.4rem 0.8rem"},onClick:()=>{const t=new Date,n=new Date(t);n.setMonth(t.getMonth()-1),f(n.toISOString().split("T")[0]),T(t.toISOString().split("T")[0])},children:s("billing.last30Days")}),e.jsx("button",{className:"btn-clear-filters",style:{fontSize:"0.8rem",padding:"0.4rem 0.8rem"},onClick:()=>{const t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1);f(n.toISOString().split("T")[0]),T(t.toISOString().split("T")[0])},children:s("billing.thisMonth")})]})]}),e.jsxs("div",{className:"billing-tabs",children:[e.jsx("button",{className:z==="overview"?"active":"",onClick:()=>K("overview"),children:s("billing.overview")}),e.jsxs("button",{className:z==="transactions"?"active":"",onClick:()=>K("transactions"),children:[s("billing.transactions")," (",B.length,")"]})]}),z==="overview"&&e.jsxs("div",{className:"billing-overview",children:[e.jsxs("div",{className:"summary-cards",children:[e.jsxs("div",{className:"summary-card",style:{background:W>0?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",border:"2px solid rgba(255,255,255,0.3)"},children:[e.jsx("div",{className:"summary-label",style:{color:"rgba(255,255,255,0.9)",fontSize:"1.1rem",fontWeight:"bold",marginBottom:"8px"},children:s("billing.balance")}),e.jsxs("div",{className:"summary-value",style:{fontSize:"2.5rem",fontWeight:"bold",marginBottom:"12px"},children:["$",W.toFixed(2)]}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"rgba(255,255,255,0.7)",marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.2)"},children:[s("billing.totalCredits"),": $",ce.toFixed(2)]}),e.jsx("button",{style:{background:"white",color:"#764ba2",border:"none",padding:"8px 16px",borderRadius:"6px",fontSize:"0.85rem",fontWeight:"bold",cursor:"pointer",marginTop:"12px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onClick:()=>L(!0),children:s("billing.purchaseCredits")})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:s("billing.totalCost")}),e.jsxs("div",{className:"summary-value",children:["$",x.totalCost.toFixed(4)]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#666",marginTop:"4px"},children:s("billing.usageOnly")})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:s("billing.totalTokens")}),e.jsx("div",{className:"summary-value",children:x.totalTokens.toLocaleString()}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#666",marginTop:"4px"},children:[s("billing.tokensIn"),": ",x.totalTokensIn.toLocaleString()," | ",s("billing.tokensOut"),": ",x.totalTokensOut.toLocaleString()]})]}),e.jsxs("div",{className:"summary-card",children:[e.jsx("div",{className:"summary-label",children:s("billing.totalRequests")}),e.jsxs("div",{className:"summary-value",children:[x.totalUserQueries," / ",x.totalLLMCalls]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#666",marginTop:"4px"},children:s("billing.userQueriesLlmCalls")})]})]}),x.byType&&Object.keys(x.byType).length>0&&e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h3",{children:s("billing.byType")}),e.jsxs("table",{className:"breakdown-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("billing.type")}),e.jsx("th",{children:s("billing.requests")}),e.jsx("th",{children:s("billing.tokensIn")}),e.jsx("th",{children:s("billing.tokensOut")}),e.jsx("th",{children:s("billing.totalTokens")}),e.jsx("th",{children:s("billing.cost")})]})}),e.jsx("tbody",{children:Object.entries(x.byType).map(([t,n])=>e.jsxs("tr",{children:[e.jsx("td",{children:t}),e.jsx("td",{children:n.count}),e.jsx("td",{children:n.tokensIn.toLocaleString()}),e.jsx("td",{children:n.tokensOut.toLocaleString()}),e.jsx("td",{children:n.tokens.toLocaleString()}),e.jsxs("td",{children:["$",n.cost.toFixed(4)]})]},t))})]})]}),x.byProvider&&Object.keys(x.byProvider).length>0&&e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h3",{children:s("billing.byProvider")}),e.jsxs("table",{className:"breakdown-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("billing.provider")}),e.jsx("th",{children:s("billing.requests")}),e.jsx("th",{children:s("billing.tokensIn")}),e.jsx("th",{children:s("billing.tokensOut")}),e.jsx("th",{children:s("billing.totalTokens")}),e.jsx("th",{children:s("billing.cost")})]})}),e.jsx("tbody",{children:Object.entries(x.byProvider).map(([t,n])=>e.jsxs("tr",{children:[e.jsx("td",{children:t}),e.jsx("td",{children:n.count}),e.jsx("td",{children:n.tokensIn.toLocaleString()}),e.jsx("td",{children:n.tokensOut.toLocaleString()}),e.jsx("td",{children:n.tokens.toLocaleString()}),e.jsxs("td",{children:["$",n.cost.toFixed(4)]})]},t))})]})]}),x.byModel&&Object.keys(x.byModel).length>0&&e.jsxs("div",{className:"breakdown-section",children:[e.jsx("h3",{children:s("billing.byModel")}),e.jsxs("table",{className:"breakdown-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("billing.provider")}),e.jsx("th",{children:s("billing.model")}),e.jsx("th",{children:s("billing.requests")}),e.jsx("th",{children:s("billing.tokensIn")}),e.jsx("th",{children:s("billing.tokensOut")}),e.jsx("th",{children:s("billing.totalTokens")}),e.jsx("th",{children:s("billing.cost")})]})}),e.jsx("tbody",{children:Object.entries(x.byModel).filter(([t,n])=>n&&n.provider).sort((t,n)=>{const i=t[1].provider.localeCompare(n[1].provider);return i!==0?i:t[0].localeCompare(n[0])}).map(([t,n])=>e.jsxs("tr",{children:[e.jsx("td",{children:n.provider}),e.jsx("td",{children:t}),e.jsx("td",{children:n.count}),e.jsx("td",{children:n.tokensIn.toLocaleString()}),e.jsx("td",{children:n.tokensOut.toLocaleString()}),e.jsx("td",{children:n.tokens.toLocaleString()}),e.jsxs("td",{children:["$",n.cost.toFixed(4)]})]},t))})]})]})]}),z==="transactions"&&e.jsxs("div",{className:"billing-transactions",children:[e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",background:"#f5f5f5",borderRadius:"8px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:q,onChange:t=>le(t.target.checked),style:{cursor:"pointer"}}),e.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:s("billing.groupByRequestId")})]}),e.jsxs("select",{value:_,onChange:t=>{he(Number(t.target.value)),F(1)},style:{padding:"0.4rem 0.6rem",border:"1px solid #ccc",borderRadius:"4px",fontSize:"0.85rem"},children:[e.jsxs("option",{value:50,children:["50 ",s("billing.perPage")]}),e.jsxs("option",{value:100,children:["100 ",s("billing.perPage")]}),e.jsxs("option",{value:250,children:["250 ",s("billing.perPage")]}),e.jsxs("option",{value:500,children:["500 ",s("billing.perPage")]}),e.jsxs("option",{value:1e3,children:["1000 ",s("billing.perPage")]})]}),e.jsx("span",{style:{fontSize:"0.85rem",color:"#666",marginLeft:"auto"},children:q?s("billing.totalRequestGroups",{total:ye.size,showing:se.size,ungrouped:fe.length}):s("billing.totalTransactionsShowing",{total:J,showing:Z.length})})]}),e.jsxs("div",{className:"transactions-table-container",children:[e.jsxs("table",{className:"transactions-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[q&&e.jsx("th",{style:{width:"40px"},children:"▶"}),e.jsx("th",{children:s("billing.timestamp")}),e.jsx("th",{children:s("billing.type")}),e.jsx("th",{children:s("billing.provider")}),e.jsx("th",{children:s("billing.model")}),e.jsx("th",{children:s("billing.tokens")}),e.jsx("th",{children:s("billing.cost")}),e.jsx("th",{children:s("billing.duration")}),e.jsx("th",{children:s("billing.status")})]})}),e.jsx("tbody",{children:q?e.jsxs(e.Fragment,{children:[Array.from(se.entries()).map(([t,n])=>{const i=re.has(t),g=n.reduce((r,h)=>r+h.cost,0),l=n.reduce((r,h)=>r+h.totalTokens,0),p=n.reduce((r,h)=>r+h.durationMs,0),o=n[0];return e.jsxs(De.Fragment,{children:[e.jsxs("tr",{onClick:()=>ve(t),style:{background:"#f0f0f0",fontWeight:500,cursor:"pointer",userSelect:"none"},children:[e.jsx("td",{style:{textAlign:"center"},children:i?"▼":"▶"}),e.jsx("td",{children:new Date(o.timestamp).toLocaleString()}),e.jsx("td",{colSpan:3,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{children:s("billing.requestGroup",{count:n.length})}),e.jsxs("code",{style:{fontSize:"0.75rem",background:"#fff",padding:"2px 6px",borderRadius:"4px",color:"#666"},children:[t.substring(0,12),"..."]})]})}),e.jsx("td",{children:l.toLocaleString()}),e.jsx("td",{children:e.jsxs("strong",{children:["$",g.toFixed(6)]})}),e.jsxs("td",{children:[p,"ms"]}),e.jsx("td",{className:n.every(r=>r.status==="success")?"status-success":"status-error",children:n.every(r=>r.status==="success")?"success":"partial"})]}),i&&n.map((r,h)=>e.jsxs("tr",{style:{...String(r.type)==="guardrail_input"||String(r.type)==="guardrail_output"?{background:"#fffde7"}:String(r.type)==="image_generation"?{background:"#e3f2fd"}:String(r.type)==="tts"?{background:"#f3e5f5"}:{background:"#fafafa"},borderLeft:"3px solid #ddd"},children:[e.jsx("td",{style:{textAlign:"center",color:"#ccc"},children:"└"}),e.jsx("td",{style:{paddingLeft:"2rem",fontSize:"0.9rem"},children:new Date(r.timestamp).toLocaleString()}),e.jsx("td",{children:String(r.type)==="guardrail_input"?"🛡️ Guardrail Input":String(r.type)==="guardrail_output"?"🛡️ Guardrail Output":String(r.type)==="image_generation"?"🖼️ Image Generation":String(r.type)==="tts"?"🎙️ Text-to-Speech":String(r.type)==="chat"?"Chat":String(r.type)==="embedding"?"Embedding":String(r.type)==="planning"?"Planning":typeof r.type=="string"?String(r.type).replace(/_/g," ").replace(/\b\w/g,v=>v.toUpperCase()):String(r.type)}),e.jsx("td",{children:r.provider}),e.jsx("td",{children:r.model}),e.jsx("td",{children:r.totalTokens.toLocaleString()}),e.jsxs("td",{children:["$",r.cost.toFixed(6)]}),e.jsxs("td",{children:[r.durationMs,"ms"]}),e.jsx("td",{className:r.status==="success"?"status-success":"status-error",children:r.status})]},`${t}-${h}`))]},t)}),je.map((t,n)=>e.jsxs("tr",{style:String(t.type)==="guardrail_input"||String(t.type)==="guardrail_output"?{background:"#fffde7"}:String(t.type)==="image_generation"?{background:"#e3f2fd"}:String(t.type)==="tts"?{background:"#f3e5f5"}:{},children:[e.jsx("td",{style:{textAlign:"center",color:"#ccc"},children:"—"}),e.jsx("td",{children:new Date(t.timestamp).toLocaleString()}),e.jsx("td",{children:s(`billing.types.${t.type}`,{defaultValue:typeof t.type=="string"?String(t.type).replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()):String(t.type)})}),e.jsx("td",{children:t.provider}),e.jsx("td",{children:t.model}),e.jsx("td",{children:t.totalTokens.toLocaleString()}),e.jsxs("td",{children:["$",t.cost.toFixed(6)]}),e.jsxs("td",{children:[t.durationMs,"ms"]}),e.jsx("td",{className:t.status==="success"?"status-success":"status-error",children:t.status})]},`ungrouped-${n}`))]}):d.transactions.map((t,n)=>e.jsxs("tr",{style:String(t.type)==="guardrail_input"||String(t.type)==="guardrail_output"?{background:"#fffde7"}:String(t.type)==="image_generation"?{background:"#e3f2fd"}:String(t.type)==="tts"?{background:"#f3e5f5"}:{},children:[e.jsx("td",{children:new Date(t.timestamp).toLocaleString()}),e.jsx("td",{children:s(`billing.types.${t.type}`,{defaultValue:typeof t.type=="string"?String(t.type).replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()):String(t.type)})}),e.jsx("td",{children:t.provider}),e.jsx("td",{children:t.model}),e.jsx("td",{children:t.totalTokens.toLocaleString()}),e.jsxs("td",{children:["$",t.cost.toFixed(6)]}),e.jsxs("td",{children:[t.durationMs,"ms"]}),e.jsx("td",{className:t.status==="success"?"status-success":"status-error",children:t.status})]},n))})]}),e.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"center",alignItems:"center",gap:"1rem",padding:"1rem",borderTop:"1px solid #eee"},children:[e.jsxs("button",{onClick:()=>F(1),disabled:b===1,style:{padding:"0.5rem 0.75rem",border:"1px solid #ccc",borderRadius:"4px",background:b===1?"#f5f5f5":"white",cursor:b===1?"not-allowed":"pointer",fontSize:"0.85rem"},children:["⏮️ ",s("billing.first")]}),e.jsxs("button",{onClick:()=>F(b-1),disabled:b===1,style:{padding:"0.5rem 0.75rem",border:"1px solid #ccc",borderRadius:"4px",background:b===1?"#f5f5f5":"white",cursor:b===1?"not-allowed":"pointer",fontSize:"0.85rem"},children:["◀️ ",s("billing.prev")]}),e.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:500},children:[s("billing.page")," ",b," ",s("billing.of")," ",P]}),e.jsxs("button",{onClick:()=>F(b+1),disabled:b===P,style:{padding:"0.5rem 0.75rem",border:"1px solid #ccc",borderRadius:"4px",background:b===P?"#f5f5f5":"white",cursor:b===P?"not-allowed":"pointer",fontSize:"0.85rem"},children:[s("billing.next")," ▶️"]}),e.jsxs("button",{onClick:()=>F(P),disabled:b===P,style:{padding:"0.5rem 0.75rem",border:"1px solid #ccc",borderRadius:"4px",background:b===P?"#f5f5f5":"white",cursor:b===P?"not-allowed":"pointer",fontSize:"0.85rem"},children:[s("billing.last")," ⏭️"]})]})]})]}),e.jsx(Be,{isOpen:ie,onClose:()=>V(!1),onConfirm:ue,providers:ee}),G&&e.jsx("div",{className:"modal-overlay",onClick:()=>L(!1),children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),style:{maxWidth:"500px"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:s("billing.addCreditsTitle")}),e.jsx("button",{className:"modal-close",onClick:()=>L(!1),children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{style:{marginBottom:"20px"},children:e.jsx("p",{children:s("billing.purchaseCreditsDescription")})}),e.jsxs("div",{style:{padding:"15px",background:"#fff8e1",border:"1px solid #ffc107",borderRadius:"8px",marginBottom:"20px",fontSize:"0.95rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",color:"#f57c00"},children:"ℹ️ Transparent Pricing Notice"}),e.jsxs("p",{style:{margin:"0 0 8px 0",color:"#5d4037"},children:["PayPal charges ",e.jsx("strong",{children:"2.9% + $0.30"})," per transaction for payment processing. To maintain transparent pricing, these fees are ",e.jsx("strong",{children:"deducted from your credit purchase"}),"."]}),e.jsxs("p",{style:{margin:0,color:"#5d4037",fontSize:"0.9rem"},children:["Example: $10.00 payment = $",(10-(10*.029+.3)).toFixed(2)," in credits (fee: $",(10*.029+.3).toFixed(2),")"]})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:s("billing.enterAmount")}),e.jsx("input",{type:"number",min:"5",step:"1",value:N,onChange:t=>pe(t.target.value),style:{width:"100%",padding:"10px",fontSize:"1rem",border:"1px solid #ddd",borderRadius:"4px"},placeholder:s("billing.minimumPurchase")})]}),e.jsxs("div",{style:{background:"#f5f5f5",padding:"15px",borderRadius:"4px",marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{children:"Payment Amount"}),e.jsxs("strong",{children:["$",parseFloat(N||"0").toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px",fontSize:"0.9rem",color:"#d32f2f"},children:[e.jsx("span",{children:"PayPal Fee (2.9% + $0.30)"}),e.jsxs("span",{children:["-$",(parseFloat(N||"0")*.029+.3).toFixed(2)]})]}),e.jsx("div",{style:{borderTop:"1px solid #ddd",paddingTop:"8px",marginTop:"8px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold",color:"#2e7d32"},children:[e.jsx("span",{children:s("billing.creditsToAdd")}),e.jsxs("span",{children:["$",Math.max(0,parseFloat(N||"0")-(parseFloat(N||"0")*.029+.3)).toFixed(2)]})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.9rem",color:"#666",marginTop:"8px"},children:[e.jsx("span",{children:s("billing.newBalance")}),e.jsxs("span",{children:["$",(W+Math.max(0,parseFloat(N||"0")-(parseFloat(N||"0")*.029+.3))).toFixed(2)]})]})]}),e.jsx("div",{style:{padding:"12px",background:"#e3f2fd",borderRadius:"4px",fontSize:"0.9rem",marginBottom:"20px"},children:s("billing.tipUseOwnKeys")}),e.jsx("div",{ref:U,style:{minHeight:"150px",display:Q?"none":"block"}}),Q&&e.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#666"},children:s("billing.loadingPayPal")}),!window.paypal&&e.jsx("div",{style:{padding:"15px",background:"#fff3cd",border:"1px solid #ffc107",borderRadius:"4px",color:"#856404"},children:s("billing.paypalNotLoaded")})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn-secondary",onClick:()=>L(!1),children:s("common.close")})})]})})]})})};export{$e as default};

import{c as S,u as Z,aE as ee,b1 as te,a as ae,b2 as se,b3 as ie,b4 as re,r as o,b5 as oe,q as x,j as t,b6 as b,b7 as ne}from"./index-DtnxAUWU.js";import{T as E,Q as le}from"./QuizCard-CTfb43kt.js";import{s as ce}from"./quizSync-DZRIRddW.js";import{C as de,T as ue}from"./trash-2-D8Sb336G.js";import"./x-Dc7d7zkt.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],me=S("arrow-left",ge);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],he=S("clock",xe);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],pe=S("trending-up",ye);function ke(){const L=Z(),{t:s}=ee(),{showSuccess:f,showError:h,showWarning:N}=te(),{getToken:Q}=ae(),{snippets:v}=se(),{settings:G}=ie(),{preferences:$}=re(),[T,M]=o.useState([]),[_,I]=o.useState(!1),[g,P]=o.useState(null),[A,C]=o.useState(!0),[D,O]=o.useState(0),[y,w]=o.useState(()=>localStorage.getItem("active_quiz_modal")==="true"),[u,k]=o.useState(()=>{const e=localStorage.getItem("active_quiz_data");return e?JSON.parse(e):null}),[c,j]=o.useState(()=>{const e=localStorage.getItem("active_quiz_metadata");return e?JSON.parse(e):null});o.useEffect(()=>{d()},[]),o.useEffect(()=>{y&&u&&c?(localStorage.setItem("active_quiz_modal","true"),localStorage.setItem("active_quiz_data",JSON.stringify(u)),localStorage.setItem("active_quiz_metadata",JSON.stringify(c)),console.log("💾 Saved active quiz state to localStorage")):y||(localStorage.removeItem("active_quiz_modal"),localStorage.removeItem("active_quiz_data"),localStorage.removeItem("active_quiz_metadata"),console.log("🗑️ Cleared active quiz state from localStorage"))},[y,u,c]),o.useEffect(()=>{if(D===0||!(()=>{const a=localStorage.getItem("google_drive_access_token"),n=localStorage.getItem("auto_sync_enabled")==="true";return a&&a.length>0&&n})())return;const i=setTimeout(async()=>{try{(await oe.syncQuizProgress()).success&&console.log("✅ Quiz progress synced to Google Drive")}catch(a){console.error("❌ Failed to sync quiz progress:",a)}},1e4);return()=>clearTimeout(i)},[D]),o.useEffect(()=>{const e=()=>{document.hidden||(console.log("Quiz page visible - reloading statistics"),d())};return document.addEventListener("visibilitychange",e),window.addEventListener("focus",d),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("focus",d)}},[]);const d=async()=>{try{C(!0);const[e,i]=await Promise.all([x.getQuizStatistics(20),x.getStatisticsSummary()]);console.log("📊 Loaded quiz statistics:",{totalQuizzes:e.length,completed:e.filter(a=>a.completed).length,incomplete:e.filter(a=>!a.completed).length,quizzes:e.map(a=>({id:a.id.substring(0,8),title:a.quizTitle,completed:a.completed,hasQuizData:!!a.quizData}))}),M(e),P(i)}catch(e){console.error("Failed to load quiz statistics:",e),h(s("quiz.errorLoadingStats"))}finally{C(!1)}},R=async(e,i)=>{if(confirm(s("quiz.confirmDelete",{title:i})))try{await x.deleteQuizStatistic(e),f(s("quiz.quizDeleted")),await d()}catch(a){console.error("Failed to delete quiz:",a),h(s("quiz.errorDeletingQuiz"))}},J=async()=>{try{I(!0),N("Generating quiz... This may take a while. Please wait.");const e=await Q();if(!e){h("Authentication required. Please sign in.");return}const i=G?.providers?.filter(r=>r.enabled!==!1)||[];console.log(`🎯 Quiz generation: sending ${i.length} client provider(s), backend will add environment providers if authorized`),i.length>0&&console.log("   Client providers:",i.map(r=>`${r.type}${r.modelName?`/${r.modelName}`:""}`).join(", "));let a,n;if(v.length>0)a=v.map(r=>`## ${r.title}

${r.content}`).join(`

`),n=v.map(r=>r.id),console.log(`🎯 Generating quiz from ${v.length} snippet(s) in Swag`);else{const r="latest world news";a=`Generate a quiz about: ${r}`,n=[],console.log(`🎯 Generating quiz from default topic: ${r}`)}if(a.trim().length===0){N("No content available. Please add snippets to Swag or configure feed prompt in Settings.");return}const l=!0,m=Date.now();console.log(`🎯 Generating quiz with ${i.length} provider(s):`,i.map(r=>`${r.type}${r.modelName?`/${r.modelName}`:""}`).join(", ")),console.log(`🎯 Using maturity level: ${$.maturityLevel}`);const p=await ne(a,l,i,e,$.maturityLevel),{quiz:z,cost:q,usage:F,model:Y,provider:K}=p;console.log("✅ Quiz generated:",z.title),console.log(`💰 Cost: $${q.toFixed(6)} (${K}/${Y}, ${F.totalTokens} tokens)`);const X=await x.saveGeneratedQuiz(z.title,n,z.questions?.length||0,l,q);j({snippetIds:n,startTime:m,enrichment:l,quizId:X}),y&&u?(f(`Quiz "${z.title}" ready! Cost: $${q.toFixed(6)}. Complete the current quiz first.`),console.log("⚠️ Quiz already active - new quiz ready but not shown"),await d()):(f(`Quiz generated! Cost: $${q.toFixed(6)} (${F.totalTokens} tokens)`),k(z),w(!0))}catch(e){console.error("Failed to generate quiz:",e),h(e.message||"Failed to generate quiz. Please try again.")}finally{I(!1)}},B=async e=>{if(e.quizData){console.log("✅ Using stored quiz data:",e.quizTitle),j({snippetIds:e.snippetIds,startTime:Date.now(),enrichment:e.enrichment,quizId:e.id}),k(e.quizData),w(!0);return}console.log("⚠️ Quiz data not available for:",e.quizTitle),h("Quiz data not available. Please generate a new quiz instead.")},U=e=>{const i=Math.floor(e/6e4),a=Math.floor(e%6e4/1e3);return`${i}:${a.toString().padStart(2,"0")}`},H=e=>{const i=new Date(e),n=new Date().getTime()-i.getTime(),l=Math.floor(n/(1e3*60*60*24));return l===0?s("quiz.today"):l===1?s("quiz.yesterday"):l<7?s("quiz.daysAgo",{days:l}):i.toLocaleDateString()},V=e=>e>=90?"text-green-600 dark:text-green-400":e>=70?"text-blue-600 dark:text-blue-400":e>=50?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",W=e=>e>=90?"bg-green-100 dark:bg-green-900/30":e>=70?"bg-blue-100 dark:bg-blue-900/30":e>=50?"bg-yellow-100 dark:bg-yellow-900/30":"bg-red-100 dark:bg-red-900/30";return A?t.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:t.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:s("quiz.loadingStats")})}):t.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4 pb-24",children:[t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:()=>L("/"),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-lg transition-colors",title:s("quiz.backToChat"),children:t.jsx(me,{className:"w-6 h-6 text-gray-600 dark:text-gray-400"})}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2 quiz-page-header","data-testid":"quiz-page-title",children:[t.jsx(b,{className:"w-8 h-8 text-indigo-600 dark:text-indigo-400"}),s("quiz.title")]}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:s("quiz.subtitle")})]})]}),t.jsxs("button",{onClick:J,disabled:_,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center gap-2",children:[t.jsx(b,{className:"w-5 h-5"}),_?"Generating...":s("quiz.createNewQuiz")]})]}),g&&g.totalQuizzes>0&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:s("quiz.totalQuizzes")}),t.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:g.totalQuizzes})]}),t.jsx(E,{className:"w-12 h-12 text-yellow-500"})]})}),t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:s("quiz.averageScore")}),t.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:[g.averagePercentage.toFixed(0),"%"]})]}),t.jsx(pe,{className:"w-12 h-12 text-blue-500"})]})}),t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:s("quiz.highestScore")}),t.jsxs("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:[g.highestScore.toFixed(0),"%"]})]}),t.jsx(E,{className:"w-12 h-12 text-green-500"})]})}),t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:s("quiz.questionsAnswered")}),t.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:g.totalQuestionsAnswered})]}),t.jsx(b,{className:"w-12 h-12 text-indigo-500"})]})})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[t.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:t.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:s("quiz.recentQuizzes")})}),T.length===0?t.jsxs("div",{className:"p-12 text-center",children:[t.jsx(b,{className:"w-16 h-16 text-gray-400 dark:text-gray-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:s("quiz.noQuizzesYet")}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("quiz.noQuizzesDescription")}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-4 max-w-md mx-auto",children:["💡 ",s("quiz.quizMeHelp")]})]}):t.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:T.map(e=>t.jsx("div",{className:`p-6 transition-colors cursor-pointer ${e.completed?"hover:bg-gray-50 dark:hover:bg-gray-750":"bg-yellow-50 dark:bg-yellow-900/20 hover:bg-yellow-100 dark:hover:bg-yellow-900/30 border-l-4 border-yellow-500"}`,onClick:()=>B(e),children:t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.quizTitle}),e.completed?t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${W(e.percentage)} ${V(e.percentage)}`,children:[e.score,"/",e.totalQuestions," (",e.percentage,"%)"]}),t.jsx("span",{className:"px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded text-xs font-medium",children:s("quiz.clickToRetake")||"Click to Retake"})]}):t.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-semibold bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-200",children:s("quiz.clickToRestart")})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(de,{className:"w-4 h-4"}),H(e.completedAt)]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(he,{className:"w-4 h-4"}),U(e.timeTaken)]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(b,{className:"w-4 h-4"}),s("quiz.snippetCount",{count:e.snippetIds.length})]}),e.enrichment&&t.jsx("span",{className:"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded text-xs font-medium",children:s("quiz.enriched")}),e.cost!==void 0&&e.cost>0&&t.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-400 rounded text-xs font-medium",children:["Cost: $",e.cost.toFixed(6)]}),!e.synced&&t.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 rounded text-xs font-medium",children:s("quiz.notSynced")})]})]}),t.jsx("button",{onClick:i=>{i.stopPropagation(),R(e.id,e.quizTitle)},className:"p-2 text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:s("quiz.deleteQuiz"),children:t.jsx(ue,{className:"w-5 h-5"})})]})},e.id))})]})]}),y&&u&&c&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:t.jsx(le,{quiz:u,onClose:()=>{console.log("❌ Quiz modal closed without completion"),console.log("📝 Quiz should remain in database as incomplete"),w(!1),k(null),j(null),d()},onComplete:async(e,i,a)=>{const n=Math.round(e/i*100),l=Date.now()-c.startTime;try{if(c.quizId){await x.updateQuizCompletion(c.quizId,e,l,a);const m=await Q();m&&ce(c.quizId,m).then(p=>{p&&console.log("✅ Quiz statistic synced to Google Sheets")}).catch(p=>{console.error("Failed to sync quiz statistic:",p)})}else console.warn("No quizId found, using fallback save method"),await x.saveQuizStatistic({quizTitle:u.title,snippetIds:c.snippetIds,score:e,totalQuestions:i,timeTaken:l,completedAt:new Date().toISOString(),answers:a,enrichment:c.enrichment,completed:!0});f(`Quiz completed! Score: ${e}/${i} (${n}%)`),w(!1),k(null),j(null),await d(),O(Date.now())}catch(m){console.error("Failed to save quiz statistic:",m),N(`Quiz completed! Score: ${e}/${i} (${n}%) - Statistics not saved`)}}})})]})}export{ke as default};

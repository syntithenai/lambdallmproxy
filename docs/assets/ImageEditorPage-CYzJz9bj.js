import{j as e,r as x,g as ge,u as Ie,bb as Ce,b2 as ze,b3 as Ee,a as Ae,bc as $e,b1 as _e,R as te,aN as Re}from"./index-DtnxAUWU.js";import{e as Pe}from"./extractImages-qKcjm2ka.js";const Te=({image:c,isSelected:I,onToggleSelection:g,processingStatus:d,isNew:j=!1})=>e.jsxs("div",{className:`
        relative rounded-lg overflow-hidden border-2 transition-all
        ${I?"border-blue-500 shadow-lg":"border-gray-200"}
        ${j?"ring-4 ring-green-500 animate-pulse":""}
      `,children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("input",{type:"checkbox",checked:I,onChange:g,className:"w-5 h-5 rounded bg-white/80 backdrop-blur cursor-pointer"})}),e.jsx("img",{src:c.url,alt:c.name,className:"w-full h-auto object-cover",loading:"lazy"},c.url),d?.status==="processing"&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto"}),e.jsx("p",{className:"text-sm mt-2",children:d.message}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2 mx-4",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${d.progress}%`}})})]})}),d?.status==="error"&&e.jsx("div",{className:"absolute inset-0 bg-red-500/20 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-red-900 bg-white/90 p-2 rounded",children:[e.jsx("p",{className:"text-sm font-bold",children:"❌ Error"}),e.jsx("p",{className:"text-xs",children:d.error})]})}),d?.status==="complete"&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-500 text-white px-2 py-1 rounded text-xs font-bold",children:"✓ Done"}),e.jsxs("div",{className:"p-2 bg-gray-50",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:c.name}),e.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:c.tags.map(m=>e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-xs rounded",children:m},m))}),c.width&&c.height&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.width," × ",c.height,c.format&&` • ${c.format.toUpperCase()}`]})]})]}),Fe=({images:c,selectedImages:I,onToggleSelection:g,processingStatus:d,newlyGeneratedIds:j=new Set})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:[c.map(m=>e.jsx(Te,{image:m,isSelected:I.has(m.id),onToggleSelection:()=>g(m.id),processingStatus:d.get(m.id),isNew:j.has(m.id)},m.id)),c.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg",children:"No images to display"}),e.jsx("p",{className:"text-sm",children:"Navigate from the Swag page to edit images"})]})]}),Me=({onSelectAll:c,onSelectNone:I,selectedCount:g,totalCount:d})=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:c,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",disabled:g===d,children:"Select All"}),e.jsx("button",{onClick:I,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",disabled:g===0,children:"Select None"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[g," of ",d," selected"]})]}),Be=({selectedCount:c,onOperation:I,disabled:g})=>{const[d,j]=x.useState(null),m=x.useRef({});x.useEffect(()=>{const i=E=>{if(d&&m.current[d]){const S=m.current[d];S&&!S.contains(E.target)&&j(null)}};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[d]);const N=(i="")=>`px-3 py-1.5 text-xs font-medium rounded transition-colors ${g||c===0?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-700"} ${i}`,v=i=>`px-3 py-1.5 text-xs font-medium rounded transition-colors flex items-center gap-1 ${g||c===0?"bg-gray-100 text-gray-400 cursor-not-allowed":i?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,n="w-full text-left px-3 py-2 text-xs hover:bg-gray-100 transition-colors border-b border-gray-100 last:border-b-0",u=i=>{g||c===0||j(d===i?null:i)},a=i=>{I(i),j(null)};return e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-start",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>a({type:"resize",params:{scale:.5},label:"50%"}),disabled:g||c===0,className:N(),title:"Resize to 50%",children:"50%"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{scale:2},label:"200%"}),disabled:g||c===0,className:N(),title:"Resize to 200%",children:"200%"})]}),e.jsxs("div",{className:"relative",ref:i=>{m.current.sizes=i},children:[e.jsx("button",{onClick:()=>u("sizes"),disabled:g||c===0,className:v(d==="sizes"),children:"More Sizes ▾"}),d==="sizes"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[120px]",children:[e.jsx("button",{onClick:()=>a({type:"resize",params:{scale:.25},label:"25%"}),className:n,children:"25%"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{scale:.33},label:"33%"}),className:n,children:"33%"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{scale:.75},label:"75%"}),className:n,children:"75%"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{scale:1.5},label:"150%"}),className:n,children:"150%"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{scale:3},label:"300%"}),className:n,children:"300%"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{scale:4},label:"400%"}),className:n,children:"400%"})]})]}),e.jsxs("div",{className:"relative",ref:i=>{m.current.dimensions=i},children:[e.jsx("button",{onClick:()=>u("dimensions"),disabled:g||c===0,className:v(d==="dimensions"),children:"Presets ▾"}),d==="dimensions"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[180px]",children:[e.jsx("button",{onClick:()=>a({type:"resize",params:{width:1920,height:1080},label:"1920×1080 (Full HD)"}),className:n,children:"📺 1920×1080 (Full HD)"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{width:1280,height:720},label:"1280×720 (HD)"}),className:n,children:"📺 1280×720 (HD)"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{width:1024,height:1024},label:"1024×1024 (Square)"}),className:n,children:"⬜ 1024×1024 (Square)"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{width:512,height:512},label:"512×512 (Icon)"}),className:n,children:"🔲 512×512 (Icon)"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{width:1080,height:1920},label:"1080×1920 (Portrait)"}),className:n,children:"📱 1080×1920 (Mobile)"}),e.jsx("button",{onClick:()=>a({type:"resize",params:{width:1200,height:630},label:"1200×630 (Social)"}),className:n,children:"🌐 1200×630 (Social)"})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>a({type:"rotate",params:{degrees:90},label:"↻ 90°"}),disabled:g||c===0,className:N(),title:"Rotate 90° clockwise",children:"↻"}),e.jsx("button",{onClick:()=>a({type:"rotate",params:{degrees:270},label:"↺ 90°"}),disabled:g||c===0,className:N(),title:"Rotate 90° counter-clockwise",children:"↺"})]}),e.jsxs("div",{className:"relative",ref:i=>{m.current.crop=i},children:[e.jsx("button",{onClick:()=>u("crop"),disabled:g||c===0,className:v(d==="crop"),children:"Crop & Trim ▾"}),d==="crop"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[180px]",children:[e.jsx("button",{onClick:()=>a({type:"trim",params:{},label:"Auto-trim borders"}),className:n,title:"Remove transparent or solid-color borders",children:"✂️ Auto-trim borders"}),e.jsx("button",{onClick:()=>a({type:"autocrop",params:{focus:"center"},label:"AI Crop (Center)"}),className:n,title:"AI-powered crop focusing on center subject",children:"🤖 AI Crop (Center)"}),e.jsx("button",{onClick:()=>a({type:"autocrop",params:{focus:"face"},label:"AI Crop (Face)"}),className:n,title:"AI-powered crop focusing on face",children:"😊 AI Crop (Face)"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>a({type:"crop",params:{width:1920,height:1080},label:"1920×1080"}),className:n,children:"📺 1920×1080 (Full HD)"}),e.jsx("button",{onClick:()=>a({type:"crop",params:{width:1280,height:720},label:"1280×720"}),className:n,children:"📺 1280×720 (HD)"}),e.jsx("button",{onClick:()=>a({type:"crop",params:{width:800,height:800},label:"800×800"}),className:n,children:"⬜ 800×800 (Square)"})]})]}),e.jsxs("div",{className:"relative",ref:i=>{m.current.flip=i},children:[e.jsx("button",{onClick:()=>u("flip"),disabled:g||c===0,className:v(d==="flip"),children:"Flip ▾"}),d==="flip"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[150px]",children:[e.jsx("button",{onClick:()=>a({type:"flip",params:{direction:"horizontal"},label:"Horizontal"}),className:n,children:"↔️ Horizontal"}),e.jsx("button",{onClick:()=>a({type:"flip",params:{direction:"vertical"},label:"Vertical"}),className:n,children:"↕️ Vertical"}),e.jsx("button",{onClick:()=>a({type:"rotate",params:{degrees:180},label:"180°"}),className:n,children:"🔄 180° rotation"})]})]}),e.jsxs("div",{className:"relative",ref:i=>{m.current.format=i},children:[e.jsx("button",{onClick:()=>u("format"),disabled:g||c===0,className:v(d==="format"),children:"Format ▾"}),d==="format"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[150px]",children:[e.jsx("button",{onClick:()=>a({type:"format",params:{format:"jpg",quality:90},label:"JPG (High)"}),className:n,children:"📄 JPG (High Quality)"}),e.jsx("button",{onClick:()=>a({type:"format",params:{format:"jpg",quality:80},label:"JPG (Medium)"}),className:n,children:"📄 JPG (Medium)"}),e.jsx("button",{onClick:()=>a({type:"format",params:{format:"jpg",quality:60},label:"JPG (Low)"}),className:n,children:"📄 JPG (Low/Small)"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>a({type:"format",params:{format:"png"},label:"PNG"}),className:n,children:"🖼️ PNG (Lossless)"}),e.jsx("button",{onClick:()=>a({type:"format",params:{format:"webp"},label:"WebP"}),className:n,children:"🌐 WebP (Modern)"}),e.jsx("button",{onClick:()=>a({type:"format",params:{format:"avif"},label:"AVIF"}),className:n,children:"⚡ AVIF (Best Compression)"})]})]}),e.jsxs("div",{className:"relative",ref:i=>{m.current.filters=i},children:[e.jsx("button",{onClick:()=>u("filters"),disabled:g||c===0,className:v(d==="filters"),children:"Filters ▾"}),d==="filters"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[150px]",children:[e.jsx("button",{onClick:()=>a({type:"filter",params:{filter:"grayscale"},label:"Grayscale"}),className:n,children:"⚫ Grayscale"}),e.jsx("button",{onClick:()=>a({type:"filter",params:{filter:"sepia"},label:"Sepia"}),className:n,children:"🟤 Sepia"}),e.jsx("button",{onClick:()=>a({type:"filter",params:{filter:"negate"},label:"Invert"}),className:n,children:"🔲 Invert Colors"}),e.jsx("button",{onClick:()=>a({type:"filter",params:{filter:"normalize"},label:"Normalize"}),className:n,children:"📊 Normalize (Auto-enhance)"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>a({type:"filter",params:{filter:"blur",strength:3},label:"Blur"}),className:n,children:"🌫️ Blur"}),e.jsx("button",{onClick:()=>a({type:"filter",params:{filter:"sharpen"},label:"Sharpen"}),className:n,children:"✨ Sharpen"})]})]}),e.jsxs("div",{className:"relative",ref:i=>{m.current.adjust=i},children:[e.jsx("button",{onClick:()=>u("adjust"),disabled:g||c===0,className:v(d==="adjust"),children:"Adjustments ▾"}),d==="adjust"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[180px]",children:[e.jsx("button",{onClick:()=>a({type:"modulate",params:{brightness:1.2},label:"Brightness +20%"}),className:n,children:"☀️ Brightness +20%"}),e.jsx("button",{onClick:()=>a({type:"modulate",params:{brightness:.8},label:"Brightness -20%"}),className:n,children:"🌙 Brightness -20%"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>a({type:"modulate",params:{saturation:1.5},label:"Saturation +50%"}),className:n,children:"🎨 Saturation +50%"}),e.jsx("button",{onClick:()=>a({type:"modulate",params:{saturation:.5},label:"Saturation -50%"}),className:n,children:"🎨 Saturation -50%"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>a({type:"modulate",params:{hue:90},label:"Hue shift +90°"}),className:n,children:"� Hue shift +90°"}),e.jsx("button",{onClick:()=>a({type:"tint",params:{r:255,g:200,b:150},label:"Warm tint"}),className:n,children:"🔥 Warm tint"}),e.jsx("button",{onClick:()=>a({type:"tint",params:{r:150,g:200,b:255},label:"Cool tint"}),className:n,children:"❄️ Cool tint"})]})]}),e.jsxs("div",{className:"relative",ref:i=>{m.current.effects=i},children:[e.jsx("button",{onClick:()=>u("effects"),disabled:g||c===0,className:v(d==="effects"),children:"Effects ▾"}),d==="effects"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[180px]",children:[e.jsx("button",{onClick:()=>a({type:"extend",params:{top:20,bottom:20,left:20,right:20,background:{r:255,g:255,b:255}},label:"White border"}),className:n,children:"⬜ White border (20px)"}),e.jsx("button",{onClick:()=>a({type:"extend",params:{top:20,bottom:20,left:20,right:20,background:{r:0,g:0,b:0}},label:"Black border"}),className:n,children:"⬛ Black border (20px)"}),e.jsx("button",{onClick:()=>a({type:"extend",params:{top:50,bottom:50,left:50,right:50,background:{r:255,g:255,b:255}},label:"Wide padding"}),className:n,children:"📐 Wide padding (50px)"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>a({type:"gamma",params:{gamma:1.5},label:"Gamma boost"}),className:n,children:"💡 Gamma boost"}),e.jsx("button",{onClick:()=>a({type:"gamma",params:{gamma:.7},label:"Gamma reduce"}),className:n,children:"🔅 Gamma reduce"})]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-3 flex justify-between items-center",children:[e.jsxs("span",{children:[c," image",c!==1?"s":""," selected"]}),c>0&&e.jsxs("span",{className:"text-gray-400",children:["Select operation above • ",d?"📂 Menu open":"💡 Click for more options"]})]})]})},Le=({value:c,onChange:I,onSubmit:g,disabled:d,placeholder:j="Describe transformation (e.g., 'resize to 800px width', 'convert to grayscale', or 'add a dog')"})=>{const[m,N]=x.useState(!1),[v,n]=x.useState(!1),[u,a]=x.useState(!1),i=x.useRef(null),E=x.useRef(null),S=x.useRef(!1),C=x.useRef(""),U=x.useRef(null),L=x.useRef(null),z=x.useRef(null),_=x.useRef(null),M=x.useRef(null),B=x.useRef(null),ne=async()=>{try{const p=await navigator.mediaDevices.getUserMedia({audio:!0});B.current=p;const h=new(window.AudioContext||window.webkitAudioContext);U.current=h;const A=h.createAnalyser();A.fftSize=256,A.smoothingTimeConstant=.8,L.current=A,h.createMediaStreamSource(p).connect(A);const $=A.frequencyBinCount,k=new Uint8Array($);z.current=k,G()}catch(p){console.error("Error accessing microphone:",p)}},G=()=>{if(!L.current||!z.current||!M.current)return;const p=M.current,h=p.getContext("2d");if(!h)return;const A=L.current,T=z.current,$=A.frequencyBinCount,k=()=>{if(!m)return;_.current=requestAnimationFrame(k),A.getByteFrequencyData(T),h.fillStyle="rgba(15, 23, 42, 0.95)",h.fillRect(0,0,p.width,p.height);const Y=p.width/$*2.5;let P,Z=0;for(let O=0;O<$;O++){P=T[O]/255*p.height*.8;const ee=T[O]/255,W=200,le=50+ee*30,K=40+ee*30;h.fillStyle=`hsl(${W}, ${le}%, ${K}%)`,h.fillRect(Z,p.height-P,Y,P),Z+=Y+1}h.strokeStyle="rgba(148, 163, 184, 0.3)",h.lineWidth=1,h.beginPath(),h.moveTo(0,p.height/2),h.lineTo(p.width,p.height/2),h.stroke()};k()},R=()=>{_.current&&(cancelAnimationFrame(_.current),_.current=null),B.current&&(B.current.getTracks().forEach(p=>p.stop()),B.current=null),U.current&&(U.current.close(),U.current=null)};x.useEffect(()=>{const p=window.SpeechRecognition||window.webkitSpeechRecognition;return p&&(n(!0),i.current=new p,i.current.continuous=!0,i.current.interimResults=!0,i.current.lang="en-US",i.current.maxAlternatives=1,i.current.onresult=h=>{let A="",T="";for(let $=h.resultIndex;$<h.results.length;$++){const k=h.results[$][0].transcript;h.results[$].isFinal?T+=k:A+=k}if((A.trim()||T.trim())&&(S.current||(S.current=!0,console.log("🎤 Speech detected, starting timeout...")),C.current=A,E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{console.log("🎤 Silence detected, stopping..."),i.current&&i.current.stop()},2e3)),T){const $=(C.current+" "+T).trim();I(c?`${c} ${$}`:$),C.current=""}},i.current.onerror=h=>{if(console.error("Speech recognition error:",h.error),h.error==="no-speech"){if(console.log("🎤 No speech detected yet, continuing to listen..."),!S.current&&m)try{i.current.start()}catch{}}else N(!1),S.current=!1,E.current&&clearTimeout(E.current)},i.current.onend=()=>{console.log("🎤 Recognition ended"),N(!1),a(!1);const h=S.current;S.current=!1,C.current="",E.current&&clearTimeout(E.current),R(),h&&c.trim()&&setTimeout(()=>{g()},500)}),()=>{i.current&&i.current.stop(),E.current&&clearTimeout(E.current),R()}},[I,c,m]);const J=async()=>{if(i.current)if(m)i.current.stop(),N(!1),a(!1),R();else try{a(!0),await ne(),i.current.start(),N(!0)}catch(p){console.error("Error starting speech recognition:",p),N(!1),a(!1),R()}};x.useEffect(()=>{const p=h=>{h.key==="Escape"&&u&&J()};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[u]);const re=p=>{p.preventDefault(),c.trim()&&!d&&g()},D=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),c.trim()&&!d&&g())};return e.jsxs("div",{className:"bg-white p-4",children:[e.jsxs("form",{onSubmit:re,children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{value:c,onChange:p=>I(p.target.value),disabled:d,placeholder:j,tabIndex:1,className:"w-full border border-gray-300 rounded-lg p-3 pr-12 resize-none h-24 focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",onKeyDown:D}),v&&e.jsx("button",{type:"button",onClick:J,disabled:d,tabIndex:3,className:`
                  absolute right-2 top-2 p-2 rounded-full transition-all
                  ${m?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}
                  ${d?"opacity-50 cursor-not-allowed":""}
                `,title:m?"Listening... Click to stop":"Click to speak command","aria-label":m?"Stop voice input":"Start voice input",children:e.jsxs("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"})]})})]}),e.jsx("button",{type:"submit",disabled:d||!c.trim(),tabIndex:2,className:`
              self-end px-6 py-3 rounded-lg font-medium transition-colors
              ${d||!c.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}
            `,children:"Apply"})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsx("strong",{children:"Examples:"}),' "resize to 800px width" • "convert to grayscale" • "rotate 90 degrees" • "add a dog" • "change background to sunset"',v&&e.jsxs(e.Fragment,{children:[" • ",e.jsx("strong",{children:"🎤 Voice:"})," Click microphone to speak commands (auto-submits)"]})," ","• Press ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Enter"})," to apply • ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Shift+Enter"})," for new line"]})]}),u&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm",children:e.jsxs("div",{className:"relative bg-slate-900 rounded-2xl shadow-2xl p-8 max-w-2xl w-full mx-4",children:[e.jsx("button",{onClick:J,className:"absolute top-4 right-4 text-slate-400 hover:text-white transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4 rounded-full bg-blue-500 bg-opacity-20",children:e.jsxs("svg",{className:"w-8 h-8 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"})]})}),e.jsx("h3",{className:"text-2xl font-semibold text-white mb-2",children:S.current?"Listening...":"Speak your command"}),e.jsx("p",{className:"text-slate-400 text-sm",children:S.current?"Processing your voice input...":'Try: "resize to 800 pixels" or "convert to grayscale"'})]}),e.jsx("div",{className:"mb-6 rounded-xl overflow-hidden border border-slate-700 shadow-inner",children:e.jsx("canvas",{ref:M,width:600,height:200,className:"w-full h-48"})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 text-slate-300",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"text-sm font-medium",children:S.current?"Speech detected":"Ready to listen"})]}),C.current&&e.jsx("div",{className:"mt-4 p-3 bg-slate-800 rounded-lg border border-slate-700",children:e.jsxs("p",{className:"text-slate-300 text-sm italic",children:['"',C.current,'"']})}),e.jsx("div",{className:"mt-6 text-center text-xs text-slate-500",children:"Click outside or press ESC to cancel • Stops automatically after 2 seconds of silence"})]})})]})};async function ue(c,I){console.log("🎨 [imageEditApi] editImages called with request:",c);const d=`${await ge()}/image-edit`;console.log("🎨 [imageEditApi] API URL:",d);const j=localStorage.getItem("google_oauth_token");console.log("🎨 [imageEditApi] Has Google token:",!!j),console.log("🎨 [imageEditApi] Making fetch request...");const m=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json",...j?{"X-Google-OAuth-Token":j}:{}},body:JSON.stringify(c)});if(console.log("🎨 [imageEditApi] Response status:",m.status,m.ok),!m.ok){const u=await m.text();throw console.error("🎨 [imageEditApi] Error response:",u),new Error(`HTTP error! status: ${m.status} - ${u}`)}if(!m.body)throw console.error("🎨 [imageEditApi] Response body is null!"),new Error("Response body is null");console.log("🎨 [imageEditApi] Starting to read SSE stream...");const N=m.body.getReader(),v=new TextDecoder;let n="";try{for(;;){const{done:u,value:a}=await N.read();if(u){console.log("🎨 [imageEditApi] Stream ended");break}n+=v.decode(a,{stream:!0});const i=n.split(`

`);n=i.pop()||"";for(const E of i)if(E.startsWith("data: ")){const S=E.substring(6);try{const C=JSON.parse(S);if(console.log("🎨 [imageEditApi] Parsed SSE event:",C.type),I(C),C.type==="error"||C.type==="complete")return}catch(C){console.error("Failed to parse SSE event:",C,S)}}}}finally{N.releaseLock()}}async function pe(c,I,g){const j=`${await ge()}/parse-image-command`,m=g||localStorage.getItem("google_oauth_token")||localStorage.getItem("access_token"),N=I?.filter(a=>a.enabled!==!1&&a.apiKey&&a.apiKey.trim()!=="")||[],v=N.length>0;console.log("🔍 [parseImageCommand] Sending request:",{hasGoogleToken:!!m,tokenSource:g?"parameter":"localStorage",tokenLength:m?.length,providersCount:N.length,hasValidProviders:v,providers:N.map(a=>({type:a.type,hasApiKey:!!a.apiKey,enabled:a.enabled})),willUseBackendProviders:!v});const n={command:c};v&&(n.providers=N);const u=await fetch(j,{method:"POST",headers:{"Content-Type":"application/json",...m?{Authorization:`Bearer ${m}`,"X-Google-OAuth-Token":m}:{}},body:JSON.stringify(n)});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return await u.json()}const Ge=Object.freeze(Object.defineProperty({__proto__:null,editImages:ue,parseImageCommand:pe},Symbol.toStringTag,{value:"Module"})),Ue=()=>{const c=Ie(),I=Ce(),{addSnippet:g,updateSnippet:d,snippets:j}=ze(),{settings:m}=Ee(),{getToken:N}=Ae(),{features:v}=$e(),{showSuccess:n,showError:u}=_e(),a=I.state,i=a?.images||[],E=a?.editingSnippetId,S=i.length===1&&i[0].snippetId,C=S?i[0].snippetId:null,U=i.length>0;U&&(localStorage.removeItem("image_editor_processed_images"),localStorage.removeItem("image_editor_images"),localStorage.removeItem("image_editor_selection"),localStorage.removeItem("image_editor_command"));const[L]=x.useState(i),[z,_]=x.useState(()=>{const s=localStorage.getItem("image_editor_images");if(s)try{const r=localStorage.getItem("image_editor_selection"),o=JSON.parse(s);if(r&&o){const t=JSON.parse(r),l=o.map(b=>b.id),f=i.map(b=>b.id);if(l.length===f.length&&l.every(b=>f.includes(b))){const b=t.filter(w=>f.includes(w));if(b.length>0)return new Set(b)}}}catch(r){console.error("Failed to load persisted selection:",r)}return i.length>0?new Set(i.map(r=>r.id)):new Set}),[M,B]=x.useState(()=>{if(!U)try{const s=localStorage.getItem("image_editor_processed_images");if(s){const r=JSON.parse(s);return console.log("🔄 Restored",r.length,"processed images from localStorage"),r}}catch(s){console.error("Failed to restore processed images:",s)}return[]}),[ne,G]=x.useState(new Map),[R,J]=x.useState(()=>{try{return localStorage.getItem("image_editor_command")||""}catch(s){return console.error("Failed to load persisted command:",s),""}}),[re,D]=x.useState(!1),[p]=x.useState(new Set),[h,A]=x.useState(new Map),[T,$]=x.useState(!1),[k,Y]=x.useState(""),[P,Z]=x.useState(!1),[O,ee]=x.useState(!1),W=te.useRef(null),[le,K]=x.useState(!1),[se,he]=x.useState(""),[ae,xe]=x.useState([]);te.useEffect(()=>{try{R.trim()?localStorage.setItem("image_editor_command",R):localStorage.removeItem("image_editor_command")}catch(s){console.error("Failed to persist command:",s)}},[R]),te.useEffect(()=>{try{L.length>0&&localStorage.setItem("image_editor_images",JSON.stringify(L))}catch(s){console.error("Failed to persist images:",s)}},[L]),te.useEffect(()=>{try{z.size>0?localStorage.setItem("image_editor_selection",JSON.stringify(Array.from(z))):localStorage.removeItem("image_editor_selection")}catch(s){console.error("Failed to persist selection:",s)}},[z]),te.useEffect(()=>{try{M.length>0?(localStorage.setItem("image_editor_processed_images",JSON.stringify(M)),console.log("💾 Persisted",M.length,"processed images to localStorage")):localStorage.removeItem("image_editor_processed_images")}catch(s){console.error("Failed to persist processed images:",s)}},[M]);const Q=[...M,...L].map(s=>{const r=h.get(s.id);return r?{...s,url:r}:s}),fe=()=>{_(new Set(Q.map(s=>s.id)))},be=()=>{_(new Set)},ye=s=>{const r=new Set(z);r.has(s)?r.delete(s):r.add(s),_(r)},we=async()=>{if(h.size!==0)try{if(S&&C){const r=j.find(l=>l.id===C);if(!r)throw new Error("Source snippet not found");let o=r.content,t=0;for(const[l,f]of h.entries()){const y=Q.find(V=>V.id===l);if(!y)continue;const b=f,w=y.url;if(o.trim()===w||o.trim()===`![](${w})`){o=b,t++;continue}if(y.markdownPosition!==void 0){const V=/!\[([^\]]*)\]\(([^)\s]+)(?:\s+"([^"]*)")?\)/g;let F,H=!1;for(;(F=V.exec(o))!==null;)if(F.index===y.markdownPosition&&F[2]===w){const oe=F[0],ie=oe.replace(w,b);o=o.slice(0,F.index)+ie+o.slice(F.index+oe.length),H=!0,t++;break}if(H)continue}const q=new RegExp(`!\\[([^\\]]*)\\]\\(${de(w)}\\)`,"g");if(q.test(o)){o=o.replace(q,`![$1](${b})`),t++;continue}const X=new RegExp(`<img([^>]*?)src=["']${de(w)}["']`,"gi");X.test(o)&&(o=o.replace(X,`<img$1src="${b}"`),t++)}if(t>0){await d(C,{content:o}),n(`Updated ${t} image(s) in snippet`),localStorage.removeItem("image_editor_selection"),localStorage.removeItem("image_editor_images"),c("/swag",{state:{updatedSnippetId:C}});return}}let s=0;for(const[r,o]of h.entries()){const t=Q.find(l=>l.id===r);if(t)try{const l=o,f=`Edited Image - ${new Date().toLocaleString()}`,y=`![${t.name||"Edited image"}](${l})`;await g(y,"user",f),s++}catch(l){console.error(`Failed to save image ${r}:`,l)}}s>0&&(n(`Saved ${s} edited image(s) to Swag`),A(new Map),localStorage.removeItem("image_editor_selection"),localStorage.removeItem("image_editor_images"),c("/swag"))}catch(s){console.error("Auto-save failed:",s),u(`Failed to save: ${s instanceof Error?s.message:String(s)}`)}},ce=async s=>{if(z.size===0)return;D(!0);const r=Array.from(z),o=Q.filter(t=>r.includes(t.id));try{await ue({images:o.map(t=>({id:t.id,url:t.url})),operations:[s]},t=>{t.type==="image_start"&&t.imageId?G(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"processing",progress:0,message:`Starting ${s.label}...`})):t.type==="progress"&&t.imageId?G(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"processing",progress:t.progress||0,message:t.currentOperation?`${t.currentOperation}... ${t.progress}%`:`${t.status}...`})):t.type==="image_complete"&&t.imageId&&t.result?(G(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"complete",progress:100,message:"Complete",result:t.result?.url})),t.result?.url&&A(l=>new Map(l).set(t.imageId,t.result.url))):t.type==="image_error"&&t.imageId?G(l=>new Map(l).set(t.imageId,{imageId:t.imageId,status:"error",progress:0,message:t.error||"Processing failed",error:t.error})):t.type==="complete"?(console.log("All images processed:",t),setTimeout(()=>{we()},500)):t.type==="error"&&(console.error("API error:",t.error),u(`Error: ${t.error}`))}),setTimeout(()=>{D(!1),r.forEach(t=>{G(l=>{const f=new Map(l);return f.delete(t),f})})},3e3)}catch(t){console.error("Image processing error:",t),u(`Error processing images: ${t instanceof Error?t.message:String(t)}`),D(!1),r.forEach(l=>{G(f=>new Map(f).set(l,{imageId:l,status:"error",progress:0,message:"Failed",error:t instanceof Error?t.message:String(t)}))})}},de=s=>s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),me=async(s,r=1024,o=768)=>new Promise((t,l)=>{const f=new Image;f.onload=()=>{let y=f.width,b=f.height;if(y>r||b>o){const V=r/y,F=o/b,H=Math.min(V,F);y=Math.floor(y*H),b=Math.floor(b*H),console.log(`📐 Resizing image from ${f.width}x${f.height} to ${y}x${b}`)}const w=document.createElement("canvas");w.width=y,w.height=b;const q=w.getContext("2d");if(!q){l(new Error("Failed to get canvas context"));return}q.drawImage(f,0,0,y,b);const X=w.toDataURL("image/jpeg",.85);t(X)},f.onerror=()=>l(new Error("Failed to load image")),f.src=s}),je=()=>{W.current?.click()},Ne=async s=>{const r=s.target.files;if(!(!r||r.length===0)){ee(!0);try{const o=[];for(let l=0;l<r.length;l++){const f=r[l],y=new FileReader,w=await new Promise((oe,ie)=>{y.onload=()=>oe(y.result),y.onerror=ie,y.readAsDataURL(f)}),q=await me(w),X=`Uploaded: ${f.name}`,V=`<img src="${q}" alt="${f.name}" style="max-width: 100%; height: auto;" />`,F=await g(V,"user",X),H=`upload-${Date.now()}-${l}`;o.push({id:H,url:w,name:f.name,tags:["uploaded"],snippetId:F?.id||"",imageIndex:0,markdownPosition:0})}B(l=>[...l,...o]);const t=o.map(l=>l.id);_(l=>new Set([...l,...t])),n(`Uploaded ${r.length} image(s) and added to editor`),W.current&&(W.current.value="")}catch(o){console.error("Upload error:",o),u(`Failed to upload: ${o instanceof Error?o.message:String(o)}`)}finally{ee(!1)}}},ve=async()=>{if(console.log("🎨 handleCreateFromPrompt called with prompt:",k),!k.trim()){u("Please enter a prompt");return}console.log("🎨 Starting image generation..."),Z(!0);try{console.log("🎨 Importing imageEditApi...");const{editImages:s}=await Re(async()=>{const{editImages:o}=await Promise.resolve().then(()=>Ge);return{editImages:o}},void 0);console.log("🎨 imageEditApi imported successfully");const r=`generated-${Date.now()}`;console.log("🎨 Creating request with imageId:",r),console.log("🎨 Calling editImages..."),await s({images:[],operations:[{type:"generate",params:{prompt:k,mode:"edit",width:1024,height:1024}}]},o=>{console.log("🎨 Progress event:",o.type,o),o.type==="image_complete"&&o.result?(A(t=>new Map(t).set(r,o.result.url)),me(o.result.url).then(t=>{const l=`Generated: ${k.substring(0,50)}`,f=`<img src="${t}" alt="${k}" style="max-width: 100%; height: auto;" />`;g(f,"user",l).then(y=>{const b={id:r,url:o.result.url,name:`Generated: ${k.substring(0,30)}...`,tags:["ai-generated"],snippetId:y?.id||"temp-"+r,width:1024,height:1024};B(w=>[...w,b]),_(w=>new Set([...w,r])),n("Image generated and saved to Swag. You can edit it below."),$(!1),Y("")}).catch(y=>{console.error("Failed to save generated image:",y);const b={id:r,url:o.result.url,name:`Generated: ${k.substring(0,30)}...`,tags:["ai-generated"],snippetId:"temp-"+r,width:1024,height:1024};B(w=>[...w,b]),_(w=>new Set([...w,r])),u("Generated image but failed to save to Swag. You can still edit it below.")})}).catch(t=>{console.error("Failed to resize image:",t),u("Failed to resize image for saving")})):o.type==="error"&&(console.error("🎨 Error event received:",o.error),u(`Generation failed: ${o.error}`))}),console.log("🎨 editImages call completed")}catch(s){console.error("🎨 Image generation error (caught):",s),u(`Failed to generate: ${s instanceof Error?s.message:String(s)}`)}finally{console.log("🎨 Setting isGenerating to false"),Z(!1)}},ke=s=>{try{const r=j.filter(l=>s.has(l.id));if(r.length===0){u("No snippets selected");return}const o=Pe(r);if(o.length===0){u("Selected snippets contain no images");return}B(l=>[...l,...o]);const t=o.map(l=>l.id);_(l=>new Set([...l,...t])),n(`Added ${o.length} image(s) from ${r.length} snippet(s)`),K(!1)}catch(r){console.error("Failed to load images from Swag:",r),u("Failed to load images from selected snippets")}},Se=async()=>{if(!(!R.trim()||z.size===0)){D(!0);try{console.log("Parsing command:",R);const s=await N(),r=await pe(R,m.providers,s);if(!r.success||r.operations.length===0){alert(r.explanation||'Could not understand command. Try: "make smaller", "rotate right", "convert to jpg"'),D(!1);return}console.log("Parsed operations:",r.operations),r.operations.some(t=>t.type==="generate")&&console.log("🎨 Generative AI operations detected - will be processed by backend");for(const t of r.operations)await ce(t);J("")}catch(s){console.error("Command parsing error:",s),alert(`Error: ${s instanceof Error?s.message:String(s)}`)}finally{D(!1)}}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[!v?.imageEditing&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-start",children:[e.jsx("svg",{className:"w-6 h-6 text-blue-400 mt-0.5 mr-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"AI Image Features Unavailable"}),e.jsx("div",{className:"mt-1 text-sm text-blue-700",children:e.jsx("p",{children:"Basic image editing works (resize, rotate, flip, crop). AI-powered features (generate from prompt, natural language edits) require an image generation provider to be configured (e.g., OpenAI DALL-E, Replicate Flux)."})})]})]})}),e.jsx("header",{className:"bg-white border-b border-gray-200 p-4 sticky top-0 z-20 shadow-sm",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>{E?c("/swag",{state:{editingSnippetId:E}}):c("/swag")},className:"flex items-center gap-2 text-gray-700 hover:text-gray-900 font-medium transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Swag"]}),e.jsxs("h1",{className:"text-xl font-bold text-gray-900",children:[S?"Edit Inline Image":"Image Editor",z.size>0&&` (${z.size} selected)`]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-sm text-gray-600 italic",children:h.size>0?`✓ ${h.size} image(s) processed`:"Select images and apply operations"}),e.jsxs("button",{onClick:je,disabled:O,className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 ${O?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,title:"Upload images from your device",children:[e.jsx("span",{children:"📤"}),e.jsx("span",{children:O?"Uploading...":"Upload Images"})]}),e.jsx("input",{ref:W,type:"file",accept:"image/*",multiple:!0,onChange:Ne,className:"hidden"}),e.jsxs("button",{onClick:()=>K(!0),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors flex items-center gap-2",title:"Select existing images from Swag library",children:[e.jsx("span",{children:"📚"}),e.jsx("span",{children:"Select from Swag"})]}),v?.imageEditing&&e.jsxs("button",{onClick:()=>$(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors flex items-center gap-2",title:"Generate new image from text prompt",children:[e.jsx("span",{children:"✨"}),e.jsx("span",{children:"Create from Prompt"})]})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"✨ Create Image from Prompt"}),e.jsx("button",{onClick:()=>$(!1),className:"text-gray-400 hover:text-gray-600 text-2xl",disabled:P,children:"×"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Describe the image you want to create:"}),e.jsx("textarea",{value:k,onChange:s=>Y(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:4,placeholder:"e.g., 'A sunset over mountains with a lake in the foreground' or 'A cute cat wearing a wizard hat'",disabled:P})]}),e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-400 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("div",{className:"text-sm text-blue-700",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Tips:"})," Be specific and descriptive. Include details about style, colors, lighting, and composition for best results."]})})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>$(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",disabled:P,children:"Cancel"}),e.jsx("button",{onClick:()=>{console.log("🎨 Generate Image button clicked, disabled:",!k.trim()||P),!k.trim()||P||ve()},disabled:!k.trim()||P,className:`px-4 py-2 rounded-lg font-medium transition-colors ${!k.trim()||P?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,children:P?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):"✨ Generate Image"})]})]})}),le&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"📚 Select from Swag Library"}),e.jsx("button",{onClick:()=>K(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-2xl",children:"×"})]}),e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 space-y-3",children:[e.jsx("input",{type:"text",placeholder:"Search snippets by title or content...",value:se,onChange:s=>he(s.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"}),(()=>{const s=Array.from(new Set(j.flatMap(r=>r.tags||[]))).sort();return s.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(r=>e.jsx("button",{onClick:()=>xe(o=>o.includes(r)?o.filter(t=>t!==r):[...o,r]),className:`px-3 py-1 text-sm rounded-full transition-colors ${ae.includes(r)?"bg-indigo-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:r},r))}):null})()]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:(()=>{let s=j.filter(r=>{if(!(r.content.includes("<img")||r.content.match(/!\[.*?\]\(.*?\)/)))return!1;if(se.trim()){const t=se.toLowerCase(),l=r.title?.toLowerCase().includes(t),f=r.content.toLowerCase().includes(t);if(!l&&!f)return!1}if(ae.length>0){const t=r.tags||[];if(!ae.every(f=>t.includes(f)))return!1}return!0});return s.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"text-lg",children:"No image snippets found"}),se.trim()||ae.length>0?e.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your search or filters"}):e.jsx("p",{className:"text-sm mt-2",children:"Upload images or generate from prompts to create Swag items"})]}):e.jsx("div",{className:"space-y-3",children:s.map(r=>{const o=r.content.match(/<img[^>]+src=["']([^"']+)["'][^>]*>/i)||r.content.match(/!\[.*?\]\(([^)]+)\)/),t=o?o[1]:null;return e.jsx("button",{onClick:()=>{const l=new Set([r.id]);ke(l)},className:"w-full p-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 hover:border-indigo-500 dark:hover:border-indigo-400 hover:shadow-md transition-all text-left",children:e.jsxs("div",{className:"flex gap-4",children:[t&&e.jsx("div",{className:"flex-shrink-0 w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded overflow-hidden",children:e.jsx("img",{src:t,alt:"Preview",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:r.title||"Untitled"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mt-1",children:r.content.replace(/<[^>]*>/g,"").replace(/!\[.*?\]\(.*?\)/g,"[Image]").substring(0,100)}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:r.tags.map(l=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded",children:l},l))})]})]})},r.id)})})})()}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Click a snippet to load its images into the editor"}),e.jsx("button",{onClick:()=>K(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(Me,{onSelectAll:fe,onSelectNone:be,selectedCount:z.size,totalCount:Q.length}),e.jsx(Fe,{images:Q,selectedImages:z,onToggleSelection:ye,processingStatus:ne,newlyGeneratedIds:p})]})}),e.jsx("footer",{className:"bg-white border-t border-gray-200 sticky bottom-0 z-20 shadow-lg",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(Be,{selectedCount:z.size,onOperation:ce,disabled:re}),e.jsx(Le,{value:R,onChange:J,onSubmit:Se,disabled:re||z.size===0,placeholder:z.size===0?"Select images to apply transformations":"Describe transformation (e.g., 'resize to 800px width' or 'convert to grayscale')"})]})})]})};export{Ue as ImageEditorPage};

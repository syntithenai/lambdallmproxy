import{j as e,r as h,g as U,u as q,b7 as H,b8 as K,b9 as X,a as Q,ba as Y,R as J}from"./index-Dvb_RkvQ.js";const Z=({image:s,isSelected:w,onToggleSelection:m,processingStatus:n,isNew:N=!1})=>e.jsxs("div",{className:`
        relative rounded-lg overflow-hidden border-2 transition-all
        ${w?"border-blue-500 shadow-lg":"border-gray-200"}
        ${N?"ring-4 ring-green-500 animate-pulse":""}
      `,children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("input",{type:"checkbox",checked:w,onChange:m,className:"w-5 h-5 rounded bg-white/80 backdrop-blur cursor-pointer"})}),e.jsx("img",{src:s.url,alt:s.name,className:"w-full h-auto object-cover",loading:"lazy"},s.url),n?.status==="processing"&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto"}),e.jsx("p",{className:"text-sm mt-2",children:n.message}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2 mx-4",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${n.progress}%`}})})]})}),n?.status==="error"&&e.jsx("div",{className:"absolute inset-0 bg-red-500/20 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-red-900 bg-white/90 p-2 rounded",children:[e.jsx("p",{className:"text-sm font-bold",children:"❌ Error"}),e.jsx("p",{className:"text-xs",children:n.error})]})}),n?.status==="complete"&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-500 text-white px-2 py-1 rounded text-xs font-bold",children:"✓ Done"}),e.jsxs("div",{className:"p-2 bg-gray-50",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.name}),e.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:s.tags.map(i=>e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-xs rounded",children:i},i))}),s.width&&s.height&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s.width," × ",s.height,s.format&&` • ${s.format.toUpperCase()}`]})]})]}),ee=({images:s,selectedImages:w,onToggleSelection:m,processingStatus:n,newlyGeneratedIds:N=new Set})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:[s.map(i=>e.jsx(Z,{image:i,isSelected:w.has(i.id),onToggleSelection:()=>m(i.id),processingStatus:n.get(i.id),isNew:N.has(i.id)},i.id)),s.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg",children:"No images to display"}),e.jsx("p",{className:"text-sm",children:"Navigate from the Swag page to edit images"})]})]}),te=({onSelectAll:s,onSelectNone:w,selectedCount:m,totalCount:n})=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:s,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",disabled:m===n,children:"Select All"}),e.jsx("button",{onClick:w,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",disabled:m===0,children:"Select None"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[m," of ",n," selected"]})]}),re=({selectedCount:s,onOperation:w,disabled:m})=>{const[n,N]=h.useState(null),i=h.useRef({});h.useEffect(()=>{const o=y=>{if(n&&i.current[n]){const b=i.current[n];b&&!b.contains(y.target)&&N(null)}};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[n]);const f=(o="")=>`px-3 py-1.5 text-xs font-medium rounded transition-colors ${m||s===0?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-700"} ${o}`,j=o=>`px-3 py-1.5 text-xs font-medium rounded transition-colors flex items-center gap-1 ${m||s===0?"bg-gray-100 text-gray-400 cursor-not-allowed":o?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,a="w-full text-left px-3 py-2 text-xs hover:bg-gray-100 transition-colors border-b border-gray-100 last:border-b-0",x=o=>{m||s===0||N(n===o?null:o)},r=o=>{w(o),N(null)};return e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-start",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>r({type:"resize",params:{scale:.5},label:"50%"}),disabled:m||s===0,className:f(),title:"Resize to 50%",children:"50%"}),e.jsx("button",{onClick:()=>r({type:"resize",params:{scale:2},label:"200%"}),disabled:m||s===0,className:f(),title:"Resize to 200%",children:"200%"})]}),e.jsxs("div",{className:"relative",ref:o=>{i.current.sizes=o},children:[e.jsx("button",{onClick:()=>x("sizes"),disabled:m||s===0,className:j(n==="sizes"),children:"More Sizes ▾"}),n==="sizes"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[120px]",children:[e.jsx("button",{onClick:()=>r({type:"resize",params:{scale:.25},label:"25%"}),className:a,children:"25%"}),e.jsx("button",{onClick:()=>r({type:"resize",params:{scale:.33},label:"33%"}),className:a,children:"33%"}),e.jsx("button",{onClick:()=>r({type:"resize",params:{scale:.75},label:"75%"}),className:a,children:"75%"}),e.jsx("button",{onClick:()=>r({type:"resize",params:{scale:1.5},label:"150%"}),className:a,children:"150%"}),e.jsx("button",{onClick:()=>r({type:"resize",params:{scale:3},label:"300%"}),className:a,children:"300%"}),e.jsx("button",{onClick:()=>r({type:"resize",params:{scale:4},label:"400%"}),className:a,children:"400%"})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>r({type:"rotate",params:{degrees:90},label:"↻ 90°"}),disabled:m||s===0,className:f(),title:"Rotate 90° clockwise",children:"↻"}),e.jsx("button",{onClick:()=>r({type:"rotate",params:{degrees:270},label:"↺ 90°"}),disabled:m||s===0,className:f(),title:"Rotate 90° counter-clockwise",children:"↺"})]}),e.jsxs("div",{className:"relative",ref:o=>{i.current.crop=o},children:[e.jsx("button",{onClick:()=>x("crop"),disabled:m||s===0,className:j(n==="crop"),children:"Crop & Trim ▾"}),n==="crop"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[180px]",children:[e.jsx("button",{onClick:()=>r({type:"trim",params:{},label:"Auto-trim borders"}),className:a,title:"Remove transparent or solid-color borders",children:"✂️ Auto-trim borders"}),e.jsx("button",{onClick:()=>r({type:"autocrop",params:{focus:"center"},label:"AI Crop (Center)"}),className:a,title:"AI-powered crop focusing on center subject",children:"🤖 AI Crop (Center)"}),e.jsx("button",{onClick:()=>r({type:"autocrop",params:{focus:"face"},label:"AI Crop (Face)"}),className:a,title:"AI-powered crop focusing on face",children:"😊 AI Crop (Face)"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>r({type:"crop",params:{width:1920,height:1080},label:"1920×1080"}),className:a,children:"📺 1920×1080 (Full HD)"}),e.jsx("button",{onClick:()=>r({type:"crop",params:{width:1280,height:720},label:"1280×720"}),className:a,children:"📺 1280×720 (HD)"}),e.jsx("button",{onClick:()=>r({type:"crop",params:{width:800,height:800},label:"800×800"}),className:a,children:"⬜ 800×800 (Square)"})]})]}),e.jsxs("div",{className:"relative",ref:o=>{i.current.flip=o},children:[e.jsx("button",{onClick:()=>x("flip"),disabled:m||s===0,className:j(n==="flip"),children:"Flip ▾"}),n==="flip"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[150px]",children:[e.jsx("button",{onClick:()=>r({type:"flip",params:{direction:"horizontal"},label:"Horizontal"}),className:a,children:"↔️ Horizontal"}),e.jsx("button",{onClick:()=>r({type:"flip",params:{direction:"vertical"},label:"Vertical"}),className:a,children:"↕️ Vertical"}),e.jsx("button",{onClick:()=>r({type:"rotate",params:{degrees:180},label:"180°"}),className:a,children:"🔄 180° rotation"})]})]}),e.jsxs("div",{className:"relative",ref:o=>{i.current.format=o},children:[e.jsx("button",{onClick:()=>x("format"),disabled:m||s===0,className:j(n==="format"),children:"Format ▾"}),n==="format"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[150px]",children:[e.jsx("button",{onClick:()=>r({type:"format",params:{format:"jpg",quality:90},label:"JPG (High)"}),className:a,children:"📄 JPG (High Quality)"}),e.jsx("button",{onClick:()=>r({type:"format",params:{format:"jpg",quality:80},label:"JPG (Medium)"}),className:a,children:"📄 JPG (Medium)"}),e.jsx("button",{onClick:()=>r({type:"format",params:{format:"jpg",quality:60},label:"JPG (Low)"}),className:a,children:"📄 JPG (Low/Small)"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>r({type:"format",params:{format:"png"},label:"PNG"}),className:a,children:"🖼️ PNG (Lossless)"}),e.jsx("button",{onClick:()=>r({type:"format",params:{format:"webp"},label:"WebP"}),className:a,children:"🌐 WebP (Modern)"}),e.jsx("button",{onClick:()=>r({type:"format",params:{format:"avif"},label:"AVIF"}),className:a,children:"⚡ AVIF (Best Compression)"})]})]}),e.jsxs("div",{className:"relative",ref:o=>{i.current.filters=o},children:[e.jsx("button",{onClick:()=>x("filters"),disabled:m||s===0,className:j(n==="filters"),children:"Filters ▾"}),n==="filters"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[150px]",children:[e.jsx("button",{onClick:()=>r({type:"filter",params:{filter:"grayscale"},label:"Grayscale"}),className:a,children:"⚫ Grayscale"}),e.jsx("button",{onClick:()=>r({type:"filter",params:{filter:"sepia"},label:"Sepia"}),className:a,children:"🟤 Sepia"}),e.jsx("button",{onClick:()=>r({type:"filter",params:{filter:"negate"},label:"Invert"}),className:a,children:"🔲 Invert Colors"}),e.jsx("button",{onClick:()=>r({type:"filter",params:{filter:"normalize"},label:"Normalize"}),className:a,children:"📊 Normalize (Auto-enhance)"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>r({type:"filter",params:{filter:"blur",strength:3},label:"Blur"}),className:a,children:"🌫️ Blur"}),e.jsx("button",{onClick:()=>r({type:"filter",params:{filter:"sharpen"},label:"Sharpen"}),className:a,children:"✨ Sharpen"})]})]}),e.jsxs("div",{className:"relative",ref:o=>{i.current.adjust=o},children:[e.jsx("button",{onClick:()=>x("adjust"),disabled:m||s===0,className:j(n==="adjust"),children:"Adjustments ▾"}),n==="adjust"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[180px]",children:[e.jsx("button",{onClick:()=>r({type:"modulate",params:{brightness:1.2},label:"Brightness +20%"}),className:a,children:"☀️ Brightness +20%"}),e.jsx("button",{onClick:()=>r({type:"modulate",params:{brightness:.8},label:"Brightness -20%"}),className:a,children:"🌙 Brightness -20%"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>r({type:"modulate",params:{saturation:1.5},label:"Saturation +50%"}),className:a,children:"🎨 Saturation +50%"}),e.jsx("button",{onClick:()=>r({type:"modulate",params:{saturation:.5},label:"Saturation -50%"}),className:a,children:"🎨 Saturation -50%"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>r({type:"modulate",params:{hue:90},label:"Hue shift +90°"}),className:a,children:"� Hue shift +90°"}),e.jsx("button",{onClick:()=>r({type:"tint",params:{r:255,g:200,b:150},label:"Warm tint"}),className:a,children:"🔥 Warm tint"}),e.jsx("button",{onClick:()=>r({type:"tint",params:{r:150,g:200,b:255},label:"Cool tint"}),className:a,children:"❄️ Cool tint"})]})]}),e.jsxs("div",{className:"relative",ref:o=>{i.current.effects=o},children:[e.jsx("button",{onClick:()=>x("effects"),disabled:m||s===0,className:j(n==="effects"),children:"Effects ▾"}),n==="effects"&&e.jsxs("div",{className:"absolute top-full mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[180px]",children:[e.jsx("button",{onClick:()=>r({type:"extend",params:{top:20,bottom:20,left:20,right:20,background:{r:255,g:255,b:255}},label:"White border"}),className:a,children:"⬜ White border (20px)"}),e.jsx("button",{onClick:()=>r({type:"extend",params:{top:20,bottom:20,left:20,right:20,background:{r:0,g:0,b:0}},label:"Black border"}),className:a,children:"⬛ Black border (20px)"}),e.jsx("button",{onClick:()=>r({type:"extend",params:{top:50,bottom:50,left:50,right:50,background:{r:255,g:255,b:255}},label:"Wide padding"}),className:a,children:"📐 Wide padding (50px)"}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsx("button",{onClick:()=>r({type:"gamma",params:{gamma:1.5},label:"Gamma boost"}),className:a,children:"💡 Gamma boost"}),e.jsx("button",{onClick:()=>r({type:"gamma",params:{gamma:.7},label:"Gamma reduce"}),className:a,children:"🔅 Gamma reduce"})]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-3 flex justify-between items-center",children:[e.jsxs("span",{children:[s," image",s!==1?"s":""," selected"]}),s>0&&e.jsxs("span",{className:"text-gray-400",children:["Select operation above • ",n?"📂 Menu open":"💡 Click for more options"]})]})]})},se=({value:s,onChange:w,onSubmit:m,disabled:n,placeholder:N="Describe transformation (e.g., 'resize to 800px width', 'convert to grayscale', or 'add a dog')"})=>{const[i,f]=h.useState(!1),[j,a]=h.useState(!1),[x,r]=h.useState(!1),o=h.useRef(null),y=h.useRef(null),b=h.useRef(!1),p=h.useRef(""),B=h.useRef(null),O=h.useRef(null),D=h.useRef(null),R=h.useRef(null),A=h.useRef(null),L=h.useRef(null),F=async()=>{try{const c=await navigator.mediaDevices.getUserMedia({audio:!0});L.current=c;const g=new(window.AudioContext||window.webkitAudioContext);B.current=g;const v=g.createAnalyser();v.fftSize=256,v.smoothingTimeConstant=.8,O.current=v,g.createMediaStreamSource(c).connect(v);const C=v.frequencyBinCount,T=new Uint8Array(C);D.current=T,_()}catch(c){console.error("Error accessing microphone:",c)}},_=()=>{if(!O.current||!D.current||!A.current)return;const c=A.current,g=c.getContext("2d");if(!g)return;const v=O.current,$=D.current,C=v.frequencyBinCount,T=()=>{if(!i)return;R.current=requestAnimationFrame(T),v.getByteFrequencyData($),g.fillStyle="rgba(15, 23, 42, 0.95)",g.fillRect(0,0,c.width,c.height);const V=c.width/C*2.5;let l,d=0;for(let S=0;S<C;S++){l=$[S]/255*c.height*.8;const t=$[S]/255,u=200,k=50+t*30,I=40+t*30;g.fillStyle=`hsl(${u}, ${k}%, ${I}%)`,g.fillRect(d,c.height-l,V,l),d+=V+1}g.strokeStyle="rgba(148, 163, 184, 0.3)",g.lineWidth=1,g.beginPath(),g.moveTo(0,c.height/2),g.lineTo(c.width,c.height/2),g.stroke()};T()},M=()=>{R.current&&(cancelAnimationFrame(R.current),R.current=null),L.current&&(L.current.getTracks().forEach(c=>c.stop()),L.current=null),B.current&&(B.current.close(),B.current=null)};h.useEffect(()=>{const c=window.SpeechRecognition||window.webkitSpeechRecognition;return c&&(a(!0),o.current=new c,o.current.continuous=!0,o.current.interimResults=!0,o.current.lang="en-US",o.current.maxAlternatives=1,o.current.onresult=g=>{let v="",$="";for(let C=g.resultIndex;C<g.results.length;C++){const T=g.results[C][0].transcript;g.results[C].isFinal?$+=T:v+=T}if((v.trim()||$.trim())&&(b.current||(b.current=!0,console.log("🎤 Speech detected, starting timeout...")),p.current=v,y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{console.log("🎤 Silence detected, stopping..."),o.current&&o.current.stop()},2e3)),$){const C=(p.current+" "+$).trim();w(s?`${s} ${C}`:C),p.current=""}},o.current.onerror=g=>{if(console.error("Speech recognition error:",g.error),g.error==="no-speech"){if(console.log("🎤 No speech detected yet, continuing to listen..."),!b.current&&i)try{o.current.start()}catch{}}else f(!1),b.current=!1,y.current&&clearTimeout(y.current)},o.current.onend=()=>{console.log("🎤 Recognition ended"),f(!1),r(!1);const g=b.current;b.current=!1,p.current="",y.current&&clearTimeout(y.current),M(),g&&s.trim()&&setTimeout(()=>{m()},500)}),()=>{o.current&&o.current.stop(),y.current&&clearTimeout(y.current),M()}},[w,s,i]);const E=async()=>{if(o.current)if(i)o.current.stop(),f(!1),r(!1),M();else try{r(!0),await F(),o.current.start(),f(!0)}catch(c){console.error("Error starting speech recognition:",c),f(!1),r(!1),M()}};h.useEffect(()=>{const c=g=>{g.key==="Escape"&&x&&E()};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[x]);const G=c=>{c.preventDefault(),s.trim()&&!n&&m()},P=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),s.trim()&&!n&&m())};return e.jsxs("div",{className:"bg-white p-4",children:[e.jsxs("form",{onSubmit:G,children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{value:s,onChange:c=>w(c.target.value),disabled:n,placeholder:N,tabIndex:1,className:"w-full border border-gray-300 rounded-lg p-3 pr-12 resize-none h-24 focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",onKeyDown:P}),j&&e.jsx("button",{type:"button",onClick:E,disabled:n,tabIndex:3,className:`
                  absolute right-2 top-2 p-2 rounded-full transition-all
                  ${i?"bg-blue-500 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}
                  ${n?"opacity-50 cursor-not-allowed":""}
                `,title:i?"Listening... Click to stop":"Click to speak command","aria-label":i?"Stop voice input":"Start voice input",children:e.jsxs("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"})]})})]}),e.jsx("button",{type:"submit",disabled:n||!s.trim(),tabIndex:2,className:`
              self-end px-6 py-3 rounded-lg font-medium transition-colors
              ${n||!s.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}
            `,children:"Apply"})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsx("strong",{children:"Examples:"}),' "resize to 800px width" • "convert to grayscale" • "rotate 90 degrees" • "add a dog" • "change background to sunset"',j&&e.jsxs(e.Fragment,{children:[" • ",e.jsx("strong",{children:"🎤 Voice:"})," Click microphone to speak commands (auto-submits)"]})," ","• Press ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Enter"})," to apply • ",e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Shift+Enter"})," for new line"]})]}),x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm",children:e.jsxs("div",{className:"relative bg-slate-900 rounded-2xl shadow-2xl p-8 max-w-2xl w-full mx-4",children:[e.jsx("button",{onClick:E,className:"absolute top-4 right-4 text-slate-400 hover:text-white transition-colors","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4 rounded-full bg-blue-500 bg-opacity-20",children:e.jsxs("svg",{className:"w-8 h-8 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"})]})}),e.jsx("h3",{className:"text-2xl font-semibold text-white mb-2",children:b.current?"Listening...":"Speak your command"}),e.jsx("p",{className:"text-slate-400 text-sm",children:b.current?"Processing your voice input...":'Try: "resize to 800 pixels" or "convert to grayscale"'})]}),e.jsx("div",{className:"mb-6 rounded-xl overflow-hidden border border-slate-700 shadow-inner",children:e.jsx("canvas",{ref:A,width:600,height:200,className:"w-full h-48"})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 text-slate-300",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"text-sm font-medium",children:b.current?"Speech detected":"Ready to listen"})]}),p.current&&e.jsx("div",{className:"mt-4 p-3 bg-slate-800 rounded-lg border border-slate-700",children:e.jsxs("p",{className:"text-slate-300 text-sm italic",children:['"',p.current,'"']})}),e.jsx("div",{className:"mt-6 text-center text-xs text-slate-500",children:"Click outside or press ESC to cancel • Stops automatically after 2 seconds of silence"})]})})]})};async function ae(s,w){const n=`${await U()}/image-edit`,N=localStorage.getItem("google_oauth_token"),i=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",...N?{"X-Google-OAuth-Token":N}:{}},body:JSON.stringify(s)});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);if(!i.body)throw new Error("Response body is null");const f=i.body.getReader(),j=new TextDecoder;let a="";try{for(;;){const{done:x,value:r}=await f.read();if(x)break;a+=j.decode(r,{stream:!0});const o=a.split(`

`);a=o.pop()||"";for(const y of o)if(y.startsWith("data: ")){const b=y.substring(6);try{const p=JSON.parse(b);if(w(p),p.type==="error"||p.type==="complete")return}catch(p){console.error("Failed to parse SSE event:",p,b)}}}}finally{f.releaseLock()}}async function oe(s,w,m){const N=`${await U()}/parse-image-command`,i=m||localStorage.getItem("google_oauth_token")||localStorage.getItem("access_token"),f=w?.filter(r=>r.enabled!==!1&&r.apiKey&&r.apiKey.trim()!=="")||[],j=f.length>0;console.log("🔍 [parseImageCommand] Sending request:",{hasGoogleToken:!!i,tokenSource:m?"parameter":"localStorage",tokenLength:i?.length,providersCount:f.length,hasValidProviders:j,providers:f.map(r=>({type:r.type,hasApiKey:!!r.apiKey,enabled:r.enabled})),willUseBackendProviders:!j});const a={command:s};j&&(a.providers=f);const x=await fetch(N,{method:"POST",headers:{"Content-Type":"application/json",...i?{Authorization:`Bearer ${i}`,"X-Google-OAuth-Token":i}:{}},body:JSON.stringify(a)});if(!x.ok)throw new Error(`HTTP error! status: ${x.status}`);return await x.json()}const le=()=>{const s=q(),w=H(),{addSnippet:m,updateSnippet:n,snippets:N}=K(),{settings:i}=X(),{getToken:f}=Q(),{features:j}=Y(),a=w.state,x=a?.images||[],r=a?.editingSnippetId,o=x.length===1&&x[0].snippetId,y=o?x[0].snippetId:null,[b]=h.useState(x),[p,B]=h.useState(()=>{const l=localStorage.getItem("image_editor_images");if(l)try{const d=localStorage.getItem("image_editor_selection"),S=JSON.parse(l);if(d&&S){const t=JSON.parse(d),u=S.map(z=>z.id),k=x.map(z=>z.id);if(u.length===k.length&&u.every(z=>k.includes(z))){const z=t.filter(W=>k.includes(W));if(z.length>0)return new Set(z)}}}catch(d){console.error("Failed to load persisted selection:",d)}return x.length>0?new Set(x.map(d=>d.id)):new Set}),[O]=h.useState([]),[D,R]=h.useState(new Map),[A,L]=h.useState(()=>{try{return localStorage.getItem("image_editor_command")||""}catch(l){return console.error("Failed to load persisted command:",l),""}}),[F,_]=h.useState(!1),[M]=h.useState(new Set),[E,G]=h.useState(new Map);J.useEffect(()=>{try{A.trim()?localStorage.setItem("image_editor_command",A):localStorage.removeItem("image_editor_command")}catch(l){console.error("Failed to persist command:",l)}},[A]),J.useEffect(()=>{try{b.length>0&&localStorage.setItem("image_editor_images",JSON.stringify(b))}catch(l){console.error("Failed to persist images:",l)}},[b]),J.useEffect(()=>{try{p.size>0?localStorage.setItem("image_editor_selection",JSON.stringify(Array.from(p))):localStorage.removeItem("image_editor_selection")}catch(l){console.error("Failed to persist selection:",l)}},[p]);const P=[...O,...b].map(l=>{const d=E.get(l.id);return d?{...l,url:d}:l}),c=()=>{B(new Set(P.map(l=>l.id)))},g=()=>{B(new Set)},v=l=>{const d=new Set(p);d.has(l)?d.delete(l):d.add(l),B(d)},$=async l=>{if(p.size===0)return;_(!0);const d=Array.from(p),S=P.filter(t=>d.includes(t.id));try{await ae({images:S.map(t=>({id:t.id,url:t.url})),operations:[l]},t=>{t.type==="image_start"&&t.imageId?R(u=>new Map(u).set(t.imageId,{imageId:t.imageId,status:"processing",progress:0,message:`Starting ${l.label}...`})):t.type==="progress"&&t.imageId?R(u=>new Map(u).set(t.imageId,{imageId:t.imageId,status:"processing",progress:t.progress||0,message:t.currentOperation?`${t.currentOperation}... ${t.progress}%`:`${t.status}...`})):t.type==="image_complete"&&t.imageId&&t.result?(R(u=>new Map(u).set(t.imageId,{imageId:t.imageId,status:"complete",progress:100,message:"Complete",result:t.result?.url})),t.result?.url&&G(u=>new Map(u).set(t.imageId,t.result.url))):t.type==="image_error"&&t.imageId?R(u=>new Map(u).set(t.imageId,{imageId:t.imageId,status:"error",progress:0,message:t.error||"Processing failed",error:t.error})):t.type==="complete"?console.log("All images processed:",t):t.type==="error"&&(console.error("API error:",t.error),alert(`Error: ${t.error}`))}),setTimeout(()=>{_(!1),d.forEach(t=>{R(u=>{const k=new Map(u);return k.delete(t),k})})},3e3)}catch(t){console.error("Image processing error:",t),alert(`Error processing images: ${t instanceof Error?t.message:String(t)}`),_(!1),d.forEach(u=>{R(k=>new Map(k).set(u,{imageId:u,status:"error",progress:0,message:"Failed",error:t instanceof Error?t.message:String(t)}))})}},C=async()=>{if(E.size===0){alert("No processed images to save");return}_(!0);try{if(o&&y){const d=Array.from(E.keys())[0],S=E.get(d),t=P.find(u=>u.id===d);if(S&&t){const u=S,k=N.find(W=>W.id===y);if(!k)throw new Error("Source snippet not found");let I=k.content;const z=t.url;I=I.replace(new RegExp(`!\\[([^\\]]*)\\]\\(${T(z)}\\)`,"g"),`![$1](${u})`),I=I.replace(new RegExp(`<img([^>]*?)src="${T(z)}"`,"g"),`<img$1src="${u}"`),I=I.replace(new RegExp(`<img([^>]*?)src='${T(z)}'`,"g"),`<img$1src='${u}'`),(I.trim()===z||I.trim()===`![](${z})`)&&(I=u),await n(y,{content:I}),localStorage.removeItem("image_editor_selection"),localStorage.removeItem("image_editor_images"),alert("Image updated inline in snippet"),s("/swag",{state:{updatedSnippetId:y}});return}}let l=0;for(const[d,S]of E.entries()){const t=P.find(u=>u.id===d);if(t)try{const u=S,k=`Edited Image - ${new Date().toLocaleString()}`,I=`![${t.name||"Edited image"}](${u})`;await m(I,"user",k),l++}catch(u){console.error(`Failed to save image ${d}:`,u)}}alert(`Successfully saved ${l} edited image(s) to Swag as new snippets`),G(new Map),localStorage.removeItem("image_editor_selection"),localStorage.removeItem("image_editor_images"),s("/swag")}catch(l){console.error("Save to swag error:",l),alert(`Error saving: ${l instanceof Error?l.message:String(l)}`)}finally{_(!1)}},T=l=>l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),V=async()=>{if(!(!A.trim()||p.size===0)){_(!0);try{console.log("Parsing command:",A);const l=await f(),d=await oe(A,i.providers,l);if(!d.success||d.operations.length===0){alert(d.explanation||'Could not understand command. Try: "make smaller", "rotate right", "convert to jpg"'),_(!1);return}console.log("Parsed operations:",d.operations),d.operations.some(t=>t.type==="generate")&&console.log("🎨 Generative AI operations detected - will be processed by backend");for(const t of d.operations)await $(t);L("")}catch(l){console.error("Command parsing error:",l),alert(`Error: ${l instanceof Error?l.message:String(l)}`)}finally{_(!1)}}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[!j?.imageEditing&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-start",children:[e.jsx("svg",{className:"w-6 h-6 text-yellow-400 mt-0.5 mr-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Image Editing Feature Unavailable"}),e.jsx("div",{className:"mt-1 text-sm text-yellow-700",children:e.jsx("p",{children:"Image editing functionality is not currently available. The server must be configured with image generation providers (e.g., OpenAI DALL-E, Replicate Flux) to enable this feature."})})]})]})}),e.jsx("header",{className:"bg-white border-b border-gray-200 p-4 sticky top-0 z-20 shadow-sm",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>{r?s("/swag",{state:{editingSnippetId:r}}):s("/swag")},className:"flex items-center gap-2 text-gray-700 hover:text-gray-900 font-medium transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Swag"]}),e.jsxs("h1",{className:"text-xl font-bold text-gray-900",children:[o?"Edit Inline Image":"Image Editor",p.size>0&&` (${p.size} selected)`]}),e.jsx("button",{onClick:C,disabled:E.size===0||F,className:`px-4 py-2 rounded-lg font-medium transition-colors ${E.size===0||F?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:F?"Saving...":o?"Update in Snippet":`Save to Swag (${E.size})`})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(te,{onSelectAll:c,onSelectNone:g,selectedCount:p.size,totalCount:P.length}),e.jsx(ee,{images:P,selectedImages:p,onToggleSelection:v,processingStatus:D,newlyGeneratedIds:M})]})}),e.jsx("footer",{className:"bg-white border-t border-gray-200 sticky bottom-0 z-20 shadow-lg",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(re,{selectedCount:p.size,onOperation:$,disabled:F}),e.jsx(se,{value:A,onChange:L,onSubmit:V,disabled:F||p.size===0,placeholder:p.size===0?"Select images to apply transformations":"Describe transformation (e.g., 'resize to 800px width' or 'convert to grayscale')"})]})})]})};export{le as ImageEditorPage};

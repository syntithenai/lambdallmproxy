import{r as L,j as o}from"./index-C8omfh96.js";import{c as X,T as Te,B as Ie}from"./trophy-0d3_PIxH.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],me=X("circle-check",ke);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],fe=X("circle-x",Ee);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],De=X("rotate-ccw",Pe);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ge=X("x",qe);var ie={};(function D(n,s,c,w){var r=!!(n.Worker&&n.Blob&&n.Promise&&n.OffscreenCanvas&&n.OffscreenCanvasRenderingContext2D&&n.HTMLCanvasElement&&n.HTMLCanvasElement.prototype.transferControlToOffscreen&&n.URL&&n.URL.createObjectURL),u=typeof Path2D=="function"&&typeof DOMMatrix=="function",f=(function(){if(!n.OffscreenCanvas)return!1;try{var t=new OffscreenCanvas(1,1),e=t.getContext("2d");e.fillRect(0,0,1,1);var a=t.transferToImageBitmap();e.createPattern(a,"no-repeat")}catch{return!1}return!0})();function b(){}function g(t){var e=s.exports.Promise,a=e!==void 0?e:n.Promise;return typeof a=="function"?new a(t):(t(b,b),null)}var S=(function(t,e){return{transform:function(a){if(t)return a;if(e.has(a))return e.get(a);var l=new OffscreenCanvas(a.width,a.height),h=l.getContext("2d");return h.drawImage(a,0,0),e.set(a,l),l},clear:function(){e.clear()}}})(f,new Map),y=(function(){var t=Math.floor(16.666666666666668),e,a,l={},h=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(e=function(m){var p=Math.random();return l[p]=requestAnimationFrame(function i(x){h===x||h+t-1<x?(h=x,delete l[p],m()):l[p]=requestAnimationFrame(i)}),p},a=function(m){l[m]&&cancelAnimationFrame(l[m])}):(e=function(m){return setTimeout(m,t)},a=function(m){return clearTimeout(m)}),{frame:e,cancel:a}})(),P=(function(){var t,e,a={};function l(h){function m(p,i){h.postMessage({options:p||{},callback:i})}h.init=function(i){var x=i.transferControlToOffscreen();h.postMessage({canvas:x},[x])},h.fire=function(i,x,M){if(e)return m(i,null),e;var N=Math.random().toString(36).slice(2);return e=g(function(C){function T(E){E.data.callback===N&&(delete a[N],h.removeEventListener("message",T),e=null,S.clear(),M(),C())}h.addEventListener("message",T),m(i,N),a[N]=T.bind(null,{data:{callback:N}})}),e},h.reset=function(){h.postMessage({reset:!0});for(var i in a)a[i](),delete a[i]}}return function(){if(t)return t;if(!c&&r){var h=["var CONFETTI, SIZE = {}, module = {};","("+D.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{t=new Worker(URL.createObjectURL(new Blob([h])))}catch(m){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",m),null}l(t)}return t}})(),R={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function B(t,e){return e?e(t):t}function I(t){return t!=null}function d(t,e,a){return B(t&&I(t[e])?t[e]:R[e],a)}function Y(t){return t<0?0:Math.floor(t)}function K(t,e){return Math.floor(Math.random()*(e-t))+t}function G(t){return parseInt(t,16)}function J(t){return t.map(ee)}function ee(t){var e=String(t).replace(/[^0-9a-f]/gi,"");return e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),{r:G(e.substring(0,2)),g:G(e.substring(2,4)),b:G(e.substring(4,6))}}function te(t){var e=d(t,"origin",Object);return e.x=d(e,"x",Number),e.y=d(e,"y",Number),e}function re(t){t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight}function j(t){var e=t.getBoundingClientRect();t.width=e.width,t.height=e.height}function k(t){var e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=t,e}function A(t,e,a,l,h,m,p,i,x){t.save(),t.translate(e,a),t.rotate(m),t.scale(l,h),t.arc(0,0,1,p,i,x),t.restore()}function O(t){var e=t.angle*(Math.PI/180),a=t.spread*(Math.PI/180);return{x:t.x,y:t.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:t.startVelocity*.5+Math.random()*t.startVelocity,angle2D:-e+(.5*a-Math.random()*a),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:t.color,shape:t.shape,tick:0,totalTicks:t.ticks,decay:t.decay,drift:t.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:t.gravity*3,ovalScalar:.6,scalar:t.scalar,flat:t.flat}}function ne(t,e){e.x+=Math.cos(e.angle2D)*e.velocity+e.drift,e.y+=Math.sin(e.angle2D)*e.velocity+e.gravity,e.velocity*=e.decay,e.flat?(e.wobble=0,e.wobbleX=e.x+10*e.scalar,e.wobbleY=e.y+10*e.scalar,e.tiltSin=0,e.tiltCos=0,e.random=1):(e.wobble+=e.wobbleSpeed,e.wobbleX=e.x+10*e.scalar*Math.cos(e.wobble),e.wobbleY=e.y+10*e.scalar*Math.sin(e.wobble),e.tiltAngle+=.1,e.tiltSin=Math.sin(e.tiltAngle),e.tiltCos=Math.cos(e.tiltAngle),e.random=Math.random()+2);var a=e.tick++/e.totalTicks,l=e.x+e.random*e.tiltCos,h=e.y+e.random*e.tiltSin,m=e.wobbleX+e.random*e.tiltCos,p=e.wobbleY+e.random*e.tiltSin;if(t.fillStyle="rgba("+e.color.r+", "+e.color.g+", "+e.color.b+", "+(1-a)+")",t.beginPath(),u&&e.shape.type==="path"&&typeof e.shape.path=="string"&&Array.isArray(e.shape.matrix))t.fill(pe(e.shape.path,e.shape.matrix,e.x,e.y,Math.abs(m-l)*.1,Math.abs(p-h)*.1,Math.PI/10*e.wobble));else if(e.shape.type==="bitmap"){var i=Math.PI/10*e.wobble,x=Math.abs(m-l)*.1,M=Math.abs(p-h)*.1,N=e.shape.bitmap.width*e.scalar,C=e.shape.bitmap.height*e.scalar,T=new DOMMatrix([Math.cos(i)*x,Math.sin(i)*x,-Math.sin(i)*M,Math.cos(i)*M,e.x,e.y]);T.multiplySelf(new DOMMatrix(e.shape.matrix));var E=t.createPattern(S.transform(e.shape.bitmap),"no-repeat");E.setTransform(T),t.globalAlpha=1-a,t.fillStyle=E,t.fillRect(e.x-N/2,e.y-C/2,N,C),t.globalAlpha=1}else if(e.shape==="circle")t.ellipse?t.ellipse(e.x,e.y,Math.abs(m-l)*e.ovalScalar,Math.abs(p-h)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI):A(t,e.x,e.y,Math.abs(m-l)*e.ovalScalar,Math.abs(p-h)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI);else if(e.shape==="star")for(var v=Math.PI/2*3,q=4*e.scalar,z=8*e.scalar,F=e.x,_=e.y,U=5,Q=Math.PI/U;U--;)F=e.x+Math.cos(v)*z,_=e.y+Math.sin(v)*z,t.lineTo(F,_),v+=Q,F=e.x+Math.cos(v)*q,_=e.y+Math.sin(v)*q,t.lineTo(F,_),v+=Q;else t.moveTo(Math.floor(e.x),Math.floor(e.y)),t.lineTo(Math.floor(e.wobbleX),Math.floor(h)),t.lineTo(Math.floor(m),Math.floor(p)),t.lineTo(Math.floor(l),Math.floor(e.wobbleY));return t.closePath(),t.fill(),e.tick<e.totalTicks}function ae(t,e,a,l,h){var m=e.slice(),p=t.getContext("2d"),i,x,M=g(function(N){function C(){i=x=null,p.clearRect(0,0,l.width,l.height),S.clear(),h(),N()}function T(){c&&!(l.width===w.width&&l.height===w.height)&&(l.width=t.width=w.width,l.height=t.height=w.height),!l.width&&!l.height&&(a(t),l.width=t.width,l.height=t.height),p.clearRect(0,0,l.width,l.height),m=m.filter(function(E){return ne(p,E)}),m.length?i=y.frame(T):C()}i=y.frame(T),x=C});return{addFettis:function(N){return m=m.concat(N),M},canvas:t,promise:M,reset:function(){i&&y.cancel(i),x&&x()}}}function H(t,e){var a=!t,l=!!d(e||{},"resize"),h=!1,m=d(e,"disableForReducedMotion",Boolean),p=r&&!!d(e||{},"useWorker"),i=p?P():null,x=a?re:j,M=t&&i?!!t.__confetti_initialized:!1,N=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,C;function T(v,q,z){for(var F=d(v,"particleCount",Y),_=d(v,"angle",Number),U=d(v,"spread",Number),Q=d(v,"startVelocity",Number),ve=d(v,"decay",Number),we=d(v,"gravity",Number),ye=d(v,"drift",Number),le=d(v,"colors",J),Se=d(v,"ticks",Number),de=d(v,"shapes"),Me=d(v,"scalar"),je=!!d(v,"flat"),ue=te(v),he=F,oe=[],Ce=t.width*ue.x,Ne=t.height*ue.y;he--;)oe.push(O({x:Ce,y:Ne,angle:_,spread:U,startVelocity:Q,color:le[he%le.length],shape:de[K(0,de.length)],ticks:Se,decay:ve,gravity:we,drift:ye,scalar:Me,flat:je}));return C?C.addFettis(oe):(C=ae(t,oe,x,q,z),C.promise)}function E(v){var q=m||d(v,"disableForReducedMotion",Boolean),z=d(v,"zIndex",Number);if(q&&N)return g(function(Q){Q()});a&&C?t=C.canvas:a&&!t&&(t=k(z),document.body.appendChild(t)),l&&!M&&x(t);var F={width:t.width,height:t.height};i&&!M&&i.init(t),M=!0,i&&(t.__confetti_initialized=!0);function _(){if(i){var Q={getBoundingClientRect:function(){if(!a)return t.getBoundingClientRect()}};x(Q),i.postMessage({resize:{width:Q.width,height:Q.height}});return}F.width=F.height=null}function U(){C=null,l&&(h=!1,n.removeEventListener("resize",_)),a&&t&&(document.body.contains(t)&&document.body.removeChild(t),t=null,M=!1)}return l&&!h&&(h=!0,n.addEventListener("resize",_,!1)),i?i.fire(v,F,U):T(v,F,U)}return E.reset=function(){i&&i.reset(),C&&C.reset()},E}var se;function ce(){return se||(se=H(null,{useWorker:!0,resize:!0})),se}function pe(t,e,a,l,h,m,p){var i=new Path2D(t),x=new Path2D;x.addPath(i,new DOMMatrix(e));var M=new Path2D;return M.addPath(x,new DOMMatrix([Math.cos(p)*h,Math.sin(p)*h,-Math.sin(p)*m,Math.cos(p)*m,a,l])),M}function xe(t){if(!u)throw new Error("path confetti are not supported in this browser");var e,a;typeof t=="string"?e=t:(e=t.path,a=t.matrix);var l=new Path2D(e),h=document.createElement("canvas"),m=h.getContext("2d");if(!a){for(var p=1e3,i=p,x=p,M=0,N=0,C,T,E=0;E<p;E+=2)for(var v=0;v<p;v+=2)m.isPointInPath(l,E,v,"nonzero")&&(i=Math.min(i,E),x=Math.min(x,v),M=Math.max(M,E),N=Math.max(N,v));C=M-i,T=N-x;var q=10,z=Math.min(q/C,q/T);a=[z,0,0,z,-Math.round(C/2+i)*z,-Math.round(T/2+x)*z]}return{type:"path",path:e,matrix:a}}function be(t){var e,a=1,l="#000000",h='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof t=="string"?e=t:(e=t.text,a="scalar"in t?t.scalar:a,h="fontFamily"in t?t.fontFamily:h,l="color"in t?t.color:l);var m=10*a,p=""+m+"px "+h,i=new OffscreenCanvas(m,m),x=i.getContext("2d");x.font=p;var M=x.measureText(e),N=Math.ceil(M.actualBoundingBoxRight+M.actualBoundingBoxLeft),C=Math.ceil(M.actualBoundingBoxAscent+M.actualBoundingBoxDescent),T=2,E=M.actualBoundingBoxLeft+T,v=M.actualBoundingBoxAscent+T;N+=T+T,C+=T+T,i=new OffscreenCanvas(N,C),x=i.getContext("2d"),x.font=p,x.fillStyle=l,x.fillText(e,E,v);var q=1/a;return{type:"bitmap",bitmap:i.transferToImageBitmap(),matrix:[q,0,0,q,-N*q/2,-C*q/2]}}s.exports=function(){return ce().apply(this,arguments)},s.exports.reset=function(){ce().reset()},s.exports.create=H,s.exports.shapeFromPath=xe,s.exports.shapeFromText=be})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),ie,!1);const Re=ie.exports;ie.exports.create;const Ae="quiz_analytics",ze=1,$="quizResults",W="topicPerformance",V="achievements",Z="studyStreak";class Fe{db=null;initPromise=null;async init(){return this.initPromise?this.initPromise:(this.initPromise=new Promise((n,s)=>{if(!window.indexedDB){console.warn("IndexedDB not supported"),s(new Error("IndexedDB not supported"));return}const c=indexedDB.open(Ae,ze);c.onerror=()=>{console.error("Failed to open quiz analytics database:",c.error),s(c.error)},c.onsuccess=()=>{this.db=c.result,console.log("âœ… Quiz analytics database initialized"),n()},c.onupgradeneeded=w=>{const r=w.target.result;if(!r.objectStoreNames.contains($)){const u=r.createObjectStore($,{keyPath:"id"});u.createIndex("timestamp","timestamp",{unique:!1}),u.createIndex("sourceSnippetId","sourceSnippetId",{unique:!1}),u.createIndex("sourceFeedItemId","sourceFeedItemId",{unique:!1}),u.createIndex("topics","topics",{unique:!1,multiEntry:!0}),u.createIndex("synced","synced",{unique:!1}),console.log("âœ… Quiz results store created")}if(!r.objectStoreNames.contains(W)){const u=r.createObjectStore(W,{keyPath:"topic"});u.createIndex("lastQuizDate","lastQuizDate",{unique:!1}),u.createIndex("averageScore","averageScore",{unique:!1}),console.log("âœ… Topic performance store created")}r.objectStoreNames.contains(V)||(r.createObjectStore(V,{keyPath:"id"}).createIndex("unlocked","unlocked",{unique:!1}),console.log("âœ… Achievements store created")),r.objectStoreNames.contains(Z)||(r.createObjectStore(Z,{keyPath:"id"}),console.log("âœ… Study streak store created"))}}),this.initPromise)}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const s=Math.random()*16|0;return(n==="x"?s:s&3|8).toString(16)})}getMidnightUTC(n){const s=new Date(n);return s.setUTCHours(0,0,0,0),s.getTime()}extractTopics(n,s){const c=new Set,w=["machine learning","ai","artificial intelligence","deep learning","python","javascript","typescript","java","c++","sql","react","angular","vue","node","express","aws","azure","cloud","docker","kubernetes","database","api","rest","graphql","algorithms","data structures","security","testing","frontend","backend","fullstack","devops"],r=(n+" "+s.map(u=>u.questionText).join(" ")).toLowerCase();for(const u of w)if(r.includes(u)){const f=u.split(" ").map(b=>b.charAt(0).toUpperCase()+b.slice(1)).join(" ");c.add(f)}return c.size===0&&c.add("General Knowledge"),Array.from(c)}calculateTrend(n,s){const c=n.filter(S=>S.topics.includes(s)).sort((S,y)=>S.timestamp-y.timestamp);if(c.length<3)return"stable";const w=Math.floor(c.length*2/3),r=c.slice(0,w),u=c.slice(w),f=r.reduce((S,y)=>S+y.score,0)/r.length,g=u.reduce((S,y)=>S+y.score,0)/u.length-f;return g>5?"improving":g<-5?"declining":"stable"}async updateStreak(n){if(await this.init(),!this.db)throw new Error("Database not initialized");const s=this.getMidnightUTC(n);return new Promise((c,w)=>{const u=this.db.transaction([Z],"readwrite").objectStore(Z),f=u.get(1);f.onsuccess=()=>{let b=f.result||{id:1,currentStreak:0,longestStreak:0,lastQuizDate:0,streakDates:[]};b.streakDates.includes(s)||(b.streakDates.push(s),b.streakDates.sort((P,R)=>P-R));let g=0;const S=[...b.streakDates].sort((P,R)=>R-P);for(let P=0;P<S.length;P++){const R=s-P*24*60*60*1e3;if(S[P]===R)g++;else break}b.currentStreak=g,b.longestStreak=Math.max(b.longestStreak,g),b.lastQuizDate=s;const y=u.put(b);y.onsuccess=()=>{console.log(`âœ… Streak updated: ${g} days`),c()},y.onerror=()=>w(y.error)},f.onerror=()=>w(f.error)})}async updateTopicPerformance(n){if(await this.init(),!this.db)throw new Error("Database not initialized");const s=await this.getQuizResults();return new Promise((c,w)=>{const u=this.db.transaction([W],"readwrite").objectStore(W);let f=0,b=!1;for(const g of n.topics){const S=u.get(g);S.onsuccess=()=>{const y=s.filter(I=>I.topics.includes(g)),P=y.flatMap(I=>I.questionStats.filter(d=>d.topic===g||I.topics.includes(g))),R={topic:g,quizzesTaken:y.length,questionsSeen:P.length,questionsCorrect:P.filter(I=>I.correct).length,averageScore:y.length>0?y.reduce((I,d)=>I+d.score,0)/y.length:0,bestScore:y.length>0?Math.max(...y.map(I=>I.score)):0,worstScore:y.length>0?Math.min(...y.map(I=>I.score)):0,lastQuizDate:n.timestamp,totalTimeSpent:y.reduce((I,d)=>I+d.timeSpent,0),trend:this.calculateTrend(s,g)},B=u.put(R);B.onsuccess=()=>{f++,f===n.topics.length&&!b&&c()},B.onerror=()=>{b||(b=!0,w(B.error))}},S.onerror=()=>{b||(b=!0,w(S.error))}}})}async saveQuizResult(n){if(await this.init(),!this.db)throw new Error("Database not initialized");const s=this.generateUUID(),c=this.extractTopics(n.title,n.questionStats),w=n.questionStats.map(u=>({...u,topic:c[0]})),r={...n,id:s,topics:c,questionStats:w,synced:!1};return new Promise((u,f)=>{const S=this.db.transaction([$],"readwrite").objectStore($).add(r);S.onsuccess=async()=>{console.log("âœ… Quiz analytics saved:",s),await this.updateTopicPerformance(r),await this.updateStreak(r.timestamp),u(s)},S.onerror=()=>{console.error("Failed to save quiz analytics:",S.error),f(S.error)}})}async getQuizResults(n){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((s,c)=>{const f=this.db.transaction([$],"readonly").objectStore($).index("timestamp").openCursor(null,"prev"),b=[];f.onsuccess=()=>{const g=f.result;g&&(!n||b.length<n)?(b.push(g.value),g.continue()):s(b)},f.onerror=()=>c(f.error)})}async getTopicPerformance(){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((n,s)=>{const r=this.db.transaction([W],"readonly").objectStore(W).getAll();r.onsuccess=()=>n(r.result),r.onerror=()=>s(r.error)})}async getStudyStreak(){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((n,s)=>{const r=this.db.transaction([Z],"readonly").objectStore(Z).get(1);r.onsuccess=()=>n(r.result||null),r.onerror=()=>s(r.error)})}async getAchievements(){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((n,s)=>{const r=this.db.transaction([V],"readonly").objectStore(V).getAll();r.onsuccess=()=>n(r.result),r.onerror=()=>s(r.error)})}async saveAchievements(n){if(await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((s,c)=>{const r=this.db.transaction([V],"readwrite").objectStore(V);let u=0,f=!1;for(const b of n){const g=r.put(b);g.onsuccess=()=>{u++,u===n.length&&!f&&s()},g.onerror=()=>{f||(f=!0,c(g.error))}}n.length===0&&s()})}async clearAllData(){if(await this.init(),!this.db)throw new Error("Database not initialized");const n=[$,W,V,Z];for(const s of n)await new Promise((c,w)=>{const f=this.db.transaction([s],"readwrite").objectStore(s).clear();f.onsuccess=()=>c(),f.onerror=()=>w(f.error)});console.log("âœ… All quiz analytics data cleared")}async exportToCSV(){const n=await this.getQuizResults(),s=["Quiz ID","Timestamp","Title","Topics","Total Questions","Correct Answers","Score (%)","Time Spent (s)","Start Time","End Time"],c=n.map(r=>[r.id,new Date(r.timestamp).toISOString(),r.title,r.topics.join("; "),r.totalQuestions.toString(),r.correctAnswers.toString(),r.score.toString(),Math.round(r.timeSpent/1e3).toString(),new Date(r.startTime).toISOString(),new Date(r.endTime).toISOString()]);return[s,...c].map(r=>r.map(u=>`"${u}"`).join(",")).join(`
`)}}const Oe=new Fe,_e=({quiz:D,onClose:n,onComplete:s})=>{const[c,w]=L.useState(0),[r,u]=L.useState(null),[f,b]=L.useState("question"),[g,S]=L.useState(0),[y,P]=L.useState([]),R=L.useRef(Date.now()),B=L.useRef(Date.now()),I=L.useRef([]),d=D.questions[c],Y=c+1,K=D.questions.length;L.useEffect(()=>{B.current=Date.now()},[c]);const G=j=>{if(f!=="question")return;u(j);const k=j===d.answerId;k&&S(g+1);const A={questionId:d.id,questionPrompt:d.prompt,selectedChoiceId:j,correctChoiceId:d.answerId,correct:k,explanation:d.explanation||""};P([...y,A]);const O=Date.now()-B.current,ne=d.choices.find(H=>H.id===j),ae=d.choices.find(H=>H.id===d.answerId);I.current.push({questionId:d.id,questionText:d.prompt,correct:k,timeSpent:O,attempts:1,selectedAnswer:ne?.text||"",correctAnswer:ae?.text||""}),b("answered")},J=async()=>{if(c<D.questions.length-1)w(c+1),u(null),b("question");else{b("completed");const j=Date.now(),k=j-R.current;try{await Oe.saveQuizResult({timestamp:j,title:D.title,totalQuestions:D.questions.length,correctAnswers:g,score:Math.round(g/D.questions.length*100),timeSpent:k,startTime:R.current,endTime:j,questionStats:I.current}),console.log("âœ… Quiz analytics saved")}catch(O){console.error("Failed to save quiz analytics:",O)}g/D.questions.length*100>=70&&Re({particleCount:100,spread:70,origin:{y:.6}}),s&&s(g,D.questions.length,y)}},ee=()=>{w(0),u(null),b("question"),S(0),P([]),R.current=Date.now(),B.current=Date.now(),I.current=[]},te=j=>{const k="w-full p-4 text-left rounded-lg border-2 transition-all duration-200";if(f==="question")return`${k} border-gray-300 hover:border-blue-400 hover:bg-blue-50 cursor-pointer`;const A=r===j.id,O=j.id===d.answerId;return O?`${k} border-green-500 bg-green-50 text-green-900`:A&&!O?`${k} border-red-500 bg-red-50 text-red-900`:`${k} border-gray-300 bg-gray-50 text-gray-500 cursor-not-allowed`},re=j=>{if(f==="question")return null;const k=r===j.id,A=j.id===d.answerId;return A?o.jsx(me,{className:"w-5 h-5 text-green-600"}):k&&!A?o.jsx(fe,{className:"w-5 h-5 text-red-600"}):null};if(f==="completed"){const j=Math.round(g/D.questions.length*100),k=j>=70;return o.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-2xl mx-auto",children:[o.jsxs("div",{className:"flex justify-between items-start mb-6",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Te,{className:`w-8 h-8 ${k?"text-yellow-500":"text-gray-400"}`}),o.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Quiz Complete!"})]}),o.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close quiz",children:o.jsx(ge,{className:"w-5 h-5 text-gray-600"})})]}),o.jsxs("div",{className:"text-center mb-8",children:[o.jsxs("div",{className:`text-6xl font-bold mb-2 ${k?"text-green-600":"text-orange-600"}`,children:[j,"%"]}),o.jsxs("div",{className:"text-xl text-gray-600 mb-4",children:[g," out of ",D.questions.length," correct"]}),o.jsx("div",{className:`text-lg font-semibold ${k?"text-green-600":"text-orange-600"}`,children:k?"ðŸŽ‰ Great job!":"ðŸ’ª Keep practicing!"})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Review"}),o.jsx("div",{className:"space-y-2",children:y.map((A,O)=>o.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg ${A.correct?"bg-green-50":"bg-red-50"}`,children:[A.correct?o.jsx(me,{className:"w-5 h-5 text-green-600 flex-shrink-0"}):o.jsx(fe,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),o.jsxs("span",{className:"text-sm text-gray-700",children:["Question ",O+1]})]},A.questionId))})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsxs("button",{onClick:ee,className:"flex-1 flex items-center justify-center gap-2 py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[o.jsx(De,{className:"w-4 h-4"}),"Retake Quiz"]}),o.jsx("button",{onClick:n,className:"flex-1 py-3 px-4 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Close"})]})]})}return o.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-2xl mx-auto",children:[o.jsxs("div",{className:"flex justify-between items-start mb-6",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(Ie,{className:"w-6 h-6 text-blue-600"}),o.jsx("h2",{className:"text-xl font-bold text-gray-800",children:D.title})]}),o.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[o.jsxs("span",{className:"font-medium",children:["Question ",Y," of ",K]}),o.jsxs("span",{children:["Score: ",g,"/",K]})]})]}),o.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Close quiz",children:o.jsx(ge,{className:"w-5 h-5 text-gray-600"})})]}),o.jsx("div",{className:"mb-6",children:o.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:`${Y/K*100}%`}})})}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:d.prompt}),o.jsx("div",{className:"space-y-3",children:d.choices.map(j=>o.jsx("button",{onClick:()=>G(j.id),disabled:f!=="question",className:te(j),children:o.jsxs("div",{className:"flex items-center justify-between gap-3",children:[o.jsx("span",{className:"flex-1 text-left",children:j.text}),re(j)]})},j.id))})]}),f==="answered"&&d.explanation&&o.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border-l-4 border-blue-500 rounded",children:[o.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"Explanation"}),o.jsx("p",{className:"text-blue-800 text-sm",children:d.explanation})]}),o.jsxs("div",{className:"flex gap-3",children:[f==="answered"&&o.jsx("button",{onClick:J,className:"flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:c<D.questions.length-1?"Next Question â†’":"Finish Quiz"}),o.jsx("button",{onClick:n,className:"py-3 px-4 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Quit"})]})]})};export{_e as Q};

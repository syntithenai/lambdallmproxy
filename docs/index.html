<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Search</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f4f9;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .form-container {
            background-color: #fff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        button {
            width: 100%;
            padding: 1rem;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .response-container {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: inherit;
            display: none;
            line-height: 1.6;
        }

        .response-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .response-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .loading {
            text-align: center;
            color: #6c757d;
            font-style: italic;
        }

        .advanced-toggle {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }

        .advanced-toggle label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: 500;
            color: #495057;
        }

        .advanced-toggle input[type="checkbox"] {
            margin-right: 8px;
        }

        .advanced-panel {
            margin: 15px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .advanced-panel h3 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 1.1em;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 8px;
        }

        .advanced-panel h3:not(:first-child) {
            margin-top: 25px;
        }

        .advanced-panel .form-group {
            margin-bottom: 20px;
        }

        .advanced-panel label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .advanced-panel textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
            resize: vertical;
            min-height: 60px;
            box-sizing: border-box;
        }

        .advanced-panel textarea:focus {
            outline: none;
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }

        /* Settings Dialog Styles */
        .settings-button {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .settings-button:hover {
            background: #0056b3;
        }

        .settings-dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
        }

        .settings-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #dee2e6;
        }

        .settings-header h2 {
            margin: 0;
            color: #333;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-button:hover {
            color: #333;
        }

        .settings-section {
            margin-bottom: 2rem;
        }

        .settings-section h3 {
            margin: 0 0 1rem 0;
            color: #555;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
        }
    </style>
</head>
<body>

<!-- Settings Button -->
<button class="settings-button" id="settings-btn" title="Settings">⚙️</button>

<!-- Settings Dialog -->
<div class="settings-dialog" id="settings-dialog">
    <div class="settings-content">
        <div class="settings-header">
            <h2>Settings</h2>
            <button class="close-button" id="close-settings">×</button>
        </div>
        
        <div class="settings-section">
            <h3>API Keys</h3>
            <div>
                <label for="openai_api_key">OpenAI API Key:</label>
                <div style="position: relative;">
                    <input type="text" id="openai_api_key" name="openai_api_key" placeholder="sk-...">
                    <small id="openai_api_key_status" style="color: #666; font-size: 0.85em; margin-top: 4px; display: block;"></small>
                    <button type="button" id="clear_openai_api_key" style="position: absolute; right: 8px; top: 8px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 4px 8px; font-size: 0.8em; color: #6c757d; cursor: pointer; display: none;" title="Clear saved API key">Clear</button>
                </div>
            </div>
            <div>
                <label for="groq_api_key">Groq API Key:</label>
                <div style="position: relative;">
                    <input type="text" id="groq_api_key" name="groq_api_key" placeholder="gsk_...">
                    <small id="groq_api_key_status" style="color: #666; font-size: 0.85em; margin-top: 4px; display: block;"></small>
                    <button type="button" id="clear_groq_api_key" style="position: absolute; right: 8px; top: 8px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 4px 8px; font-size: 0.8em; color: #6c757d; cursor: pointer; display: none;" title="Clear saved API key">Clear</button>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h3>Advanced Prompt Settings</h3>
            
            <div class="form-group">
                <label for="system-prompt-decision">Decision System Prompt:</label>
                <textarea id="system-prompt-decision" name="system_prompt_decision" rows="3" placeholder="System prompt for deciding whether to search or respond directly">You are a helpful assistant that determines whether a question can be answered directly or requires web search for fact-checking. Always respond with valid JSON only.</textarea>
            </div>

            <div class="form-group">
                <label for="system-prompt-direct">Direct Response System Prompt:</label>
                <textarea id="system-prompt-direct" name="system_prompt_direct" rows="3" placeholder="System prompt for direct responses">You are a helpful assistant. Answer the user's question directly based on your knowledge. Be comprehensive and informative.</textarea>
            </div>

            <div class="form-group">
                <label for="system-prompt-search">Search Response System Prompt:</label>
                <textarea id="system-prompt-search" name="system_prompt_search" rows="3" placeholder="System prompt for search-based responses">You are a helpful research assistant. Use the provided search results to answer questions comprehensively. Always cite specific sources using the URLs provided when making factual claims. Format your response in a clear, organized manner.</textarea>
            </div>

            <div class="form-group">
                <label for="decision-template">Decision Template:</label>
                <textarea id="decision-template" name="decision_template" rows="8" placeholder="Template for decision prompts (use {{QUERY}} as placeholder)">Analyze this question and determine if you can answer it directly or if it requires web search for fact-checking.

IMPORTANT: Respond ONLY with valid JSON in one of these formats:

For questions you can answer directly (general knowledge, explanations, creative tasks, personal advice):
{"response": "Your complete answer here"}

For questions requiring current facts, recent events, specific data, or verification:
{"search_terms": "optimized search terms here"}

Guidelines:
- Use search for: current events, recent developments, specific statistics, factual claims that need verification, breaking news, real-time information
- Answer directly for: general knowledge, explanations, creative writing, personal advice, theoretical concepts, historical facts (pre-2023)

Question: {{QUERY}}</textarea>
            </div>

            <div class="form-group">
                <label for="search-template">Search Template:</label>
                <textarea id="search-template" name="search_template" rows="6" placeholder="Template for search-based prompts">Based on the search results below, please provide a comprehensive answer to the user's question.

Search Results:
{{SEARCH_CONTEXT}}

User Question: {{QUERY}}

Please provide a detailed, well-structured response using the search results. Include relevant URLs when citing sources.</textarea>
            </div>
        </div>
    </div>
</div>

<div class="form-container">
    <h1>AI Search</h1> 
    <form id="llm-form">
        <input type="hidden" id="access_secret" name="access_secret" value="FUCKoffNOW2">
        <div>
            <label for="model">Model:</label>
            <select id="model" name="model" style="width: 100%; padding: 0.75rem; margin-bottom: 1rem; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1rem;">
                <optgroup label="Groq Models" id="groq-models">
                    <option value="groq:llama-3.1-8b-instant">Llama 3.1 8B Instant</option>
                    <option value="groq:llama-3.1-70b-versatile">Llama 3.1 70B Versatile</option>
                    <option value="groq:llama-3.1-405b-reasoning">Llama 3.1 405B Reasoning</option>
                    <option value="groq:mixtral-8x7b-32768">Mixtral 8x7B</option>
                </optgroup>
                <optgroup label="OpenAI Models" id="openai-models">
                    <option value="openai:gpt-5">GPT-5</option>
                    <option value="openai:gpt-5-mini">GPT-5 Mini</option>
                    <option value="openai:gpt-5-nano">GPT-5 Nano</option>
                </optgroup>
            </select>
        </div>
        <div>
            <label style="display: block; margin-bottom: 0.5rem; color: #555; font-weight: 500;">Search Mode:</label>
            <div style="margin-bottom: 1rem;">
                <label style="display: flex; align-items: center; margin-bottom: 0.5rem; font-weight: normal;">
                    <input type="radio" id="search_auto" name="search_mode" value="auto" checked style="margin-right: 0.5rem;">
                    <span>Auto Detect - Let AI decide whether to search</span>
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 0.5rem; font-weight: normal;">
                    <input type="radio" id="search_force" name="search_mode" value="search" style="margin-right: 0.5rem;">
                    <span>Use Search - Always search for current information</span>
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 0.5rem; font-weight: normal;">
                    <input type="radio" id="search_skip" name="search_mode" value="direct" style="margin-right: 0.5rem;">
                    <span>Skip Search - Answer directly without searching</span>
                </label>
            </div>
        </div>

        <div>
            <label for="prompt">Prompt:</label>
            <textarea id="prompt" name="prompt" required>how old is the first child of the king of spain</textarea>
        </div>
       
        <button type="submit" id="submit-btn">Send Request</button>
    </form>
    
    <div id="response-container" class="response-container">
        <!-- Response will be displayed here -->
    </div>
</div>

<script>
// Handle API key persistence and model selection
document.addEventListener('DOMContentLoaded', function() {
    // API key elements
    const openaiApiKeyInput = document.getElementById('openai_api_key');
    const groqApiKeyInput = document.getElementById('groq_api_key');
    const clearOpenaiButton = document.getElementById('clear_openai_api_key');
    const clearGroqButton = document.getElementById('clear_groq_api_key');
    const modelSelect = document.getElementById('model');
    
    // Settings dialog elements
    const settingsBtn = document.getElementById('settings-btn');
    const settingsDialog = document.getElementById('settings-dialog');
    const closeSettingsBtn = document.getElementById('close-settings');
    
    // Model groups
    const openaiModels = document.getElementById('openai-models');
    const groqModels = document.getElementById('groq-models');
    
    // Function to update API key status
    function updateApiKeyStatus(elementId, message, color = '#6c757d') {
        const statusElement = document.getElementById(elementId);
        statusElement.textContent = message;
        statusElement.style.color = color;
    }
    
    // Function to update model availability based on API keys
    function updateModelAvailability() {
        console.log('updateModelAvailability called');
        const hasOpenaiKey = openaiApiKeyInput.value.trim() && openaiApiKeyInput.value !== '{{OPENAI_API_KEY}}' && openaiApiKeyInput.value !== '';
        const hasGroqKey = groqApiKeyInput.value.trim() && groqApiKeyInput.value !== '{{GROQ_API_KEY}}' && groqApiKeyInput.value !== '';
        
        console.log('hasOpenaiKey:', hasOpenaiKey, 'hasGroqKey:', hasGroqKey);
        
        // Enable/disable individual options based on available API keys, but keep them visible
        const allOptions = modelSelect.querySelectorAll('option');
        let hasAvailableOptions = false;
        let firstAvailableOption = null;
        
        allOptions.forEach(option => {
            if (!option.value) {
                // Skip empty options
                return;
            }
            
            let shouldEnable = false;
            if (option.value.startsWith('openai:')) {
                shouldEnable = hasOpenaiKey;
                // Add visual indicator for disabled options
                option.textContent = option.textContent.replace(' (requires API key)', '');
                if (!shouldEnable) {
                    option.textContent += ' (requires API key)';
                }
            } else if (option.value.startsWith('groq:')) {
                shouldEnable = hasGroqKey;
                // Add visual indicator for disabled options
                option.textContent = option.textContent.replace(' (requires API key)', '');
                if (!shouldEnable) {
                    option.textContent += ' (requires API key)';
                }
            }
            
            option.disabled = !shouldEnable;
            // Keep all options visible, just disable unavailable ones
            option.style.display = '';
            
            if (shouldEnable) {
                hasAvailableOptions = true;
                if (!firstAvailableOption) {
                    firstAvailableOption = option;
                }
            }
        });
        
        // If no keys available, disable the entire selector
        if (!hasAvailableOptions) {
            modelSelect.disabled = true;
            console.log('No API keys available, disabling model select');
        } else {
            modelSelect.disabled = false;
            console.log('API keys available, enabling model select');
            
            // Check if current selection is still valid
            const currentOption = modelSelect.querySelector(`option[value="${modelSelect.value}"]`);
            if (!currentOption || currentOption.disabled) {
                // Set default model based on available API keys
                let defaultModel = null;
                
                // Priority 1: Groq llama instant if Groq key is available (and no OpenAI key)
                if (hasGroqKey) {
                    defaultModel = 'groq:llama-3.1-8b-instant';
                // Priority 2: OpenAI gpt-5-nano if OpenAI key is available
                } else if (hasOpenaiKey) {
                    defaultModel = 'openai:gpt-5-nano';
                }
                 
                
                // Apply default model if available, otherwise use first available option
                if (defaultModel && modelSelect.querySelector(`option[value="${defaultModel}"]`) && 
                    !modelSelect.querySelector(`option[value="${defaultModel}"]`).disabled) {
                    modelSelect.value = defaultModel;
                    console.log('Selected default model:', defaultModel);
                } else if (firstAvailableOption) {
                    modelSelect.value = firstAvailableOption.value;
                    console.log('Selected first available model:', firstAvailableOption.value);
                }
            }
        }
    }
    
    // Load saved API keys on page load
    const savedOpenaiApiKey = localStorage.getItem('openai_api_key');
    if (savedOpenaiApiKey) {
        openaiApiKeyInput.value = savedOpenaiApiKey;
        updateApiKeyStatus('openai_api_key_status', 'Loaded from local storage', '#28a745');
        clearOpenaiButton.style.display = 'block';
    }
    
    const savedGroqApiKey = localStorage.getItem('groq_api_key');
    if (savedGroqApiKey) {
        groqApiKeyInput.value = savedGroqApiKey;
        updateApiKeyStatus('groq_api_key_status', 'Loaded from local storage', '#28a745');
        clearGroqButton.style.display = 'block';
    }
    
    // Set initial default model based on available API keys
    function setInitialDefaultModel() {
        const hasOpenaiKey = savedOpenaiApiKey && savedOpenaiApiKey.trim() && savedOpenaiApiKey !== '{{OPENAI_API_KEY}}';
        const hasGroqKey = savedGroqApiKey && savedGroqApiKey.trim() && savedGroqApiKey !== '{{GROQ_API_KEY}}';
        
        // Only set default if no model is currently selected
        if (!modelSelect.value || modelSelect.value === '') {
            if (hasOpenaiKey) {
                modelSelect.value = 'openai:gpt-5-nano';
                console.log('Set initial default model to gpt-5-nano (OpenAI key available)');
            } else if (hasGroqKey) {
                modelSelect.value = 'groq:llama-3.1-8b-instant';
                console.log('Set initial default model to llama-3.1-8b-instant (Groq key available)');
            }
        }
    }
    
    // Update model availability on initial load
    updateModelAvailability();
    
    // Set initial default model
    setInitialDefaultModel();
    
    // Also call it after a small delay to ensure localStorage values are set
    setTimeout(updateModelAvailability, 100);
    
    // Save OpenAI API key when it changes
    openaiApiKeyInput.addEventListener('input', function() {
        const apiKey = this.value.trim();
        if (apiKey && apiKey !== '{{OPENAI_API_KEY}}') {
            localStorage.setItem('openai_api_key', apiKey);
            updateApiKeyStatus('openai_api_key_status', 'Saved to local storage', '#28a745');
            clearOpenaiButton.style.display = 'block';
        } else if (!apiKey) {
            updateApiKeyStatus('openai_api_key_status', '');
            clearOpenaiButton.style.display = 'none';
        }
        updateModelAvailability();
    });
    
    // Save Groq API key when it changes
    groqApiKeyInput.addEventListener('input', function() {
        const apiKey = this.value.trim();
        if (apiKey && apiKey !== '{{GROQ_API_KEY}}') {
            localStorage.setItem('groq_api_key', apiKey);
            updateApiKeyStatus('groq_api_key_status', 'Saved to local storage', '#28a745');
            clearGroqButton.style.display = 'block';
        } else if (!apiKey) {
            updateApiKeyStatus('groq_api_key_status', '');
            clearGroqButton.style.display = 'none';
        }
        updateModelAvailability();
    });
    
    // Handle clear OpenAI button
    clearOpenaiButton.addEventListener('click', function() {
        localStorage.removeItem('openai_api_key');
        openaiApiKeyInput.value = '{{OPENAI_API_KEY}}';
        updateApiKeyStatus('openai_api_key_status', 'Cleared from local storage', '#dc3545');
        clearOpenaiButton.style.display = 'none';
        updateModelAvailability();
        setTimeout(() => {
            updateApiKeyStatus('openai_api_key_status', '');
        }, 3000);
    });
    
    // Handle clear Groq button
    clearGroqButton.addEventListener('click', function() {
        localStorage.removeItem('groq_api_key');
        groqApiKeyInput.value = '{{GROQ_API_KEY}}';
        updateApiKeyStatus('groq_api_key_status', 'Cleared from local storage', '#dc3545');
        clearGroqButton.style.display = 'none';
        updateModelAvailability();
        setTimeout(() => {
            updateApiKeyStatus('groq_api_key_status', '');
        }, 3000);
    });
    
    // Settings dialog functionality
    function openSettings() {
        settingsDialog.style.display = 'block';
    }
    
    function closeSettings() {
        settingsDialog.style.display = 'none';
    }
    
    // Check if API keys are available, open settings if not
    function checkInitialSettings() {
        const hasOpenaiKey = localStorage.getItem('openai_api_key');
        const hasGroqKey = localStorage.getItem('groq_api_key');
        
        // Open settings dialog by default if no API keys are set
        if (!hasOpenaiKey && !hasGroqKey) {
            openSettings();
        }
    }
    
    // Settings button event listeners
    settingsBtn.addEventListener('click', openSettings);
    closeSettingsBtn.addEventListener('click', closeSettings);
    
    // Close dialog when clicking outside
    settingsDialog.addEventListener('click', function(e) {
        if (e.target === settingsDialog) {
            closeSettings();
        }
    });
    
    // Close dialog with escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && settingsDialog.style.display === 'block') {
            closeSettings();
        }
    });
    
    // Check initial settings after everything is loaded
    checkInitialSettings();
});

document.getElementById('llm-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('submit-btn');
    const responseContainer = document.getElementById('response-container');
    
    // Disable submit button and show loading state
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';
    
    // Show loading message
    responseContainer.className = 'response-container loading';
    responseContainer.style.display = 'block';
    responseContainer.textContent = 'Sending request to Lambda function...';
    
    // Get the selected model to determine which API key to use
    const selectedModel = document.getElementById('model').value;
    const isGroqModel = selectedModel.startsWith('groq:');
    const isOpenaiModel = selectedModel.startsWith('openai:');
    
    // Get the appropriate API key
    let apiKey;
    if (isGroqModel) {
        apiKey = document.getElementById('groq_api_key').value;
        if (apiKey === '{{GROQ_API_KEY}}') apiKey = '';
    } else if (isOpenaiModel) {
        apiKey = document.getElementById('openai_api_key').value;
        if (apiKey === '{{OPENAI_API_KEY}}') apiKey = '';
    }
    
    // Validate API key
    if (!apiKey || !apiKey.trim()) {
        responseContainer.className = 'response-container response-error';
        responseContainer.textContent = `Error: No API key provided for ${isGroqModel ? 'Groq' : 'OpenAI'} models.`;
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Request';
        return;
    }
    
    // Collect form data
    const searchMode = document.querySelector('input[name="search_mode"]:checked').value;
    const formData = {
        api_key: apiKey,
        model: selectedModel,
        query: document.getElementById('prompt').value,
        access_secret: document.getElementById('access_secret').value,
        search_mode: searchMode
    };

    // Include advanced settings if they have values
    const advancedFields = [
        'system_prompt_decision',
        'system_prompt_direct', 
        'system_prompt_search',
        'decision_template',
        'search_template'
    ];

    advancedFields.forEach(field => {
        const element = document.getElementById(field.replace('_', '-'));
        if (element && element.value && element.value.trim()) {
            formData[field] = element.value;
        }
    });

    // Set a reasonable default timeout (60 seconds)
    const timeoutMs = 60000;

    // Create an AbortController for timeout handling
    const controller = new AbortController();
    const timeoutId = setTimeout(() => {
        controller.abort();
    }, timeoutMs);
    
    try {
        console.log('Sending request to:', 'https://nrw7pperjjdswbmqgmigbwsbyi0rwdqf.lambda-url.us-east-1.on.aws/');
        console.log('Request data:', formData);
        
        // Update loading message
        responseContainer.textContent = 'Sending request to Lambda function...';
        
        const response = await fetch('https://nrw7pperjjdswbmqgmigbwsbyi0rwdqf.lambda-url.us-east-1.on.aws/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
            mode: 'cors',
            credentials: 'omit',
            signal: controller.signal // Add timeout signal
        });
        
        // Clear the timeout since we got a response
        clearTimeout(timeoutId);
        
        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers);
        
        const responseData = await response.text();
        console.log('Response data:', responseData);
        
        if (response.ok) {
            // Success response - parse JSON and extract just the answer
            try {
                const jsonData = JSON.parse(responseData);
                const answer = jsonData.answer || 'No answer found in response';
                
                responseContainer.className = 'response-container response-success';
                responseContainer.style.fontFamily = 'inherit'; // Use normal font instead of monospace
                responseContainer.textContent = answer;
            } catch (parseError) {
                // If JSON parsing fails, show the raw response
                responseContainer.className = 'response-container response-success';
                responseContainer.textContent = `Success (${response.status}):\n\n${responseData}`;
            }
        } else {
            // Error response from server
            responseContainer.className = 'response-container response-error';
            responseContainer.style.fontFamily = 'monospace'; // Keep monospace for error details
            responseContainer.textContent = `Error (${response.status}):\n\n${responseData}`;
        }
    } catch (error) {
        // Clear the timeout in case of other errors
        clearTimeout(timeoutId);
        
        // Network or other errors
        console.error('Request error:', error);
        
        responseContainer.className = 'response-container response-error';
        
        if (error.name === 'AbortError') {
            // Request was aborted due to timeout
            responseContainer.textContent = `Request Timeout Error:\n\nThe request timed out after 60 seconds. The Lambda function may be taking longer than expected to process your request.\n\nYou can try:\n- Simplifying your query\n- Checking if the Lambda function is running properly\n- Trying again in a moment`;
        } else {
            // Other network or fetch errors
            responseContainer.textContent = `Network Error:\n\n${error.message}\n\nCheck browser console for more details.`;
        }
    } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Request';
    }
});
</script>

</body>
</html>
